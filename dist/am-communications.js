/*! layer-websdk - v3.2.3 - 2017-05-04 */ !function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.layer=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(c){"use strict";c.layer&&c.layer.Client?console.error("ERROR: It appears that you have multiple copies of the Layer WebSDK in your build!"):c.layer=a("./src/layer"),b.exports=c.layer}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/layer":15}],2:[function(b,c,d){!function(){function b(){return{keys:Object.keys||function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("keys() called on a non-object");var b,c=[];for(b in a)a.hasOwnProperty(b)&&(c[c.length]=b);return c},uniqueId:function(a){var b=++j+"";return a?a+b:b},has:function(a,b){return h.call(a,b)},each:function(a,b,c){if(null!=a)if(g&&a.forEach===g)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,e=a.length;d<e;d++)b.call(c,a[d],d,a);else for(var f in a)this.has(a,f)&&b.call(c,a[f],f,a)},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}}}var e,f=this,g=Array.prototype.forEach,h=Object.prototype.hasOwnProperty,i=Array.prototype.slice,j=0,k=b();e={on:function(a,b,c){if(!m(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!m(this,"once",a,[b,c])||!b)return this;var d=this,e=k.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,h,i,j,l;if(!this._events||!m(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:k.keys(this._events),h=0,i=g.length;h<i;h++)if(a=g[h],f=this._events[a]){if(this._events[a]=d=[],b||c)for(j=0,l=f.length;j<l;j++)e=f[j],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=i.call(arguments,1);if(!m(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&n(c,b),d&&n(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}};var l=/\s+/,m=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(l.test(c)){for(var f=c.split(l),g=0,h=f.length;g<h;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},n=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},o={listenTo:"on",listenToOnce:"once"};k.each(o,function(a,b){e[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=k.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),e.bind=e.on,e.unbind=e.off,e.mixin=function(a){var b=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return k.each(b,function(b){a[b]=this[b]},this),a},"undefined"!=typeof d?("undefined"!=typeof c&&c.exports&&(d=c.exports=e),d.BackboneEvents=e):"function"==typeof a&&"object"==typeof a.amd?a(function(){return e}):f.BackboneEvents=e}(this)},{}],3:[function(a,b,c){},{}],4:[function(a,b,c){!function(){function a(a){return this.camelCase=a.camelCase,this.propertyNameMap=a.propertyNameMap,this.changeCallbacks=a.changeCallbacks,this.abortCallbacks=a.abortCallbacks,this.getObjectCallback=a.getObjectCallback,this.createObjectCallback=a.createObjectCallback,this.doesObjectMatchIdCallback=a.doesObjectMatchIdCallback||function(a,b){return b.id==a},this.returnIds=a.returnIds,this}function c(a,b,c){this.changeCallbacks&&c&&this.changeCallbacks[c]&&Object.keys(a).forEach(function(d){this.changeCallbacks[c].all?this.changeCallbacks[c].all(b,b[d],a[d].before,a[d].paths):this.changeCallbacks[c][d]&&this.changeCallbacks[c][d](b,b[d],a[d].before,a[d].paths)},this)}function d(a,b,c,d){var e=b.object,f=String.fromCharCode(145);a=a.replace(/\\\./g,f),a=a.replace(/\\(.)/g,"$1");var h=a.split(/\./),i=new RegExp(f,"g");if(h=h.map(function(a){return a.replace(i,".")}),this.camelCase&&(h[0]=h[0].replace(/[-_]./g,function(a){return a[1].toUpperCase()})),this.propertyNameMap){var j=this.propertyNameMap[b.type];h[0]=j&&j[h[0]]||h[0]}g.apply(this,[{baseName:h[0],fullPath:a,object:b.object,options:b,changes:c,operation:d}]);for(var k=e,l=0;l<h.length-1;l++){var m=h[l];if(m in k){if(k=k[m],null===k||"object"!=typeof k)throw new Error("Can not access property '"+a+"'")}else k[m]={},k=k[m]}return{pointer:k,lastName:h[h.length-1],baseName:h[0],fullPath:a,abortHandler:this.abortCallbacks&&this.abortCallbacks[b.type]&&(this.abortCallbacks[b.type].all||this.abortCallbacks[b.type][h[0]])}}function e(a,b){if(a.id){if(!this.getObjectCallback)throw new Error("Must provide getObjectCallback in constructor to use ids");var c=this.getObjectCallback(a.id);return!c&&a.value&&(c=this.createObjectCallback?this.createObjectCallback(a.id,a.value):a.value),c?c:this.returnIds?a.id:null}return a.value}function f(a){if(Array.isArray(a))return a.map(function(a){return f(a)});if(a instanceof Date)return new Date(a);if(a&&"object"==typeof a){var b=Object.keys(a).filter(function(a){return 0!==a.indexOf("_")}),c={};return b.forEach(function(b){c[b]=f(a[b])}),c}return a}function g(a){if(!a.changes[a.baseName]){var b=a.object[a.baseName];("set"===a.operation||"delete"===a.operation)&&"id"in a.operation&&b&&(b=b.id);var c=a.changes[a.baseName]={paths:[]};c.before=b&&"object"==typeof b?f(b):b}var d=a.changes[a.baseName].paths;d.indexOf(a.fullPath)===-1&&d.push(a.fullPath)}function h(a,b,c,d,e){a.abortHandler&&a.abortHandler(a.fullPath,"set",b)||(a.pointer[a.lastName]=b)}function i(a,b,c,d,e){a.abortHandler&&a.abortHandler(a.fullPath,"delete",b)||delete a.pointer[a.lastName]}function j(a,b,c,d,e){if(!a.abortHandler||!a.abortHandler(a.fullPath,"add",b)){var f;if(f=a.lastName in a.pointer?a.pointer[a.lastName]:a.pointer[a.lastName]=[],!Array.isArray(f))throw new Error("The add operation requires an array or new structure to add to.");if(Array.isArray(b))throw new Error("The add operation will not add arrays to sets.");if(c.id){for(var g=0;g<f.length;g++)if(this.doesObjectMatchIdCallback(c.id,f[g]))return;f.push(b)}else{if(b&&"object"==typeof b)throw new Error("The add operation will not add objects to sets.");f.indexOf(b)===-1&&f.push(b)}}}function k(a,b,c,d,e){if(!a.abortHandler||!a.abortHandler(a.fullPath,"remove",b)){var f;if(f=a.lastName in a.pointer?a.pointer[a.lastName]:a.pointer[a.lastName]=[],!Array.isArray(f))throw new Error("The remove operation requires an array or new structure to remove from.");if(c.id){for(var g=0;g<f.length;g++)if(this.doesObjectMatchIdCallback(c.id,f[g])){f.splice(g,1);break}}else{if(Array.isArray(b))throw new Error("The remove operation will not remove arrays from sets.");if(b&&"object"==typeof b)throw new Error("The remove operation will not remove objects from sets.");var h=f.indexOf(b);h!==-1&&f.splice(h,1)}}}var l={set:h,delete:i,add:j,remove:k};"undefined"!=typeof b?b.exports=a:window.LayerPatchParser=a,a.prototype.parse=function(a){var b={};a.operations.forEach(function(c){var f=d.apply(this,[c.property,a,b,c]);l[c.operation].call(this,f,e.apply(this,[c,a]),c,a,b)},this),c.apply(this,[b,a.object,a.type])}}()},{}],5:[function(a,b,c){(function(a){var c;if(a.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);c=function(){return crypto.getRandomValues(d),d}}if(!c){var e=new Array(16);c=function(){for(var a,b=0;b<16;b++)0===(3&b)&&(a=4294967296*Math.random()),e[b]=a>>>((3&b)<<3)&255;return e}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(a,b,c){function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=j[a])});e<16;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=i;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:n,h=void 0!==a.msecs?a.msecs:(new Date).getTime(),i=void 0!==a.nsecs?a.nsecs:p+1,j=h-o+(i-p)/1e4;if(j<0&&void 0===a.clockseq&&(g=g+1&16383),(j<0||h>o)&&void 0===a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=h,p=i,n=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var q=a.node||m,r=0;r<6;r++)f[d+r]=q[r];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;g<16;g++)b[d+g]=f[g];return b||e(f)}for(var h=a("./rng"),i=[],j={},k=0;k<256;k++)i[k]=(k+256).toString(16).substr(1),j[i[k]]=k;var l=h(),m=[1|l[0],l[1],l[2],l[3],l[4],l[5]],n=16383&(l[6]<<8|l[7]),o=0,p=0,q=g;q.v1=f,q.v4=g,q.parse=d,q.unparse=e,b.exports=q},{"./rng":5}],7:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./xhr"),j=a("./root"),k=a("./websockets/socket-manager"),l=a("./websockets/change-manager"),m=a("./websockets/request-manager"),n=a("./layer-error"),o=a("./online-state-manager"),p=a("./sync-manager"),q=a("./db-manager"),r=a("./models/identity"),s=a("./sync-event"),t=s.XHRSyncEvent,u=s.WebsocketSyncEvent,v=a("./const"),w=v.ACCEPT,x=v.LOCALSTORAGE_KEYS,y=a("./logger"),z=a("./client-utils"),A=3,B=function(a){function b(a){if(d(this,b),!a.appId)throw new Error(n.dictionary.appIdMissing);return e(this,Object.getPrototypeOf(b).call(this,a))}return f(b,a),h(b,[{key:"_initComponents",value:function(){this.socketManager=new k({client:this}),this.socketChangeManager=new l({client:this,socketManager:this.socketManager}),this.socketRequestManager=new m({client:this,socketManager:this.socketManager}),this.onlineManager=new o({socketManager:this.socketManager,connected:this._handleOnlineChange.bind(this),disconnected:this._handleOnlineChange.bind(this)}),this.syncManager=new p({onlineManager:this.onlineManager,socketManager:this.socketManager,requestManager:this.socketRequestManager,client:this})}},{key:"_destroyComponents",value:function(){this.syncManager.destroy(),this.onlineManager.destroy(),this.socketManager.destroy(),this.socketChangeManager.destroy(),this.socketRequestManager.destroy(),this.dbManager&&this.dbManager.destroy()}},{key:"_isPersistedSessionsDisabled",value:function(){return!c.localStorage||this.persistenceFeatures&&!this.persistenceFeatures.sessionToken}},{key:"_restoreLastSession",value:function(){if(!this._isPersistedSessionsDisabled())try{var a=c.localStorage[x.SESSIONDATA+this.appId];if(!a)return;var b=JSON.parse(a);b.expires<Date.now()?c.localStorage.removeItem(x.SESSIONDATA+this.appId):this.sessionToken=b.sessionToken}catch(a){}}},{key:"_restoreLastUser",value:function(){try{var a=c.localStorage[x.SESSIONDATA+this.appId];if(!a)return null;var b=JSON.parse(a).user;return new r({clientId:this.appId,sessionOwner:!0,fromServer:b})}catch(a){return null}}},{key:"_hasUserIdChanged",value:function(a){try{var b=c.localStorage[x.SESSIONDATA+this.appId];return!b||JSON.parse(b).user.user_id!==a}catch(a){return!0}}},{key:"_connect",value:function(){var a=this;this.xhr({url:"/nonces",method:"POST",sync:!1},function(b){return a._connectionResponse(b)})}},{key:"connect",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],b=void 0;return this.isConnected=!1,this._lastChallengeTime=0,this._wantsToBeAuthenticated=!0,this.user=null,this.onlineManager.start(),this.isTrustedDevice&&a&&!this._isPersistedSessionsDisabled()&&!this._hasUserIdChanged(a)||this._clearStoredData(),this.isTrustedDevice&&a&&(this._restoreLastSession(a),b=this._restoreLastUser(),b&&(this.user=b)),this.user||(this.user=new r({userId:a,sessionOwner:!0,clientId:this.appId,id:a?r.prefixUUID+encodeURIComponent(a):""})),this.sessionToken&&this.user.userId?this._sessionTokenRestored():this._connect(),this}},{key:"connectWithSession",value:function(a,b){var c=this,d=void 0;if(this.isConnected=!1,this.user=null,this._lastChallengeTime=0,this._wantsToBeAuthenticated=!0,!a||!b)throw new Error(n.dictionary.sessionAndUserRequired);return(!this.isTrustedDevice||this._isPersistedSessionsDisabled()||this._hasUserIdChanged(a))&&this._clearStoredData(),this.isTrustedDevice&&(d=this._restoreLastUser(),d&&(this.user=d)),this.onlineManager.start(),this.user||(this.user=new r({userId:a,sessionOwner:!0,clientId:this.appId,id:r.prefixUUID+encodeURIComponent(a)})),this.isConnected=!0,setTimeout(function(){return c._authComplete({session_token:b},!1)},1),this}},{key:"_connectionResponse",value:function(a){a.success?this._connectionComplete(a.data):this._connectionError(a.data)}},{key:"_connectionComplete",value:function(a){this.isConnected=!0,this.trigger("connected"),this._authenticate(a.nonce)}},{key:"_connectionError",value:function(a){this.trigger("connected-error",{error:a})}},{key:"_authenticate",value:function(a){this._lastChallengeTime=Date.now(),a&&this.trigger("challenge",{nonce:a,callback:this.answerAuthenticationChallenge.bind(this)})}},{key:"answerAuthenticationChallenge",value:function(a){var b=this;if(!a)throw new Error(n.dictionary.identityTokenMissing);var c=z.decode(a.split(".")[1]),d=JSON.parse(c);if(!d.prn)throw new Error("Your identity token prn (user id) is empty");if(this.user.userId&&this.user.userId!==d.prn)throw new Error(n.dictionary.invalidUserIdChange);this.user._setUserId(d.prn),d.display_name&&(this.user.displayName=d.display_name),d.avatar_url&&(this.user.avatarUrl=d.avatar_url),this.xhr({url:"/sessions",method:"POST",sync:!1,data:{identity_token:a,app_id:this.appId}},function(c){return b._authResponse(c,a)})}},{key:"_authResponse",value:function(a,b){a.success?this._authComplete(a.data,!1):this._authError(a.data,b)}},{key:"_authComplete",value:function(a,b){if(!a||!a.session_token)throw new Error(n.dictionary.sessionTokenMissing);if(this.sessionToken=a.session_token,!this._isPersistedSessionsDisabled()&&!b)try{c.localStorage[x.SESSIONDATA+this.appId]=JSON.stringify({sessionToken:this.sessionToken||"",user:q.prototype._getIdentityData([this.user],!0)[0],expires:Date.now()+2592e6})}catch(a){}this._clientAuthenticated()}},{key:"_authError",value:function(a,b){this.trigger("authenticated-error",{error:a})}},{key:"_sessionTokenRestored",value:function(){this.isConnected=!0,this.trigger("connected"),this._clientAuthenticated()}},{key:"_clientAuthenticated",value:function(){var a=this;if(this.isAuthenticated=!0,this.trigger("authenticated"),this.isTrustedDevice||(this.isPersistenceEnabled=!1),!this.persistenceFeatures||!this.isPersistenceEnabled){var b=void 0;b=this.persistenceFeatures&&"sessionToken"in this.persistenceFeatures?Boolean(this.persistenceFeatures.sessionToken):this.isTrustedDevice,this.persistenceFeatures={conversations:this.isPersistenceEnabled,channels:this.isPersistenceEnabled,messages:this.isPersistenceEnabled,identities:this.isPersistenceEnabled,syncQueue:this.isPersistenceEnabled,sessionToken:b}}this.dbManager||(this.dbManager=new q({client:this,tables:this.persistenceFeatures,enabled:this.isPersistenceEnabled})),this.isPersistenceEnabled?this.dbManager.onOpen(function(){return a._loadUser()}):this._loadUser()}},{key:"_loadUser",value:function(){var a=this;this.user.isFullIdentity?this._clientReady():(this.user._load(),this.user.once("identities:loaded",function(){a._isPersistedSessionsDisabled()||(a._writeSessionOwner(),a.user.on("identities:change",a._writeSessionOwner,a)),a._clientReady()}).once("identities:loaded-error",function(){a.user.displayName||(a.user.displayName=a.defaultOwnerDisplayName),a._clientReady()}))}},{key:"_writeSessionOwner",value:function(){try{var a=JSON.parse(c.localStorage[x.SESSIONDATA+this.appId]);a.user=q.prototype._getIdentityData([this.user])[0],c.localStorage[x.SESSIONDATA+this.appId]=JSON.stringify(a)}catch(a){}}},{key:"_clientReady",value:function(){this.isReady||(this.isReady=!0,this.trigger("ready"))}},{key:"logout",value:function(a){this._wantsToBeAuthenticated=!1;var b=1,c=0;return this.isAuthenticated&&(b++,this.xhr({method:"DELETE",url:"/sessions/"+escape(this.sessionToken),sync:!1},function(){c++,c===b&&a&&a()})),this._clearStoredData(function(){c++,c===b&&a&&a()}),this._resetSession(),this}},{key:"_clearStoredData",value:function(a){c.localStorage&&localStorage.removeItem(x.SESSIONDATA+this.appId),this.dbManager?this.dbManager.deleteTables(a):a&&a()}},{key:"_resetSession",value:function(){this.isReady=!1,this.isConnected=!1,this.isAuthenticated=!1,this.sessionToken&&(this.sessionToken="",c.localStorage&&localStorage.removeItem(x.SESSIONDATA+this.appId)),this.trigger("deauthenticated"),this.onlineManager.stop()}},{key:"registerIOSPushToken",value:function(a,b){this.xhr({url:"push_tokens",method:"POST",sync:!1,data:{token:a.token,type:"apns",device_id:a.deviceId,ios_version:a.iosVersion,apns_bundle_id:a.bundleId}},function(a){return b(a.data)})}},{key:"registerAndroidPushToken",value:function(a,b){this.xhr({url:"push_tokens",method:"POST",sync:!1,data:{token:a.token,type:"gcm",device_id:a.deviceId,gcm_sender_id:a.senderId}},function(a){return b(a.data)})}},{key:"unregisterPushToken",value:function(a,b){this.xhr({url:"push_tokens/"+a,method:"DELETE"},function(a){return b(a.data)})}},{key:"__adjustAppId",value:function(){if(this.isConnected)throw new Error(n.dictionary.cantChangeIfConnected)}},{key:"__adjustUser",value:function(a){if(this.isConnected)throw new Error(n.dictionary.cantChangeIfConnected)}},{key:"_addIdentity",value:function(a){}},{key:"_removeIdentity",value:function(a){}},{key:"sendSocketRequest",value:function(a,b){var c=Boolean(a.isChangesArray);if(this._wantsToBeAuthenticated&&!this.isAuthenticated&&this._connect(),a.sync){var d=a.sync.target,e=a.sync.depends;d&&!e&&(e=[d]),this.syncManager.request(new u({data:a.body,operation:a.method,returnChangesArray:c,target:d,depends:e,callback:b}))}else"function"==typeof a.data&&(a.data=a.data()),this.socketRequestManager.sendRequest({data:a,isChangesArray:c,callback:b})}},{key:"_handleOnlineChange",value:function(a){if(this._wantsToBeAuthenticated){var c=a.offlineDuration,d="connected"===a.eventName,e={isOnline:d};d&&(e.reset=c>b.ResetAfterOfflineDuration,this.isAuthenticated||this._connect()),this.trigger("online",e)}}},{key:"xhr",value:function(a,b){return a.sync&&a.sync.target||(a.url=this._xhrFixRelativeUrls(a.url||"")),a.withCredentials=!0,a.method||(a.method="GET"),a.headers||(a.headers={}),this._xhrFixHeaders(a.headers),this._xhrFixAuth(a.headers),a.sync===!1?this._nonsyncXhr(a,b,0):this._syncXhr(a,b),this}},{key:"_syncXhr",value:function(a,b){var c=this;a.sync||(a.sync={}),this._wantsToBeAuthenticated&&!this.isAuthenticated&&this._connect();var d=function(a){c._xhrResult(a,b)},e=a.sync.target,f=a.sync.depends;e&&!f&&(f=[e]),this.syncManager.request(new t({url:a.url,data:a.data,method:a.method,operation:a.sync.operation||a.method,headers:a.headers,callback:d,target:e,depends:f}))}},{key:"_nonsyncXhr",value:function(a,b,c){var d=this;i(a,function(e){[502,503,504].indexOf(e.status)!==-1&&c<A?setTimeout(function(){return d._nonsyncXhr(a,b,c+1)},1e3):d._xhrResult(e,b)})}},{key:"_xhrFixAuth",value:function(a){this.sessionToken&&!a.Authorization&&(a.authorization='Layer session-token="'+this.sessionToken+'"')}},{key:"_xhrFixRelativeUrls",value:function(a){var b=a;return a.indexOf("https://")===-1&&(b="/"===a[0]?this.url+a:this.url+"/"+a),b}},{key:"_xhrFixHeaders",value:function(a){var b=Object.keys(a);b.forEach(function(b){b!==b.toLowerCase()&&(a[b.toLowerCase()]=a[b],delete a[b])}),a.accept||(a.accept=w),a["content-type"]||(a["content-type"]="application/json")}},{key:"_xhrResult",value:function(a,d){this.isDestroyed||(a.success||(a.data&&"object"===g(a.data)&&this._generateError(a),401===a.status&&this._wantsToBeAuthenticated&&(this.isAuthenticated?(y.warn("SESSION EXPIRED!"),this.isAuthenticated=!1,this.isReady=!1,c.localStorage&&localStorage.removeItem(x.SESSIONDATA+this.appId),this.trigger("deauthenticated"),this._authenticate(a.data.getNonce())):this._lastChallengeTime>Date.now()+b.TimeBetweenReauths&&this._authenticate(a.data.getNonce()))),d&&d(a))}},{key:"_generateError",value:function(a){a.data=new n(a.data),a.data.httpStatus||(a.data.httpStatus=a.status),a.data.log()}}]),b}(j);B.prototype.isAuthenticated=!1,B.prototype.isConnected=!1,B.prototype.isReady=!1,B.prototype._wantsToBeAuthenticated=!1,B.prototype.isPresenceEnabled=!0,B.prototype.appId="",B.prototype.user=null,B.prototype.sessionToken="",B.prototype._lastChallengeTime=0,B.prototype.url="https://api.layer.com",B.prototype.websocketUrl="wss://websockets.layer.com",B.prototype.socketManager=null,B.prototype.socketRequestManager=null,B.prototype.socketChangeManager=null,B.prototype.syncManager=null,B.prototype.onlineManager=null,B.prototype.isTrustedDevice=!1,B.prototype.isPersistenceEnabled=!1,B.prototype.persistenceFeatures=null,B.prototype.dbManager=null,B.prototype.defaultOwnerDisplayName="You",Object.defineProperty(B.prototype,"isOnline",{enumerable:!0,get:function(){return this.onlineManager&&this.onlineManager.isOnline}}),Object.defineProperty(B.prototype,"logLevel",{enumerable:!1,get:function(){return y.level},set:function(a){y.level=a}}),Object.defineProperty(B.prototype,"userId",{enumerable:!0,get:function(){return this.user?this.user.userId:""},set:function(){}}),B.ResetAfterOfflineDuration=108e6,B.TimeBetweenReauths=3e4,B._supportedEvents=["ready","connected","connected-error","authenticated","authenticated-error","deauthenticated","challenge","session-terminated","online"].concat(j._supportedEvents),j.initClass.apply(B,[B,"ClientAuthenticator"]),b.exports=B}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./client-utils":9,"./const":11,"./db-manager":12,"./layer-error":13,"./logger":16,"./models/identity":30,"./online-state-manager":35,"./root":44,"./sync-event":45,"./sync-manager":46,"./websockets/change-manager":53,"./websockets/request-manager":54,"./websockets/socket-manager":55,"./xhr":56}],8:[function(a,b,c){"use strict";function d(a){var b=a.appId;k[b]&&!k[b].isDestroyed&&k[b].destroy(),k[b]=a,(0,j.defer)(function(){return l.forEach(function(b){return b(a)})})}function e(a){k[a.appId]&&delete k[a.appId]}function f(a){return k[a]||null}function g(){return Object.keys(k).map(function(a){return k[a]})}function h(a){l.push(a)}function i(a){if(a){var b=l.indexOf(a);b>=0&&l.splice(b,1)}else l.splice(0,l.length)}var j=a("./client-utils"),k={},l=[];b.exports={get:f,getAll:g,register:d,unregister:e,addListener:h,removeListener:i}},{"./client-utils":9}],9:[function(a,b,c){(function(b){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=a("uuid");c.atob="undefined"==typeof atob?b.getNativeSupport("atob"):atob.bind(window),c.btoa="undefined"==typeof btoa?b.getNativeSupport("btoa"):btoa.bind(window);var f="undefined"==typeof FileReader?b.getNativeSupport("FileReader"):FileReader;c.generateUUID=e.v4,c.typeFromID=function(a){var b=a.match(/([^\/]*)(\/[^\/]*)$/);return b?b[1]:""},c.uuid=function(a){return(a||"").replace(/^.*\//,"")},c.isEmpty=function(a){return"[object Object]"===Object.prototype.toString.apply(a)&&0===Object.keys(a).length},c.sortBy=function(a,b,c){return c=c?-1:1,a.sort(function(a,d){var e=b(a),f=b(d);return void 0===e&&void 0===f?0:void 0===e&&void 0!==f?1:void 0!==e&&void 0===f?-1:e>f?1*c:e<f?-1*c:0})},c.clone=function(a){return JSON.parse(JSON.stringify(a))},c.decode=function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw new Error("Illegal base64url string!")}return c.atob(b)},c.getExponentialBackoffSeconds=function(a,b){var c=Math.pow(2,b)/10,d=Math.random();return b<2?d/=4:b<6&&(d/=2),c>=a&&(c=a),c+d},c.isBlob=function(a){return"undefined"!=typeof Blob&&a instanceof Blob},c.blobToBase64=function(a,b){var c=new f;c.readAsDataURL(a),c.onloadend=function(){return b(c.result.replace(/^.*?,/,""))}},c.base64ToBlob=function(a,b){try{var d=512,e=c.atob(a),f=[],g=void 0;for(g=0;g<e.length;g+=d){var h=void 0,i=e.slice(g,g+d),j=new Array(i.length);for(h=0;h<i.length;h++)j[h]=i.charCodeAt(h);var k=new Uint8Array(j);f.push(k)}var l=new Blob(f,{type:b});return l}catch(a){}return null},c.utoa=function(a){return c.btoa(unescape(encodeURIComponent(a)))},c.atou=function(a){return decodeURIComponent(escape(c.atob(a)))},c.fetchTextFromFile=function(a,b){if("string"==typeof a)return b(a);var c=new f;c.addEventListener("loadend",function(){b(c.result)}),c.readAsText(a)},c.defer=a("./utils/defer"),c.layerParse=a("./utils/layer-parser"),c.doesObjectMatch=function(a,b){if(!a&&b||a&&!b)return!1;var e=Object.keys(a).sort(),f=Object.keys(b).sort();if(e.length!==f.length)return!1;for(var g=0;g<e.length;g++){var h=e[g],i=f[g],j=a[h],k=b[i];if(h!==i)return!1;if(j&&"object"===("undefined"==typeof j?"undefined":d(j))){if(Array.isArray(j))throw new Error("Array comparison not handled yet");if(!c.doesObjectMatch(j,k))return!1}else if(j!==k)return!1}return!0},c.includes=function(a,b){return a.indexOf(b)!==-1},c.asciiInit=function(a){if(!a)return"Missing version";var b=a.split("-"),c=b[0]||"",d=b[1]||"";return c+=new Array(13-c.length).join(" "),d+=new Array(14-d.length).join(" "),"\n    /hNMMMMMMMMMMMMMMMMMMMms.\n  hMMy+/////////////////omMN-\n  MMN                    oMMo\n  MMN        Layer       oMMo\n  MMN       Web SDK      oMMo\n  MMM-                   oMMo\n  MMMy      v"+c+"oMMo\n  MMMMo     "+d+"oMMo\n  MMMMMy.                oMMo\n  MMMMMMNy:'             oMMo\n  NMMMMMMMMmy+:-.'      'yMM/\n  :dMMMMMMMMMMMMNNNNNNNNNMNs\n   -/+++++++++++++++++++:'"}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils/defer":51,"./utils/layer-parser":52,uuid:6}],10:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=a("./client-authenticator"),k=a("./models/conversation"),l=a("./models/channel"),m=a("./layer-error").dictionary,n=a("./models/conversation-message"),o=a("./models/channel-message"),p=a("./models/announcement"),q=a("./models/identity"),r=a("./models/membership"),s=a("./typing-indicators/typing-indicator-listener"),t=a("./client-utils"),u=a("./root"),v=a("./client-registry"),w=a("./logger"),x=a("./typing-indicators/typing-listener"),y=a("./typing-indicators/typing-publisher"),Client=function(a){function Client(a){d(this,Client);var b=e(this,Object.getPrototypeOf(Client).call(this,a));return v.register(b),b._models={},b._runMixins("constructor",[a]),b._scheduleCheckAndPurgeCacheItems=[],b._initComponents(),b.on("online",b._connectionRestored.bind(b)),w.info(t.asciiInit(Client.version)),b}return f(Client,a),h(Client,[{key:"_initComponents",value:function(){i(Object.getPrototypeOf(Client.prototype),"_initComponents",this).call(this),this._typingIndicators=new s({clientId:this.appId})}},{key:"_cleanup",value:function(){if(!this.isDestroyed){this._inCleanup=!0;try{this._runMixins("cleanup",[])}catch(a){w.error(a)}this.socketManager&&this.socketManager.close(),this._inCleanup=!1}}},{key:"destroy",value:function(){this._cleanup(),this._destroyComponents(),v.unregister(this),i(Object.getPrototypeOf(Client.prototype),"destroy",this).call(this),this._inCleanup=!1}},{key:"__adjustAppId",value:function(){if(this.appId)throw new Error(m.appIdImmutable)}},{key:"_fixIdentities",value:function(a){var b=this;return a.map(function(a){if(a instanceof q)return a;if("string"==typeof a)return b.getIdentity(a,!0);if(a&&"object"===("undefined"==typeof a?"undefined":g(a))){if("userId"in a)return b.getIdentity(a.id||a.userId);if("user_id"in a)return b._createObject(a)}return null})}},{key:"getObject",value:function(a){var b=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];switch(t.typeFromID(a)){case"messages":case"announcements":return this.getMessage(a,b);case"conversations":return this.getConversation(a,b);case"channels":return this.getChannel(a,b);case"queries":return this.getQuery(a);case"identities":return this.getIdentity(a,b);case"members":return this.getMember(a,b)}return null}},{key:"_createObject",value:function(a){var b=this.getObject(a.id);if(b)return b._populateFromServer(a),b;switch(t.typeFromID(a.id)){case"messages":if(a.conversation)return n._createFromServer(a,this);
if(a.channel)return o._createFromServer(a,this);break;case"announcements":return p._createFromServer(a,this);case"conversations":return k._createFromServer(a,this);case"channels":return l._createFromServer(a,this);case"identities":return q._createFromServer(a,this);case"members":return r._createFromServer(a,this)}return null}},{key:"_updateContainerId",value:function(a,b){a instanceof k?this._updateConversationId(a,b):this._updateChannelId(a,b)}},{key:"_processDelayedTriggers",value:function(){if(!this.isDestroyed){var a=this._delayedTriggers.filter(function(a){return"conversations:add"===a[0]}),b=this._delayedTriggers.filter(function(a){return"conversations:remove"===a[0]});this._foldEvents(a,"conversations",this),this._foldEvents(b,"conversations",this);var c=this._delayedTriggers.filter(function(a){return"messages:add"===a[0]}),d=this._delayedTriggers.filter(function(a){return"messages:remove"===a[0]});this._foldEvents(c,"messages",this),this._foldEvents(d,"messages",this);var e=this._delayedTriggers.filter(function(a){return"identities:add"===a[0]}),f=this._delayedTriggers.filter(function(a){return"identities:remove"===a[0]});this._foldEvents(e,"identities",this),this._foldEvents(f,"identities",this),i(Object.getPrototypeOf(Client.prototype),"_processDelayedTriggers",this).call(this)}}},{key:"trigger",value:function(a,b){this._triggerLogger(a,b),i(Object.getPrototypeOf(Client.prototype),"trigger",this).call(this,a,b)}},{key:"_triggerLogger",value:function(a,b){var c=["conversations:add","conversations:remove","conversations:change","messages:add","messages:remove","messages:change","identities:add","identities:remove","identities:change","challenge","ready"];if(c.indexOf(a)!==-1){if(b&&b.isChange)w.info("Client Event: "+a+" "+b.changes.map(function(a){return a.property}).join(", "));else{var d="";b&&(b.message&&(d=b.message.id),b.messages&&(d=b.messages.length+" messages"),b.conversation&&(d=b.conversation.id),b.conversations&&(d=b.conversations.length+" conversations"),b.channel&&(d=b.channel.id),b.channels&&(d=b.channels.length+" channels")),w.info("Client Event: "+a+" "+d)}b&&w.debug(b)}else w.debug(a,b)}},{key:"_resetSession",value:function(){return this._cleanup(),this._runMixins("reset",[]),i(Object.getPrototypeOf(Client.prototype),"_resetSession",this).call(this)}},{key:"_checkAndPurgeCache",value:function(a){var b=this;a.forEach(function(a){a.isDestroyed||b._isCachedObject(a)||(a instanceof u==!1&&(a=b.getObject(a.id)),a&&a.destroy())})}},{key:"_scheduleCheckAndPurgeCache",value:function(a){var b=this;a.isSaved()&&(this._scheduleCheckAndPurgeCacheAt<Date.now()&&(this._scheduleCheckAndPurgeCacheAt=Date.now()+Client.CACHE_PURGE_INTERVAL,setTimeout(function(){return b._runScheduledCheckAndPurgeCache()},Client.CACHE_PURGE_INTERVAL)),this._scheduleCheckAndPurgeCacheItems.push(a))}},{key:"_runScheduledCheckAndPurgeCache",value:function(){var a=this._scheduleCheckAndPurgeCacheItems;this._scheduleCheckAndPurgeCacheItems=[],this._checkAndPurgeCache(a),this._scheduleCheckAndPurgeCacheAt=0}},{key:"_isCachedObject",value:function(a){for(var b=Object.keys(this._models.queries),c=0;c<b.length;c++){var d=this._models.queries[b[c]];if(d._getItem(a.id))return!0}return!1}},{key:"_connectionRestored",value:function(a){var b=this;a.reset&&(w.debug("Client Connection Restored; Resetting all Queries"),this.dbManager.deleteTables(function(){b.dbManager._open(),Object.keys(b._models.queries).forEach(function(a){var c=b._models.queries[a];c&&c.reset()})}))}},{key:"createTypingListener",value:function(a){return new x({clientId:this.appId,input:a})}},{key:"createTypingPublisher",value:function(){return new y({clientId:this.appId})}},{key:"getTypingState",value:function(a){return this._typingIndicators.getState(a)}}],[{key:"getClient",value:function(a){return v.get(a)}},{key:"destroyAllClients",value:function(){v.getAll().forEach(function(a){return a.destroy()})}},{key:"addListenerForNewClient",value:function(a){v.addListener(a)}},{key:"removeListenerForNewClient",value:function(a){v.removeListener(a)}}]),Client}(j);Client.prototype._scheduleCheckAndPurgeCacheItems=null,Client.prototype._scheduleCheckAndPurgeCacheAt=0,Client.version="3.2.3",Client.CACHE_PURGE_INTERVAL=6e5,Client._ignoredEvents=["conversations:loaded","conversations:loaded-error"],Client._supportedEvents=["typing-indicator-change"].concat(j._supportedEvents),Client.mixins=[a("./mixins/client-queries"),a("./mixins/client-identities"),a("./mixins/client-members"),a("./mixins/client-conversations"),a("./mixins/client-channels"),a("./mixins/client-messages")],u.initClass.apply(Client,[Client,"Client"]),b.exports=Client},{"./client-authenticator":7,"./client-registry":8,"./client-utils":9,"./layer-error":13,"./logger":16,"./mixins/client-channels":17,"./mixins/client-conversations":18,"./mixins/client-identities":19,"./mixins/client-members":20,"./mixins/client-messages":21,"./mixins/client-queries":22,"./models/announcement":23,"./models/channel":25,"./models/channel-message":24,"./models/conversation":29,"./models/conversation-message":28,"./models/identity":30,"./models/membership":31,"./root":44,"./typing-indicators/typing-indicator-listener":47,"./typing-indicators/typing-listener":49,"./typing-indicators/typing-publisher":50}],11:[function(a,b,c){"use strict";b.exports={SYNC_STATE:{NEW:"NEW",SAVING:"SAVING",SYNCING:"SYNCING",SYNCED:"SYNCED",LOADING:"LOADING"},RECIPIENT_STATE:{NONE:"NONE",SOME:"SOME",ALL:"ALL"},RECEIPT_STATE:{SENT:"sent",DELIVERED:"delivered",READ:"read",PENDING:"pending"},LOCALSTORAGE_KEYS:{SESSIONDATA:"layer-session-data-"},ACCEPT:"application/vnd.layer+json; version=2.0",WEBSOCKET_PROTOCOL:"layer-2.0",LOG:{DEBUG:4,INFO:3,WARN:2,ERROR:1,NONE:0},DELETION_MODE:{ALL:"all_participants",MY_DEVICES:"my_devices"}}},{}],12:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a){return a?a.toISOString():null}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./root"),j=a("./logger"),k=a("./sync-event"),l=a("./const"),m=a("./client-utils"),n=a("./models/announcement"),o=5,p=9007199254740991,q=l.SYNC_STATE.NEW,r=[{name:"conversations",indexes:{created_at:["created_at"],last_message_sent:["last_message_sent"]}},{name:"channels",indexes:{created_at:["created_at"]}},{name:"messages",indexes:{conversationId:["conversationId","position"]}},{name:"identities",indexes:{}},{name:"syncQueue",indexes:{}}],s=function(a){function b(a){d(this,b);var c=e(this,Object.getPrototypeOf(b).call(this,a));if(window.indexedDB&&a.enabled){var f=!0;try{window.IDBKeyRange.bound(["announcement",0],["announcement",p])}catch(b){a.tables={},f=!1}f&&c.client.constructor._supportedEvents.indexOf("conversations:add")!==-1&&(c.client.on("conversations:add",function(a){return c.writeConversations(a.conversations)},c),c.client.on("conversations:change",function(a){return c._updateConversation(a.target,a.changes)},c),c.client.on("conversations:delete conversations:sent-error",function(a){return c.deleteObjects("conversations",[a.target])},c),c.client.on("channels:add",function(a){return c.writeChannels(a.channels)},c),c.client.on("channels:change",function(a){return c._updateChannel(a.target,a.changes)},c),c.client.on("channels:delete channels:sent-error",function(a){return c.deleteObjects("channels",[a.target])},c),c.client.on("messages:add",function(a){return c.writeMessages(a.messages)},c),c.client.on("messages:change",function(a){return c.writeMessages([a.target])},c),c.client.on("messages:delete messages:sent-error",function(a){return c.deleteObjects("messages",[a.target])},c),c.client.on("identities:add",function(a){return c.writeIdentities(a.identities)},c),c.client.on("identities:change",function(a){return c.writeIdentities([a.target])},c),c.client.on("identities:unfollow",function(a){return c.deleteObjects("identities",[a.target])},c)),(a.tables.conversations||a.tables.channels)&&a.tables.messages||(a.tables.syncQueue=!1)}else a.tables={};return r.forEach(function(b){c["_permission_"+b.name]=Boolean(a.tables[b.name])}),c._open(!1),c}return f(b,a),h(b,[{key:"_getDbName",value:function(){return"LayerWebSDK_"+this.client.appId}},{key:"_open",value:function(a){var b=this;this.db&&(this.db.close(),delete this.db);var c=r.filter(function(a){return b["_permission_"+a.name]});if(0===c.length)return this._isOpenError=!0,void this.trigger("error",{error:"Persistence is disabled by application"});var d=window.indexedDB.open(this._getDbName(),o);try{d.onerror=function(c){a?(b._isOpenError=!0,j.warn("Database Unable to Open (common cause: private browsing window)",c.target.error),b.trigger("error",{error:c})):b.deleteTables(function(){return b._open(!0)})},d.onupgradeneeded=function(a){return b._onUpgradeNeeded(a)},d.onsuccess=function(a){b.db=a.target.result,b.isOpen=!0,b.trigger("open"),b.db.onversionchange=function(){b.db.close(),b.isOpen=!1},b.db.onerror=function(a){return j.error("db-manager Error: ",a)}}}catch(a){this._isOpenError=!0,j.error("Database Unable to Open: ",a),this.trigger("error",{error:a})}}},{key:"onOpen",value:function(a){this.isOpen||this._isOpenError?a():this.once("open error",a)}},{key:"_onUpgradeNeeded",value:function(a){var b=this,c=a.target.result,d=!1,e=function(a){d||(b.db=c,b.isComplete=!0,b.isOpen=!0,b.trigger("open"))},f=Array.prototype.slice.call(c.objectStoreNames);r.forEach(function(a){try{f.indexOf(a.name)!==-1&&c.deleteObjectStore(a.name)}catch(a){}try{!function(){var b=c.createObjectStore(a.name,{keyPath:"id"});Object.keys(a.indexes).forEach(function(c){return b.createIndex(c,a.indexes[c],{unique:!1})}),b.transaction.oncomplete=e}()}catch(b){j.error("Failed to create object store "+a.name,b)}})}},{key:"_getConversationData",value:function(a){var b=this;return a.filter(function(a){return a._fromDB?(a._fromDB=!1,!1):!a.isLoading&&a.syncState!==q}).map(function(a){var c={id:a.id,url:a.url,participants:b._getIdentityData(a.participants,!0),distinct:a.distinct,created_at:g(a.createdAt),metadata:a.metadata,unread_message_count:a.unreadCount,last_message:a.lastMessage?a.lastMessage.id:"",last_message_sent:g(a.lastMessage?a.lastMessage.sentAt:a.createdAt),sync_state:a.syncState};return c})}},{key:"_updateConversation",value:function(a,b){var c=this,d=b.filter(function(a){return"id"===a.property});d.length?this.deleteObjects("conversations",[{id:d[0].oldValue}],function(){c.writeConversations([a])}):this.writeConversations([a])}},{key:"writeConversations",value:function(a,b){this._writeObjects("conversations",this._getConversationData(a.filter(function(a){return!a.isDestroyed})),b)}},{key:"_getChannelData",value:function(a){return a.filter(function(a){return a._fromDB?(a._fromDB=!1,!1):!a.isLoading&&a.syncState!==q}).map(function(a){var b={id:a.id,url:a.url,created_at:g(a.createdAt),sync_state:a.syncState,membership:null,name:a.name,metadata:a.metadata};return b})}},{key:"_updateChannel",value:function(a,b){var c=this,d=b.filter(function(a){return"id"===a.property});d.length?this.deleteObjects("channels",[{id:d[0].oldValue}],function(){c.writeChannels([a])}):this.writeChannels([a])}},{key:"writeChannels",value:function(a,b){this._writeObjects("channels",this._getChannelData(a.filter(function(a){return!a.isDestroyed})),b)}},{key:"_getIdentityData",value:function(a,b){return a.filter(function(a){return!(a.isDestroyed||!a.isFullIdentity&&!b)&&(a._fromDB?(a._fromDB=!1,!1):!a.isLoading)}).map(function(a){return a.isFullIdentity&&!b?{id:a.id,url:a.url,user_id:a.userId,first_name:a.firstName,last_name:a.lastName,display_name:a.displayName,avatar_url:a.avatarUrl,metadata:a.metadata,public_key:a.publicKey,phone_number:a.phoneNumber,email_address:a.emailAddress,sync_state:a.syncState,type:a.type}:{id:a.id,url:a.url,user_id:a.userId,display_name:a.displayName,avatar_url:a.avatarUrl}})}},{key:"writeIdentities",value:function(a,b){this._writeObjects("identities",this._getIdentityData(a),b)}},{key:"_getMessageData",value:function(a,c){var d=this,e=a.filter(function(a){return a._fromDB?(a._fromDB=!1,!1):a.syncState!==l.SYNC_STATE.LOADING}).map(function(a){return{id:a.id,url:a.url,parts:a.parts.map(function(a){var c=m.isBlob(a.body)&&a.body.size>b.MaxPartSize?null:a.body;return{body:c,id:a.id,encoding:a.encoding,mime_type:a.mimeType,content:a._content?{id:a._content.id,download_url:a._content.downloadUrl,expiration:a._content.expiration,refresh_url:a._content.refreshUrl,size:a._content.size}:null}}),position:a.position,sender:d._getIdentityData([a.sender],!0)[0],recipient_status:a.recipientStatus,sent_at:g(a.sentAt),received_at:g(a.receivedAt),conversationId:a instanceof n?"announcement":a.conversationId,sync_state:a.syncState,is_unread:a.isUnread}}),f=0,h=[];e.forEach(function(a){a.parts.forEach(function(a){m.isBlob(a.body)&&h.push(a)})}),0===h.length?c(e):h.forEach(function(a){m.blobToBase64(a.body,function(b){a.body=b,a.useBlob=!0,f++,f===h.length&&c(e)})})}},{key:"writeMessages",value:function(a,b){var c=this;this._getMessageData(a.filter(function(a){return!a.isDestroyed}),function(a){return c._writeObjects("messages",a,b)})}},{key:"_getSyncEventData",value:function(a){return a.filter(function(a){return!a.fromDB||(a.fromDB=!1,!1)}).map(function(a){var b={id:a.id,target:a.target,depends:a.depends,isWebsocket:a instanceof k.WebsocketSyncEvent,operation:a.operation,data:a.data,url:a.url||"",headers:a.headers||null,method:a.method||null,created_at:a.createdAt};return b})}},{key:"writeSyncEvents",value:function(a,b){this._writeObjects("syncQueue",this._getSyncEventData(a),b)}},{key:"_writeObjects",value:function(a,b,c){var d=this;return!this["_permission_"+a]||this._isOpenError?c?c():null:b.length?void this.onOpen(function(){d.getObjects(a,b.map(function(a){return a.id}),function(e){var f={};e.forEach(function(a){f[a.id]=a});var g=d.db.transaction([a],"readwrite"),h=g.objectStore(a);g.oncomplete=g.onerror=c,b.forEach(function(a){try{f[a.id]?h.put(a):h.add(a)}catch(a){j.error(a)}})})}):void(c&&c())}},{key:"loadConversations",value:function(a,b,c,d){var e=this;try{var f=void 0,h=null,i=b?this.client.getConversation(b):null;"last_message"===a?(f="last_message_sent",i&&(h=window.IDBKeyRange.upperBound([g(i.lastMessage?i.lastMessage.sentAt:i.createdAt)]))):(f="created_at",i&&(h=window.IDBKeyRange.upperBound([g(i.createdAt)]))),this._loadByIndex("conversations",f,h,Boolean(b),c,function(a){var b=a.map(function(a){return a.last_message}).filter(function(a){return a&&!e.client.getMessage(a)});e.getObjects("messages",b,function(b){e._loadConversationsResult(a,b,d)})})}catch(a){}}},{key:"_loadConversationsResult",value:function(a,b,c){var d=this;b.forEach(function(a){return d._createMessage(a)});var e=a.map(function(a){return d._createConversation(a)||d.client.getConversation(a.id)}).filter(function(a){return a});c&&c(e)}},{key:"loadChannels",value:function(a,b,c){var d=this;try{var e="created_at",f=null,h=a?this.client.getChannel(a):null;h&&(f=window.IDBKeyRange.upperBound([g(h.createdAt)])),this._loadByIndex("channels",e,f,Boolean(a),b,function(a){d._loadChannelsResult(a,c)})}catch(a){}}},{key:"_loadChannelsResult",value:function(a,b){var c=this,d=a.map(function(a){return c._createChannel(a)||c.client.getChannel(a.id)}).filter(function(a){return a});b&&b(d)}},{key:"loadMessages",value:function(a,b,c,d){var e=this;if(!this._permission_messages||this._isOpenError)return d([]);try{var f=b?this.client.getMessage(b):null,g=window.IDBKeyRange.bound([a,0],[a,f?f.position:p]);this._loadByIndex("messages","conversationId",g,Boolean(b),c,function(a){e._loadMessagesResult(a,d)})}catch(a){}}},{key:"loadAnnouncements",value:function(a,b,c){var d=this;if(!this._permission_messages||this._isOpenError)return c([]);try{var e=a?this.client.getMessage(a):null,f=window.IDBKeyRange.bound(["announcement",0],["announcement",e?e.position:p]);this._loadByIndex("messages","conversationId",f,Boolean(a),b,function(a){d._loadMessagesResult(a,c)})}catch(a){}}},{key:"_blobifyPart",value:function(a){a.useBlob&&(a.body=m.base64ToBlob(a.body),delete a.useBlob,a.encoding=null)}},{key:"_loadMessagesResult",value:function(a,b){var c=this;a.forEach(function(a){return a.parts.forEach(function(a){return c._blobifyPart(a)})});var d=a.map(function(a){return c._createMessage(a)||c.client.getMessage(a.id)}).filter(function(a){return a});b&&b(d)}},{key:"loadIdentities",value:function(a){var b=this;this._loadAll("identities",function(c){b._loadIdentitiesResult(c,a)})}},{key:"_loadIdentitiesResult",value:function(a,b){var c=this,d=a.map(function(a){return c._createIdentity(a)||c.client.getIdentity(a.id)}).filter(function(a){return a});b&&b(d)}},{key:"_createConversation",value:function(a){if(!this.client.getConversation(a.id)){a._fromDB=!0;var b=this.client._createObject(a);return b.syncState=a.sync_state,b}}},{key:"_createChannel",value:function(a){if(!this.client.getChannel(a.id)){a._fromDB=!0;var b=this.client._createObject(a);return b.syncState=a.sync_state,b}}},{key:"_createMessage",value:function(a){if(!this.client.getMessage(a.id)){a._fromDB=!0,a.conversationId.indexOf("layer:///conversations")?a.conversation={id:a.conversationId}:a.conversationId.indexOf("layer:///channels")&&(a.channel={id:a.conversationId}),delete a.conversationId;var b=this.client._createObject(a);return b.syncState=a.sync_state,b}}},{key:"_createIdentity",value:function(a){if(!this.client.getIdentity(a.id)){a._fromDB=!0;var b=this.client._createObject(a);return b.syncState=a.sync_state,b}}},{key:"loadSyncQueue",value:function(a){var b=this;this._loadAll("syncQueue",function(c){return b._loadSyncEventRelatedData(c,a)})}},{key:"_loadSyncEventRelatedData",value:function(a,b){var c=this,d=a.filter(function(a){return"DELETE"!==a.operation&&a.target&&a.target.match(/messages/)}).map(function(a){return a.target}),e=a.filter(function(a){return"DELETE"!==a.operation&&a.target&&a.target.match(/conversations/)}).map(function(a){return a.target}),f=a.filter(function(a){return"DELETE"!==a.operation&&a.target&&a.target.match(/identities/)}).map(function(a){return a.target}),g=0,h=3;this.getObjects("messages",d,function(d){d.forEach(function(a){return c._createMessage(a)}),g++,g===h&&c._loadSyncEventResults(a,b)}),this.getObjects("conversations",e,function(d){d.forEach(function(a){return c._createConversation(a)}),g++,g===h&&c._loadSyncEventResults(a,b)}),this.getObjects("identities",f,function(d){d.forEach(function(a){return c._createIdentity(a)}),g++,g===h&&c._loadSyncEventResults(a,b)})}},{key:"_loadSyncEventResults",value:function(a,b){var c=this,d=a.filter(function(a){var b=Boolean(a.target&&c.client.getObject(a.target));return"DELETE"===a.operation||b}).map(function(a){return a.isWebsocket?new k.WebsocketSyncEvent({target:a.target,depends:a.depends,operation:a.operation,id:a.id,data:a.data,fromDB:!0,createdAt:a.created_at}):new k.XHRSyncEvent({target:a.target,depends:a.depends,operation:a.operation,id:a.id,data:a.data,method:a.method,headers:a.headers,url:a.url,fromDB:!0,createdAt:a.created_at})});m.sortBy(d,function(a){return a.createdAt}),b(d)}},{key:"_loadAll",value:function(a,b){var c=this;return!this["_permission_"+a]||this._isOpenError?b([]):void this.onOpen(function(){var d=[];c.db.transaction([a],"readonly").objectStore(a).openCursor().onsuccess=function(a){if(!c.isDestroyed){var e=a.target.result;e?(d.push(e.value),e.continue()):c.isDestroyed||b(d)}}})}},{key:"_loadByIndex",value:function(a,b,c,d,e,f){var g=this;if(!this["_permission_"+a]||this._isOpenError)return f([]);var h=d;this.onOpen(function(){var d=[];g.db.transaction([a],"readonly").objectStore(a).index(b).openCursor(c,"prev").onsuccess=function(a){if(!g.isDestroyed){var b=a.target.result;b?(h?h=!1:d.push(b.value),e&&d.length>=e?f(d):b.continue()):f(d)}}})}},{key:"deleteObjects",value:function(a,b,c){var d=this;return!this["_permission_"+a]||this._isOpenError?c?c():null:void this.onOpen(function(){var e=d.db.transaction([a],"readwrite"),f=e.objectStore(a);e.oncomplete=c,b.forEach(function(a){return f.delete(a.id)})})}},{key:"getObjects",value:function(a,b,c){var d=this;if(!this["_permission_"+a]||this._isOpenError)return c([]);for(var e=[],f=b.sort(),g=f.length-1;g>0;g--)f[g]===f[g-1]&&f.splice(g,1);var h=0;this.onOpen(function(){d.db.transaction([a],"readonly").objectStore(a).openCursor().onsuccess=function(a){if(!d.isDestroyed){var b=a.target.result;if(!b)return void c(e);for(var g=b.key;g>f[h];)h++;g===f[h]&&(e.push(b.value),h++),h===f.length?d.isDestroyed||c(e):b.continue(f[h])}}})}},{key:"getObject",value:function(a,b,c){var d=this;return!this["_permission_"+a]||this._isOpenError?c():void this.onOpen(function(){d.db.transaction([a],"readonly").objectStore(a).openCursor(window.IDBKeyRange.only(b)).onsuccess=function(b){var e=b.target.result;if(!e)return c(null);switch(a){case"messages":return e.value.parts.forEach(function(a){return d._blobifyPart(a)}),c(e.value);case"identities":case"channels":return c(e.value);case"conversations":if(e.value.last_message){var f=d.client.getMessage(e.value.last_message);return f?d._getMessageData([f],function(a){e.value.last_message=a[0],c(e.value)}):d.getObject("messages",e.value.last_message,function(a){e.value.last_message=a,c(e.value)})}return c(e.value)}}})}},{key:"claimSyncEvent",value:function(a,b){var c=this;return!this._permission_syncQueue||this._isOpenError?b(!0):void this.onOpen(function(){var d=c.db.transaction(["syncQueue"],"readwrite"),e=d.objectStore("syncQueue");e.get(a.id).onsuccess=function(a){return b(Boolean(a.target.result))},e.delete(a.id)})}},{key:"deleteTables",value:function(){var a=arguments.length<=0||void 0===arguments[0]?function(){}:arguments[0];try{var b=window.indexedDB.deleteDatabase(this._getDbName());b.onsuccess=b.onerror=a,delete this.db}catch(b){j.error("Failed to delete database",b),a&&a(b)}}}]),b}(i);s.prototype.client=null,s.prototype.isOpen=!1,s.prototype._isOpenError=!1,s.prototype._permission_messages=!1,s.prototype._permission_conversations=!1,s.prototype._permission_channels=!1,s.prototype._permission_identities=!1,s.prototype._permission_syncQueue=!1,s.prototype.db=null,s.MaxPartSize=25e4,s._supportedEvents=["open","error"].concat(i._supportedEvents),i.initClass.apply(s,[s,"DbManager"]),b.exports=s},{"./client-utils":9,"./const":11,"./logger":16,"./models/announcement":23,"./root":44,"./sync-event":45}],13:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./logger"),h=function(){function a(b){var c=this;d(this,a),b instanceof a?b={errType:b.errType,httpStatus:b.httpStatus,message:b.message,code:b.code,url:b.url,data:b.data}:b&&"object"===("undefined"==typeof b?"undefined":e(b))?b.errType=b.id:b={message:b},Object.keys(b).forEach(function(a){return c[a]=b[a]}),this.data||(this.data={})}return f(a,[{key:"getNonce",value:function(){return this.data&&this.data.nonce?this.data.nonce:""}},{key:"toString",value:function(){return this.code+" ("+this.id+"): "+this.message+"; (see "+this.url+")"}},{key:"log",value:function(){g.error("Layer-Error: "+this.toString())}}]),a}();h.prototype.errType="",h.prototype.code=0,h.prototype.url="",h.prototype.message="",h.prototype.httpStatus=0,h.prototype.request=null,h.prototype.data=null,h.prototype.xhr=null,h.dictionary={appIdMissing:"Property missing: appId is required",identityTokenMissing:"Identity Token missing: answerAuthenticationChallenge requires an identity token",sessionTokenMissing:"Session Token missing: _authComplete requires a {session_token: value} input",clientMissing:"Property missing: client is required",conversationMissing:"Property missing: conversation is required",partsMissing:"Property missing: parts is required",moreParticipantsRequired:"Conversation needs participants other than the current user",isDestroyed:"Object is destroyed",urlRequired:"Object needs a url property",invalidUrl:"URL is invalid",invalidId:"Identifier is invalid",idParamRequired:"The ID Parameter is required",wrongClass:"Parameter class error; should be: ",inProgress:"Operation already in progress",cantChangeIfConnected:"You can not change value after connecting",cantChangeUserId:"You can not change the userId property",alreadySent:"Already sent or sending",contentRequired:"MessagePart requires rich content for this call",alreadyDestroyed:"This object has already been destroyed",deletionModeUnsupported:"Call to deletion was made with an unsupported deletion mode",sessionAndUserRequired:"connectWithSession requires both a userId and a sessionToken",invalidUserIdChange:"The prn field in the Identity Token must match the requested UserID",predicateNotSupported:"The predicate is not supported for this value of model",invalidPredicate:"The predicate does not match the expected format",appIdImmutable:"The appId property cannot be changed",clientMustBeReady:'The Client must have triggered its "ready" event before you can call this',modelImmutable:"The model property cannot be changed",valueNotSupported:"The value provided is not a supported value",permissionDenied:"Operation not allowed on that object"},b.exports=h},{"./logger":16}],14:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){var e=this;d(this,a);var f=this;c.match(/:change$/)?(this.changes=[{}],f=this.changes[0],this.isChange=!0):this.isChange=!1,Object.keys(b).forEach(function(a){f!==e&&"target"===a?e.target=b.target:f[a]=b[a]}),this.eventName=c}return e(a,[{key:"hasProperty",value:function(a){return!!this.isChange&&Boolean(this.changes.filter(function(b){return b.property===a}).length)}},{key:"getChangesFor",value:function(a){return this.isChange?this.changes.filter(function(b){return b.property===a}):[]}},{key:"_mergeChanges",value:function(a){this.changes=this.changes.concat(a.changes)}}]),a}();f.prototype.isChange=!1,f.prototype.changes=null,f.prototype.target=null,f.prototype.eventName="",b.exports=f},{}],15:[function(a,b,c){"use strict";var layer={};b.exports=layer,layer.Root=a("./root"),layer.Client=a("./client"),layer.ClientAuthenticator=a("./client-authenticator"),layer.Syncable=a("./models/syncable"),layer.Conversation=a("./models/conversation"),layer.Channel=a("./models/channel"),layer.Container=a("./models/container"),layer.Message=a("./models/message"),layer.Message.ConversationMessage=a("./models/conversation-message"),layer.Message.ChannelMessage=a("./models/channel-message"),layer.Announcement=a("./models/announcement"),layer.MessagePart=a("./models/message-part"),layer.Content=a("./models/content"),layer.Query=a("./queries/query"),layer.QueryBuilder=a("./queries/query-builder"),layer.xhr=a("./xhr"),layer.Identity=a("./models/identity"),layer.Membership=a("./models/membership"),layer.LayerError=a("./layer-error"),layer.LayerEvent=a("./layer-event"),layer.SyncManager=a("./sync-manager"),layer.SyncEvent=a("./sync-event").SyncEvent,layer.XHRSyncEvent=a("./sync-event").XHRSyncEvent,layer.WebsocketSyncEvent=a("./sync-event").WebsocketSyncEvent,layer.Websockets={SocketManager:a("./websockets/socket-manager"),RequestManager:a("./websockets/request-manager"),ChangeManager:a("./websockets/change-manager")},layer.OnlineStateManager=a("./online-state-manager"),layer.DbManager=a("./db-manager"),layer.Constants=a("./const"),layer.Util=a("./client-utils"),layer.TypingIndicators=a("./typing-indicators/typing-indicators"),layer.TypingIndicators.TypingListener=a("./typing-indicators/typing-listener"),layer.TypingIndicators.TypingPublisher=a("./typing-indicators/typing-publisher")},{"./client":10,"./client-authenticator":7,"./client-utils":9,"./const":11,"./db-manager":12,"./layer-error":13,"./layer-event":14,"./models/announcement":23,"./models/channel":25,"./models/channel-message":24,"./models/container":26,"./models/content":27,"./models/conversation":29,"./models/conversation-message":28,"./models/identity":30,"./models/membership":31,"./models/message":33,"./models/message-part":32,"./models/syncable":34,"./online-state-manager":35,"./queries/query":43,"./queries/query-builder":42,"./root":44,"./sync-event":45,"./sync-manager":46,"./typing-indicators/typing-indicators":48,"./typing-indicators/typing-listener":49,"./typing-indicators/typing-publisher":50,"./websockets/change-manager":53,"./websockets/request-manager":54,"./websockets/socket-manager":55,"./xhr":56}],16:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("./const").LOG,h=g.DEBUG,i=g.INFO,j=g.WARN,k=g.ERROR,l=g.NONE,m=Boolean(console.assert&&console.assert.toString().match(/assert/)),n="color: #888; font-weight: bold;",o="color: black",p=function(){function a(){d(this,a)}return f(a,[{key:"log",value:function(a,b,c,d){"object"===("undefined"==typeof a?"undefined":e(a))&&(b=a,a="");var f=(new Date).toLocaleTimeString(),g=void 0;switch(c){case h:g="debug";break;case i:g="info";break;case j:g="warn";break;case k:g="error";break;default:g="log"}b?m?console[g]("%cLayer%c "+g.toUpperCase()+"%c ["+f+"]: "+a,n,"color: "+d,o,b):console[g]("Layer "+g.toUpperCase()+" ["+f+"]: "+a,b):m?console[g]("%cLayer%c "+g.toUpperCase()+"%c ["+f+"]: "+a,n,"color: "+d,o):console[g]("Layer "+g.toUpperCase()+" ["+f+"]: "+a)}},{key:"debug",value:function(a,b){this.level>=h&&this.log(a,b,h,"#888")}},{key:"info",value:function(a,b){this.level>=i&&this.log(a,b,i,"black")}},{key:"warn",value:function(a,b){this.level>=j&&this.log(a,b,j,"orange")}},{key:"error",value:function(a,b){this.level>=k&&this.log(a,b,k,"red")}}]),a}();p.prototype.level="undefined"==typeof jasmine?k:l;var q=new p;b.exports=q},{"./const":11}],17:[function(a,b,c){"use strict";var d=a("../models/channel"),e=a("../layer-error").dictionary;b.exports={events:["channels:add","channels:remove","channels:change","channels:loaded","channels:delete","channels:sent","channels:sent-error"],lifecycle:{constructor:function(a){this._models.channels={}},cleanup:function(){var a=this;Object.keys(this._models.channels).forEach(function(b){var c=a._models.channels[b];c&&!c.isDestroyed&&c.destroy()}),this._models.channels=null},reset:function(){this._models.channels={}}},methods:{getChannel:function(a,b){if("string"!=typeof a)throw new Error(e.idParamRequired);
return d.isValidId(a)||(a=d.prefixUUID+a),this._models.channels[a]?this._models.channels[a]:b?d.load(a,this):null},_addChannel:function(a){var b=a.id;this._models.channels[b]||(this._models.channels[b]=a,a.clientId!==this.appId&&(a.clientId=this.appId),this._triggerAsync("channels:add",{channels:[a]}),this._scheduleCheckAndPurgeCache(a))},_removeChannel:function(a){var b=this;a.off(null,null,this),this._models.channels[a.id]&&(delete this._models.channels[a.id],this._triggerAsync("channels:remove",{channels:[a]})),Object.keys(this._models.messages).forEach(function(c){b._models.messages[c].channelId===a.id&&b._models.messages[c].destroy()})},_updateChannelId:function(a,b){var c=this;this._models.channels[b]&&(this._models.channels[a.id]=a,delete this._models.channels[b],Object.keys(this._models.messages).filter(function(a){return c._models.messages[a].conversationId===b}).forEach(function(b){return c._models.messages[b].conversationId=a.id}))},findCachedChannel:function(a,b){for(var c=b?a.bind(b):a,d=Object.keys(this._models.channels),e=d.length,f=0;f<e;f++){var g=d[f],h=this._models.channels[g];if(c(h,f))return h}return null},createChannel:function(a){if(!this.isAuthenticated)throw new Error(e.clientMustBeReady);return"private"in a||(a.private=!1),a.client=this,d.create(a)}}}},{"../layer-error":13,"../models/channel":25}],18:[function(a,b,c){"use strict";var d=a("../models/conversation"),e=a("../layer-error").dictionary;b.exports={events:["conversations:add","conversations:remove","conversations:sent","conversations:sent-error","conversations:change","conversations:loaded","conversations:delete"],lifecycle:{constructor:function(a){this._models.conversations={}},cleanup:function(){var a=this;Object.keys(this._models.conversations).forEach(function(b){var c=a._models.conversations[b];c&&!c.isDestroyed&&c.destroy()}),this._models.conversations=null},reset:function(){this._models.conversations={}}},methods:{getConversation:function(a,b){if("string"!=typeof a)throw new Error(e.idParamRequired);return d.isValidId(a)||(a=d.prefixUUID+a),this._models.conversations[a]?this._models.conversations[a]:b?d.load(a,this):null},_addConversation:function(a){var b=a.id;this._models.conversations[b]||(this._models.conversations[b]=a,a.clientId!==this.appId&&(a.clientId=this.appId),this._triggerAsync("conversations:add",{conversations:[a]}),this._scheduleCheckAndPurgeCache(a))},_removeConversation:function(a){var b=this;a.off(null,null,this),this._models.conversations[a.id]&&(delete this._models.conversations[a.id],this._triggerAsync("conversations:remove",{conversations:[a]})),Object.keys(this._models.messages).forEach(function(c){b._models.messages[c].conversationId===a.id&&b._models.messages[c].destroy()})},_updateConversationId:function(a,b){var c=this;this._models.conversations[b]&&(this._models.conversations[a.id]=a,delete this._models.conversations[b],Object.keys(this._models.messages).filter(function(a){return c._models.messages[a].conversationId===b}).forEach(function(b){return c._models.messages[b].conversationId=a.id}))},findCachedConversation:function(a,b){for(var c=b?a.bind(b):a,d=Object.keys(this._models.conversations),e=d.length,f=0;f<e;f++){var g=d[f],h=this._models.conversations[g];if(c(h,f))return h}return null},createConversation:function(a){if(!this.isAuthenticated)throw new Error(e.clientMustBeReady);return"distinct"in a||(a.distinct=!0),a.client=this,d.create(a)}}}},{"../layer-error":13,"../models/conversation":29}],19:[function(a,b,c){"use strict";var d=a("../models/identity"),e=a("../layer-error").dictionary,f=(a("../client-utils"),a("../sync-event")),g=f.WebsocketSyncEvent;b.exports={events:["identities:loaded","identities:change","identities:add","identities:remove","identities:unfollow"],lifecycle:{constructor:function(a){this._models.identities={},this._loadPresenceIds=[]},cleanup:function(){var a=this;Object.keys(this._models.identities).forEach(function(b){var c=a._models.identities[b];c&&!c.isDestroyed&&c.destroy()}),this._models.identities=null},reset:function(){this._models.identities={}}},methods:{getIdentity:function(a,b){if("string"!=typeof a)throw new Error(e.idParamRequired);return d.isValidId(a)||(a=d.prefixUUID+encodeURIComponent(a)),this._models.identities[a]?this._models.identities[a]:b?d.load(a,this):null},_addIdentity:function(a){var b=this,c=a.id;c&&!this._models.identities[c]&&(this._models.identities[c]=a,this._triggerAsync("identities:add",{identities:[a]}),a.id&&null===a._presence.status&&!a.sessionOwner&&(this._loadPresenceIds.push(c),1===this._loadPresenceIds.length&&setTimeout(function(){b.isDestroyed||b._loadPresence()},150)))},_removeIdentity:function(a){a.off(null,null,this);var b=a.id;this._models.identities[b]&&(delete this._models.identities[b],this._triggerAsync("identities:remove",{identities:[a]}))},followIdentity:function(a){d.isValidId(a)||(a=d.prefixUUID+encodeURIComponent(a));var b=this.getIdentity(a);return b||(b=new d({id:a,clientId:this.appId,userId:a.substring(20)})),b.follow(),b},unfollowIdentity:function(a){d.isValidId(a)||(a=d.prefixUUID+encodeURIComponent(a));var b=this.getIdentity(a);return b||(b=new d({id:a,clientId:this.appId,userId:a.substring(20)})),b.unfollow(),b},_loadPresence:function(){var a=this._loadPresenceIds;this._loadPresenceIds=[],this.syncManager.request(new g({data:{method:"Presence.sync",data:{ids:a}},returnChangesArray:!0,operation:"READ",target:null,depends:[]}))}}}},{"../client-utils":9,"../layer-error":13,"../models/identity":30,"../sync-event":45}],20:[function(a,b,c){"use strict";var d=a("../models/syncable"),e=(a("../models/membership"),a("../layer-error").dictionary);b.exports={events:["members:loaded","members:change","members:add","members:remove"],lifecycle:{constructor:function(a){this._models.members={}},cleanup:function(){var a=this;Object.keys(this._models.members).forEach(function(b){var c=a._models.members[b];c&&!c.isDestroyed&&c.destroy()}),this._models.members=null},reset:function(){this._models.members={}}},methods:{getMember:function(a,b){if("string"!=typeof a)throw new Error(e.idParamRequired);return this._models.members[a]?this._models.members[a]:b?d.load(a,this):null},_addMembership:function(a){this._models.members[a.id]||(this._models.members[a.id]=a,this._triggerAsync("members:add",{members:[a]}),this._scheduleCheckAndPurgeCache(a))},_removeMembership:function(a){var b="string"==typeof a?a:a.id;a=this._models.members[b],a&&(delete this._models.members[b],this._inCleanup||(a.off(null,null,this),this._triggerAsync("members:remove",{members:[a]})))}}}},{"../layer-error":13,"../models/membership":31,"../models/syncable":34}],21:[function(a,b,c){"use strict";var d=a("../models/syncable"),e=a("../models/message"),f=a("../layer-error").dictionary;b.exports={events:["messages:notify","messages:add","messages:remove","messages:sent","messages:sending","messages:sent-error","messages:change","messages:loaded","messages:delete"],lifecycle:{constructor:function(a){this._models.messages={}},cleanup:function(){var a=this;Object.keys(this._models.messages).forEach(function(b){var c=a._models.messages[b];c&&!c.isDestroyed&&c.destroy()}),this._models.messages=null},reset:function(){this._models.messages={}}},methods:{getMessage:function(a,b){if("string"!=typeof a)throw new Error(f.idParamRequired);return 0!==a.indexOf("layer:///")&&(a=e.prefixUUID+a),this._models.messages[a]?this._models.messages[a]:b?d.load(a,this):null},getMessagePart:function(a){if("string"!=typeof a)throw new Error(f.idParamRequired);var b=a.replace(/\/parts.*$/,""),c=this.getMessage(b);return c?c.getPartById(a):null},_addMessage:function(a){if(!this._models.messages[a.id]){this._models.messages[a.id]=a,this._triggerAsync("messages:add",{messages:[a]}),a._notify&&(this._triggerAsync("messages:notify",{message:a}),a._notify=!1);var b=a.getConversation(!1);if(b&&(!b.lastMessage||b.lastMessage.position<a.position)){var c=b.lastMessage;b.lastMessage=a,c&&this._scheduleCheckAndPurgeCache(c)}else this._scheduleCheckAndPurgeCache(a)}},_removeMessage:function(a){var b="string"==typeof a?a:a.id;if(a=this._models.messages[b],a&&(delete this._models.messages[b],!this._inCleanup)){this._triggerAsync("messages:remove",{messages:[a]});var c=a.getConversation(!1);c&&c.lastMessage===a&&(c.lastMessage=null)}},_purgeMessagesByPosition:function(a,b){var c=this;Object.keys(this._models.messages).forEach(function(d){var e=c._models.messages[d];e.conversationId===a&&e.position<=b&&e.destroy()})}}}},{"../layer-error":13,"../models/message":33,"../models/syncable":34}],22:[function(a,b,c){"use strict";var d=a("../queries/query"),e=a("../queries/identities-query"),f=a("../queries/conversations-query"),g=a("../queries/channels-query"),h=a("../queries/members-query"),i=a("../queries/messages-query"),j=a("../queries/announcements-query"),k=a("../layer-error").dictionary;b.exports={events:[],lifecycle:{constructor:function(a){this._models.queries={}},cleanup:function(){var a=this;Object.keys(this._models.queries).forEach(function(b){var c=a._models.queries[b];c&&!c.isDestroyed&&c.destroy()}),this._models.queries=null},reset:function(){this._models.queries={}}},methods:{getQuery:function(a){if("string"!=typeof a)throw new Error(k.idParamRequired);return this._models.queries[a]||null},createQuery:function(a){var b=void 0;switch("function"==typeof a.build&&(a=a.build()),a.client=this,a.model){case d.Identity:b=new e(a);break;case d.Conversation:b=new f(a);break;case d.Channel:b=new g(a);break;case d.Membership:b=new h(a);break;case d.Message:b=new i(a);break;case d.Announcement:b=new j(a);break;default:b=new d(a)}return this._addQuery(b),b},_addQuery:function(a){this._models.queries[a.id]=a},_removeQuery:function(a){var b=this;if(a){if(delete this._models.queries[a.id],!this._inCleanup){var c=a.data.map(function(a){return b.getObject(a.id)}).filter(function(a){return a});this._checkAndPurgeCache(c)}this.off(null,null,a)}}}}},{"../layer-error":13,"../queries/announcements-query":36,"../queries/channels-query":37,"../queries/conversations-query":38,"../queries/identities-query":39,"../queries/members-query":40,"../queries/messages-query":41,"../queries/query":43}],23:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./conversation-message"),i=a("./syncable"),j=a("../root"),k=a("../layer-error"),l=function(a){function b(){return d(this,b),e(this,Object.getPrototypeOf(b).apply(this,arguments))}return f(b,a),g(b,[{key:"send",value:function(){}},{key:"_send",value:function(){}},{key:"getConversation",value:function(){}},{key:"_loaded",value:function(a){this.getClient()._addMessage(this)}},{key:"delete",value:function(){if(this.isDestroyed)throw new Error(k.dictionary.isDestroyed);var a=this.id,b=this.getClient();this._xhr({url:"",method:"DELETE"},function(c){c.success||c.data&&("not_found"===c.data.id||"authentication_required"===c.data.id)||i.load(a,b)}),this._deleted(),this.destroy()}}],[{key:"_createFromServer",value:function(a,c){var d=a.fromWebsocket;return new b({fromServer:a,clientId:c.appId,_notify:d&&a.is_unread})}}]),b}(h);l.prefixUUID="layer:///announcements/",l.bubbleEventParent="getClient",l._supportedEvents=[].concat(h._supportedEvents),l.inObjectIgnore=h.inObjectIgnore,j.initClass.apply(l,[l,"Announcement"]),i.subclasses.push(l),b.exports=l},{"../layer-error":13,"../root":44,"./conversation-message":28,"./syncable":34}],24:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../root"),i=a("./message"),j=a("../client-registry"),k=a("../layer-error"),l=a("../const"),m=a("../logger"),n=function(a){function b(a){d(this,b),a.channel&&(a.conversationId=a.channel.id);var c=e(this,Object.getPrototypeOf(b).call(this,a)),f=c.getClient();return c.isInitializing=!1,a&&a.fromServer&&f._addMessage(c),c}return f(b,a),g(b,[{key:"getConversation",value:function(a){return this.conversationId?j.get(this.clientId).getChannel(this.conversationId,a):null}},{key:"sendReceipt",value:function(){arguments.length<=0||void 0===arguments[0]?l.RECEIPT_STATE.READ:arguments[0];return m.warn("Receipts not supported for Channel Messages yet"),this}},{key:"delete",value:function(){if(this.isDestroyed)throw new Error(k.dictionary.isDestroyed);var a=this.id,b=this.getClient();this._xhr({url:"",method:"DELETE"},function(c){c.success||c.data&&("not_found"===c.data.id||"authentication_required"===c.data.id)||i.load(a,b)}),this._deleted(),this.destroy()}},{key:"_loaded",value:function(a){this.conversationId=a.channel.id,this.getClient()._addMessage(this)}}],[{key:"_createFromServer",value:function(a,c){var d=a.fromWebsocket,e=void 0;return e=a.channel?a.channel.id:a.conversationId,new b({conversationId:e,fromServer:a,clientId:c.appId,_fromDB:a._fromDB,_notify:d&&a.is_unread&&a.sender.user_id!==c.user.userId})}}]),b}(i);n.prototype.isRead=!1,n.inObjectIgnore=i.inObjectIgnore,n._supportedEvents=[].concat(i._supportedEvents),h.initClass.apply(n,[n,"ChannelMessage"]),b.exports=n},{"../client-registry":8,"../const":11,"../layer-error":13,"../logger":16,"../root":44,"./message":33}],25:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("./syncable"),k=a("./container"),l=a("./channel-message"),m=a("../layer-error"),n=a("../layer-event"),o=a("../client-utils"),p=a("../const"),q=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];d(this,b),a.membership||(a.membership={});var c=e(this,Object.getPrototypeOf(b).call(this,a));return c._members=c.getClient()._fixIdentities(a.members||[]).map(function(a){return a.id}),c._register(),c}return f(b,a),g(b,[{key:"destroy",value:function(){this.lastMessage=null,this.getClient()._removeChannel(this),h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this),this.membership=null}},{key:"createMessage",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b="string"==typeof a?{parts:[{body:a,mimeType:"text/plain"}]}:a;return b.clientId=this.clientId,b.conversationId=this.id,new l(b)}},{key:"_setupMessage",value:function(a){a.position=b.nextPosition,b.nextPosition+=8192}},{key:"_getSendData",value:function(a){var b=o.isEmpty(this.metadata),c=this._members||[];return c.indexOf(this.getClient().user.id)===-1&&c.push(this.getClient().user.id),{method:"Channel.create",data:{name:this.name,metadata:b?null:this.metadata,id:this.id,members:c}}}},{key:"_populateFromServer",value:function(a){this._inPopulateFromServer=!0,this._disableEvents=this.syncState===p.SYNC_STATE.NEW,this.name=a.name,this.isCurrentParticipant=Boolean(a.membership),this.membership=a.membership&&a.membership.id?this.getClient()._createObject(a.membership):null,h(Object.getPrototypeOf(b.prototype),"_populateFromServer",this).call(this,a),this._register(),this._disableEvents=!1}},{key:"_createResultConflict",value:function(a){var b=a.data;b?this._createSuccess(b):(this.syncState=p.SYNC_STATE.NEW,this._syncCounter=0,this.trigger("channels:sent-error",{error:a})),this._inPopulateFromServer=!1}},{key:"__adjustName",value:function(a){if(!(this._inPopulateFromServer||this._inLayerParser||this.isNew()||this.isLoading))throw new Error(m.dictionary.permissionDenied)}},{key:"__updateName",value:function(a,b){this._triggerAsync("channels:change",{property:"name",oldValue:b,newValue:a})}},{key:"addMembers",value:function(a){var b=this;return a=this.getClient()._fixIdentities(a).map(function(a){return a.id}),this.syncState===p.SYNC_STATE.NEW?(this._members=this._members.concat(a),this):(a.forEach(function(a){b._xhr({url:"/members/"+a.replace(/^layer:\/\/\/identities\//,""),method:"PUT"})}),this)}},{key:"removeMembers",value:function(a){var b=this;return a=this.getClient()._fixIdentities(a).map(function(a){return a.id}),this.syncState===p.SYNC_STATE.NEW?(a.forEach(function(a){var c=b._members.indexOf(a);c!==-1&&b._members.splice(c,1)}),this):(a.forEach(function(a){b._xhr({url:"/members/"+a.replace(/^layer:\/\/\/identities\//,""),method:"DELETE"})}),this)}},{key:"join",value:function(){return this.addMembers([this.getClient().user.id])}},{key:"leave",value:function(){return this.removeMembers([this.getClient().user.id])}},{key:"getMember",value:function(a){a=this.getClient()._fixIdentities([a])[0].id;var b=this.id+"/members/"+a.replace(/layer:\/\/\/identities\//,"");return this.getClient().getMember(b,!0)}},{key:"delete",value:function(){this._delete("")}},{key:"_handlePatchEvent",value:function(a,c,d){this._inLayerParser=!1;try{var e=this._disableEvents;this._disableEvents=!1,h(Object.getPrototypeOf(b.prototype),"_handlePatchEvent",this).call(this,a,c,d),this._disableEvents=e}catch(a){}this._inLayerParser=!0}},{key:"_register",value:function(){var a=this.getClient();a._addChannel(this)}},{key:"_deleteResult",value:function(a,c){var d=this.getClient();a.success||a.data&&("not_found"===a.data.id||"authentication_required"===a.data.id)||b.load(c,d)}},{key:"toObject",value:function(){return this._toObject||(this._toObject=h(Object.getPrototypeOf(b.prototype),"toObject",this).call(this),this._toObject.membership=o.clone(this.membership)),this._toObject}}],[{key:"_createFromServer",value:function(a,c){return new b({client:c,fromServer:a,_fromDB:a._fromDB})}},{key:"create",value:function(a){if(!a.client)throw new Error(m.dictionary.clientMissing);a.name||(a.name="channel-"+String(Math.random()).replace(/\./,""));var c={name:a.name,private:a.private,members:a.members?a.client._fixIdentities(a.members).map(function(a){return a.id}):[],metadata:a.metadata,client:a.client},d=a.client.findCachedChannel(function(a){return a.name===c.name});return d&&(d._sendDistinctEvent=new n({target:d,result:!a.metadata||o.doesObjectMatch(a.metadata,d.metadata)?b.FOUND:b.FOUND_WITHOUT_REQUESTED_METADATA},"channels:sent")),d||new b(c)}}]),b}(k);q.prototype.name="",q.prototype.membership=null,q.prototype._members=null,q.eventPrefix="channels",q.nextPosition=0x10000000000000000,q.prefixUUID="layer:///channels/",q._supportedEvents=["channels:sent","channels:sent-error","channels:loaded","channels:loaded-error","channels:delete","channels:change"].concat(j._supportedEvents),i.initClass.apply(q,[q,"Channel"]),j.subclasses.push(q),b.exports=q},{"../client-utils":9,"../const":11,"../layer-error":13,"../layer-event":14,"../root":44,"./channel-message":24,"./container":26,"./syncable":34}],26:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=a("./syncable"),k=a("../layer-error"),l=a("../client-utils"),m=a("../const"),n=a("../root"),o=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];d(this,b),a.fromServer&&(a.id=a.fromServer.id),a.client&&(a.clientId=a.client.appId),a.metadata||(a.metadata={});var c=e(this,Object.getPrototypeOf(b).call(this,a));if(!c.clientId)throw new Error(k.dictionary.clientMissing);return c.isInitializing=!0,a&&a.fromServer&&c._populateFromServer(a.fromServer),c.metadata||(c.metadata={}),c.createdAt||(c.createdAt=new Date),c.isInitializing=!1,c}return f(b,a),h(b,[{key:"send",value:function(a){var b=this;return this.isNew()&&(this.createdAt=new Date,this._setSyncing(),this.getClient().sendSocketRequest({method:"POST",body:{},sync:{depends:this.id,target:this.id}},function(a){return b._createResult(a)})),a&&this._setupMessage(a),this}},{key:"_populateFromServer",value:function(a){var b=this.getClient();this._setSynced();var c=this.id;this.id=a.id,c!==this.id&&(b._updateContainerId(this,c),this._triggerAsync(this.constructor.eventPrefix+":change",{oldValue:c,newValue:this.id,property:"id"})),this.url=a.url,this.createdAt=new Date(a.created_at),this.metadata=a.metadata}},{key:"_createResult",value:function(a){var b=a.success,c=a.data;this.isDestroyed||(b?this._createSuccess(c):"conflict"===c.id?this._createResultConflict(c):(this.trigger(this.constructor.eventPrefix+":sent-error",{error:c}),this.destroy()))}},{key:"_createSuccess",value:function(a){var c=this.id;this._populateFromServer(a),this._triggerAsync(this.constructor.eventPrefix+":sent",{result:c===this.id?b.CREATED:b.FOUND})}},{key:"setMetadataProperties",value:function(a){var b=this,c=[];return Object.keys(a).forEach(function(b){var d=b;b&&("metadata"!==b&&0!==b.indexOf("metadata.")&&(d="metadata."+b),c.push({operation:"set",property:d,value:a[b]}))}),this._inLayerParser=!0,l.layerParse({object:this,type:"Conversation",operations:c,client:this.getClient()}),this._inLayerParser=!1,this._xhr({url:"",method:"PATCH",data:JSON.stringify(c),headers:{"content-type":"application/vnd.layer-patch+json"}},function(a){a.success||b.isDestroyed||"authentication_required"===a.data.id||b._load()}),this}},{key:"deleteMetadataProperties",value:function(a){var b=this,c=[];return a.forEach(function(a){"metadata"!==a&&0!==a.indexOf("metadata.")&&(a="metadata."+a),c.push({operation:"delete",property:a})},this),this._inLayerParser=!0,l.layerParse({object:this,type:"Conversation",operations:c,client:this.getClient()}),this._inLayerParser=!1,this._xhr({url:"",method:"PATCH",data:JSON.stringify(c),headers:{"content-type":"application/vnd.layer-patch+json"}},function(a){a.success||"authentication_required"===a.data.id||b._load()}),this}},{key:"_delete",value:function(a){var b=this,c=this.id;this._xhr({method:"DELETE",url:"?"+a},function(a){return b._deleteResult(a,c)}),this._deleted(),this.destroy()}},{key:"_handleWebsocketDelete",value:function(a){a.mode===m.DELETION_MODE.MY_DEVICES&&a.from_position?this.getClient()._purgeMessagesByPosition(this.id,a.from_position):i(Object.getPrototypeOf(b.prototype),"_handleWebsocketDelete",this).call(this)}},{key:"_getUrl",value:function(a){return this.url+(a||"")}},{key:"_loaded",value:function(a){this._register(this)}},{key:"on",value:function(a,c,d){var e=this.constructor.eventPrefix+":loaded",f=a===e||a&&"object"===("undefined"==typeof a?"undefined":g(a))&&a[e];return f&&!this.isLoading&&!function(){var b=a===e?c:a[e];l.defer(function(){return b.apply(d)})}(),i(Object.getPrototypeOf(b.prototype),"on",this).call(this,a,c,d),this}},{key:"_triggerAsync",value:function(a,c){this._clearObject(),i(Object.getPrototypeOf(b.prototype),"_triggerAsync",this).call(this,a,c)}},{key:"trigger",value:function(a,c){this._clearObject(),i(Object.getPrototypeOf(b.prototype),"trigger",this).call(this,a,c)}},{key:"__updateMetadata",value:function(a,b,c){this._inLayerParser||JSON.stringify(a)!==JSON.stringify(b)&&this._triggerAsync(this.constructor.eventPrefix+":change",{property:"metadata",newValue:a,oldValue:b,paths:c})}},{key:"_handlePatchEvent",value:function(a,b,c){0===c[0].indexOf("metadata")&&this.__updateMetadata(a,b,c)}},{key:"toObject",value:function(){return this._toObject||(this._toObject=i(Object.getPrototypeOf(b.prototype),"toObject",this).call(this),this._toObject.metadata=l.clone(this.metadata)),this._toObject}}],[{key:"_loadResourceForPatch",value:function(a){return!0}}]),b}(j);o.prototype.createdAt=null,o.prototype.metadata=null,o.prototype.isCurrentParticipant=!0,o.prototype._sendDistinctEvent=null,o.prototype._toObject=null,o.bubbleEventParent="getClient",o.CREATED="Created",o.FOUND="Found",o.FOUND_WITHOUT_REQUESTED_METADATA="FoundMismatch",n.initClass.apply(o,[o,"Container"]),j.subclasses.push(o),b.exports=o},{"../client-utils":9,"../const":11,"../layer-error":13,"../root":44,"./syncable":34}],27:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../root"),i=a("../xhr"),j=function(a){function b(a){return d(this,b),"string"==typeof a&&(a={id:a}),e(this,Object.getPrototypeOf(b).call(this,a))}return f(b,a),g(b,[{key:"loadContent",value:function(a,b){i({url:this.downloadUrl,responseType:"arraybuffer"},function(c){if(c.success)if("undefined"!=typeof Blob){var d=new Blob([c.data],{type:a});b(null,d)}else b(null,c.data);else b(c.data,null)})}},{key:"refreshContent",value:function(a,b){var c=this;a.xhr({url:this.refreshUrl,method:"GET",sync:!1},function(a){var d=a.data;c.expiration=new Date(d.expiration),c.downloadUrl=d.download_url,b&&b(c.downloadUrl)})}},{key:"isExpired",value:function(){var a=6e5;return this.expiration.getTime()-a<Date.now()}}],[{key:"_createFromServer",value:function(a){return new b({id:a.id,downloadUrl:a.download_url,expiration:new Date(a.expiration),refreshUrl:a.refresh_url})}}]),b}(h);j.prototype.id="",j.prototype.blob=null,j.prototype.downloadUrl="",j.prototype.refreshUrl="",j.prototype.size=0,j.prototype.expiration=null,h.initClass.apply(j,[j,"Content"]),b.exports=j},{"../root":44,"../xhr":56}],28:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("./message"),k=a("../client-registry"),l=a("../layer-error"),m=a("../const"),n=a("../client-utils"),o=function(a){function b(a){d(this,b),a.conversation&&(a.conversationId=a.conversation.id);var c=e(this,Object.getPrototypeOf(b).call(this,a));c._disableEvents=!0,a.fromServer?c.__updateRecipientStatus(c.recipientStatus):c.recipientStatus={},c._disableEvents=!1;var f=c.getClient();if(c.isInitializing=!1,a&&a.fromServer){f._addMessage(c);var g=c.recipientStatus[f.user.id];g&&g!==m.RECEIPT_STATE.READ&&g!==m.RECEIPT_STATE.DELIVERED&&n.defer(function(){return c._sendReceipt("delivery")})}return c}return f(b,a),g(b,[{key:"getConversation",value:function(a){return this.conversationId?k.get(this.clientId).getConversation(this.conversationId,a):null}},{key:"_loaded",value:function(a){this.conversationId=a.conversation.id,this.getClient()._addMessage(this)}},{key:"__getRecipientStatus",value:function(a){var b=this,c=this[a]||{},d=this.getClient();return d&&!function(){var a=d.user.id,e=b.getConversation(!1);e&&e.participants.forEach(function(b){c[b.id]||(c[b.id]=b.id===a?m.RECEIPT_STATE.READ:m.RECEIPT_STATE.PENDING)})}(),c}},{key:"__updateRecipientStatus",value:function(a,b){var c=this.getConversation(!1),d=this.getClient();if(c&&!n.doesObjectMatch(a,b)){var e=d.user.id,f=this.sender.sessionOwner,g=a[e]===m.RECEIPT_STATE.READ;try{var h=c.participants.length-1;this.__isRead||!f&&!g||(this.__isRead=!0);var i=this._getReceiptStatus(a,e),j=i.readCount,k=i.deliveredCount;this._setReceiptStatus(j,k,h)}catch(a){}if(!this.isInitializing&&b){var l=g&&b[e]!==m.RECEIPT_STATE.READ;(l||f)&&this._triggerAsync("messages:change",{oldValue:b,newValue:a,property:"recipientStatus"})}}}},{key:"_getReceiptStatus",value:function(a,b){var c=0,d=0;return Object.keys(a).filter(function(a){return a!==b}).forEach(function(b){a[b]===m.RECEIPT_STATE.READ?(c++,d++):a[b]===m.RECEIPT_STATE.DELIVERED&&d++;
}),{readCount:c,deliveredCount:d}}},{key:"_setReceiptStatus",value:function(a,b,c){a===c?this.readStatus=m.RECIPIENT_STATE.ALL:a>0?this.readStatus=m.RECIPIENT_STATE.SOME:this.readStatus=m.RECIPIENT_STATE.NONE,b===c?this.deliveryStatus=m.RECIPIENT_STATE.ALL:b>0?this.deliveryStatus=m.RECIPIENT_STATE.SOME:this.deliveryStatus=m.RECIPIENT_STATE.NONE}},{key:"__updateIsRead",value:function(a){if(a){this._inPopulateFromServer||this._sendReceipt(m.RECEIPT_STATE.READ),this._triggerMessageRead();var b=this.getConversation(!1);b&&b.unreadCount--}}},{key:"_triggerMessageRead",value:function(){var a=this.isRead;this._triggerAsync("messages:change",{property:"isRead",oldValue:!a,newValue:a}),this._triggerAsync("messages:change",{property:"isUnread",oldValue:a,newValue:!a})}},{key:"sendReceipt",value:function(){var a=arguments.length<=0||void 0===arguments[0]?m.RECEIPT_STATE.READ:arguments[0];if(a===m.RECEIPT_STATE.READ){if(this.isRead)return this;this.__isRead=!0,this._triggerMessageRead();var b=this.getConversation(!1);b&&b.unreadCount--}return this._sendReceipt(a),this}},{key:"_sendReceipt",value:function(a){var b=this,c=this.getConversation(!1);c&&0===c.participants.length||(this._setSyncing(),this._xhr({url:"/receipts",method:"POST",data:{type:a},sync:{operation:"RECEIPT"}},function(){return b._setSynced()}))}},{key:"delete",value:function(a){if(this.isDestroyed)throw new Error(l.dictionary.isDestroyed);var b=void 0;switch(a){case m.DELETION_MODE.ALL:case!0:b="mode=all_participants";break;case m.DELETION_MODE.MY_DEVICES:b="mode=my_devices";break;default:throw new Error(l.dictionary.deletionModeUnsupported)}var c=this.id,d=this.getClient();this._xhr({url:"?"+b,method:"DELETE"},function(a){a.success||a.data&&("not_found"===a.data.id||"authentication_required"===a.data.id)||j.load(c,d)}),this._deleted(),this.destroy()}},{key:"toObject",value:function(){return this._toObject||(this._toObject=h(Object.getPrototypeOf(b.prototype),"toObject",this).call(this),this._toObject.recipientStatus=n.clone(this.recipientStatus)),this._toObject}}],[{key:"_createFromServer",value:function(a,c){var d=a.fromWebsocket,e=void 0;return e=a.conversation?a.conversation.id:a.conversationId,new b({conversationId:e,fromServer:a,clientId:c.appId,_fromDB:a._fromDB,_notify:d&&a.is_unread&&a.sender.user_id!==c.user.userId})}}]),b}(j);o.prototype.isRead=!1,o.prototype.recipientStatus=null,o.prototype.readStatus=m.RECIPIENT_STATE.NONE,o.prototype.deliveryStatus=m.RECIPIENT_STATE.NONE,o.inObjectIgnore=j.inObjectIgnore,o._supportedEvents=[].concat(j._supportedEvents),i.initClass.apply(o,[o,"ConversationMessage"]),b.exports=o},{"../client-registry":8,"../client-utils":9,"../const":11,"../layer-error":13,"../root":44,"./message":33}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("./syncable"),k=a("./container"),l=a("./conversation-message"),m=a("../layer-error"),n=a("../client-utils"),o=a("../const"),p=a("../layer-event"),q=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];d(this,b),a.participants||(a.participants=[]);var c=e(this,Object.getPrototypeOf(b).call(this,a));c.isInitializing=!0;var f=c.getClient();return a&&a.fromServer||(c.participants=f._fixIdentities(c.participants),c.participants.indexOf(f.user)===-1&&c.participants.push(f.user)),c._register(),c.isInitializing=!1,c}return f(b,a),g(b,[{key:"destroy",value:function(){this.lastMessage=null,this.clientId&&this.getClient()._removeConversation(this),h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this),this.participants=null,this.metadata=null}},{key:"createMessage",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b="string"==typeof a?{parts:[{body:a,mimeType:"text/plain"}]}:a;return b.clientId=this.clientId,b.conversationId=this.id,new l(b)}},{key:"_setupMessage",value:function(a){var b=void 0;b=this.lastMessage?this.lastMessage.position+1:0,a.position=b,this.lastMessage=a}},{key:"send",value:function(a){var c=this.getClient();if(!c)throw new Error(m.dictionary.clientMissing);var d=Boolean(this._sendDistinctEvent);return this._sendDistinctEvent&&this._handleLocalDistinctConversation(),d||this.syncState!==o.SYNC_STATE.NEW?(a&&this._setupMessage(a),this):(this.participants.indexOf(c.user)===-1&&this.participants.push(c.user),h(Object.getPrototypeOf(b.prototype),"send",this).call(this,a))}},{key:"_handleLocalDistinctConversation",value:function(){var a=this._sendDistinctEvent;return this._sendDistinctEvent=null,this._triggerAsync("conversations:sent",a),this}},{key:"_getSendData",value:function(a){var b=n.isEmpty(this.metadata);return{method:"Conversation.create",data:{participants:this.participants.map(function(a){return a.id}),distinct:this.distinct,metadata:b?null:this.metadata,id:this.id}}}},{key:"_populateFromServer",value:function(a){var c=this,d=this.getClient();this._disableEvents=this.syncState===o.SYNC_STATE.NEW,this.participants=d._fixIdentities(a.participants),this.participants.forEach(function(a){return a.on("identities:change",c._handleParticipantChangeEvent,c)}),this.distinct=a.distinct,this.unreadCount=a.unread_message_count,this.isCurrentParticipant=this.participants.indexOf(d.user)!==-1,h(Object.getPrototypeOf(b.prototype),"_populateFromServer",this).call(this,a),"string"==typeof a.last_message?this.lastMessage=d.getMessage(a.last_message):a.last_message&&(this.lastMessage=d._createObject(a.last_message)),this._register(),this._disableEvents=!1}},{key:"_createResultConflict",value:function(a){this._populateFromServer(a.data),this._triggerAsync(this.constructor.eventPrefix+":sent",{result:b.FOUND_WITHOUT_REQUESTED_METADATA})}},{key:"addParticipants",value:function(a){var b=this,c=this.getClient(),d=c._fixIdentities(a),e=d.filter(function(a){return b.participants.indexOf(a)===-1});return this._patchParticipants({add:e,remove:[]}),this}},{key:"removeParticipants",value:function(a){var b={};this.participants.forEach(function(a){return b[a.id]=!0});var c=this.getClient(),d=c._fixIdentities(a),e=d.filter(function(a){return b[a.id]});if(0===e.length)return this;if(e.length===this.participants.length)throw new Error(m.dictionary.moreParticipantsRequired);return this._patchParticipants({add:[],remove:e}),this}},{key:"replaceParticipants",value:function(a){if(!a||!a.length)throw new Error(m.dictionary.moreParticipantsRequired);var b=this.getClient(),c=b._fixIdentities(a),d=this._getParticipantChange(c,this.participants);return this._patchParticipants(d),this}},{key:"_patchParticipants",value:function(a){var b=this;this._applyParticipantChange(a),this.isCurrentParticipant=this.participants.indexOf(this.getClient().user)!==-1;var c=[];a.remove.forEach(function(a){c.push({operation:"remove",property:"participants",id:a.id})}),a.add.forEach(function(a){c.push({operation:"add",property:"participants",id:a.id})}),this._xhr({url:"",method:"PATCH",data:JSON.stringify(c),headers:{"content-type":"application/vnd.layer-patch+json"}},function(a){a.success||"authentication_required"===a.data.id||b._load()})}},{key:"_applyParticipantChange",value:function(a){var b=[].concat(this.participants);a.add.forEach(function(a){b.indexOf(a)===-1&&b.push(a)}),a.remove.forEach(function(a){var c=b.indexOf(a);c!==-1&&b.splice(c,1)}),this.participants=b}},{key:"leave",value:function(){if(this.isDestroyed)throw new Error(m.dictionary.isDestroyed);this._delete("mode="+o.DELETION_MODE.MY_DEVICES+"&leave=true")}},{key:"delete",value:function(a){if(this.isDestroyed)throw new Error(m.dictionary.isDestroyed);var b=void 0;switch(a){case o.DELETION_MODE.ALL:case!0:b="mode="+o.DELETION_MODE.ALL;break;case o.DELETION_MODE.MY_DEVICES:b="mode="+o.DELETION_MODE.MY_DEVICES+"&leave=false";break;default:throw new Error(m.dictionary.deletionModeUnsupported)}this._delete(b)}},{key:"_handlePatchEvent",value:function(a,c,d){var e=this;this._inLayerParser=!1;try{var f=this._disableEvents;this._disableEvents=!1,"participants"===d[0]?!function(){var b=e.getClient();c=c.map(function(a){return b.getIdentity(a.id)}),a=a.map(function(a){return b.getIdentity(a.id)}),e.__updateParticipants(a,c)}():h(Object.getPrototypeOf(b.prototype),"_handlePatchEvent",this).call(this,a,c,d),this._disableEvents=f}catch(a){}this._inLayerParser=!0}},{key:"_getParticipantChange",value:function(a,b){var c={};return c.add=a.filter(function(a){return b.indexOf(a)===-1}),c.remove=b.filter(function(b){return a.indexOf(b)===-1}),c}},{key:"_deleteResult",value:function(a,c){var d=this.getClient();a.success||a.data&&("not_found"===a.data.id||"authentication_required"===a.data.id)||b.load(c,d)}},{key:"_register",value:function(){var a=this.getClient();a&&a._addConversation(this)}},{key:"__adjustUnreadCount",value:function(a){if(a<0)return 0}},{key:"__updateUnreadCount",value:function(a,b){var c=this;this._inLayerParser?(void 0===this._oldUnreadCount&&(this._oldUnreadCount=b),this._updateUnreadCountTimeout&&clearTimeout(this._updateUnreadCountTimeout),this._updateUnreadCountTimeout=setTimeout(function(){return c._updateUnreadCountEvent()},1e3)):this._updateUnreadCountEvent()}},{key:"_updateUnreadCountEvent",value:function(){if(!this.isDestroyed){var a=this._oldUnreadCount,b=this.__unreadCount;this._oldUnreadCount=void 0,b!==a&&this._triggerAsync("conversations:change",{newValue:b,oldValue:a,property:"unreadCount"})}}},{key:"__updateLastMessage",value:function(a,b){a&&b&&a.id===b.id||this._triggerAsync("conversations:change",{property:"lastMessage",newValue:a,oldValue:b})}},{key:"__updateParticipants",value:function(a,b){var c=this;if(!this._inLayerParser){var d=this._getParticipantChange(a,b);d.add.forEach(function(a){return a.on("identities:change",c._handleParticipantChangeEvent,c)}),d.remove.forEach(function(a){return a.off("identities:change",c._handleParticipantChangeEvent,c)}),(d.add.length||d.remove.length)&&(d.property="participants",d.oldValue=b,d.newValue=a,this._triggerAsync("conversations:change",d))}}},{key:"_handleParticipantChangeEvent",value:function(a){var b=this;a.changes.forEach(function(c){b._triggerAsync("conversations:change",{property:"participants."+c.property,identity:a.target,oldValue:c.oldValue,newValue:c.newValue})})}}],[{key:"_createFromServer",value:function(a,c){return new b({client:c,fromServer:a,_fromDB:a._fromDB})}},{key:"create",value:function(a){if(!a.client)throw new Error(m.dictionary.clientMissing);var c={distinct:a.distinct,participants:a.client._fixIdentities(a.participants),metadata:a.metadata,client:a.client};if(c.distinct){var d=this._createDistinct(c);if(d)return d}return new b(c)}},{key:"_createDistinct",value:function(a){a.participants.indexOf(a.client.user)===-1&&a.participants.push(a.client.user);var c={};a.participants.forEach(function(a){c[a.id]=a});var d=a.client.findCachedConversation(function(b){if(b.distinct&&b.participants.length===a.participants.length){for(var d=0;d<b.participants.length;d++)if(!c[b.participants[d].id])return!1;return!0}});if(d)return d._sendDistinctEvent=new p({target:d,result:!a.metadata||n.doesObjectMatch(a.metadata,d.metadata)?b.FOUND:b.FOUND_WITHOUT_REQUESTED_METADATA},"conversations:sent"),d}}]),b}(k);q.prototype.participants=null,q.prototype.unreadCount=0,q.prototype.distinct=!0,q.prototype.lastMessage=null,q.eventPrefix="conversations",q.FOUND_WITHOUT_REQUESTED_METADATA="FoundMismatch",q.prefixUUID="layer:///conversations/",q._supportedEvents=["conversations:sent","conversations:sent-error","conversations:loaded","conversations:loaded-error","conversations:delete","conversations:change"].concat(j._supportedEvents),i.initClass.apply(q,[q,"Conversation"]),j.subclasses.push(q),b.exports=q},{"../client-utils":9,"../const":11,"../layer-error":13,"../layer-event":14,"../root":44,"./container":26,"./conversation-message":28,"./syncable":34}],30:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("./syncable"),j=a("../root"),k=a("../const"),l=k.SYNC_STATE,m=a("../layer-error"),n=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(d(this,b),a.fromServer?a.id=a.fromServer.id||"-":!a.id&&a.userId?a.id=b.prefixUUID+encodeURIComponent(a.userId):a.id&&!a.userId&&(a.userId=a.id.substring(b.prefixUUID.length)),a.client&&(a.clientId=a.client.appId),!a.clientId)throw new Error(m.dictionary.clientMissing);var c=e(this,Object.getPrototypeOf(b).call(this,a));return"-"===c.id&&(c.id=""),c.isInitializing=!0,c._presence||(c._presence={status:null,lastSeenAt:null}),a&&a.fromServer&&c._populateFromServer(a.fromServer),!c.url&&c.id?c.url=c.getClient().url+"/"+c.id.substring(9):c.url||(c.url=""),c.getClient()._addIdentity(c),c.getClient().on("online",function(a){a.isOnline||c._updateValue(["_presence","status"],b.STATUS.OFFLINE)},c),c.isInitializing=!1,c}return f(b,a),g(b,[{key:"destroy",value:function(){var a=this.getClient();a&&a._removeIdentity(this),h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_triggerAsync",value:function(a,c){this._clearObject(),h(Object.getPrototypeOf(b.prototype),"_triggerAsync",this).call(this,a,c)}},{key:"trigger",value:function(a,c){this._clearObject(),h(Object.getPrototypeOf(b.prototype),"trigger",this).call(this,a,c)}},{key:"_populateFromServer",value:function(a){var b=this,c=this.getClient();this._disableEvents=this.syncState===l.NEW,this._setSynced(),this.userId=a.user_id||"",this._updateValue(["avatarUrl"],a.avatar_url),this._updateValue(["displayName"],a.display_name);var d="metadata"in a;d&&(this.url=a.url,this.type=a.type,this._updateValue(["emailAddress"],a.email_address),this._updateValue(["lastName"],a.last_name),this._updateValue(["firstName"],a.first_name),this._updateValue(["metadata"],a.metadata),this._updateValue(["publicKey"],a.public_key),this._updateValue(["phoneNumber"],a.phone_number),this.isFullIdentity=!0),!this.url&&this.id&&(this.url=this.getClient().url+this.id.substring(8)),this._disableEvents=!1,!this.isFullIdentity&&c.isAuthenticated&&c.dbManager.getObjects("identities",[this.id],function(a){a.length&&b._populateFromServer(a[0])})}},{key:"_updateValue",value:function(a,b){null!==b&&void 0!==b||(b="");for(var c=this,d=0;d<a.length-1;d++)c=c[a[d]];var e=a[a.length-1];c[e]!==b&&(this.isInitializing||("_presence"===a[0]&&(a=[a[1]]),this._triggerAsync("identities:change",{property:a.join("."),oldValue:c[e],newValue:b})),c[e]=b)}},{key:"_handlePatchEvent",value:function(a,b,c){var d=this;c.forEach(function(c){var e=a,f=b;"presence.last_seen_at"===c?(d._presence.lastSeenAt=new Date(e.last_seen_at),e=d._presence.lastSeenAt,f=f.lastSeenAt,delete d._presence.last_seen_at):"presence.status"===c&&(e=d._presence.status,f=f.status);var g=c.replace(/_(.)/g,function(a,b){return b.toUpperCase()}).replace(/^presence\./,"");d._triggerAsync("identities:change",{property:g,oldValue:f,newValue:e})})}},{key:"follow",value:function(){var a=this;this.isFullIdentity||(this._xhr({method:"PUT",url:this.url.replace(/identities/,"following/users"),syncable:{}},function(b){b.success&&a._load()}),this.syncState=l.LOADING)}},{key:"unfollow",value:function(){this._xhr({url:this.url.replace(/identities/,"following/users"),method:"DELETE",syncable:{}})}},{key:"setStatus",value:function(a){var c=this;if(a=(a||"").toLowerCase(),!b.STATUS[a.toUpperCase()])throw new Error(m.dictionary.valueNotSupported);if(this!==this.getClient().user)throw new Error(m.dictionary.permissionDenied);a===b.STATUS.INVISIBLE&&(a=b.STATUS.OFFLINE);var d=this._presence.status;this.getClient().sendSocketRequest({method:"PATCH",body:{method:"Presence.update",data:[{operation:"set",property:"status",value:a}]},sync:{depends:[this.id],target:this.id}},function(a){a.success||"authentication_required"===a.data.id||c._updateValue(["_presence","status"],d)}),a===b.STATUS.OFFLINE&&(a=b.STATUS.INVISIBLE),this._updateValue(["_presence","status"],a)}},{key:"_setUserId",value:function(a){var c=this.getClient();c._removeIdentity(this),this.__userId=a;var d=encodeURIComponent(a);this.id=b.prefixUUID+d,this.url=this.getClient().url+"/identities/"+d,c._addIdentity(this)}},{key:"__adjustUserId",value:function(a){if(this.__userId)throw new Error(m.dictionary.cantChangeUserId)}},{key:"_handleWebsocketDelete",value:function(a){var b=this;this.getClient().dbManager.deleteObjects("identities",[this]),["firstName","lastName","emailAddress","phoneNumber","metadata","publicKey","isFullIdentity","type"].forEach(function(a){return delete b[a]}),this._triggerAsync("identities:unfollow")}}],[{key:"_createFromServer",value:function(a,c){return new b({client:c,fromServer:a,_fromDB:a._fromDB})}}]),b}(i);n.prototype.displayName="",n.prototype.sessionOwner=!1,n.prototype.clientId="",n.prototype.isFullIdentity=!1,n.prototype.userId="",n.prototype.avatarUrl="",n.prototype.firstName="",n.prototype.lastName="",n.prototype.emailAddress="",n.prototype.phoneNumber="",n.prototype.metadata=null,n.prototype.publicKey="",n.UserType="user",n.BotType="bot",n.prototype.type=n.UserType,n.prototype._presence=null,Object.defineProperty(n.prototype,"status",{enumerable:!0,get:function(){return this._presence&&this._presence.status||n.STATUS.OFFLINE}}),Object.defineProperty(n.prototype,"lastSeenAt",{enumerable:!0,get:function(){return this._presence&&this._presence.lastSeenAt}}),Object.defineProperty(n.prototype,"isBot",{enumerable:!0,get:function(){return this.type===n.BotType}}),n.STATUS={AVAILABLE:"available",AWAY:"away",OFFLINE:"offline",BUSY:"busy",INVISIBLE:"invisible"},n.inObjectIgnore=j.inObjectIgnore,n.bubbleEventParent="getClient",n._supportedEvents=["identities:change","identities:loaded","identities:loaded-error","identities:unfollow"].concat(i._supportedEvents),n.eventPrefix="identities",n.prefixUUID="layer:///identities/",n.enableOpsIfNew=!0,j.initClass.apply(n,[n,"Identity"]),i.subclasses.push(n),b.exports=n},{"../const":11,"../layer-error":13,"../root":44,"./syncable":34}],31:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("./syncable"),j=a("../root"),k=a("../const"),l=a("../layer-error"),m=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(d(this,b),a.fromServer?a.id=a.fromServer.id:a.id&&!a.userId&&(a.userId=a.id.replace(/^.*\//,"")),a.client&&(a.clientId=a.client.appId),!a.clientId)throw new Error(l.dictionary.clientMissing);var c=e(this,Object.getPrototypeOf(b).call(this,a));return c.isInitializing=!0,a&&a.fromServer&&c._populateFromServer(a.fromServer),!c.url&&c.id?c.url=c.getClient().url+"/"+c.id.substring(9):c.url||(c.url=""),c.getClient()._addMembership(c),c.isInitializing=!1,c}return f(b,a),g(b,[{key:"destroy",value:function(){var a=this.getClient();a&&a._removeMembership(this),h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_triggerAsync",value:function(a,c){this._clearObject(),h(Object.getPrototypeOf(b.prototype),"_triggerAsync",this).call(this,a,c)}},{key:"trigger",value:function(a,c){this._clearObject(),h(Object.getPrototypeOf(b.prototype),"trigger",this).call(this,a,c)}},{key:"_populateFromServer",value:function(a){var b=this,c=this.getClient();this._disableEvents=this.syncState===k.SYNC_STATE.NEW,this._setSynced(),this.userId=a.identity?a.identity.user_id||"":c.user.userId,this.channelId=a.channel.id,this.identity=a.identity?c._createObject(a.identity):c.user,this.identity.on("identities:change",function(a){b.trigger("members:change",{property:"identity"})},this),!this.url&&this.id&&(this.url=this.getClient().url+this.id.substring(8)),this._disableEvents=!1}},{key:"_updateValue",value:function(a,b){null!==b&&void 0!==b||(b=""),this[a]!==b&&(this.isInitializing||this._triggerAsync("members:change",{property:a,oldValue:this[a],newValue:b}),this[a]=b)}},{key:"__getUserId",value:function(){return this.identity?this.identity.userId:""}},{key:"__updateIdentity",value:function(a,b){b&&b.off(null,null,this)}}],[{key:"_createFromServer",value:function(a,c){return new b({client:c,fromServer:a,_fromDB:a._fromDB})}}]),b}(i);m.prototype.userId="",m.prototype.channelId="",m.prototype.role=null,m.prototype.identity="",m.inObjectIgnore=j.inObjectIgnore,m.bubbleEventParent="getClient",m._supportedEvents=["members:change","members:loaded","members:loaded-error"].concat(i._supportedEvents),m.eventPrefix="members",m.prefixUUID="/members/",j.initClass.apply(m,[m,"Membership"]),i.subclasses.push(m),b.exports=m},{"../const":11,"../layer-error":13,"../root":44,"./syncable":34}],32:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("./content"),k=a("../xhr"),l=a("../client-registry"),m=a("../layer-error"),n=a("../client-utils"),o=a("../logger"),p=function(a){function b(a){d(this,b);var c=a;if("string"==typeof a)c={body:a},(arguments.length<=1?0:arguments.length-1)>0?c.mimeType=arguments.length<=1?void 0:arguments[1]:c.mimeType="text/plain";else if(n.isBlob(a)||n.isBlob(a.body)){var f=a instanceof Blob?a:a.body,g=n.isBlob(a.body)?a.mimeType:f.type;c={mimeType:g,body:f,size:f.size,hasContent:!0}}var h=e(this,Object.getPrototypeOf(b).call(this,c));!h.size&&h.body&&(h.size=h.body.length),"base64"===a.encoding&&(h.body=n.base64ToBlob(h.body));var i=n.isBlob(h.body),j=h.isTextualMimeType();return j||(!i&&h.body&&(h.body=new Blob([h.body],{type:h.mimeType})),h.body&&(h.url=URL.createObjectURL(h.body))),h}return f(b,a),g(b,[{key:"destroy",value:function(){this.__url&&(URL.revokeObjectURL(this.__url),this.__url=null),this.body=null,h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_getClient",value:function(){return l.get(this.clientId)}},{key:"_getMessage",value:function(){return this._getClient().getMessage(this.id.replace(/\/parts.*$/,""))}},{key:"fetchContent",value:function(a){var b=this;if(this._content&&!this.isFiring){this.isFiring=!0;var c="image/jpeg+preview"===this.mimeType?"image/jpeg":this.mimeType;this._content.loadContent(c,function(c,d){b.isDestroyed||b._fetchContentCallback(c,d,a)})}return this}},{key:"_fetchContentCallback",value:function(a,b,c){var d=this;a?this.trigger("content-loaded-error",a):(this.isFiring=!1,this.isTextualMimeType()?n.fetchTextFromFile(b,function(a){return d._fetchContentComplete(a,c)}):(this.url=URL.createObjectURL(b),this._fetchContentComplete(b,c)))}},{key:"_fetchContentComplete",value:function(a,b){var c=this._getMessage();c&&(this.body=a,this.trigger("content-loaded"),c._triggerAsync("messages:change",{oldValue:c.parts,newValue:c.parts,property:"parts"}),b&&b(this.body))}},{key:"fetchStream",value:function(a){var b=this;if(!this._content)throw new Error(m.dictionary.contentRequired);return this._content.isExpired()?this._content.refreshContent(this._getClient(),function(c){return b._fetchStreamComplete(c,a)}):this._fetchStreamComplete(this._content.downloadUrl,a),this}},{key:"_fetchStreamComplete",value:function(a,b){var c=this._getMessage();this.trigger("url-loaded"),this._triggerAsync("messageparts:change",{oldValue:"",newValue:a,property:"url"}),c._triggerAsync("messages:change",{oldValue:c.parts,newValue:c.parts,property:"parts"}),b&&b(a)}},{key:"_send",value:function(a){this._content?this._sendWithContent():this.size>2048?this._generateContentAndSend(a):n.isBlob(this.body)?this._sendBlob(a):this._sendBody()}},{key:"_sendBody",value:function(){if("string"!=typeof this.body){var a="MessagePart.body must be a string in order to send it";throw o.error(a,{mimeType:this.mimeType,body:this.body}),new Error(a)}var b={mime_type:this.mimeType,body:this.body};this.trigger("parts:send",b)}},{key:"_sendWithContent",value:function(){this.trigger("parts:send",{mime_type:this.mimeType,content:{size:this.size,id:this._content.id}})}},{key:"_sendBlob",value:function(a){var b=this;n.blobToBase64(this.body,function(c){if(c.length<2048){var d=c.substring(c.indexOf(",")+1),e={body:d,mime_type:b.mimeType};e.encoding="base64",b.trigger("parts:send",e)}else b._generateContentAndSend(a)})}},{key:"_generateContentAndSend",value:function(a){var b=this;this.hasContent=!0;var c=void 0;c=n.isBlob(this.body)?this.body:n.base64ToBlob(n.utoa(this.body),this.mimeType),a.xhr({url:"/content",method:"POST",headers:{"Upload-Content-Type":this.mimeType,"Upload-Content-Length":c.size,"Upload-Origin":"undefined"!=typeof location?location.origin:""},sync:{}},function(d){return b._processContentResponse(d.data,c,a)})}},{key:"_processContentResponse",value:function(a,b,c){var d=this;this._content=new j(a.id),this.hasContent=!0,k({url:a.upload_url,method:"PUT",data:b,headers:{"Upload-Content-Length":this.size,"Upload-Content-Type":this.mimeType}},function(b){return d._processContentUploadResponse(b,a,c)})}},{key:"_processContentUploadResponse",value:function(a,b,c){a.success?this.trigger("parts:send",{mime_type:this.mimeType,content:{size:this.size,id:this._content.id}}):c.onlineManager.isOnline?o.error("We don't yet handle this!"):c.onlineManager.once("connected",this._processContentResponse.bind(this,b,c),this)}},{key:"getText",value:function(){return this.isTextualMimeType()?this.body:""}},{key:"_populateFromServer",value:function(a){a.content&&this._content&&(this._content.downloadUrl=a.content.download_url,this._content.expiration=new Date(a.content.expiration))}},{key:"isTextualMimeType",value:function(){var a=0;for(a=0;a<b.TextualMimeTypes.length;a++){var c=b.TextualMimeTypes[a];if("string"==typeof c){if(c===this.mimeType)return!0}else if(c instanceof RegExp&&this.mimeType.match(c))return!0}return!1}},{key:"__updateBody",value:function(a,b){this._triggerAsync("messageparts:change",{property:"body",newValue:a,oldValue:b})}},{key:"__updateMimeType",value:function(a,b){this._triggerAsync("messageparts:change",{property:"mimeType",newValue:a,oldValue:b})}}],[{key:"_createFromServer",value:function(a){var c=a.content?j._createFromServer(a.content):null;return"base64"===a.encoding&&(a.body=n.base64ToBlob(a.body,a.mimeType)),new b({id:a.id,mimeType:a.mime_type,body:a.body||"",_content:c,hasContent:Boolean(c),size:a.size||0})}}]),b}(i);p.prototype.clientId="",p.prototype.id="",p.prototype.body=null,p.prototype._content=null,p.prototype.hasContent=!1,Object.defineProperty(p.prototype,"url",{enumerable:!0,get:function(){return this.__url?this.__url:this._content?this._content.isExpired()?"":this._content.downloadUrl:""},set:function(a){this.__url=a}}),p.prototype.mimeType="text/plain",p.prototype.size=0,p.TextualMimeTypes=[/^text\/.+$/,/^application\/json(\+.+)?$/],p._supportedEvents=["parts:send","content-loaded","url-loaded","content-loaded-error","messageparts:change"].concat(i._supportedEvents),i.initClass.apply(p,[p,"MessagePart"]),b.exports=p},{"../client-registry":8,"../client-utils":9,"../layer-error":13,"../logger":16,"../root":44,"../xhr":56,"./content":27}],33:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;
var g=e.get;if(void 0!==g)return g.call(d)},j=a("../root"),k=a("./syncable"),l=a("./message-part"),m=a("../layer-error"),n=a("../const"),o=a("../client-utils"),p=a("./identity"),q=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(d(this,b),a.fromServer?a.id=a.fromServer.id:"isUnread"in a?(a.isRead=!a.isUnread&&!a.is_unread,delete a.isUnread):a.isRead=!0,a.client&&(a.clientId=a.client.appId),!a.clientId)throw new Error(m.dictionary.clientMissing);var c=a.parts;a.parts=null;var f=e(this,Object.getPrototypeOf(b).call(this,a));f.parts=c;var g=f.getClient();return f.isInitializing=!0,a&&a.fromServer?f._populateFromServer(a.fromServer):(g&&(f.sender=g.user),f.sentAt=new Date),f.parts||(f.parts=[]),f}return f(b,a),h(b,[{key:"__adjustParts",value:function(a){var b=this,c=void 0;return"string"==typeof a?c=[new l({body:a,mimeType:"text/plain",clientId:this.clientId})]:Array.isArray(a)?c=a.map(function(a){var c=void 0;return c=a instanceof l?a:new l(a),c.clientId=b.clientId,c}):a&&"object"===("undefined"==typeof a?"undefined":g(a))&&(a.clientId=this.clientId,c=[new l(a)]),c&&c.forEach(function(a){a.off("messageparts:change",b._onMessagePartChange,b),a.on("messageparts:change",b._onMessagePartChange,b)}),c}},{key:"addPart",value:function(a){if(a){a.clientId=this.clientId,a instanceof l?this.parts.push(a):"object"===("undefined"==typeof a?"undefined":g(a))&&this.parts.push(new l(a));var b=this.parts[this.parts.length-1];b.off("messageparts:change",this._onMessagePartChange,this),b.on("messageparts:change",this._onMessagePartChange,this)}return this}},{key:"_onMessagePartChange",value:function(a){var b=this;a.changes.forEach(function(c){b._triggerAsync("messages:change",{property:"parts."+c.property,oldValue:c.oldValue,newValue:c.newValue,part:a.target})})}},{key:"presend",value:function(){var a=this,b=this.getClient();if(!b)throw new Error(m.dictionary.clientMissing);var c=this.getConversation(!1);if(!c)throw new Error(m.dictionary.conversationMissing);if(this.syncState!==n.SYNC_STATE.NEW)throw new Error(m.dictionary.alreadySent);c._setupMessage(this),this._readAllBlobs(function(){b._addMessage(a)})}},{key:"send",value:function(a){var b=this,c=this.getClient();if(!c)throw new Error(m.dictionary.clientMissing);var d=this.getConversation(!0);if(!d)throw new Error(m.dictionary.conversationMissing);if(this.syncState!==n.SYNC_STATE.NEW)throw new Error(m.dictionary.alreadySent);if(d.isLoading)return d.once(d.constructor.eventPrefix+":loaded",function(){return b.send(a)}),this;if(!this.parts||!this.parts.length)throw new Error(m.dictionary.partsMissing);return this._setSyncing(),d.send(this),this._readAllBlobs(function(){c._addMessage(b),b.trigger("messages:sending");var d={parts:new Array(b.parts.length),id:b.id};a&&b.conversationId&&(d.notification=a),b._preparePartsForSending(d)}),this}},{key:"_readAllBlobs",value:function(a){var b=0,c=this.parts.filter(function(a){return o.isBlob(a.body)&&a.isTextualMimeType()});c.forEach(function(d){o.fetchTextFromFile(d.body,function(e){d.body=e,b++,b===c.length&&a()})}),c.length||a()}},{key:"_preparePartsForSending",value:function(a){var b=this,c=this.getClient(),d=0;this.parts.forEach(function(e,f){e.once("parts:send",function(c){a.parts[f]={mime_type:c.mime_type},c.content&&(a.parts[f].content=c.content),c.body&&(a.parts[f].body=c.body),c.encoding&&(a.parts[f].encoding=c.encoding),d++,d===b.parts.length&&b._send(a)},b),e._send(c)})}},{key:"_send",value:function(a){var b=this,c=this.getClient(),d=this.getConversation(!1);this.sentAt=new Date,c.sendSocketRequest({method:"POST",body:{method:"Message.create",object_id:d.id,data:a},sync:{depends:[this.conversationId,this.id],target:this.id}},function(a,c){return b._sendResult(a,c)})}},{key:"_getSendData",value:function(a){return a.object_id=this.conversationId,a}},{key:"_sendResult",value:function(a){var b=a.success,c=a.data;this.isDestroyed||(b?(this._populateFromServer(c),this._triggerAsync("messages:sent"),this._triggerAsync("messages:change",{property:"syncState",oldValue:n.SYNC_STATE.SAVING,newValue:n.SYNC_STATE.SYNCED})):(this.trigger("messages:sent-error",{error:c}),this.destroy()),this._setSynced())}},{key:"on",value:function(a,c,d){var e="messages:loaded"===a||a&&"object"===("undefined"==typeof a?"undefined":g(a))&&a["messages:loaded"];return e&&!this.isLoading&&!function(){var b="messages:loaded"===a?c:a["messages:loaded"];o.defer(function(){return b.apply(d)})}(),i(Object.getPrototypeOf(b.prototype),"on",this).call(this,a,c,d),this}},{key:"destroy",value:function(){var a=this.getClient();a&&a._removeMessage(this),this.parts.forEach(function(a){return a.destroy()}),this.__parts=null,i(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_populateFromServer",value:function(a){var b=this;this._inPopulateFromServer=!0;var c=this.getClient();this.id=a.id,this.url=a.url;var d=this.position;this.position=a.position,this.parts&&this.parts.forEach(function(a,c){a.id||(a.id=b.id+"/parts/"+c)}),this.parts=a.parts.map(function(a){var c=b.getPartById(a.id);return c?(c._populateFromServer(a),c):l._createFromServer(a)}),this.recipientStatus=a.recipient_status||{},this.isRead=!("is_unread"in a)||!a.is_unread,this.sentAt=new Date(a.sent_at),this.receivedAt=a.received_at?new Date(a.received_at):void 0;var e=void 0;a.sender.id&&(e=c.getIdentity(a.sender.id)),e||(e=p._createFromServer(a.sender,c)),this.sender=e,this._setSynced(),d&&d!==this.position&&this._triggerAsync("messages:change",{oldValue:d,newValue:this.position,property:"position"}),this._inPopulateFromServer=!1}},{key:"getPartById",value:function(a){var b=this.parts?this.parts.filter(function(b){return b.id===a})[0]:null;return b||null}},{key:"_handlePatchEvent",value:function(a,b,c){this._inLayerParser=!1,0===c[0].indexOf("recipient_status")&&this.__updateRecipientStatus(this.recipientStatus,b),this._inLayerParser=!0}},{key:"_getUrl",value:function(a){return this.url+(a||"")}},{key:"_setupSyncObject",value:function(a){return a!==!1&&(a=i(Object.getPrototypeOf(b.prototype),"_setupSyncObject",this).call(this,a),a.depends?a.depends.indexOf(this.id)===-1&&a.depends.push(this.conversationId):a.depends=[this.conversationId]),a}},{key:"getText",value:function(){var a=arguments.length<=0||void 0===arguments[0]?". ":arguments[0],b=this.parts.filter(function(a){return"text/plain"===a.mimeType}).map(function(a){return a.body});return b=b.filter(function(a){return a}),b.join(a)}},{key:"toObject",value:function(){return this._toObject||(this._toObject=i(Object.getPrototypeOf(b.prototype),"toObject",this).call(this)),this._toObject}},{key:"_triggerAsync",value:function(a,c){this._clearObject(),i(Object.getPrototypeOf(b.prototype),"_triggerAsync",this).call(this,a,c)}},{key:"trigger",value:function(a,c){this._clearObject(),i(Object.getPrototypeOf(b.prototype),"trigger",this).call(this,a,c)}}],[{key:"_loadResourceForPatch",value:function(a){return!1}}]),b}(k);q.prototype.clientId="",q.prototype.conversationId="",q.prototype.parts=null,q.prototype.sentAt=null,q.prototype.receivedAt=null,q.prototype.sender=null,q.prototype.position=0,q.prototype._notify=!1,Object.defineProperty(q.prototype,"isUnread",{enumerable:!0,get:function(){return!this.isRead}}),q.prototype._toObject=null,q.prototype._inPopulateFromServer=!1,q.eventPrefix="messages",q.eventPrefix="messages",q.prefixUUID="layer:///messages/",q.inObjectIgnore=k.inObjectIgnore,q.bubbleEventParent="getClient",q.imageTypes=["image/gif","image/png","image/jpeg","image/jpg"],q._supportedEvents=["messages:loaded","messages:loaded-error","messages:delete","messages:sending","messages:sent","messages:sent-error","messages:change"].concat(k._supportedEvents),j.initClass.apply(q,[q,"Message"]),k.subclasses.push(q),b.exports=q},{"../client-utils":9,"../const":11,"../layer-error":13,"../root":44,"./identity":30,"./message-part":32,"./syncable":34}],34:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("../const"),k=j.SYNC_STATE,l=a("../layer-error"),m=a("../client-registry"),n=a("../const"),o=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];d(this,b);var c=e(this,Object.getPrototypeOf(b).call(this,a));return c.localCreatedAt=new Date,c}return f(b,a),g(b,[{key:"getClient",value:function(){return m.get(this.clientId)}},{key:"_xhr",value:function(a,b){var c=this;a.url||(a.url=""),a.method||(a.method="GET");var d=this.getClient();if(this.isDestroyed)throw new Error(l.dictionary.isDestroyed);if(!d)throw new Error(l.dictionary.clientMissing);return this.constructor.enableOpsIfNew||"POST"===a.method||"GET"===a.method||this.syncState!==n.SYNC_STATE.NEW?(a.url.match(/^http(s):\/\//)||(a.url&&!a.url.match(/^(\/|\?)/)&&(a.url="/"+a.url),a.sync||(a.url=this.url+a.url)),a.sync=this._setupSyncObject(a.sync),"GET"!==a.method&&this._setSyncing(),d.xhr(a,function(d){d.success&&"GET"!==a.method&&!c.isDestroyed&&c._setSynced(),b&&b(d)}),this):this}},{key:"_setupSyncObject",value:function(a){return a!==!1&&(a||(a={}),a.target||(a.target=this.id)),a}},{key:"_handleWebsocketDelete",value:function(a){this._deleted(),this.destroy()}},{key:"_deleted",value:function(){this.trigger(this.constructor.eventPrefix+":delete")}},{key:"_load",value:function(){var a=this;this.syncState=k.LOADING,this._xhr({method:"GET",sync:!1},function(b){return a._loadResult(b)})}},{key:"_loadResult",value:function(a){var b=this;if(!this.isDestroyed){var c=this.constructor.eventPrefix;a.success?(this._populateFromServer(a.data),this._loaded(a.data),this.trigger(c+":loaded")):(this.syncState=k.NEW,this._triggerAsync(c+":loaded-error",{error:a.data}),setTimeout(function(){b.isDestroyed||b.destroy()},100))}}},{key:"_loaded",value:function(a){}},{key:"_setSyncing",value:function(){switch(this._clearObject(),this.syncState){case k.SYNCED:this.syncState=k.SYNCING;break;case k.NEW:this.syncState=k.SAVING}this._syncCounter++}},{key:"_setSynced",value:function(){this._clearObject(),this._syncCounter>0&&this._syncCounter--,this.syncState=0===this._syncCounter?k.SYNCED:k.SYNCING,this.isSending=!1}},{key:"_clearObject",value:function(){this._toObject=null}},{key:"toObject",value:function(){return this._toObject||(this._toObject=h(Object.getPrototypeOf(b.prototype),"toObject",this).call(this),this._toObject.isNew=this.isNew(),this._toObject.isSaving=this.isSaving(),this._toObject.isSaved=this.isSaved(),this._toObject.isSynced=this.isSynced()),this._toObject}},{key:"isNew",value:function(){return this.syncState===k.NEW}},{key:"isSaving",value:function(){return this.syncState===k.SAVING}},{key:"isSaved",value:function(){return!(this.isNew()||this.isSaving())}},{key:"isSynced",value:function(){return this.syncState===k.SYNCED}}],[{key:"load",value:function(a,c){if(!(c&&c instanceof i))throw new Error(l.dictionary.clientMissing);var d={id:a,url:c.url+a.substring(8),clientId:c.appId};b.sortedSubclasses||(b.sortedSubclasses=b.subclasses.filter(function(a){return a.prefixUUID}).sort(function(a,b){return a.prefixUUID.length-b.prefixUUID.length}));var e=b.sortedSubclasses.filter(function(a){return 0===a.prefixUUID.indexOf("layer:///")?0===d.id.indexOf(a.prefixUUID):d.id.indexOf(a.prefixUUID)!==-1})[0],f=new e(d),g=e.eventPrefix;return g?c.dbManager?c.dbManager.getObject(g,a,function(a){f.isDestroyed||(a?(f._populateFromServer(a),f.trigger(g+":loaded")):c.isReady?f._load():(f.syncState=k.LOADING,c.once("ready",function(){return f._load()})))}):(f.syncState=k.LOADING,c.once("ready",function(){return f._load()})):f._load(),f.syncState=k.LOADING,f}}]),b}(i);o.prototype.id="",o.prototype.url="",o.prototype.localCreatedAt=null,o.prototype.clientId="",o.prototype._fromDB=!1,o.prototype.syncState=k.NEW,o.prototype._syncCounter=0,o.eventPrefix="",o.enableOpsIfNew=!1,Object.defineProperty(o.prototype,"isLoading",{enumerable:!0,get:function(){return this.syncState===k.LOADING}}),o.subclasses=[],o._supportedEvents=[].concat(i._supportedEvents),o.inObjectIgnore=i.inObjectIgnore,b.exports=o},{"../client-registry":8,"../const":11,"../layer-error":13,"../root":44}],35:[function(a,b,c){(function(c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("./root"),j=a("./xhr"),k=a("./logger"),l=a("./client-utils"),m=a("./const"),n=m.ACCEPT,o=function(a){function b(a){d(this,b);var f=e(this,Object.getPrototypeOf(b).call(this,a));if(j.addConnectionListener(function(a){return f._connectionListener(a)}),f.socketManager.on("message",function(){return f._connectionListener({status:"connection:success"})},f),"undefined"!=typeof window&&window.addEventListener)window.addEventListener("online",f._handleOnlineEvent.bind(f)),window.addEventListener("offline",f._handleOnlineEvent.bind(f));else{var g=c.getNativeSupport("OnlineEvents");g&&g.addEventListener("change",f._handleOnlineEvent.bind(f))}return f}return f(b,a),g(b,[{key:"start",value:function(){k.info("OnlineStateManager: start"),this.isClientReady=!0,this.isOnline=!0,this.checkOnlineStatus()}},{key:"stop",value:function(){k.info("OnlineStateManager: stop"),this.isClientReady=!1,this._clearCheck(),this._changeToOffline()}},{key:"_scheduleNextOnlineCheck",value:function(a,b){if(k.debug("OnlineStateManager: skip schedule"),!this.isDestroyed&&this.isClientReady)if(this._clearCheck(),a){k.info("OnlineStateManager: Scheduled checkOnlineStatus");var c=l.getExponentialBackoffSeconds(this.maxOfflineWait,Math.min(10,this.offlineCounter++));this.onlineCheckId=setTimeout(this.checkOnlineStatus.bind(this,b),Math.floor(1e3*c))}else k.debug("OnlineStateManager: Scheduled onlineExpired"),this.onlineCheckId=setTimeout(this._onlineExpired.bind(this),this.pingFrequency)}},{key:"_clearCheck",value:function(){this.onlineCheckId&&(clearTimeout(this.onlineCheckId),this.onlineCheckId=0)}},{key:"_handleOnlineEvent",value:function(a){this.offlineCounter=0,this.checkOnlineStatus()}},{key:"_onlineExpired",value:function(){this._clearCheck(),this._changeToOffline(),this._scheduleNextOnlineCheck()}},{key:"checkOnlineStatus",value:function(a){this._clearCheck(),k.info("OnlineStateManager: Firing XHR for online check"),this._lastCheckOnlineStatus=new Date,j({url:this.socketManager.client.url+"/?action=validateIsOnline&client="+this.socketManager.client.constructor.version,method:"GET",headers:{accept:n}},function(b){var c=b.status;a&&a(408!==c)})}},{key:"_changeToOffline",value:function(){this.isOnline&&(this.isOnline=!1,this.trigger("disconnected"),k.info("OnlineStateManager: Connection lost"))}},{key:"_connectionListener",value:function(a){var b=this,c="connection:success"!==a.status;if(!c){var d=this.lastMessageTime;this.lastMessageTime=new Date,this.isOnline||(this.isOnline=!0,this.offlineCounter=0,this.trigger("connected",{offlineDuration:d?Date.now()-d:0}),void 0===this.connectedCounter&&(this.connectedCounter=0),this.connectedCounter++,k.info("OnlineStateManager: Connected restored"))}this._scheduleNextOnlineCheck(c,function(a){a||b._changeToOffline()})}},{key:"destroy",value:function(){this._clearCheck(),this.socketManager=null,h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}}]),b}(i);o.prototype.isClientReady=!1,o.prototype.socketManager=null,o.prototype.offlineCounter=0,o.prototype.maxOfflineWait=300,o.prototype.minBackoffWait=100,o.prototype.lastMessageTime=null,o.prototype._lastCheckOnlineStatus=null,o.prototype.isOnline=!1,o.prototype.onlineCheckId=0,o.prototype.pingFrequency=1e5,o._supportedEvents=["connected","disconnected"].concat(i._supportedEvents),i.initClass.apply(o,[o,"OnlineStateManager"]),b.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./client-utils":9,"./const":11,"./logger":16,"./root":44,"./xhr":56}],36:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../root"),i=a("./query"),j=a("./messages-query"),k=function(a){function b(){return d(this,b),e(this,Object.getPrototypeOf(b).apply(this,arguments))}return f(b,a),g(b,[{key:"_fixPredicate",value:function(a){return i.prototype._fixPredicate.apply(this,[a])}},{key:"_fetchData",value:function(a){var b=this;this.client.dbManager.loadAnnouncements(this._nextDBFromId,a,function(a){a.length&&b._appendResults({data:a},!0)});var c="announcements?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");c!==this._firingRequest&&(this.isFiring=!0,this._firingRequest=c,this.client.xhr({url:c,method:"GET",sync:!1},function(d){return b._processRunResults(d,c,a)}))}}]),b}(j);k._supportedEvents=[].concat(j._supportedEvents),k.MaxPageSize=100,k.prototype.model=i.Announcement,h.initClass.apply(k,[k,"AnnouncementsQuery"]),b.exports=k},{"../root":44,"./messages-query":41,"./query":43}],37:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../root"),j=a("../const"),k=j.SYNC_STATE,l=a("./query"),m=a("./conversations-query"),n=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"_fetchData",value:function(a){var b=this;this.client.dbManager.loadChannels(this._nextDBFromId,a,function(a){a.length&&b._appendResults({data:a},!0)});var c="channels?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");c!==this._firingRequest&&(this.isFiring=!0,this._firingRequest=c,this.client.xhr({url:this._firingRequest,method:"GET",sync:!1},function(c){return b._processRunResults(c,b._firingRequest,a)}))}},{key:"_getSortField",value:function(){return"created_at"}},{key:"_getItem",value:function(a){return l.prototype._getItem.apply(this,[a])}},{key:"_handleEvents",value:function(a,b){switch(a){case"channels:change":this._handleChangeEvent("channels",b);break;case"channels:add":this._handleAddEvent("channels",b);break;case"channels:remove":this._handleRemoveEvent("channels",b)}}},{key:"_appendResultsSplice",value:function(a){this.data.unshift(this._getData(a))}},{key:"_handleChangeEvent",value:function(a,b){var c=this._getIndex(b.target.id);if(this.dataType===l.ObjectDataType){var e=b.getChangesFor("id");e.length&&(c=this._getIndex(e[0].oldValue))}if(c!==-1){var f=this._getSortField(),g=b.hasProperty("lastMessage")&&"last_message"===f,h=void 0;this.dataType===l.ObjectDataType?g?(h=this._getInsertIndex(b.target,this.data),this.data.splice(c,1),this.data.splice(h,0,this._getData(b.target)),this.data=this.data.concat([])):this.data=[].concat(d(this.data.slice(0,c)),[b.target.toObject()],d(this.data.slice(c+1))):g&&(h=this._getInsertIndex(b.target,this.data),h!==c&&(this.data.splice(c,1),this.data.splice(h,0,b.target))),this._triggerChange({type:"property",target:this._getData(b.target),query:this,isChange:!0,changes:b.changes}),g&&h!==c&&this._triggerChange({type:"move",target:this._getData(b.target),query:this,isChange:!1,fromIndex:c,toIndex:h})}}},{key:"_getInsertIndex",value:function(a,b){if(!a.isSaved())return 0;var c=this._getSortField(),d=void 0;if("created_at"===c){for(d=0;d<b.length;d++){var e=b[d];if(e.syncState===k.NEW||e.syncState===k.SAVING);else if(a.createdAt>=e.createdAt)break}return d}var f=-1,g=a.lastMessage?a.lastMessage.sentAt:a.createdAt;for(d=0;d<b.length;d++){var h=b[d];if(h.id===a.id)f=d;else if(h.syncState===k.NEW||h.syncState===k.SAVING);else{var i=h.lastMessage?h.lastMessage.sentAt:h.createdAt;if(g>=i)break}}return f===-1||f>d?d:d-1}},{key:"_handleAddEvent",value:function(a,b){var c=this,d=b[a].filter(function(a){return c._getIndex(a.id)===-1});d.length&&!function(){var a=c.data;d.forEach(function(b){var d=c._getInsertIndex(b,a);a.splice(d,0,c._getData(b)),c.dataType===l.ObjectDataType&&(c.data=[].concat(a)),c.totalSize+=1;var e=c._getData(b);c._triggerChange({type:"insert",index:d,target:e,query:c})})}()}},{key:"_handleRemoveEvent",value:function(a,b){var c=this,e=[];b[a].forEach(function(a){var b=c._getIndex(a.id);b!==-1&&(a.id===c._nextDBFromId&&(c._nextDBFromId=c._updateNextFromId(b)),a.id===c._nextServerFromId&&(c._nextServerFromId=c._updateNextFromId(b)),e.push({data:a,index:b}),c.dataType===l.ObjectDataType?c.data=[].concat(d(c.data.slice(0,b)),d(c.data.slice(b+1))):c.data.splice(b,1))}),this.totalSize-=e.length,e.forEach(function(a){c._triggerChange({type:"remove",index:a.index,target:c._getData(a.data),query:c})})}}]),b}(m);n._supportedEvents=[].concat(m._supportedEvents),n.MaxPageSize=100,n.prototype.model=l.Channel,i.initClass.apply(n,[n,"ChannelsQuery"]),b.exports=n},{"../const":11,"../root":44,"./conversations-query":38,"./query":43}],38:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=a("../root"),k=a("../client-utils"),l=a("../const"),m=l.SYNC_STATE,n=a("./query"),o=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"_fetchData",value:function(a){var b=this,c=this._getSortField();this.client.dbManager.loadConversations(c,this._nextDBFromId,a,function(a){a.length&&b._appendResults({data:a},!0)});var d="conversations?sort_by="+c+"&page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");d!==this._firingRequest&&(this.isFiring=!0,this._firingRequest=d,this.client.xhr({url:this._firingRequest,method:"GET",sync:!1},function(c){return b._processRunResults(c,d,a)}))}},{key:"_getSortField",value:function(){return this.sortBy&&this.sortBy[0]&&this.sortBy[0]["lastMessage.sentAt"]?"last_message":"created_at"}},{key:"_getItem",value:function(a){switch(k.typeFromID(a)){case"messages":for(var c=0;c<this.data.length;c++){var d=this.data[c];if(d.lastMessage&&d.lastMessage.id===a)return d.lastMessage}return null;case"conversations":return i(Object.getPrototypeOf(b.prototype),"_getItem",this).call(this,a)}}},{key:"_appendResultsSplice",value:function(a){var b=this.data,c=this._getInsertIndex(a,b);b.splice(c,0,this._getData(a))}},{key:"_handleEvents",value:function(a,b){switch(a){case"conversations:change":this._handleChangeEvent("conversations",b);break;case"conversations:add":this._handleAddEvent("conversations",b);break;case"conversations:remove":this._handleRemoveEvent("conversations",b)}}},{key:"_handleChangeEvent",value:function(a,b){var c=this._getIndex(b.target.id);if(this.dataType===n.ObjectDataType){var e=b.getChangesFor("id");e.length&&(c=this._getIndex(e[0].oldValue))}if(c!==-1){var f=this._getSortField(),g=b.hasProperty("lastMessage")&&"last_message"===f,h=void 0;this.dataType===n.ObjectDataType?g?(h=this._getInsertIndex(b.target,this.data),this.data.splice(c,1),this.data.splice(h,0,this._getData(b.target)),this.data=this.data.concat([])):this.data=[].concat(d(this.data.slice(0,c)),[b.target.toObject()],d(this.data.slice(c+1))):g&&(h=this._getInsertIndex(b.target,this.data),h!==c&&(this.data.splice(c,1),this.data.splice(h,0,b.target))),this._triggerChange({type:"property",target:this._getData(b.target),query:this,isChange:!0,changes:b.changes}),g&&h!==c&&this._triggerChange({type:"move",target:this._getData(b.target),query:this,isChange:!1,fromIndex:c,toIndex:h})}}},{key:"_getInsertIndex",value:function(a,b){if(!a.isSaved())return 0;var c=this._getSortField(),d=void 0;if("created_at"===c){for(d=0;d<b.length;d++){var e=b[d];if(e.syncState===m.NEW||e.syncState===m.SAVING);else if(a.createdAt>=e.createdAt)break}return d}var f=-1,g=a.lastMessage?a.lastMessage.sentAt:a.createdAt;for(d=0;d<b.length;d++){var h=b[d];if(h.id===a.id)f=d;else if(h.syncState===m.NEW||h.syncState===m.SAVING);else{var i=h.lastMessage?h.lastMessage.sentAt:h.createdAt;if(g>=i)break}}return f===-1||f>d?d:d-1}},{key:"_handleAddEvent",value:function(a,b){var c=this,d=b[a].filter(function(a){return c._getIndex(a.id)===-1});d.length&&!function(){var a=c.data;d.forEach(function(b){var d=c._getInsertIndex(b,a);a.splice(d,0,c._getData(b)),c.dataType===n.ObjectDataType&&(c.data=[].concat(a)),c.totalSize+=1;var e=c._getData(b);c._triggerChange({type:"insert",index:d,target:e,query:c})})}()}},{key:"_handleRemoveEvent",value:function(a,b){var c=this,e=[];b[a].forEach(function(a){var b=c._getIndex(a.id);b!==-1&&(a.id===c._nextDBFromId&&(c._nextDBFromId=c._updateNextFromId(b)),a.id===c._nextServerFromId&&(c._nextServerFromId=c._updateNextFromId(b)),e.push({data:a,index:b}),c.dataType===n.ObjectDataType?c.data=[].concat(d(c.data.slice(0,b)),d(c.data.slice(b+1))):c.data.splice(b,1))}),this.totalSize-=e.length,e.forEach(function(a){c._triggerChange({type:"remove",index:a.index,target:c._getData(a.data),query:c})})}}]),b}(n);o._supportedEvents=[].concat(n._supportedEvents),o.MaxPageSize=100,o.prototype.model=n.Conversation,j.initClass.apply(o,[o,"ConversationsQuery"]),b.exports=o},{"../client-utils":9,"../const":11,"../root":44,"./query":43}],39:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../root"),i=a("./query"),j=function(a){function b(){return d(this,b),e(this,Object.getPrototypeOf(b).apply(this,arguments))}return f(b,a),g(b,[{key:"_fetchData",value:function(a){var b=this;this._nextDBFromId||this.client.dbManager.loadIdentities(function(a){a.length&&b._appendResults({data:a},!0)});var c="identities?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");c!==this._firingRequest&&(this.isFiring=!0,this._firingRequest=c,this.client.xhr({url:c,method:"GET",sync:!1},function(d){return b._processRunResults(d,c,a)}))}},{key:"_appendResultsSplice",value:function(a){this.data.push(this._getData(a))}},{key:"_handleEvents",value:function(a,b){switch(a){case"identities:change":this._handleChangeEvent("identities",b);break;case"identities:add":this._handleAddEvent("identities",b);break;case"identities:remove":this._handleRemoveEvent("identities",b)}}}]),b}(i);j._supportedEvents=[].concat(i._supportedEvents),j.MaxPageSize=500,j.prototype.model=i.Identity,h.initClass.apply(j,[j,"IdentitiesQuery"]),b.exports=j},{"../root":44,"./query":43}],40:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b);
}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("../root"),i=a("../layer-error"),j=a("../logger"),k=a("./query"),l=new RegExp(/^channel.id\s*=\s*['"]((layer:\/\/\/channels\/)?.{8}-.{4}-.{4}-.{4}-.{12})['"]$/),m=function(a){function b(){return d(this,b),e(this,Object.getPrototypeOf(b).apply(this,arguments))}return f(b,a),g(b,[{key:"_fixPredicate",value:function(a){if(""===a)return"";if(a.indexOf("channel.id")!==-1){var b=a.match(l)?a.replace(l,"$1"):null;if(!b)throw new Error(i.dictionary.invalidPredicate);return 0!==b.indexOf("layer:///channels/")&&(b="layer:///channels/"+b),"channel.id = '"+b+"'"}throw new Error(i.dictionary.invalidPredicate)}},{key:"_getChannelPredicateIds",value:function(){if(this.predicate.match(l)){var a=this.predicate.replace(l,"$1"),b=(this._predicate||a).replace(/^layer:\/\/\/channels\//,"");if(b)return{uuid:b,id:a,type:k.Channel}}}},{key:"_fetchData",value:function(a){var b=this,c=this._getChannelPredicateIds();if(!c)return void(this.predicate&&!this.predicate.match(/['"]/)&&j.error("This query may need to quote its value"));var d="layer:///channels/"+c.uuid;this._predicate||(this._predicate=c.id);var e=this.client.getChannel(d),f="channels/"+c.uuid+"/members?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");e&&!e.isSaved()||f===this._firingRequest||(this.isFiring=!0,this._firingRequest=f,this.client.xhr({url:f,method:"GET",sync:!1},function(c){return b._processRunResults(c,f,a)}))}},{key:"_appendResultsSplice",value:function(a){this.data.push(this._getData(a))}},{key:"_handleEvents",value:function(a,b){switch(a){case"members:change":this._handleChangeEvent("members",b);break;case"members:add":this._handleAddEvent("members",b);break;case"members:remove":this._handleRemoveEvent("members",b)}}}]),b}(k);m._supportedEvents=[].concat(k._supportedEvents),m.MaxPageSize=500,m.prototype.model=k.Membership,h.initClass.apply(m,[m,"MembersQuery"]),b.exports=m},{"../layer-error":13,"../logger":16,"../root":44,"./query":43}],41:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../root"),j=a("../layer-error"),k=a("../client-utils"),l=a("../logger"),m=a("./query"),n=new RegExp(/^conversation.id\s*=\s*['"]((layer:\/\/\/conversations\/)?.{8}-.{4}-.{4}-.{4}-.{12})['"]$/),o=new RegExp(/^channel.id\s*=\s*['"]((layer:\/\/\/channels\/)?.{8}-.{4}-.{4}-.{4}-.{12})['"]$/),p=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).apply(this,arguments))}return g(b,a),h(b,[{key:"_fixPredicate",value:function(a){if(""===a)return"";if(a.indexOf("conversation.id")!==-1){var b=a.match(n)?a.replace(n,"$1"):null;if(!b)throw new Error(j.dictionary.invalidPredicate);return 0!==b.indexOf("layer:///conversations/")&&(b="layer:///conversations/"+b),"conversation.id = '"+b+"'"}if(a.indexOf("channel.id")!==-1){var c=a.match(o)?a.replace(o,"$1"):null;if(!c)throw new Error(j.dictionary.invalidPredicate);return 0!==c.indexOf("layer:///channels/")&&(c="layer:///channels/"+c),"channel.id = '"+c+"'"}throw new Error(j.dictionary.invalidPredicate)}},{key:"_fetchData",value:function(a){var b=this._getConversationPredicateIds();if(!b)return void(this.predicate&&!this.predicate.match(/['"]/)&&l.error("This query may need to quote its value"));switch(b.type){case m.Conversation:this._fetchConversationMessages(a,b);break;case m.Channel:this._fetchChannelMessages(a,b)}}},{key:"_getSortField",value:function(){return"position"}},{key:"_getConversationPredicateIds",value:function(){if(this.predicate.indexOf("conversation.id")!==-1){if(this.predicate.match(n)){var a=this.predicate.replace(n,"$1"),b=(this._predicate||a).replace(/^layer:\/\/\/conversations\//,"");if(b)return{uuid:b,id:a,type:m.Conversation}}}else if(this.predicate.indexOf("channel.id")!==-1&&this.predicate.match(o)){var c=this.predicate.replace(o,"$1"),d=(this._predicate||c).replace(/^layer:\/\/\/channels\//,"");if(d)return{uuid:d,id:c,type:m.Channel}}}},{key:"_fetchConversationMessages",value:function(a,b){var c=this,d="layer:///conversations/"+b.uuid;this._predicate||(this._predicate=b.id);var e=this.client.getConversation(d);this.client.dbManager.loadMessages(d,this._nextDBFromId,a,function(a){a.length&&c._appendResults({data:a},!0)});var f="conversations/"+b.uuid+"/messages?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");e&&!e.isSaved()||f===this._firingRequest||(this.isFiring=!0,this._firingRequest=f,this.client.xhr({url:f,method:"GET",sync:!1},function(b){return c._processRunResults(b,f,a)})),0===this.data.length&&e&&e.lastMessage&&(this.data=[this._getData(e.lastMessage)],this._triggerChange({type:"data",data:[this._getData(e.lastMessage)],query:this,target:this.client}))}},{key:"_fetchChannelMessages",value:function(a,b){var c=this,d="layer:///channels/"+b.uuid;this._predicate||(this._predicate=b.id);var e=this.client.getChannel(d);this.client.dbManager.loadMessages(d,this._nextDBFromId,a,function(a){a.length&&c._appendResults({data:a},!0)});var f="channels/"+b.uuid+"/messages?page_size="+a+(this._nextServerFromId?"&from_id="+this._nextServerFromId:"");e&&!e.isSaved()||f===this._firingRequest||(this.isFiring=!0,this._firingRequest=f,this.client.xhr({url:f,method:"GET",sync:!1},function(b){return c._processRunResults(b,f,a)}))}},{key:"_appendResultsSplice",value:function(a){var b=this.data,c=this._getInsertIndex(a,b);b.splice(c,0,this._getData(a))}},{key:"_getInsertIndex",value:function(a,b){var c=void 0;for(c=0;c<b.length&&!(a.position>b[c].position);c++);return c}},{key:"_handleEvents",value:function(a,b){switch(a){case"conversations:change":this._handleConvIdChangeEvent(b);break;case"messages:change":case"messages:read":this._handleChangeEvent("messages",b);break;case"messages:add":this._handleAddEvent("messages",b);break;case"messages:remove":this._handleRemoveEvent("messages",b)}}},{key:"_handleConvIdChangeEvent",value:function(a){var b=a.getChangesFor("id");b.length&&this._predicate===b[0].oldValue&&(this._predicate=b[0].newValue,this.predicate="conversation.id = '"+this._predicate+"'",this._run())}},{key:"_handlePositionChange",value:function(a,b){if(b===-1)return!1;var c=[].concat(d(this.data.slice(0,b)),d(this.data.slice(b+1))),e=this._getInsertIndex(a.target,c);return e!==b&&(c.splice(e,0,this._getData(a.target)),this.data=c,this._triggerChange({type:"property",target:this._getData(a.target),query:this,isChange:!0,changes:a.changes}),!0)}},{key:"_handleChangeEvent",value:function(a,b){var c=this._getIndex(b.target.id),e=b.getChangesFor("position");if(e.length&&this._handlePositionChange(b,c)){if(e.length===b.changes.length)return;c=this._getIndex(b.target.id)}c!==-1&&(this.dataType===m.ObjectDataType&&(this.data=[].concat(d(this.data.slice(0,c)),[b.target.toObject()],d(this.data.slice(c+1)))),this._triggerChange({type:"property",target:this._getData(b.target),query:this,isChange:!0,changes:b.changes}))}},{key:"_handleAddEvent",value:function(a,b){var c=this,d=b[a].filter(function(a){var b=k.typeFromID(a.id);return"messages"===b&&c.model===m.Message||"announcements"===b&&c.model===m.Announcement}).filter(function(a){var b=k.typeFromID(a.id);return"announcements"===b||a.conversationId===c._predicate}).filter(function(a){return c._getIndex(a.id)===-1}).map(function(a){return c._getData(a)});d.length&&!function(){var a=c.data=c.dataType===m.ObjectDataType?[].concat(c.data):c.data;d.forEach(function(b){var d=c._getInsertIndex(b,a);a.splice(d,0,b),0!==d&&l.warn("Index of "+b.id+" is "+d+"; position is "+b.position+"; compared to "+a[0].position),c.totalSize+=1,c._triggerChange({type:"insert",target:b,query:c,index:d})})}()}},{key:"_handleRemoveEvent",value:function(a,b){var c=this,e=[];b[a].forEach(function(a){var b=c._getIndex(a.id);b!==-1&&(a.id===c._nextDBFromId&&(c._nextDBFromId=c._updateNextFromId(b)),a.id===c._nextServerFromId&&(c._nextServerFromId=c._updateNextFromId(b)),e.push({data:a,index:b}),c.dataType===m.ObjectDataType?c.data=[].concat(d(c.data.slice(0,b)),d(c.data.slice(b+1))):c.data.splice(b,1))}),this.totalSize-=e.length,e.forEach(function(a){c._triggerChange({type:"remove",target:c._getData(a.data),index:a.index,query:c})})}}]),b}(m);p._supportedEvents=[].concat(m._supportedEvents),p.MaxPageSize=100,p.prototype.model=m.Message,i.initClass.apply(p,[p,"MessagesQuery"]),b.exports=p},{"../client-utils":9,"../layer-error":13,"../logger":16,"../root":44,"./query":43}],42:[function(a,b,c){"use strict";function d(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("./query"),j=function(){function a(b){g(this,a),b?this._query={model:b.model,returnType:b.returnType,dataType:b.dataType,paginationWindow:b.paginationWindow}:this._query={model:i.Message,returnType:"object",dataType:"object",paginationWindow:i.prototype.paginationWindow},this._conversationIdSet=!1}return h(a,[{key:"forConversation",value:function(a){return 0===a.indexOf("layer:///channels/")?(this._query.predicate="channel.id = '"+a+"'",this._conversationIdSet=!0):0===a.indexOf("layer:///conversations/")?(this._query.predicate="conversation.id = '"+a+"'",this._conversationIdSet=!0):(this._query.predicate="",this._conversationIdSet=!1),this}},{key:"paginationWindow",value:function(a){return this._query.paginationWindow=a,this}},{key:"build",value:function(){return this._query}}]),a}(),k=function(a){function b(a){g(this,b);var c=e(this,Object.getPrototypeOf(b).call(this,a));return c._query.model=i.Announcement,c}return f(b,a),h(b,[{key:"build",value:function(){return this._query}}]),b}(j),l=function(){function a(b){g(this,a),b?this._query={model:b.model,returnType:b.returnType,dataType:b.dataType,paginationWindow:b.paginationWindow,sortBy:b.sortBy}:this._query={model:i.Conversation,returnType:"object",dataType:"object",paginationWindow:i.prototype.paginationWindow,sortBy:null}}return h(a,[{key:"paginationWindow",value:function(a){return this._query.paginationWindow=a,this}},{key:"sortBy",value:function(a){var b=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return this._query.sortBy=[d({},a,b?"asc":"desc")],this}},{key:"build",value:function(){return this._query}}]),a}(),m=function(){function a(b){g(this,a),b?this._query={model:b.model,returnType:b.returnType,dataType:b.dataType,paginationWindow:b.paginationWindow,sortBy:null}:this._query={model:i.Channel,returnType:"object",dataType:"object",paginationWindow:i.prototype.paginationWindow,sortBy:null}}return h(a,[{key:"paginationWindow",value:function(a){return this._query.paginationWindow=a,this}},{key:"build",value:function(){return this._query}}]),a}(),n=function(){function a(b){g(this,a),b?this._query={model:b.model,returnType:b.returnType,dataType:b.dataType,paginationWindow:b.paginationWindow,sortBy:null}:this._query={model:i.Membership,returnType:"object",dataType:"object",paginationWindow:i.prototype.paginationWindow,sortBy:null}}return h(a,[{key:"paginationWindow",value:function(a){return this._query.paginationWindow=a,this}},{key:"forChannel",value:function(a){return 0===a.indexOf("layer:///channels/")?this._query.predicate="channel.id = '"+a+"'":this._query.predicate="",this}},{key:"build",value:function(){return this._query}}]),a}(),o=function(){function a(b){g(this,a),b?this._query={model:b.model,returnType:b.returnType,dataType:b.dataType,paginationWindow:b.paginationWindow}:this._query={model:i.Identity,returnType:"object",dataType:"object",paginationWindow:i.prototype.paginationWindow}}return h(a,[{key:"paginationWindow",value:function(a){return this._query.paginationWindow=a,this}},{key:"build",value:function(){return this._query}}]),a}(),p={messages:function(){return new j},announcements:function(){return new k},conversations:function(){return new l},channels:function(){return new m},members:function(){return new n},identities:function(){return new o},fromQueryObject:function(a){switch(a.model){case i.Message:return new j(a);case i.Announcement:return new k(a);case i.Conversation:return new l(a);case i.Channel:return new m(a);case i.Identity:return new o(a);case i.Membership:return new n(a);default:return null}}};b.exports=p},{"./query":43}],43:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=a("../root"),k=a("../layer-error"),l=a("../logger"),m=a("../client-utils"),n=function(a){function b(){e(this,b);for(var a=void 0,c=arguments.length,d=Array(c),g=0;g<c;g++)d[g]=arguments[g];2===d.length?(a=d[1].build(),a.client=d[0]):a=d[0];var h=f(this,Object.getPrototypeOf(b).call(this,a));if(h.predicate=h._fixPredicate(a.predicate||""),"paginationWindow"in a){var i=a.paginationWindow;h.paginationWindow=Math.min(h._getMaxPageSize(),a.paginationWindow),a.paginationWindow!==i&&l.warn("paginationWindow value "+i+" in Query constructor excedes Query.MaxPageSize of "+h._getMaxPageSize())}if(h.data=[],h._initialPaginationWindow=h.paginationWindow,!h.client)throw new Error(k.dictionary.clientMissing);return h.client.on("all",h._handleEvents,h),h.client.isReady?h._run():h.client.once("ready",function(){return h._run()},h),h}return g(b,a),h(b,[{key:"destroy",value:function(){this.data=[],this._triggerChange({data:[],type:"reset"}),this.client.off(null,null,this),this.client._removeQuery(this),this.data=null,i(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_getMaxPageSize",value:function(){return this.constructor.MaxPageSize}},{key:"update",value:function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=void 0,c=void 0,d="function"==typeof a.build?a.build():a;if("paginationWindow"in d&&this.paginationWindow!==d.paginationWindow&&(this.paginationWindow=Math.min(this._getMaxPageSize()+this.size,d.paginationWindow),this.paginationWindow<d.paginationWindow&&l.warn("paginationWindow value "+d.paginationWindow+" in Query.update() increases size greater than Query.MaxPageSize of "+this._getMaxPageSize()),b=!0),"model"in d&&this.model!==d.model)throw new Error(k.dictionary.modelImmutable);if("predicate"in d){var e=this._fixPredicate(d.predicate||"");this.predicate!==e&&(this.predicate=e,c=!0)}return"sortBy"in d&&JSON.stringify(this.sortBy)!==JSON.stringify(d.sortBy)&&(this.sortBy=d.sortBy,c=!0),c&&this._reset(),(c||b)&&this._run(),this}},{key:"_fixPredicate",value:function(a){if(a)throw new Error(k.dictionary.predicateNotSupported);return""}},{key:"_reset",value:function(){this._isSyncingId&&(clearTimeout(this._isSyncingId),this._isSyncingId=0),this.totalSize=0;var a=this.data;this.data=[],this.client._checkAndPurgeCache(a),this.isFiring=!1,this._predicate=null,this._nextDBFromId="",this._nextServerFromId="",this._isServerSyncing=!1,this._isSyncingCount=0,this.pagedToEnd=!1,this.paginationWindow=this._initialPaginationWindow,this._triggerChange({data:[],type:"reset"})}},{key:"reset",value:function(){this._reset(),this._run()}},{key:"_run",value:function(){var a=Math.min(this.paginationWindow-this.size,this._getMaxPageSize());if(a<0){var b=this.data.slice(this.paginationWindow);this.data=this.data.slice(0,this.paginationWindow),this.client._checkAndPurgeCache(b),this.pagedToEnd=!1,this._triggerAsync("change",{data:[]})}else 0===a||this.pagedToEnd||this._fetchData(a)}},{key:"_fetchData",value:function(a){}},{key:"_getSortField",value:function(){}},{key:"_processRunResults",value:function(a,b,c){var d=this;if(b===this._firingRequest&&!this.isDestroyed){var e="true"===a.xhr.getResponseHeader("Layer-Conversation-Is-Syncing")&&this._isSyncingCount<9;if(this.isFiring=e,this._firingRequest="",a.success)if(e){var f=m.getExponentialBackoffSeconds(30,Math.min(10,this._isSyncingCount));this._isSyncingId=setTimeout(function(){d._isSyncingId=0,d._run()},Math.floor(1e3*f)),this._isSyncingCount++}else this._isSyncingCount=0,this._isSyncingId=0,this.totalSize=Number(a.xhr.getResponseHeader("Layer-Count")),this._appendResults(a,!1),a.data.length<c&&(this.pagedToEnd=!0);else a.data.getNonce()?this.client.once("ready",function(){d._run()}):this.trigger("error",{error:a.data})}}},{key:"_appendResults",value:function(a,c){var d=this;a.data.forEach(function(a){a instanceof j||d.client._createObject(a)});var e=a.data.filter(function(a){return d._getIndex(a.id)===-1}),f=a.data.length;f&&(c?this._nextDBFromId=a.data[f-1].id:this._nextServerFromId=a.data[f-1].id),this.dataType===b.ObjectDataType&&(this.data=[].concat(this.data)),e.forEach(function(a){var b=d.client.getObject(a.id);b&&d._appendResultsSplice(b)}),this._triggerChange({type:"data",data:e.map(function(a){return d._getData(d.client.getObject(a.id))}),query:this,target:this.client})}},{key:"_appendResultsSplice",value:function(a){}},{key:"_getData",value:function(a){return this.dataType===b.ObjectDataType?a.toObject():a}},{key:"_getInstance",value:function(a){return a instanceof j?a:this.client.getObject(a.id)}},{key:"_getItem",value:function(a){var b=this._getIndex(a);return b===-1?null:this.data[b]}},{key:"_getIndex",value:function(a){for(var b=0;b<this.data.length;b++)if(this.data[b].id===a)return b;return-1}},{key:"_handleEvents",value:function(a,b){}},{key:"_handleChangeEvent",value:function(a,c){var e=this._getIndex(c.target.id);e!==-1&&(this.dataType===b.ObjectDataType&&(this.data=[].concat(d(this.data.slice(0,e)),[c.target.toObject()],d(this.data.slice(e+1)))),this._triggerChange({type:"property",target:this._getData(c.target),query:this,isChange:!0,changes:c.changes}))}},{key:"_handleAddEvent",value:function(a,c){var d=this,e=c[a].filter(function(a){return d._getIndex(a.id)===-1}).map(function(a){return d._getData(a)});e.length&&!function(){var a=d.data=d.dataType===b.ObjectDataType?[].concat(d.data):d.data;e.forEach(function(b){a.push(b),d.totalSize+=1,d._triggerChange({type:"insert",index:a.length-1,target:b,query:d})})}()}},{key:"_handleRemoveEvent",value:function(a,c){var e=this,f=[];c[a].forEach(function(a){var c=e._getIndex(a.id);c!==-1&&(a.id===e._nextDBFromId&&(e._nextDBFromId=e._updateNextFromId(c)),a.id===e._nextServerFromId&&(e._nextServerFromId=e._updateNextFromId(c)),f.push({data:a,index:c}),e.dataType===b.ObjectDataType?e.data=[].concat(d(e.data.slice(0,c)),d(e.data.slice(c+1))):e.data.splice(c,1))}),this.totalSize-=f.length,f.forEach(function(a){e._triggerChange({type:"remove",target:e._getData(a.data),index:a.index,query:e})})}},{key:"_updateNextFromId",value:function(a){return a>0?this.data[a-1].id:""}},{key:"_triggerChange",value:function(a){this.isDestroyed||this.client._inCleanup||(this.trigger("change",a),this.trigger("change:"+a.type,a))}},{key:"toString",value:function(){return this.id}}]),b}(j);n.prefixUUID="layer:///queries/",n.Conversation="Conversation",n.Channel="Channel",n.Message="Message",n.Announcement="Announcement",n.Identity="Identity",n.Membership="Membership",n.ObjectDataType="object",n.InstanceDataType="instance",n.MaxPageSize=100,Object.defineProperty(n.prototype,"size",{enumerable:!0,get:function(){return this.data?this.data.length:0}}),n.prototype.totalSize=0,n.prototype.client=null,n.prototype.data=null,n.prototype.model="",n.prototype.returnType="object",n.prototype.dataType=n.InstanceDataType,n.prototype.paginationWindow=100,n.prototype.sortBy=null,n.prototype._initialPaginationWindow=100,n.prototype.predicate=null,n.prototype.isFiring=!1,n.prototype.pagedToEnd=!1,n.prototype._firingRequest="",n.prototype._nextServerFromId="",n.prototype._nextDBFromId="",n.prototype._isSyncingCount=0,n._supportedEvents=["change","change:data","change:reset","change:property","change:insert","change:remove","change:move","error"].concat(j._supportedEvents),j.initClass.apply(n,[n,"Query"]),b.exports=n},{"../client-utils":9,"../layer-error":13,"../logger":16,"../root":44}],44:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function h(){}function i(a,b){var c="__"+b,d=b.substring(0,1).toUpperCase()+b.substring(1),e=a.prototype["__adjust"+d]||a.prototype["__update"+d]||a.prototype["__get"+d];e&&(a.prototype[c]=a.prototype[b],Object.defineProperty(a.prototype,b,{enumerable:!0,get:function(){return this["__get"+d]?this["__get"+d](c):this[c]},set:function(a){if(!this.isDestroyed){var b=this[c];if(a!==b){if(this["__adjust"+d]){var e=this["__adjust"+d](a);void 0!==e&&(a=e)}this[c]=a}a!==b&&!this.isInitializing&&this["__update"+d]&&this["__update"+d](a,b)}}}))}function j(a,b){a.name||(a.name=b),a._supportedEvents||(a._supportedEvents=u._supportedEvents),a._ignoredEvents||(a._ignoredEvents=u._ignoredEvents),a.mixins&&a.mixins.forEach(function(b){b.events&&(a._supportedEvents=a._supportedEvents.concat(b.events)),b.properties&&Object.keys(b.properties).forEach(function(c){a.prototype[c]=b.properties[c]}),b.methods&&Object.keys(b.methods).forEach(function(c){a.prototype[c]=b.methods[c]})});var c=Object.keys(a.prototype).filter(function(b){return a.prototype.hasOwnProperty(b)&&!u.prototype.hasOwnProperty(b)&&"function"!=typeof a.prototype[b]});c.forEach(function(b){return i(a,b)})}var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=a("./client-utils"),n=a("./layer-event"),o=a("./layer-error"),p=a("backbone-events-standalone/backbone-events-standalone"),q=a("./logger");h.prototype=p;var r=new h;"function"==typeof postMessage&&addEventListener("message",function(a){"layer-delayed-event"===a.data.type&&r.trigger(a.data.internalId+"-delayed-event")});var s={},t=/\s+/,u=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this));c._layerEventSubscriptions=[],c._delayedTriggers=[],c._lastDelayedTrigger=Date.now(),c._events={};var d=c.constructor.name;s[d]||(s[d]=0),c.internalId=d+s[d]++,r.on(c.internalId+"-delayed-event",c._processDelayedTriggers,c),c.id||a.id||!c.constructor.prefixUUID||(c.id=c.constructor.prefixUUID+m.generateUUID());var g=void 0;for(g in a)c.constructor._supportedEvents.indexOf(g)!==-1?c.on(g,a[g]):g in c&&"function"!=typeof c[g]&&(c[g]=a[g]);return c.isInitializing=!1,c}return g(b,a),l(b,[{key:"destroy",value:function(){var a=this;if(this.isDestroyed)throw new Error(o.dictionary.alreadyDestroyed);this.trigger("destroy"),r.off(this.internalId+"-delayed-event",null,this),this.off(),this._layerEventSubscriptions.forEach(function(b){return b.off(null,null,a)}),this._layerEventSubscriptions=null,this._delayedTriggers=null,this.isDestroyed=!0}},{key:"toObject",value:function(){var a=this,c=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.__inToObject=!0;var d={};try{var e=[],f=void 0;for(f in this.constructor.prototype)f in b.prototype||e.push(f);e.forEach(function(e){var f=a[e];0!==e.indexOf("_")&&"function"!=typeof f&&(Array.isArray(f)?(d[e]=[],f.forEach(function(a){a instanceof b?c?delete d[e]:a.__inToObject||d[e].push(a.toObject()):d[e].push(a)})):f instanceof b?f.__inToObject||c||(d[e]=f.toObject()):f instanceof Date?d[e]=new Date(f):d[e]=f)})}catch(a){}return this.__inToObject=!1,d}},{key:"_warnForEvent",value:function(a){if(!m.includes(this.constructor._supportedEvents,a))throw new Error("Event "+a+" not defined for "+this.toString())}},{key:"_prepareOn",value:function(a,c,d){var e=this;if(d){if(d instanceof b&&d.isDestroyed)throw new Error(o.dictionary.isDestroyed);d._layerEventSubscriptions&&d._layerEventSubscriptions.push(this)}if("string"==typeof a&&"all"!==a)if(t.test(a)){var f=a.split(t);f.forEach(function(a){return e._warnForEvent(a)})}else this._warnForEvent(a);else a&&"object"===("undefined"==typeof a?"undefined":k(a))&&Object.keys(a).forEach(function(a){return e._warnForEvent(a)})}},{key:"on",value:function(a,b,c){return this._prepareOn(a,b,c),p.on.apply(this,[a,b,c]),this}},{key:"once",value:function(a,b,c){return this._prepareOn(a,b,c),p.once.apply(this,[a,b,c]),this}},{key:"trigger",value:function(){return this._disableEvents?this:this._trigger.apply(this,arguments)}},{key:"_trigger",value:function(){if(!m.includes(this.constructor._supportedEvents,arguments.length<=0?void 0:arguments[0]))return void(m.includes(this.constructor._ignoredEvents,arguments.length<=0?void 0:arguments[0])||q.error(this.toString()+" ignored "+(arguments.length<=0?void 0:arguments[0])));var a=this._getTriggerArgs.apply(this,arguments);p.trigger.apply(this,a);var b=this.constructor.bubbleEventParent;if(b&&"destroy"!==(arguments.length<=0?void 0:arguments[0])){var c,e=this[b];e="function"==typeof e?e.apply(this):e,e&&(c=e).trigger.apply(c,d(a))}}},{key:"_getTriggerArgs",value:function(){for(var a=this,b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];var e=Array.prototype.slice.call(c);return c[1]?!function(){var b={target:a};e[1]instanceof n||("object"===k(e[1])?Object.keys(e[1]).forEach(function(a){return b[a]=e[1][a]}):b.data=e[1],e[1]=new n(b,e[0]))}():e[1]=new n({target:this},e[0]),e}},{key:"_triggerAsync",value:function(){var a=this,b=this._getTriggerArgs.apply(this,arguments);this._delayedTriggers.push(b);var c=1===this._delayedTriggers.length||this._delayedTriggers.length&&this._lastDelayedTrigger+500<Date.now();if(c)if(this._lastDelayedTrigger=Date.now(),"function"==typeof postMessage&&"undefined"==typeof jasmine){var d={type:"layer-delayed-event",internalId:this.internalId};"undefined"!=typeof document?window.postMessage(d,"*"):window.postMessage(d)}else setTimeout(function(){return a._processDelayedTriggers()},0)}},{key:"_foldEvents",value:function(a,b,c){var d=this,e=a.length?a[0][1]:null,f=e?e[b]:null;a.forEach(function(a,c){c>0&&(f.push(a[1][b][0]),d._delayedTriggers.splice(d._delayedTriggers.indexOf(a),1))}),a.length&&c&&(a[0][1].target=c)}},{key:"_foldChangeEvents",value:function(){var a=this,b=this._delayedTriggers.filter(function(a){return a[1].isChange});b.forEach(function(c,d){d>0&&(b[0][1]._mergeChanges(c[1]),a._delayedTriggers.splice(a._delayedTriggers.indexOf(c),1))})}},{key:"_processDelayedTriggers",value:function(){this.isDestroyed||(this._foldChangeEvents(),this._delayedTriggers.forEach(function(a){this.trigger.apply(this,d(a))},this),this._delayedTriggers=[])}},{key:"_runMixins",value:function(a,b){var c=this;this.constructor.mixins.forEach(function(d){d.lifecycle[a]&&d.lifecycle[a].apply(c,b)})}},{key:"toString",value:function(){return this.internalId}}],[{key:"isValidId",value:function(a){return 0===a.indexOf(this.prefixUUID)}}]),b}(h);u.prototype.isDestroyed=!1,u.prototype.internalId="",u.prototype.isInitializing=!0,u.prototype._layerEventSubscriptions=null,u.prototype._disableEvents=!1,u._supportedEvents=["destroy","all"],u._ignoredEvents=[],b.exports=u,b.exports.initClass=j},{"./client-utils":9,"./layer-error":13,"./layer-event":14,"./logger":16,"backbone-events-standalone/backbone-events-standalone":2}],45:[function(a,b,c){"use strict";function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./client-utils"),i=function(){function a(b){f(this,a);var c=void 0;for(c in b)c in this&&(this[c]=b[c]);this.depends||(this.depends=[]),this.id||(this.id="layer:///syncevents/"+h.generateUUID()),this.createdAt||(this.createdAt=Date.now())}return g(a,[{key:"destroy",value:function(){this.target=null,this.depends=null,this.callback=null,this.data=null}},{key:"_updateData",value:function(a){if(this.target){var b=a.getObject(this.target);b&&"POST"===this.operation&&b._getSendData&&(this.data=b._getSendData(this.data));
}}},{key:"toObject",value:function(){return{data:this.data}}}]),a}();i.prototype.operation="",i.prototype.fromDB=!1,i.prototype.createdAt=0,Object.defineProperty(i.prototype,"isFiring",{enumerable:!0,set:function(a){this.__isFiring=a,a&&(this.__firedAt=Date.now())},get:function(){return Boolean(this.__isFiring&&Date.now()-this.__firedAt<i.FIRING_EXPIRATION)}}),Object.defineProperty(i.prototype,"_isValidating",{enumerable:!0,set:function(a){this.__isValidating=a,a&&(this.__validatedAt=Date.now())},get:function(){return Boolean(this.__isValidating&&Date.now()-this.__validatedAt<i.VALIDATION_EXPIRATION)}}),i.prototype.id="",i.prototype.success=null,i.prototype.callback=null,i.prototype.retryCount=0,i.prototype.target=null,i.prototype.depends=null,i.prototype.data=null,i.FIRING_EXPIRATION=15e3,i.VALIDATION_EXPIRATION=500;var j=function(a){function b(){return f(this,b),d(this,Object.getPrototypeOf(b).apply(this,arguments))}return e(b,a),g(b,[{key:"_getRequestData",value:function(a){return this._updateUrl(a),this._updateData(a),{url:this.url,method:this.method,headers:this.headers,data:this.data}}},{key:"_updateUrl",value:function(a){if(this.target){var b=a.getObject(this.target);b&&!this.url.match(/^http(s):\/\//)&&(this.url=b._getUrl(this.url))}}},{key:"toObject",value:function(){return{data:this.data,url:this.url,method:this.method}}},{key:"_getCreateId",value:function(){return"POST"===this.operation&&this.data?this.data.id:""}}]),b}(i);j.prototype.timeout=15e3,j.prototype.url="",j.prototype.returnToOnlineCount=0,j.prototype.headers=null,j.prototype.method="GET";var k=function(a){function b(){return f(this,b),d(this,Object.getPrototypeOf(b).apply(this,arguments))}return e(b,a),g(b,[{key:"_getRequestData",value:function(a){return this._updateData(a),this.data}},{key:"toObject",value:function(){return this.data}},{key:"_getCreateId",value:function(){return"POST"===this.operation&&this.data.data?this.data.data.id:""}}]),b}(i);k.prototype.returnChangesArray=!1,b.exports={SyncEvent:i,XHRSyncEvent:j,WebsocketSyncEvent:k}},{"./client-utils":9}],46:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("./root"),j=a("./sync-event"),k=j.WebsocketSyncEvent,l=a("./xhr"),m=a("./logger"),n=a("./client-utils"),o=4,p=function(a){function b(a){d(this,b);var c=e(this,Object.getPrototypeOf(b).call(this,a));return c.client=a.client,c.client&&c.client.on("ready",function(){c._processNextRequest(),c._loadPersistedQueue()},c),c.queue=[],c.receiptQueue=[],c.onlineManager.on("disconnected",c._onlineStateChange,c),c.socketManager.on("connected disconnected",c._onlineStateChange,c),c}return f(b,a),g(b,[{key:"isOnline",value:function(){return this.onlineManager.isOnline}},{key:"_onlineStateChange",value:function(a){var b=this;"connected"===a.eventName?(this.queue.length&&this.queue[0].returnToOnlineCount++,setTimeout(function(){return b._processNextRequest()},100)):"disconnected"===a.eventName&&(this.queue.length&&(this.queue[0].isFiring=!1),this.receiptQueue.length&&this.receiptQueue.forEach(function(a){return a.isFiring=!1}))}},{key:"request",value:function(a){"PATCH"===a.operation&&this._findUnfiredCreate(a)?m.info("Sync Manager Request PATCH "+a.target+" request ignored; create request still enqueued",a.toObject()):(m.info("Sync Manager Request "+a.operation+" on target "+a.target,a.toObject()),"RECEIPT"===a.operation?this.receiptQueue.push(a):this.queue.push(a),this.trigger("sync:add",{request:a,target:a.target})),"DELETE"===a.operation&&this._purgeOnDelete(a),this._processNextRequest(a)}},{key:"_processNextRequest",value:function(a){var b=this;this.queue.length&&!this.queue[0].isFiring&&(a?this.client.dbManager.writeSyncEvents([a],function(){return b._processNextStandardRequest()}):this._processNextStandardRequest()),this.receiptQueue.length&&this._processNextReceiptRequest()}},{key:"_findUnfiredCreate",value:function(a){return Boolean(this.queue.filter(function(b){return b.target===a.target&&"POST"===b.operation&&!b.isFiring}).length)}},{key:"_processNextStandardRequest",value:function(){var a=this;if(!this.isDestroyed&&this.client.isAuthenticated){var b=this.queue[0];this.isOnline()&&b&&!b.isFiring&&!b._isValidating&&(b._isValidating=!0,this._validateRequest(b,function(c){return b._isValidating=!1,c?void a._fireRequest(b):(a._removeRequest(b,!1),a._processNextStandardRequest())}))}}},{key:"_processNextReceiptRequest",value:function(){var a=this,b=0;this.receiptQueue.forEach(function(c){a.isOnline()&&c&&(c.isFiring||c._isValidating?b++:b<o&&(b++,a._fireRequest(c)))})}},{key:"_fireRequest",value:function(a){a instanceof k?this._fireRequestWebsocket(a):this._fireRequestXHR(a)}},{key:"_fireRequestXHR",value:function(a){var b=this;a.isFiring=!0,a.headers||(a.headers={}),a.headers.authorization='Layer session-token="'+this.client.sessionToken+'"',m.info("Sync Manager XHR Request Firing "+a.operation+" "+a.target+" at "+(new Date).toISOString(),a.toObject()),l(a._getRequestData(this.client),function(c){return b._xhrResult(c,a)})}},{key:"_fireRequestWebsocket",value:function(a){var b=this;this.socketManager&&this.socketManager._isOpen()?(m.debug("Sync Manager Websocket Request Firing "+a.operation+" on target "+a.target,a.toObject()),a.isFiring=!0,this.requestManager.sendRequest({data:a._getRequestData(this.client),callback:function(c){return b._xhrResult(c,a)},isChangesArray:a.returnChangesArray})):m.debug("Sync Manager Websocket Request skipped; socket closed")}},{key:"_validateRequest",value:function(a,b){this.client.dbManager.claimSyncEvent(a,function(a){return b(a)})}},{key:"_handleDeduplicationErrors",value:function(a){a.data&&"id_in_use"===a.data.id&&a.data.data&&a.data.data.id===a.request._getCreateId()&&(a.success=!0,a.data=a.data.data)}},{key:"_xhrResult",value:function(a,b){this.isDestroyed||(a.request=b,b.isFiring=!1,this._handleDeduplicationErrors(a),a.success?this._xhrSuccess(a):this._xhrError(a))}},{key:"_getErrorState",value:function(a,c,d){var e=a.data?a.data.id:"";return d?"not_found"===e?"notFound":"id_in_use"===e?"invalidId":408===a.status||"request_timeout"===e?c.retryCount>=b.MAX_RETRIES?"tooManyFailuresWhileOnline":"validateOnlineAndRetry":[502,503,504].indexOf(a.status)!==-1?c.retryCount>=b.MAX_RETRIES?"tooManyFailuresWhileOnline":"serverUnavailable":"authentication_required"===e&&a.data.data&&a.data.data.nonce?"reauthorize":"serverRejectedRequest":c.returnToOnlineCount>=b.MAX_RETRIES_BEFORE_CORS_ERROR?"CORS":"offline"}},{key:"_xhrError",value:function(a){var b=a.request;m.warn("Sync Manager "+(b instanceof k?"Websocket":"XHR")+" "+(b.operation+" Request on target "+b.target+" has Failed"),b.toObject());var c=this._getErrorState(a,b,this.isOnline());switch(m.warn("Sync Manager Error State: "+c),c){case"tooManyFailuresWhileOnline":this._xhrHandleServerError(a,"Sync Manager Server Unavailable Too Long; removing request",!1);break;case"notFound":this._xhrHandleServerError(a,"Resource not found; presumably deleted",!1);break;case"invalidId":this._xhrHandleServerError(a,"ID was not unique; request failed",!1);break;case"validateOnlineAndRetry":this._xhrHandleServerUnavailableError(b);break;case"serverUnavailable":this._xhrHandleServerUnavailableError(b);break;case"reauthorize":b.callback&&b.callback(a);break;case"serverRejectedRequest":this._xhrHandleServerError(a,"Sync Manager Server Rejects Request; removing request",!0);break;case"CORS":this._xhrHandleServerError(a,"Sync Manager Server detects CORS-like errors; removing request",!1);break;case"offline":this._xhrHandleConnectionError()}this.queue.indexOf(b)===-1&&this.receiptQueue.indexOf(b)===-1||this.client.dbManager.writeSyncEvents([b])}},{key:"_xhrHandleServerUnavailableError",value:function(a){var c=b.MAX_UNAVAILABLE_RETRY_WAIT,d=n.getExponentialBackoffSeconds(c,Math.min(15,a.retryCount++));m.warn("Sync Manager Server Unavailable; retry count "+a.retryCount+"; retrying in "+d+" seconds"),setTimeout(this._processNextRequest.bind(this),1e3*d)}},{key:"_xhrHandleServerError",value:function(a,b,c){a.request.callback&&a.request.callback(a),c?m.error(b+"\nREQUEST: "+JSON.stringify(a.request.toObject(),null,4)+"\nRESPONSE: "+JSON.stringify(a.data,null,4)):m.error(b,a),this.trigger("sync:error",{target:a.request.target,request:a.request,error:a.data}),a.request.success=!1,"POST"===a.request.operation&&this._purgeDependentRequests(a.request),this._removeRequest(a.request,!0),this._processNextRequest()}},{key:"_xhrHandleConnectionError",value:function(){}},{key:"_xhrValidateIsOnline",value:function(a){var b=this;m.debug("Sync Manager verifying online state"),this.onlineManager.checkOnlineStatus(function(c){return b._xhrValidateIsOnlineCallback(c,a)})}},{key:"_xhrValidateIsOnlineCallback",value:function(a,b){m.debug("Sync Manager online check result is "+a),a?(b.retryCount++,this._processNextRequest()):this._xhrHandleConnectionError()}},{key:"_xhrSuccess",value:function(a){var b=a.request;m.debug("Sync Manager "+(b instanceof k?"Websocket":"XHR")+" "+(b.operation+" Request on target "+b.target+" has Succeeded"),b.toObject()),a.data&&m.debug(a.data),b.success=!0,this._removeRequest(b,!0),b.callback&&b.callback(a),this._processNextRequest(),this.trigger("sync:success",{target:b.target,request:b,response:a.data})}},{key:"_removeRequest",value:function(a,b){var c="RECEIPT"===a.operation?this.receiptQueue:this.queue,d=c.indexOf(a);d!==-1&&c.splice(d,1),b&&this.client.dbManager.deleteObjects("syncQueue",[a])}},{key:"_purgeDependentRequests",value:function(a){this.queue=this.queue.filter(function(b){return b.depends.indexOf(a.target)===-1||b===a}),this.receiptQueue=this.receiptQueue.filter(function(b){return b.depends.indexOf(a.target)===-1||b===a})}},{key:"_purgeOnDelete",value:function(a){var b=this;this.queue.filter(function(b){return b.depends.indexOf(a.target)!==-1&&a!==b}).forEach(function(a){b.trigger("sync:abort",{target:a.target,request:a}),b._removeRequest(a,!0)})}},{key:"destroy",value:function(){this.queue.forEach(function(a){return a.destroy()}),this.queue=null,this.receiptQueue.forEach(function(a){return a.destroy()}),this.receiptQueue=null,h(Object.getPrototypeOf(b.prototype),"destroy",this).call(this)}},{key:"_loadPersistedQueue",value:function(){var a=this;this.client.dbManager.loadSyncQueue(function(b){b.length&&(a.queue=a.queue.concat(b),a._processNextRequest())})}}]),b}(i);p.prototype.socketManager=null,p.prototype.requestManager=null,p.prototype.onlineManager=null,p.prototype.queue=null,p.prototype.receiptQueue=null,p.prototype.client=null,p.MAX_UNAVAILABLE_RETRY_WAIT=900,p.MAX_RETRIES_BEFORE_CORS_ERROR=3,p.MAX_RETRIES=20,p._supportedEvents=["sync:error","sync:success","sync:add","sync:abort"].concat(i._supportedEvents),i.initClass(p),b.exports=p},{"./client-utils":9,"./logger":16,"./root":44,"./sync-event":45,"./xhr":56}],47:[function(a,b,c){"use strict";function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../root"),j=a("../client-registry"),k=a("./typing-indicators"),l=k.STARTED,m=k.PAUSED,n=k.FINISHED,o=function(a){function b(a){e(this,b);var c=f(this,Object.getPrototypeOf(b).call(this,a));c.state={},c._pollId=0;var d=c._getClient();return d.on("ready",function(){return c._clientReady()}),c}return g(b,a),h(b,[{key:"_clientReady",value:function(){var a=this._getClient();this.user=a.user;var b=a.socketManager;b.on("message",this._handleSocketEvent,this),this._startPolling()}},{key:"_isRelevantEvent",value:function(a){return"signal"===a.type&&"typing_indicator"===a.body.type&&a.body.data.sender.id!==this.user.id}},{key:"_handleSocketEvent",value:function(a){var b=this,c=a.data;this._isRelevantEvent(c)&&!function(){var a=b._getClient().getIdentity(c.body.data.sender.id)||b._getClient()._createObject(c.body.data.sender),d=c.body.data.action,e=c.body.object.id,f=b.state[e];f||(f=b.state[e]={users:{},typing:[],paused:[]}),f.users[a.id]={startTime:Date.now(),state:d,identity:a},f.users[a.id].state===n&&delete f.users[a.id],b._updateState(f,d,a.id),b.trigger("typing-indicator-change",{conversationId:e,typing:f.typing.map(function(a){return f.users[a].identity.toObject()}),paused:f.paused.map(function(a){return f.users[a].identity.toObject()})})}()}},{key:"getState",value:function(a){var b=this.state[a];return b?{typing:b.typing.map(function(a){return b.users[a].identity.toObject()}),paused:b.paused.map(function(a){return b.users[a].identity.toObject()})}:{typing:[],paused:[]}}},{key:"_updateState",value:function(a,b,c){var e=a.typing.indexOf(c);b!==l&&e!==-1&&(a.typing=[].concat(d(a.typing.slice(0,e)),d(a.typing.slice(e+1))));var f=a.paused.indexOf(c);b!==m&&f!==-1&&(a.paused=[].concat(d(a.paused.slice(0,f)),d(a.paused.slice(f+1)))),b===l&&e===-1?a.typing=[].concat(d(a.typing),[c]):b===m&&f===-1&&(a.paused=[].concat(d(a.paused),[c]))}},{key:"_startPolling",value:function(){var a=this;this._pollId||(this._pollId=setInterval(function(){return a._poll()},5e3))}},{key:"_poll",value:function(){var a=this,b=Object.keys(this.state);b.forEach(function(b){var c=a.state[b];Object.keys(c.users).forEach(function(d){Date.now()>=c.users[d].startTime+6e3&&(a._updateState(c,n,d),delete c.users[d],a.trigger("typing-indicator-change",{conversationId:b,typing:c.typing.map(function(a){return c.users[a].identity.toObject()}),paused:c.paused.map(function(a){return c.users[a].identity.toObject()})}))})})}},{key:"_getClient",value:function(){return j.get(this.clientId)}}]),b}(i);o.prototype._pollId=0,o.prototype.clientId="",o.bubbleEventParent="_getClient",o._supportedEvents=["typing-indicator-change"].concat(i._supportedEvents),i.initClass.apply(o,[o,"TypingIndicatorListener"]),b.exports=o},{"../client-registry":8,"../root":44,"./typing-indicators":48}],48:[function(a,b,c){"use strict";b.exports={STARTED:"started",PAUSED:"paused",FINISHED:"finished"}},{}],49:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./typing-publisher"),g=a("./typing-indicators"),h=g.STARTED,i=(g.PAUSED,g.FINISHED),j=function(){function a(b){d(this,a),this.clientId=b.clientId,this.conversation=b.conversation,this.publisher=new f({clientId:this.clientId,conversation:this.conversation}),this.intervalId=0,this.lastKeyId=0,this._handleKeyPress=this._handleKeyPress.bind(this),this._handleKeyDown=this._handleKeyDown.bind(this),this.setInput(b.input)}return e(a,[{key:"destroy",value:function(){this._removeInput(this.input),this.publisher.destroy()}},{key:"setInput",value:function(a){a!==this.input&&(this._removeInput(this.input),this.input=a,this.input.addEventListener("keypress",this._handleKeyPress),this.input.addEventListener("keydown",this._handleKeyDown))}},{key:"_removeInput",value:function(a){a&&(a.removeEventListener("keypress",this._handleKeyPress),a.removeEventListener("keydown",this._handleKeyDown),this.input=null)}},{key:"setConversation",value:function(a){a!==this.conversation&&(this.conversation=a,this.publisher.setConversation(a))}},{key:"_handleKeyPress",value:function(a){var b=this;this.lastKeyId&&window.clearTimeout(this.lastKeyId),this.lastKeyId=window.setTimeout(function(){b.lastKeyId=0;var a=!b.input.value;b.send(a?i:h)},50)}},{key:"_handleKeyDown",value:function(a){[8,46,13].indexOf(a.keyCode)!==-1&&this._handleKeyPress()}},{key:"send",value:function(a){this.publisher.setState(a)}}]),a}();b.exports=j},{"./typing-indicators":48,"./typing-publisher":50}],50:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=2500,g=a("./typing-indicators"),h=g.STARTED,i=g.PAUSED,j=g.FINISHED,k=a("../client-registry"),l=function(){function a(b){d(this,a),this.clientId=b.clientId,b.conversation&&(this.conversation=this._getClient().getObject(b.conversation.id)),this.state=j,this._lastMessageTime=0}return e(a,[{key:"setConversation",value:function(a){this.setState(j),this.conversation=a?this._getClient().getObject(a.id):null,this.state=j}},{key:"setState",value:function(a){if(this._pauseLoopId&&(clearInterval(this._pauseLoopId),this._pauseLoopId=0),this.conversation){if(this.state!==a)this.state=a,this._send(a);else{if(a===j)return;Date.now()>this._lastMessageTime+f?this._send(a):this._scheduleNextMessage(a)}this.state!==j&&this._startPauseLoop()}}},{key:"_startPauseLoop",value:function(){var a=this;this._pauseLoopId||(this._pauseLoopId=window.setInterval(function(){a.state===i?a.setState(j):a.state===h&&a.setState(i)},f))}},{key:"_scheduleNextMessage",value:function(a){var b=this;this._scheduleId&&clearTimeout(this._scheduleId);var c=f-Math.min(Date.now()-this._lastMessageTime,f);this._scheduleId=setTimeout(function(){b._scheduleId=0,b.state===a&&b._send(a)},c)}},{key:"_send",value:function(a){if(this.conversation.isSaved()){this._lastMessageTime=Date.now();var b=this._getClient().socketManager;b.sendSignal({type:"typing_indicator",object:{id:this.conversation.id},data:{action:a}})}}},{key:"_getClient",value:function(){return k.get(this.clientId)}},{key:"destroy",value:function(){delete this.conversation,this.isDestroyed=!0,clearTimeout(this._scheduleId),clearInterval(this._pauseLoopId)}}]),a}();b.exports=l},{"../client-registry":8,"./typing-indicators":48}],51:[function(a,b,c){(function(a){"use strict";var c=a.getNativeSupport&&a.getNativeSupport("setImmediate");c?b.exports=c:!function(){var a=function(){for(e=!1,clearTimeout(c),c=0,d=0,f.push(d);f.length;){var a=f.shift();if("function"==typeof a)try{a()}catch(a){console.error(a)}else a>=g&&(f=[],console.error("Layer Error: setImmediate Max Queue Depth Exceded"))}},c=0,d=0,e=!1,f=[],g=10;b.exports=function(b){if("function"!=typeof b)throw new Error("Function expected in defer");f.push(b),e||(e=!0,"undefined"!=typeof document?window.postMessage({type:"layer-set-immediate"},"*"):window.postMessage({type:"layer-set-immediate"}),c=setTimeout(a,0))},b.exports.flush=function(){return a()},b.exports.reset=function(){f=[]},addEventListener("message",function(b){"layer-set-immediate"===b.data.type&&a()})}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],52:[function(a,b,c){"use strict";function d(a){a.client.once("destroy",function(){return f=null}),f=new e({camelCase:!0,getObjectCallback:function(b){return a.client.getObject(b)},createObjectCallback:function(b,c){return a.client._createObject(c)},propertyNameMap:{Conversation:{unreadMessageCount:"unreadCount"},Identity:{presence:"_presence"}},changeCallbacks:{Message:{all:function(a,b,c,d){a._handlePatchEvent(b,c,d)}},Conversation:{all:function(a,b,c,d){a._handlePatchEvent(b,c,d)}},Channel:{all:function(a,b,c,d){a._handlePatchEvent(b,c,d)}},Identity:{all:function(a,b,c,d){a._handlePatchEvent(b,c,d)}}}})}var e=a("layer-patch"),f=void 0;b.exports=function(a){f||d(a),f.parse(a)}},{"layer-patch":4}],53:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("../client-utils"),g=a("../logger"),h=a("../models/message"),i=a("../models/conversation"),j=a("../models/channel"),k=function(){function a(b){d(this,a),this.client=b.client,b.socketManager.on("message",this._handleChange,this)}return e(a,[{key:"_handleChange",value:function(a){"change"===a.data.type&&this._processChange(a.data.body)}},{key:"_processChange",value:function(a){switch(a.operation){case"create":g.info("Websocket Change Event: Create "+a.object.type+" "+a.object.id),g.debug(a.data),this._handleCreate(a);break;case"delete":g.info("Websocket Change Event: Delete "+a.object.type+" "+a.object.id),g.debug(a.data),this._handleDelete(a);break;case"update":g.info("Websocket Change Event: Patch "+a.object.type+" "+a.object.id+": "+a.data.map(function(a){return a.property}).join(", ")),g.debug(a.data),this._handlePatch(a)}}},{key:"_handleCreate",value:function(a){a.data.fromWebsocket=!0,this.client._createObject(a.data)}},{key:"_handleDelete",value:function(a){var b=this.getObject(a);b&&b._handleWebsocketDelete(a.data)}},{key:"_handlePatch",value:function(a){var b=this.getObject(a);if(b)try{b._inLayerParser=!0,f.layerParse({object:b,type:a.object.type,operations:a.data,client:this.client}),b._inLayerParser=!1}catch(b){g.error("websocket-manager: Failed to handle event",a.data)}else switch(f.typeFromID(a.object.id)){case"channels":j._loadResourceForPatch(a.data)&&this.client.getObject(a.object.id,!0);break;case"conversations":i._loadResourceForPatch(a.data)&&this.client.getObject(a.object.id,!0);break;case"messages":h._loadResourceForPatch(a.data)&&this.client.getMessage(a.object.id,!0);break;case"announcements":}}},{key:"getObject",value:function(a){return this.client.getObject(a.object.id)}},{key:"destroy",value:function(){this.client=null}}]),a}();k.prototype.client=null,b.exports=k},{"../client-utils":9,"../logger":16,"../models/channel":25,"../models/conversation":29,"../models/message":33}],54:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("../client-utils"),g=a("../logger"),h=a("../layer-error"),i=15e3,j=function(){function a(b){d(this,a),this.client=b.client,this.socketManager=b.socketManager,this.socketManager.on({message:this._handleResponse,disconnected:this._reset},this),this._requestCallbacks={}}return e(a,[{key:"_reset",value:function(){this._requestCallbacks={}}},{key:"cancelOperation",value:function(a){var b=this;Object.keys(this._requestCallbacks).forEach(function(c){var d=b._requestCallbacks[c];d.method===a&&delete b._requestCallbacks[c]})}},{key:"_handleResponse",value:function(a){if("response"===a.data.type){var b=a.data.body,c=b.request_id;g.debug("Websocket response "+c+" "+(b.success?"Successful":"Failed")),c&&this._requestCallbacks[c]&&this._processResponse(c,a)}}},{key:"_processResponse",value:function(a,b){var c=this._requestCallbacks[a],d=b.data.body,e=(d.success?d.data:new h(d.data))||{};d.success&&(c.isChangesArray&&this._handleChangesArray(e.changes),"batch"in e&&(c.batchTotal=e.batch.count,c.batchIndex=e.batch.index,c.isChangesArray?c.results=c.results.concat(e.changes):"results"in e&&Array.isArray(e.results)&&(c.results=c.results.concat(e.results)),e.batch.index<e.batch.count-1))||(c.callback({success:d.success,fullData:"batch"in e?c.results:b.data,data:e}),delete this._requestCallbacks[a])}},{key:"_handleChangesArray",value:function(a){var b=this;a.forEach(function(a){return b.client.socketChangeManager._processChange(a)})}},{key:"sendRequest",value:function(a){var b=a.data,c=a.callback,d=a.isChangesArray,e=void 0!==d&&d;if(!this._isOpen())return c?c(new h({success:!1,data:{id:"not_connected",code:0,message:"WebSocket not connected"}})):void 0;var i=f.clone(b);return i.request_id="r"+this._nextRequestId++,g.debug("Request "+i.request_id+" is sending"),c&&(this._requestCallbacks[i.request_id]={request_id:i.request_id,date:Date.now(),callback:c,isChangesArray:e,method:b.method,batchIndex:-1,batchTotal:-1,results:[]}),this.socketManager.send({type:"request",body:i}),this._scheduleCallbackCleanup(),i.request_id?this._requestCallbacks[i.request_id]:void 0}},{key:"_scheduleCallbackCleanup",value:function(){this._callbackCleanupId||(this._callbackCleanupId=setTimeout(this._runCallbackCleanup.bind(this),i+50))}},{key:"_runCallbackCleanup",value:function(){var a=this;if(this._callbackCleanupId=0,!this.isDestroyed&&this._isOpen()){var b=0,c=Date.now();Object.keys(this._requestCallbacks).forEach(function(d){var e=a._requestCallbacks[d];e&&c<e.date+i?b++:c>a.socketManager._lastDataFromServerTimestamp+i?(a.socketManager._reconnect(!1),a._scheduleCallbackCleanup()):a._timeoutRequest(d)}),b&&this._scheduleCallbackCleanup()}}},{key:"_timeoutRequest",value:function(a){try{g.warn("Websocket request timeout"),this._requestCallbacks[a].callback({success:!1,data:new h({id:"request_timeout",message:"The server is not responding. We know how much that sucks.",url:"https:/developer.layer.com/docs/websdk",code:0,status:408,httpStatus:408})})}catch(a){}delete this._requestCallbacks[a]}},{key:"_isOpen",value:function(){return this.socketManager._isOpen()}},{key:"destroy",value:function(){this.isDestroyed=!0,this._callbackCleanupId&&clearTimeout(this._callbackCleanupId),this._requestCallbacks=null}}]),a}();j.prototype._nextRequestId=1,j.prototype.client=null,j.prototype._requestCallbacks=null,j.prototype._callbackCleanupId=0,j.prototype.socketManager=null,b.exports=j},{"../client-utils":9,"../layer-error":13,"../logger":16}],55:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},i=a("../root"),j=a("../client-utils"),k=a("../logger"),l=a("../layer-error"),m=a("../const"),n=m.WEBSOCKET_PROTOCOL,o=function(b){function c(a){d(this,c);var b=e(this,Object.getPrototypeOf(c).call(this,a));if(!b.client)throw new Error("SocketManager requires a client");return b._onMessage=b._onMessage.bind(b),b._onOpen=b._onOpen.bind(b),b._onSocketClose=b._onSocketClose.bind(b),b._onError=b._onError.bind(b),b.client.isAuthenticated&&b.client.onlineManager.isOnline&&b.connect(),b.client.on("online",b._onlineStateChange,b),b.client.on("authenticated",b.connect,b),b._lastTimestamp=Date.now(),b}return f(c,b),g(c,[{key:"_reset",value:function(){this._lastTimestamp=0,this._lastDataFromServerTimestamp=0,this._lastCounter=null,this._hasCounter=!1,this._needsReplayFrom=null}},{key:"_onlineStateChange",value:function(a){this.client.isAuthenticated&&(a.isOnline?this._reconnect(a.reset):this.close())}},{key:"_reconnect",value:function(a){this.close(),a&&this._reset(),this.connect()}},{key:"connect",value:function(b){if(!this.client.isDestroyed&&this.client.isOnline){if(this._isOpen())return this._reconnect();this._closing=!1,this._lastCounter=-1;var c=this.client.websocketUrl+"/?session_token="+this.client.sessionToken,d="undefined"==typeof WebSocket?a("websocket").w3cwebsocket:WebSocket;this._socket=new d(c,n),"undefined"==typeof WebSocket?(this._socket.onmessage=this._onMessage,this._socket.onclose=this._onSocketClose,this._socket.onopen=this._onOpen,this._socket.onerror=this._onError):(this._socket.addEventListener("message",this._onMessage),this._socket.addEventListener("close",this._onSocketClose),this._socket.addEventListener("open",this._onOpen),this._socket.addEventListener("error",this._onError)),this._connectionFailedId=setTimeout(this._connectionFailed.bind(this),5e3)}}},{key:"_clearConnectionFailed",value:function(){this._connectionFailedId&&(clearTimeout(this._connectionFailedId),this._connectionFailedId=0)}},{key:"_connectionFailed",value:function(){this._connectionFailedId=0;var a="Websocket failed to connect to server";k.warn(a);try{this.isOpen=!1,this._removeSocketEvents(),this._socket&&(this._socket.close(),this._socket=null)}catch(a){}this._onError(new Error(a))}},{key:"_onOpen",value:function(){this._clearConnectionFailed(),this._isOpen()&&(this._lostConnectionCount=0,this.isOpen=!0,this.trigger("connected"),k.debug("Websocket Connected"),this._hasCounter&&this._lastTimestamp?this.resync(this._lastTimestamp):(this._enablePresence(),this._reschedulePing()))}},{key:"_isOpen",value:function(){return!!this._socket&&("undefined"==typeof WebSocket||this._socket&&this._socket.readyState===WebSocket.OPEN)}},{key:"_onError",value:function(a){this._closing||(this._clearConnectionFailed(),k.debug("Websocket Error causing websocket to close",a),this.isOpen?(this._onSocketClose(),this._socket.close(),this._socket=null):(this._removeSocketEvents(),this._lostConnectionCount++,this._scheduleReconnect()))}},{key:"sendSignal",value:function(a){this._isOpen()&&this._socket.send(JSON.stringify({type:"signal",body:a}))}},{key:"getCounter",value:function(a){var b=this,c=Date.now()-this._lastGetCounterRequest<1e3;return c?void(this._lastGetCounterId||(this._lastGetCounterId=setTimeout(function(){b._lastGetCounterId=0,b.getCounter(a)},Date.now()-this._lastGetCounterRequest-1e3))):(this._lastGetCounterRequest=Date.now(),this._lastGetCounterId&&(clearTimeout(this._lastGetCounterId),this._lastGetCounterId=0),k.debug("Websocket request: getCounter"),void this.client.socketRequestManager.sendRequest({data:{method:"Counter.read"
},callback:function(b){k.debug("Websocket response: getCounter "+b.data.counter),a&&(b.success?a(!0,b.data.counter,b.fullData.counter):a(!1))},isChangesArray:!1}))}},{key:"resync",value:function(a,b){var c=this;if(!a)throw new Error(l.dictionary.valueNotSupported);"number"==typeof a&&(a=new Date(a).toISOString()),this.client.socketRequestManager.cancelOperation("Event.replay"),this.client.socketRequestManager.cancelOperation("Presence.sync"),this._replayEvents(a,function(){c._enablePresence(a,function(){c.trigger("synced"),b&&b()})})}},{key:"_replayEvents",value:function(a,b){var c=this;this._isOpen()||this._needsReplayFrom?(k.info("Websocket request: _replayEvents"),this.client.socketRequestManager.sendRequest({data:{method:"Event.replay",data:{from_timestamp:a}},callback:function(d){return c._replayEventsComplete(a,b,d.success)},isChangesArray:!1})):(k.debug("Websocket request: _replayEvents updating _needsReplayFrom"),this._needsReplayFrom=a)}},{key:"_replayEventsComplete",value:function(a,b,c){var d=this;if(c)if(this._replayRetryCount=0,this._needsReplayFrom){if(this._needsReplayFrom){k.info("Websocket replay partially complete");var e=this._needsReplayFrom;this._needsReplayFrom=null,this._replayEvents(e)}}else k.info("Websocket replay complete"),b&&b();else if(this._replayRetryCount<8){var f=20,g=j.getExponentialBackoffSeconds(f,Math.min(15,this._replayRetryCount+2));k.info("Websocket replay retry in "+g+" seconds"),setTimeout(function(){return d._replayEvents(a)},1e3*g),this._replayRetryCount++}else k.error("Websocket Event.replay has failed")}},{key:"_enablePresence",value:function(a,b){this.client.socketRequestManager.sendRequest({data:{method:"Presence.subscribe"},callback:null,isChangesArray:!1}),this.client.isPresenceEnabled&&this.client.socketRequestManager.sendRequest({data:{method:"Presence.update",data:[{operation:"set",property:"status",value:"auto"}]},callback:null,isChangesArray:!1}),a?this.syncPresence(a,b):b&&b({success:!0})}},{key:"syncPresence",value:function(a,b){if(a)return this.client.socketRequestManager.sendRequest({data:{method:"Presence.sync",data:{since:a}},isChangesArray:!0,callback:b})}},{key:"_onMessage",value:function(a){this._lostConnectionCount=0;try{var b=JSON.parse(a.data),c=this._lastCounter+1!==b.counter;this._hasCounter=!0,this._lastCounter=b.counter,this._lastDataFromServerTimestamp=Date.now(),c?this.resync(this._lastTimestamp):this._lastTimestamp=new Date(b.timestamp).getTime(),this.trigger("message",{data:b}),this._reschedulePing()}catch(b){k.error("Layer-Websocket: Failed to handle websocket message: "+b+"\n",a.data)}}},{key:"_reschedulePing",value:function(){this._nextPingId&&clearTimeout(this._nextPingId),this._nextPingId=setTimeout(this._ping.bind(this),this.pingFrequency)}},{key:"_ping",value:function(){k.debug("Websocket ping"),this._nextPingId=0,this._isOpen()&&this.getCounter(this._reschedulePing.bind(this))}},{key:"close",value:function(){k.debug("Websocket close requested"),this._closing=!0,this.isOpen=!1,this._socket&&(this._onSocketClose(),this._socket.close(),this._socket=null)}},{key:"send",value:function(a){this._socket.send(JSON.stringify(a))}},{key:"destroy",value:function(){this.close(),this._nextPingId&&clearTimeout(this._nextPingId),h(Object.getPrototypeOf(c.prototype),"destroy",this).call(this)}},{key:"_onSocketClose",value:function(){k.debug("Websocket closed"),this.isOpen=!1,this._closing||this._scheduleReconnect(),this._removeSocketEvents(),this.trigger("disconnected")}},{key:"_removeSocketEvents",value:function(){"undefined"!=typeof WebSocket&&this._socket?(this._socket.removeEventListener("message",this._onMessage),this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("open",this._onOpen),this._socket.removeEventListener("error",this._onError)):this._socket&&(this._socket.onmessage=null,this._socket.onclose=null,this._socket.onopen=null,this._socket.onerror=null)}},{key:"_scheduleReconnect",value:function(){var a=this;if(!this.isDestroyed&&this.client.isOnline&&this.client.isAuthenticated){var b=(this.client.onlineManager.pingFrequency-1e3)/1e3,c=j.getExponentialBackoffSeconds(b,Math.min(15,this._lostConnectionCount));k.debug("Websocket Reconnect in "+c+" seconds"),this._reconnectId||(this._reconnectId=setTimeout(function(){a._reconnectId=0,a._validateSessionBeforeReconnect()},1e3*c))}}},{key:"_validateSessionBeforeReconnect",value:function(){var a=this;if(!this.isDestroyed&&this.client.isOnline&&this.client.isAuthenticated){var b=3e4,c=Date.now()-this._lastValidateSessionRequest-b;c<0?this._reconnectId||(this._reconnectId=setTimeout(function(){a._reconnectId=0,a._validateSessionBeforeReconnect()},Math.abs(c)+1e3)):(this._lastValidateSessionRequest=Date.now(),this.client.xhr({url:"/?action=validateConnectionForWebsocket&client="+this.client.constructor.version,method:"GET",sync:!1},function(b){b.success&&a.connect()}))}}}]),c}(i);o.prototype.isOpen=!1,o.prototype._reconnectId=0,o.prototype._connectionFailedId=0,o.prototype._lastTimestamp=0,o.prototype._lastDataFromServerTimestamp=0,o.prototype._lastCounter=null,o.prototype._hasCounter=!1,o.prototype._needsReplayFrom=null,o.prototype._replayRetryCount=0,o.prototype._lastGetCounterRequest=0,o.prototype._lastGetCounterId=0,o.prototype._lastValidateSessionRequest=0,o.prototype.pingFrequency=3e4,o.prototype.client=null,o.prototype._socket=null,o.prototype._closing=!1,o.prototype._lostConnectionCount=0,o._supportedEvents=["message","connected","disconnected","syncing","synced"].concat(i._supportedEvents),i.initClass.apply(o,[o,"SocketManager"]),b.exports=o},{"../client-utils":9,"../const":11,"../layer-error":13,"../logger":16,"../root":44,websocket:3}],56:[function(a,b,c){"use strict";function d(a){if(!a)return{};var b=a.split(","),c={};return b.forEach(function(a){var b=a.split(";");if(2===b.length){var d=b[0].replace(/<(.*)>/,"$1").trim(),e=b[1].replace(/rel='?(.*)'?/,"$1").trim();c[e]=d}}),c}var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f="undefined"==typeof window?a("xhr2"):null;b.exports=function(a,c){var g=f?new f:new XMLHttpRequest,h=(a.method||"GET").toUpperCase(),i=function(){var f={"content-type":this.getResponseHeader("content-type")},g={status:this.status,success:this.status&&this.status<300,xhr:this},h=String(f["content-type"]).split(/;/)[0].match(/^application\/json/)||"json"===a.format;if("blob"===this.responseType||"arraybuffer"===this.responseType)0===this.status?g.data=new Error("Connection Failed"):g.data="function"==typeof this.response?this.responseText:this.response;else{if(h&&this.responseText)try{g.data=JSON.parse(this.responseText)}catch(a){g.data={code:999,message:"Invalid JSON from server",response:this.responseText},g.status=999}else g.data=this.responseText;b.exports.trigger({target:this,status:this.responseText||this.status?"connection:success":"connection:error"}),this.responseText||this.status?404===this.status&&"object"!==e(g.data)?g.data={id:"operation_not_found",message:"Endpoint "+(a.method||"GET")+" "+a.url+" does not exist",status:this.status,httpStatus:404,code:106,url:"https://docs.layer.com/reference/client_api/errors"}:"string"==typeof g.data&&this.status>=400&&(g.data={id:"unknown_error",message:g.data,status:this.status,httpStatus:this.status,code:0,url:"https://www.google.com/search?q=doh!"}):(g.status=408,g.data={id:"request_timeout",message:"The server is not responding please try again in a few minutes",url:"https://docs.layer.com/reference/client_api/errors",code:0,status:408,httpStatus:408})}if(a.headers&&(a.headers.accept||"").match(/application\/vnd.layer\+json/)){var i=this.getResponseHeader("link");i&&(g.Links=d(i))}g.xhr=this,c&&c(g)};g.onload=i,g.onerror=g.ontimeout=i;var j=Object.keys(a.headers||{}),k={};j.forEach(function(b){"content-type"===b.toLowerCase()?k["content-type"]=a.headers[b]:k[b.toLowerCase()]=a.headers[b]}),a.headers=k;var l="";a.data&&("undefined"!=typeof Blob&&a.data instanceof Blob?l=a.data:a.headers&&(String(a.headers["content-type"]).match(/^application\/json/)||"application/vnd.layer-patch+json"===String(a.headers["content-type"]))?l="string"==typeof a.data?a.data:JSON.stringify(a.data):a.data&&"object"===e(a.data)?Object.keys(a.data).forEach(function(b){l&&(l+="&"),l+=b+"="+a.data[b]}):l=a.data),l&&"GET"===h&&(a.url+="?"+l),g.open(h,a.url,!0),a.timeout&&(g.timeout=a.timeout),a.withCredentials&&(g.withCredentials=!0),a.responseType&&(g.responseType=a.responseType),a.headers&&Object.keys(a.headers).forEach(function(b){return g.setRequestHeader(b,a.headers[b])});try{"GET"===h?g.send():g.send(l)}catch(a){}};var g=[];b.exports.addConnectionListener=function(a){return g.push(a)},b.exports.trigger=function(a){g.forEach(function(b){return b(a)})}},{xhr2:3}]},{},[1])(1)});
/*! layer-ui-web - v1.0.6 - 2017-09-28 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.layerUI=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){function b(a,b,c,d){d.forEach(function(d){var e=0===d.propertyName.indexOf("on")?"ng"+d.propertyName.substring(2):"ng"+d.propertyName.substring(0,1).toUpperCase()+d.propertyName.substring(1);c.$observe(d.propertyName,function(a){b.properties?b[d.propertyName]=a:(b.properties||(b.properties={}),b.properties[d.propertyName]=a)}),c.$observe(e,function(c){a.$watch(c,function(a){b.properties||(b.properties={}),b.properties._internalState&&!b.properties._internalState.disableSetters?b[d.propertyName]=a:b.properties[d.propertyName]=a})})})}var c=a.module("layerUIControllers",[]);Object.keys(f.default.components).filter(function(a){return f.default.components[a].properties.filter(function(a){return"_isMainComponent"===a.propertyName}).length}).forEach(function(a){var d=f.default.components[a],e=a.replace(/-(.)/g,function(a,b){return b.toUpperCase()});c.directive(e,function(){return{retrict:"E",link:function(a,c,e){var f=d.properties;b(a,c[0],e,f)}}})})}var e=a("../base"),f=function(a){return a&&a.__esModule?a:{default:a}}(e);b.exports=d,f.default.addAdapter("angular",d)},{"../base":4}],2:[function(a,b,c){"use strict";function d(a){return g?g:(g={},Object.keys(f.default.components).filter(function(a){return f.default.components[a].properties.filter(function(a){return"_isMainComponent"===a.propertyName}).length}).forEach(function(b){var c=f.default.components[b],d=(b.substring(0,1).toUpperCase()+b.substring(1).replace(/-(.)/g,function(a,b){return b.toUpperCase()})).replace(/^Layer/,""),e=g[d]=a.View.extend({el:b,initialize:function(a,b){var c=this;this.client=a,Object.keys(b||{}).forEach(function(a){c[a]=b[a]})}});c.properties.forEach(function(a){Object.defineProperty(e.prototype,a.propertyName,{set:function(b){this.$el[0][a.propertyName]=b},get:function(){return this.$el[0][a.propertyName]}})})}),g)}var e=a("../base"),f=function(a){return a&&a.__esModule?a:{default:a}}(e),g=void 0;b.exports=d,f.default.addAdapter("backbone",d)},{"../base":4}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){return k?k:(k={},Object.keys(j.default.components).filter(function(a){return j.default.components[a].properties.filter(function(a){return"_isMainComponent"===a.propertyName}).length}).forEach(function(c){var g=j.default.components[c];k[(c.substring(0,1).toUpperCase()+c.substring(1).replace(/-(.)/g,function(a,b){return b.toUpperCase()})).replace(/^Layer/,"")]=function(i){function j(){return d(this,j),e(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}return f(j,i),h(j,[{key:"componentDidMount",value:function(){var a=this;if(g.properties.filter(function(b){return a.props[b.propertyName]||a.props[b.attributeName]}).forEach(function(b){var c=b.propertyName in a.props?a.props[b.propertyName]:a.props[b.attributeName];b.type===HTMLElement&&c&&(c=a.handleReactDom(b,c)),a.node[b.propertyName]=c}),!this.node._onAfterCreate){var b=document.createEvent("CustomEvent");b.initCustomEvent("HTMLImportsLoaded",!0,!0,null),document.dispatchEvent(b)}this.node._onAfterCreate()}},{key:"shouldComponentUpdate",value:function(a){var b=this;return g.properties.filter(function(a){return b.props[a.propertyName]||b.props[a.attributeName]}).forEach(function(c){var d=c.propertyName in b.props?c.propertyName:c.attributeName,e=a[d];c.type===HTMLElement&&e&&(e=b.handleReactDom(c,e)),e!==b.props[d]&&(b.node[c.propertyName]=e)},this),!1}},{key:"handleReactDom",value:function(c,d){if(this.layerUIGeneratedNodes||(this.layerUIGeneratedNodes={}),Array.isArray(d)){var e=[];this.layerUIGeneratedNodes[c.propertyName]||(this.layerUIGeneratedNodes[c.propertyName]=e),e.length=d.length,d.forEach(function(c,d){if(c.tagName)e[d]=c;else{var f=e[d]||document.createElement("div");b.render("function"==typeof c?a.createElement(c):c,f),e[d]=f}})}else void 0===d.tagName&&(this.layerUIGeneratedNodes[c.propertyName]||(this.layerUIGeneratedNodes[c.propertyName]=document.createElement("div")),b.render(d,this.layerUIGeneratedNodes[c.propertyName]));return this.layerUIGeneratedNodes[c.propertyName]}},{key:"render",value:function(){var b=this;return a.createElement(c,{ref:function(a){b.node=a},id:this.props.id})}}]),j}(a.Component)}),k)}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a("../base"),j=function(a){return a&&a.__esModule?a:{default:a}}(i),k=void 0;b.exports=g,j.default.addAdapter("react",g)},{"../base":4}],4:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d),f={};f.settings={appId:"",messageGroupTimeSpan:18e5,disableTabAsWhiteSpace:!1,markReadDelay:2500,defaultHandler:{tagName:"layer-message-unknown"},textHandlers:["autolinker","emoji","images","newline","youtube"],maxSizes:{width:512,height:512},verticalMessagePadding:0},f.handlers=[],f.textHandlers={},f.components={},f.utils={},f.createItemSeparator=function(){var a=document.createElement("div");return a.classList.add(f.itemSeparatorParentClassName),a},f.itemSeparatorParentClassName="layer-list-item-separator-parent",f.addListItemSeparator=function(a,b,c,d){var e=d?"customNodeAbove":"customNodeBelow",g=void 0;if(b&&(g=document.createElement("div"),g.classList.add(c)),b&&("string"==typeof b?g.innerHTML=b:g.appendChild(b)),a[e]&&g){var h=a[e].querySelector("."+c);h?h.parentNode.replaceChild(g,h):a[e].appendChild(g)}else if(!a[e]&&g){var i=f.createItemSeparator();i.appendChild(g),a[e]=i}else if(a[e]&&!g){var j=a[e].querySelector("."+c);j&&j.parentNode.removeChild(j)}};var g="You must call layerUI.init() before you can use an adapter";f.adapters={angular:function(){throw new Error(g)},backbone:function(){throw new Error(g)},react:function(){throw new Error(g)}},f.registerMessageHandler=function(a){a.order||(a.order=0);for(var b=!1,c=0;c<f.handlers.length;c++)if(a.order<=f.handlers[c].order){f.handlers.splice(c,0,a),b=!0;break}b||f.handlers.push(a)},f.getHandler=function(a,b){return f.handlers.filter(function(c){return c.handlesMessage(a,b)})[0]||f.settings.defaultHandler},f.registerTextHandler=function(a){f.textHandlers[a.name]?a.handler?Object.keys(a).forEach(function(b){f.textHandlers[a.name][b]=a[b]}):f.textHandlers[a.name].enabled=!0:(a.enabled=!a.handler||!a.requiresEnable,"order"in a||(a.order=1e5),f.textHandlers[a.name]=a)},f.registerTemplate=function(a,b){b||(b=document._currentScript.ownerDocument.querySelector("template"));var c=b.innerHTML.match(/<style>([\s\S]*?)<\/style>/),d=c&&c[1];d&&(b.innerHTML=b.innerHTML.replace(/<style>[\s\S]*?<\/style>/,"")),f.components[a].template=b,f.components[a].style=d,b.setAttribute("layer-template-registered","true")},f.buildAndRegisterTemplate=function(a,b){var c=document.createElement("template");c.innerHTML=b,f.components[a].template=c,c.setAttribute("layer-template-registered","true")},f.buildStyle=function(a,b){f.components[a].style=b},f.camelCase=function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})};f.hyphenate=function(a){return a.replace(/([a-z])([A-Z])/g,function(a,b,c){return b+"-"+c.toLowerCase()})},f.isInBackground=function(){return!document.hasFocus()||document.hidden},f.addAdapter=function(a,b){f.adapters[a]=b},f.init=function(a){},f.version="1.0.6",3!==e.default.Client.version.split(".").map(function(a){return Number(a)})[0]&&"3.1.1"!==e.default.Client.version&&console.error("This version or Layer UI for Web requires Layer WebSDK version 3.1.1 or up"),b.exports=f},{"layer-websdk":66}],5:[function(require,module,exports){"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function setupMethods(a,b){var c=a.methods;Object.keys(b).forEach(function(a){c[a]||(c[a]={});var d=c[a],e=b[a];d.methodsBefore||(d.methodsBefore=[],d.methodsAfter=[],d.methodsMiddle=[],d.conditional=[]),"function"==typeof e?d.methodsMiddle.push(b[a]):e.mode===registerComponent.MODES.BEFORE?d.methodsBefore.push(b[a].value):e.mode===registerComponent.MODES.AFTER?d.methodsAfter.push(b[a].value):e.mode===registerComponent.MODES.OVERWRITE?d.lock=e.value:e.mode===registerComponent.MODES.DEFAULT&&d.methodsMiddle.push(b[a].value),e.conditional&&d.conditional.push(e.conditional)})}function setupMixin(a,b){Object.keys(b.properties||{}).forEach(function(c){a["__"+c]||(a["__"+c]=[]),a["__"+c].push(b.properties[c]),a.properties[c]?(void 0!==b.properties[c].order&&void 0===a.properties[c].order&&(a.properties[c].order=b.properties[c].order),void 0!==b.properties[c].value&&void 0===a.properties[c].value&&(a.properties[c].value=b.properties[c].value),void 0!==b.properties[c].propagateToChildren&&void 0===a.properties[c].propagateToChildren&&(a.properties[c].propagateToChildren=b.properties[c].propagateToChildren)):a.properties[c]=b.properties[c]}),setupMethods(a,b.methods||{})}function finalizeMixinMerge(a){Object.keys(a.properties||{}).forEach(function(b){if(a["__"+b]){var c=_layerWebsdk2.default.Util.sortBy(a["__"+b].filter(function(a){return a.set}),function(a){switch(a.mode){case registerComponent.MODES.BEFORE:return 1;case registerComponent.MODES.AFTER:return 3;default:return 2}});a["__set_"+b]=c.map(function(a){return a.set})}}),Object.keys(a.methods||{}).forEach(function(b){var c=a.methods[b],d=[].concat(_toConsumableArray(c.methodsBefore),_toConsumableArray(c.methodsMiddle),_toConsumableArray(c.methodsAfter));c.lock&&(d=[c.lock]),1!==d.length||c.conditional.length?(a["__method_"+b]=d,a.methods[b]=getMethod(a,c.conditional,a["__method_"+b])):a.methods[b]=d[0]})}function getMethod(a,b,c){return function(){for(var a=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];for(var g=void 0,h=0;h<b.length;h++)if(!b[h].apply(this,e))return;return c.forEach(function(b){var c=b.apply(a,e);void 0!==c&&(g=c)}),g}}function setupEvents(a){a.mixins.filter(function(a){return a.events}).forEach(function(b){a.events=a.events.concat(b.events)}),a.events.forEach(function(b){return setupEvent(a,b)})}function setupEvent(a,b){var c=_base2.default.camelCase(b.replace(/^layer-/,"")),d="on"+c.charAt(0).toUpperCase()+c.substring(1);a.properties[d]||(a.properties[d]={type:Function,set:function(a){this.properties["old-"+b]&&(this.removeEventListener(b,this.properties["old-"+b]),this.properties["old-"+b]=null),a&&(this.addEventListener(b,a),this.properties["old-"+b]=a)}})}function getPropArray(a){return Object.keys(a.properties).map(function(b){return{propertyName:b,attributeName:_base2.default.hyphenate(b),type:a.properties[b].type,order:a.properties[b].order,noGetterFromSetter:a.properties[b].noGetterFromSetter,propagateToChildren:a.properties[b].propagateToChildren}}).sort(function(a,b){return void 0!==a.order&&void 0!==b.order?a.order-b.order:void 0!==a.order?-1:void 0!==b.order?1:0})}function castProperty(type,value){switch(type){case Boolean:return["false","0","null","undefined"].indexOf(value)===-1&&Boolean(value);case Number:return Number(value);case Function:return"string"==typeof value?eval("("+value+")"):value}return value}function setupProperty(a,b,c){var d={},e=b.propertyName,f=a.properties[e];c[e]=f,d.get=function(){return this.properties._internalState.disableGetters?this.properties[e]:f.get?f.get.apply(this):this.properties[e]},d.set=function(c){var d=this;_base2.default.debug&&console.log("Set property "+this.tagName+"."+e+" to ",c),f.type&&(c=castProperty(f.type,c));var g=b.noGetterFromSetter?this.properties[e]:this[e];if(g!==c||this.properties._internalState.inPropInit.indexOf(e)!==-1){var h=this.properties._internalState.inPropInit.indexOf(e),i=h!==-1;if(i&&this.properties._internalState.inPropInit.splice(h,1),this.properties[e]=c,a["__set_"+e]&&!this.properties._internalState.disableSetters&&a["__set_"+e].forEach(function(a){return a.call(d,c,i?null:g)}),f.propagateToChildren&&(Object.keys(this.nodes).forEach(function(a){d.nodes[a][e]=c}),this._isList)){var j=this.childNodes,k=void 0;for(k=0;k<j.length;k++)j[k]._isListItem&&(j[k][e]=c)}}},a[e]=d}function registerComponent(a,b){_base2.default.components[a]||(_base2.default.components[a]={}),_base2.default.components[a].def=b,b.template&&(_base2.default.components[a].template=b.template,delete b.template),b.style&&(_base2.default.components[a].style=b.style,delete b.style),registerAllCalled&&_registerComponent(a)}function unregisterComponent(a){delete _base2.default.components[a]}function registerAll(){registerAllCalled=!0,Object.keys(_base2.default.components).filter(function(a){return"function"!=typeof _base2.default.components[a]}).forEach(function(a){return _registerComponent(a)})}function _registerComponent(a){var b=_base2.default.components[a].def,c=_base2.default.components[a].template;c&&("string"==typeof c?_base2.default.buildAndRegisterTemplate(a,c):"true"!==c.getAttribute("layer-template-registered")&&_base2.default.registerTemplate(a,c)),b.properties||(b.properties={}),b.methods||(b.methods={}),b.events||(b.events=[]),b.mixins||(b.mixins=[]),b.mixins.push(_stateManager2.default),_base2.default.settings.mixins[a]&&(b.mixins=b.mixins.concat(_base2.default.settings.mixins[a])),setupEvents(b);var d=b.methods;b.methods={},setupMethods(b,standardClassMethods),setupMethods(b,d);var e=b.properties;b.properties={},setupMixin(b,{properties:e}),setupMixin(b,{properties:standardClassProperties});for(var f=0;f<b.mixins.length;f++){var g=b.mixins[f].mixins;g&&g.forEach(function(a){b.mixins.indexOf(a)===-1&&b.mixins.push(a)})}b.properties._listeners={value:Object.keys(b.listeners||{})},b.mixins.forEach(function(a){return setupMixin(b,a)}),finalizeMixinMerge(b);var h={},i=getPropArray(b);i.forEach(function(a){return setupProperty(b,a,h)}),delete b.properties,Object.keys(b.methods).forEach(function(a){b[a]={value:b.methods[a],writable:!0}}),delete b.methods,Object.keys(b.listeners||{}).forEach(function(a){b["__listener-"+a]={value:b.listeners[a],writable:!0}}),delete b.listeners,b.createdCallback={value:function(){var b=this;if(_base2.default.components[a]){this._initializeProperties(),this.nodes={};var c=this.getTemplate();if(c){if(!this.getAttribute("layer-has-template")){var d=document.importNode(c.content,!0);this.appendChild(d),this.setAttribute("layer-has-template","true")}this.setupDomNodes()}this.onCreate(),_layerWebsdk2.default.Util.defer(function(){return b._onAfterCreate()})}}},b._setupListeners={value:function(){var a=this;this._listeners.forEach(function(b){document.body.addEventListener(b,a._handleListenerEvent.bind(a,"__listener-"+b))})}},b._handleListenerEvent={value:function(a,b){this.properties.listenTo.indexOf(b.target.id)!==-1&&this[a].apply(this,[b])}},b._onAfterCreate={value:function(){var b=this;this.properties._internalState.onDestroyCalled||this.properties._internalState.onAfterCreateCalled||(this.properties._internalState.disableSetters=!1,this.properties._internalState.disableGetters=!1,this.properties._internalState.inPropInit=_base2.default.components[a].properties.map(function(a){return a.propertyName}),i.forEach(function(a){var c=b.properties[a.propertyName];if(!(c instanceof _layerWebsdk2.default.Root&&c.isDestroyed))if(void 0!==c&&null!==c)b[a.propertyName]=c,a.propagateToChildren&&Object.keys(b.nodes).forEach(function(d){return b.nodes[d][a.propertyName]=c});else if(a.propagateToChildren&&b.parentComponent){var d=b.parentComponent.properties[a.propertyName];d&&(b[a.propertyName]=d)}}),this.properties._internalState.inPropInit=[],this._setupListeners(),this.onAfterCreate())}},b.attachedCallback={value:function(){this.onAttach()}},b._initializeProperties={value:function(){var a=this;this.properties&&this.properties._internalState||(this.properties||(this.properties={}),this.properties._internalState={onCreateCalled:!1,onAfterCreateCalled:!1,onRenderCalled:!1,onAttachCalled:!1,onDetachCalled:!1,disableSetters:!0,disableGetters:!0,inPropInit:[]},i.forEach(function(b){return a._copyInAttribute(b)}))}},b._copyInAttribute={value:function(a){var b=null,c=this.getAttribute(a.attributeName);null===c&&void 0!==this[a.attributeName]&&(c=this[a.attributeName]),null!==c?b=c:void 0!==this[a.propertyName]?(b=this[a.propertyName],delete this[a.propertyName]):"value"in h[a.propertyName]&&(b=h[a.propertyName].value,Array.isArray(b)&&(b=b.concat([]))),this.properties[a.propertyName]=a.type?castProperty(a.type,b):b}},b.detachedCallback={value:function(){var a=this;this.onDetach(),setTimeout(function(){document.body.contains(a)||document.head.contains(a)||!a.trigger("layer-widget-destroyed")||a.onDestroy()},1e4)}},b.attributeChangedCallback={value:function(a,b,c){_base2.default.debug&&console.log("Attribute Change on "+this.tagName+"."+a+" from "+b+" to ",c),this[_base2.default.camelCase(a)]=c}},_base2.default.components[a].classDef=document.registerElement(a,{prototype:Object.create(HTMLElement.prototype,b)}),_base2.default.components[a].properties=i}function registerMessageComponent(a,b){var c=b.methods.handlesMessage,d=b.properties.label.value,e=b.properties.order;registerComponent(a,b),_base2.default.registerMessageHandler({handlesMessage:c,tagName:a,label:d,order:e})}var _layerWebsdk=require("layer-websdk"),_layerWebsdk2=_interopRequireDefault(_layerWebsdk),_base=require("../base"),_base2=_interopRequireDefault(_base),_stateManager=require("../mixins/state-manager"),_stateManager2=_interopRequireDefault(_stateManager),registerAllCalled=!1;registerComponent.MODES={BEFORE:"BEFORE",AFTER:"AFTER",OVERWRITE:"OVERWRITE",DEFAULT:"DEFAULT"};var standardClassProperties={_layerEventSubscriptions:{value:[]},parentComponent:{},mainComponent:{get:function(){return this.properties._isMainComponent?this:(this.properties.mainComponent||(this.properties.mainComponent=this.properties.parentComponent.mainComponent),this.properties.mainComponent)}},client:{propagateToChildren:!0},listenTo:{value:[],set:function(a){"string"==typeof a&&(this.properties.listenTo=a.split(/\s*,\s*/))}}},standardClassMethods={setupDomNodes:function(){var a=this;this.nodes={},this._findNodesWithin(this,function(b,c){var d=b.getAttribute&&b.getAttribute("layer-id");d&&(a.nodes[d]=b),c&&(b.properties||(b.properties={}),b.properties.parentComponent=a)})},_findNodesWithin:function(a,b){for(var c=a.childNodes,d=0;d<c.length;d++){var e=c[d],f=Boolean(e instanceof HTMLElement&&_base2.default.components[e.tagName.toLowerCase()]);b(e,f),f||this._findNodesWithin(e,b)}},getTemplate:function(){var a=this.tagName.toLocaleLowerCase();if(_base2.default.components[a].style){var b=document.createElement("style");b.id="style-"+this.tagName.toLowerCase(),b.innerHTML=_base2.default.components[a].style,document.getElementsByTagName("head")[0].appendChild(b),_base2.default.components[a].style=""}return _base2.default.components[a].template},trigger:function(a,b){var c=new CustomEvent(a,{detail:b,bubbles:!0,cancelable:!0});return this.dispatchEvent(c),!c.defaultPrevented},querySelectorAllArray:function(a){return Array.prototype.slice.call(this.querySelectorAll(a))},onCreate:{mode:registerComponent.MODES.AFTER,value:function(){this.properties._internalState.onCreateCalled=!0}},onAfterCreate:{mode:registerComponent.MODES.AFTER,value:function(){this.properties._internalState.onAfterCreateCalled=!0,this.onRender(),this.properties._internalState.onRenderCalled=!0,this.properties._callOnAttachAfterCreate&&(this.properties._callOnAttachAfterCreate=!1,this.onAttach())}},onRender:{conditional:function(){return this.properties._internalState.onAfterCreateCalled}},onRerender:{conditional:function(){return this.properties._internalState.onAfterCreateCalled}},onAttach:{conditional:function(){return!!this.properties._internalState.onAfterCreateCalled||(this.properties._callOnAttachAfterCreate=!0,!1)},mode:registerComponent.MODES.AFTER,value:function(){this.properties._internalState.onAttachCalled=!0}},onDetach:{mode:registerComponent.MODES.AFTER,value:function(){this.properties.mainComponent&&!this.properties.mainComponent.contains(this)&&(this.properties.mainComponent=null),this.properties.parentComponent&&!this.properties.parentComponent.contains(this)&&(this.properties.parentComponent=null),this.properties._internalState.onDetachCalled=!0}},onDestroy:function(){var a=this;this.properties._internalState.onDestroyCalled=!0,this.properties._internalState.disableSetters=!0,this.properties._layerEventSubscriptions.forEach(function(b){return b.off(null,null,a)}),this.properties._layerEventSubscriptions=[],this.classList.add("layer-node-destroyed")}};module.exports={registerComponent:registerComponent,registerMessageComponent:registerMessageComponent,registerAll:registerAll,unregisterComponent:unregisterComponent}},{"../base":4,"../mixins/state-manager":54,"layer-websdk":66}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../../components/component"),f=a("../../../mixins/list-item"),g=d(f),h=a("../../../mixins/list-item-selection"),i=d(h);a("../../subcomponents/layer-delete/layer-delete"),(0,e.registerComponent)("layer-channel-item",{mixins:[g.default,i.default],properties:{item:{set:function(a,b){a&&this.onRerender()}},deleteConversationEnabled:{type:Boolean,set:function(a){this.nodes.delete&&(this.nodes.delete.enabled=a)}}},methods:{onRender:function(){this.onRerender()},onRerender:function(){this.item&&(this.nodes.title.innerHTML=this.item.name)},_runFilter:function(a){var b=this.properties.item,c=void 0;a?"function"==typeof a?c=a(b):a instanceof RegExp?c=a.test(b.name):(a=a.toLowerCase(),c=b.name.toLowerCase().indexOf(a)!==-1):c=!0,this.classList[c?"remove":"add"]("layer-item-filtered")}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-channel-item","<div class='layer-list-item' layer-id='innerNode'><div class='layer-channel-item-content'><div layer-id='title' class='layer-channel-title'></div></div><layer-delete layer-id='delete'></layer-delete></div>",""),b.buildStyle("layer-channel-item","layer-channel-item {\ndisplay: flex;\nflex-direction: column;\n}\nlayer-channel-item .layer-list-item {\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}\nlayer-channel-item  .layer-list-item .layer-channel-item-content {\nflex-grow: 1;\nwidth: 100px; \n}\nlayer-channel-item.layer-item-filtered .layer-list-item {\ndisplay: none;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list-item":47,"../../../mixins/list-item-selection":46,"../../subcomponents/layer-delete/layer-delete":25}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../../components/component"),f=a("../../../mixins/list-item"),g=d(f),h=a("../../../mixins/list-item-selection"),i=d(h);a("../../subcomponents/layer-conversation-last-message/layer-conversation-last-message"),a("../../subcomponents/layer-delete/layer-delete"),a("../../subcomponents/layer-avatar/layer-avatar"),a("../../subcomponents/layer-conversation-title/layer-conversation-title"),(0,e.registerComponent)("layer-conversation-item",{mixins:[g.default,i.default],properties:{item:{set:function(a,b){this.nodes.lastMessage&&(this.nodes.lastMessage.canFullyRenderLastMessage=this.canFullyRenderLastMessage)}},deleteConversationEnabled:{type:Boolean,set:function(a){this.nodes.delete&&(this.nodes.delete.enabled=a)}},canFullyRenderLastMessage:{}},methods:{onRender:function(){this.onRerender()},onRerender:function(){var a=this.item.participants.filter(function(a){return!a.sessionOwner}),b=!this.item.lastMessage||this.item.lastMessage.isRead;this.nodes.avatar.users=a,this.classList[b?"remove":"add"]("layer-conversation-unread-messages")},_runFilter:function(a){var b=this.properties.item,c=void 0;if(a)if("function"==typeof a)c=a(b);else{var d=[];b.metadata.conversationName&&d.push(b.metadata.conversationName),b.participants.forEach(function(a){d.push(a.displayName),d.push(a.firstName),d.push(a.lastName),d.push(a.emailAddress)}),a instanceof RegExp?c=d.filter(function(b){return a.test(b)}).length:(a=a.toLowerCase(),c=d.filter(function(b){return!!b&&b.toLowerCase().indexOf(a)!==-1}).length)}else c=!0;this.classList[c?"remove":"add"]("layer-item-filtered")}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-conversation-item","<div class='layer-list-item' layer-id='innerNode'><layer-avatar layer-id='avatar'></layer-avatar><div class='layer-conversation-item-content'><layer-conversation-title layer-id='title'></layer-conversation-title><layer-conversation-last-message layer-id='lastMessage'></layer-conversation-last-message></div><layer-delete layer-id='delete'></layer-delete></div>",""),b.buildStyle("layer-conversation-item","layer-conversation-item {\ndisplay: flex;\nflex-direction: column;\n}\nlayer-conversation-item .layer-list-item {\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}\nlayer-conversation-item .layer-list-item layer-avatar {\nmargin-right: 15px;\n}\nlayer-conversation-item  .layer-list-item .layer-conversation-item-content {\nflex-grow: 1;\nwidth: 100px; \n}\nlayer-conversation-item.layer-item-filtered .layer-list-item {\ndisplay: none;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list-item":47,"../../../mixins/list-item-selection":46,"../../subcomponents/layer-avatar/layer-avatar":19,"../../subcomponents/layer-conversation-last-message/layer-conversation-last-message":22,"../../subcomponents/layer-conversation-title/layer-conversation-title":23,"../../subcomponents/layer-delete/layer-delete":25}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../components/component"),h=a("../../../mixins/list"),i=d(h),j=a("../../../mixins/list-load-indicator"),k=d(j),l=a("../../../mixins/list-selection"),m=d(l),n=a("../../../mixins/main-component"),o=d(n);a("../layer-conversation-item/layer-conversation-item"),a("../layer-channel-item/layer-channel-item"),(0,g.registerComponent)("layer-conversations-list",{mixins:[i.default,m.default,o.default,k.default],events:["layer-conversation-selected","layer-conversation-deleted"],properties:{selectedConversationId:{set:function(a){this.selectedId=a},get:function(){return this.selectedId}},deleteConversationEnabled:{type:Function},_queryModel:{value:f.default.Query.Conversation},sortBy:{order:-1,value:"lastMessage",set:function(a){switch(a){case"lastMessage":this.properties.sortBy=[{"lastMessage.sentAt":"desc"}];break;default:this.properties.sortBy=[{createdAt:"desc"}]}}},_selectedItemEventName:{value:"layer-conversation-selected"},canFullyRenderLastMessage:{type:Function,value:function(a){return"text/plain"===a.parts[0].mimeType}}},methods:{_generateItem:function(a){var b=a instanceof f.default.Channel,c=document.createElement("layer-"+(b?"channel":"conversation")+"-item");return c.id=this._getItemId(a.id),c.deleteConversationEnabled="function"!=typeof this.deleteConversationEnabled||this.deleteConversationEnabled(a),c.canFullyRenderLastMessage=this.canFullyRenderLastMessage,c.item=a,this.filter&&c._runFilter(this.filter),c}},listeners:{"layer-notification-click":function(a){var b=a.detail.item,c=b.getConversation();c&&(this.selectedId=c.id)}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-conversations-list","<div class='layer-load-indicator' layer-id='loadIndicator'>Loading conversations...</div>",""),b.buildStyle("layer-conversations-list","layer-conversations-list {\noverflow-y: auto;\ndisplay: block;\n}\nlayer-conversations-list .layer-load-indicator {\ntext-align: center;\nborder-top: solid 1px #ccc;\nfont-style: italic;\ndisplay: none;\n}\nlayer-conversations-list.layer-loading-data .layer-load-indicator {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list":50,"../../../mixins/list-load-indicator":48,"../../../mixins/list-selection":49,"../../../mixins/main-component":51,"../layer-channel-item/layer-channel-item":6,"../layer-conversation-item/layer-conversation-item":7,"layer-websdk":66}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../components/component"),h=a("../../../mixins/list"),i=d(h),j=a("../../../mixins/main-component"),k=d(j),l=a("../../../mixins/has-query"),m=d(l),n=a("../../../mixins/list-load-indicator"),o=d(n);a("../layer-identity-item/layer-identity-item"),(0,g.registerComponent)("layer-identities-list",{mixins:[i.default,k.default,m.default,o.default],events:["layer-identity-selected","layer-identity-deselected"],properties:{selectedIdentities:{set:function(a){var b=this;a||(a=[]),Array.isArray(a)&&(a||(a=[]),this.properties.selectedIdentities=a.map(function(a){return a instanceof f.default.Identity?a:b.properties.client.getIdentity(a.id)}),this._renderSelection())}},_queryModel:{value:f.default.Query.Identity}},methods:{onCreate:function(){this.id||(this.id=f.default.Util.generateUUID()),this.properties.selectedIdentities=[],this.addEventListener("layer-identity-item-selected",this._handleIdentitySelect.bind(this)),this.addEventListener("layer-identity-item-deselected",this._handleIdentityDeselect.bind(this))},_handleIdentitySelect:function(a){a.stopPropagation();var b=a.detail.item;this.selectedIdentities.indexOf(b)===-1&&(this.trigger("layer-identity-selected",{item:b})?this.selectedIdentities.push(b):a.preventDefault())},_handleIdentityDeselect:function(a){a.stopPropagation();var b=a.detail.item,c=this.selectedIdentities.indexOf(b);c!==-1&&(this.trigger("layer-identity-deselected",{item:b})?this.selectedIdentities.splice(c,1):a.preventDefault())},_generateItem:function(a){var b=document.createElement("layer-identity-item");return b.item=a,b.id=this._getItemId(a.id),b.selected=this.selectedIdentities.indexOf(a)!==-1,b._runFilter(this.filter),b},onRerender:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};switch(a.type){case"remove":var b=this.selectedIdentities.indexOf(a.target);b!==-1&&this.selectedIdentities.splice(b,1);break;case"reset":this.selectedIdentities=[]}},_renderSelection:function(){var a=this,b=this.querySelectorAllArray(".layer-identity-item-selected").map(function(a){return a.parentNode}),c=this.selectedIdentities.map(function(b){return"#"+a._getItemId(b.id)}),d=this.selectedIdentities.length?this.querySelectorAllArray(c.join(", ")):[];b.forEach(function(a){d.indexOf(a)===-1&&(a.selected=!1)}),d.forEach(function(a){b.indexOf(a)===-1&&(a.selected=!0)})}}}),function(){var b=a("../../../base")
;b.buildAndRegisterTemplate("layer-identities-list","<div class='layer-load-indicator' layer-id='loadIndicator'>Loading users...</div>",""),b.buildStyle("layer-identities-list","layer-identities-list {\noverflow-y: auto;\ndisplay: block;\n}\nlayer-identities-list .layer-load-indicator {\ntext-align: center;\nborder-top: solid 1px #ccc;\nfont-style: italic;\ndisplay: none;\n}\nlayer-identities-list.layer-loading-data .layer-load-indicator {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/has-query":45,"../../../mixins/list":50,"../../../mixins/list-load-indicator":48,"../../../mixins/main-component":51,"../layer-identity-item/layer-identity-item":10,"layer-websdk":66}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../components/component"),h=a("../../../mixins/list-item"),i=d(h);a("../../subcomponents/layer-avatar/layer-avatar"),(0,g.registerComponent)("layer-identity-item",{mixins:[i.default],properties:{selected:{type:Boolean,noGetterFromSetter:!0,set:function(a){this.nodes.checkbox&&(this.nodes.checkbox.checked=a),this.innerNode.classList[a?"add":"remove"]("layer-identity-item-selected")},get:function(){return this.nodes.checkbox?this.nodes.checkbox.checked:Boolean(this.properties.selected)}}},methods:{onCreate:function(){this.id||(this.id=f.default.Util.generateUUID()),this.nodes.checkbox.addEventListener("click",this.onClick.bind(this)),this.nodes.checkbox.id=this.id+"-checkbox",this.nodes.title.setAttribute("for",this.nodes.checkbox.id)},onClick:function(a){a.stopPropagation();var b=this.selected,c=this.item;this.trigger("layer-identity-item-"+(b?"selected":"deselected"),{item:c})?this.selected=!this.properties.selected:a.preventDefault(),this.onSelection(a)},onSelection:function(a){},onRender:function(){this.onRerender()},onRerender:function(){this.nodes.avatar.users=[this.item],this.nodes.title.innerHTML=this.item.displayName,this.toggleClass("layer-identity-item-empty",!this.item.displayName)},_runFilter:function(a){var b=this.properties.item,c=!1;a?a instanceof RegExp?c=a.test(b.displayName)||a.test(b.firstName)||a.test(b.lastName)||a.test(b.emailAddress):"function"==typeof a?c=a(b):(a=a.toLowerCase(),c=b.displayName.toLowerCase().indexOf(a)!==-1||b.firstName.toLowerCase().indexOf(a)!==-1||b.lastName.toLowerCase().indexOf(a)!==-1||b.emailAddress.toLowerCase().indexOf(a)!==-1):c=!0,this.classList[c?"remove":"add"]("layer-item-filtered")}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-identity-item","<div class='layer-list-item'><layer-avatar layer-id='avatar'></layer-avatar><label class='layer-identity-name' layer-id='title'></label><input type='checkbox' layer-id='checkbox'></input></div>",""),b.buildStyle("layer-identity-item","layer-identity-item {\ndisplay: flex;\nflex-direction: column;\n}\nlayer-identity-item .layer-list-item {\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}\nlayer-identity-item .layer-list-item layer-avatar {\nmargin-right: 20px;\n}\nlayer-identity-item .layer-list-item label {\nflex-grow: 1;\nwidth: 100px; \n}\nlayer-identity-item.layer-item-filtered .layer-list-item {\ndisplay: none;\n}\nlayer-identity-item.layer-identity-item-empty {\ndisplay: none;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list-item":47,"../../subcomponents/layer-avatar/layer-avatar":19,"layer-websdk":66}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../components/component"),h=a("../../mixins/main-component"),i=d(h),j=a("../../mixins/has-query"),k=d(j),l=a("../../mixins/focus-on-keydown"),m=d(l);a("../messages-list-panel/layer-messages-list/layer-messages-list"),a("../subcomponents/layer-composer/layer-composer"),a("../subcomponents/layer-typing-indicator/layer-typing-indicator"),(0,g.registerComponent)("layer-conversation-panel",{mixins:[i.default,k.default,m.default],events:["layer-message-deleted","layer-send-message","layer-typing-indicator-change","layer-composer-change-value"],properties:{query:{set:function(a){this.nodes.list.query=a}},conversationId:{set:function(a){var b=this;a&&0!==a.indexOf("layer:///conversations")&&0!==a.indexOf("layer:///channels")&&(this.properties.conversationId=""),this.client&&(this.conversationId?this.client.isReady&&!this.client.isDestroyed?this.conversation=this.client.getObject(this.conversationId,!0):this.client.once("ready",function(){b.conversationId&&(b.conversation=b.client.getObject(b.conversationId,!0))}):this.conversation=null)}},initialConversationId:{set:function(a){this.properties._internalState.onAfterCreateCalled||(this.conversationId=a)}},conversation:{set:function(a){a&&!(a instanceof f.default.Conversation||a instanceof f.default.Channel)&&(this.properties.conversation=null),this.client&&this._setupConversation()}},hasGeneratedQuery:{set:function(a){a&&this.conversationId&&this.client&&this._setupConversation()},type:Boolean},autoFocusConversation:{value:"desktop-only"},client:{set:function(a){a&&(!this.conversation&&this.conversationId&&(this.conversation=a.getObject(this.conversationId,!0)),this.conversation&&this._setupConversation())}},onRenderListItem:{type:Function,set:function(a){this.nodes.list.onRenderListItem=a},get:function(){return this.nodes.list.onRenderListItem}},dateRenderer:{type:Function,set:function(a){this.nodes.list.dateRenderer=a}},messageStatusRenderer:{type:Function,set:function(a){this.nodes.list.messageStatusRenderer=a}},emptyMessageListNode:{type:HTMLElement,set:function(a){this.nodes.list.emptyNode=a},get:function(a){return this.nodes.list.emptyNode}},endOfMessagesNode:{type:HTMLElement,set:function(a){this.nodes.list.endOfResultsNode=a},get:function(a){return this.nodes.list.endOfResultsNode}},getMessageDeleteEnabled:{type:Function,value:function(a){return a.sender.sessionOwner},set:function(a){this.nodes.list.getMessageDeleteEnabled=a}},composeButtons:{type:HTMLElement,set:function(a){this.nodes.composer.buttons=a}},composeButtonsLeft:{type:HTMLElement,set:function(a){this.nodes.composer.buttonsLeft=a}},composeText:{get:function(){return this.nodes.composer.value},set:function(a){this.nodes.composer.value=a}},composePlaceholder:{get:function(){return this.nodes.composer.placeholder},set:function(a){this.nodes.composer.placeholder=a}},disable:{type:Boolean,set:function(a){this.nodes.list.disable=a}},_queryModel:{value:f.default.Query.Message}},methods:{onCreate:function(){},onKeyDown:function(){this.focusText()},focusText:function(){this.nodes.composer.focus()},send:function(a){var b,c=a?[a]:[];(b=this.nodes.composer).send.apply(b,c)},_setupConversation:function(){var a=this.properties.conversation;if(this.client&&!this.client.isReady)return void this.client.once("ready",this._setupConversation.bind(this));this.client&&(this.nodes.composer.conversation=a,this.nodes.typingIndicators.conversation=a,this.hasGeneratedQuery&&(a instanceof f.default.Conversation?this.query.update({predicate:'conversation.id = "'+a.id+'"'}):a instanceof f.default.Channel?this.query.update({predicate:'channel.id = "'+a.id+'"'}):this.query.update({predicate:""})),this.shouldAutoFocusConversation(navigator)&&this.focusText())},shouldAutoFocusConversation:function(a){var b=a.userAgent,c=void 0===b?"":b,d=a.maxTouchPoints;switch(this.autoFocusConversation){case"always":return!0;case"desktop-only":return!(void 0!==d&&d>0)&&!c.match(/(mobile|android|phone)/i);case"never":return!1}}},listeners:{"layer-conversation-selected":function(a){this.conversation=a.detail.item},"layer-notification-click":function(a){var b=a.detail.item,c=b.getConversation();c!==this.conversation&&(this.conversation=c)},"layer-message-notification":function(a){a.detail.isBackground||a.detail.item.conversationId!==this.conversation.id||"toast"!==a.target.notifyInForeground||a.preventDefault()}}}),function(){var b=a("../../base");b.buildAndRegisterTemplate("layer-conversation-panel","<layer-messages-list layer-id='list'></layer-messages-list><layer-typing-indicator layer-id='typingIndicators'></layer-typing-indicator><layer-composer layer-id='composer'></layer-composer>",""),b.buildStyle("layer-conversation-panel","layer-conversation-panel {\ndisplay: flex;\nflex-direction: column;\noutline: none; \n}\nlayer-messages-list {\nflex-grow: 1;\nheight: 100px;\n}\nlayer-composer {\nborder-top: 1px solid #dedede;\nmin-height: 30px;\n}","")}()},{"../../base":4,"../../components/component":5,"../../mixins/focus-on-keydown":44,"../../mixins/has-query":45,"../../mixins/main-component":51,"../messages-list-panel/layer-messages-list/layer-messages-list":18,"../subcomponents/layer-composer/layer-composer":21,"../subcomponents/layer-typing-indicator/layer-typing-indicator":30,"layer-websdk":66}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("notifyjs"),f=d(e),g=a("../../base"),h=a("../../components/component"),i=a("../../mixins/main-component"),j=d(i);a("../subcomponents/layer-avatar/layer-avatar");var k=f.default;"default"in k&&(k=k.default),(0,h.registerComponent)("layer-notifier",{mixins:[j.default],events:["layer-message-notification","layer-notification-click"],properties:{client:{set:function(a){a.on("messages:notify",this._notify.bind(this))}},notifyInBackground:{value:"desktop",set:function(a){"desktop"===a&&window.Notification&&k.requestPermission(this._onPermissionGranted.bind(this))}},notifyInForeground:{value:"none",set:function(a){"desktop"===a&&window.Notification&&k.requestPermission(this._onPermissionGranted.bind(this))}},notifyInTitlebar:{type:Boolean,value:!0},notifyCharacterForTitlebar:{value:""},flagTitlebar:{type:Boolean,value:!1,set:function(a){a?0!==document.title.indexOf(this.notifyCharacterForTitlebar)&&(document.title=this.notifyCharacterForTitlebar+" "+document.title):0===document.title.indexOf(this.notifyCharacterForTitlebar)&&(document.title=document.title.substring(this.notifyCharacterForTitlebar.length+1))}},flagTitlebarForMessage:{set:function(a,b){b&&b.off(null,this._handleTitlebarMessageChange,this),!a||a.isRead?this.flagTitlebar=!1:(this.flagTitlebar=!0,a.on("messages:change destroy",this._handleTitlebarMessageChange,this))}},userEnabledDesktopNotifications:{value:!1},iconUrl:{value:""},timeoutSeconds:{type:Number,value:30},_toastTimeout:{value:0}},methods:{onCreate:function(){this.addEventListener("click",this.onClickToast.bind(this)),this.addEventListener("transitionend",this._afterTransition.bind(this),!0)},_afterTransition:function(){this.classList.remove("layer-notifier-toast-fade")},_onPermissionGranted:function(){this.properties.userEnabledDesktopNotifications=!0},_notify:function(a){var b=(0,g.isInBackground)(),c=b?this.notifyInBackground:this.notifyInForeground,d=a.message;this.notifyInTitlebar&&b&&(this.flagTitlebarForMessage=d),c&&"none"!==c&&this.trigger("layer-message-notification",{item:d,type:c,isBackground:b})&&("desktop"===c&&this.properties.userEnabledDesktopNotifications?this.desktopNotify(a.message):"toast"===c&&this.toastNotify(a.message))},_handleTitlebarMessageChange:function(a){var b=this.flagTitlebarForMessage;b&&(b.isRead||"destroy"===a.eventName)&&(this.flagTitlebar=!1,this.flagTitlebarForMessage=null)},desktopNotify:function(a){var b=this;try{var c=a.getText();this.properties.desktopNotify&&this.closeDesktopNotify(),this.properties.desktopMessage=a,this.properties.desktopNotify=new k("Message from "+a.sender.displayName,{icon:this.iconUrl||a.sender.avatarUrl,timeout:this.timeoutSeconds,body:c||"New file received",tag:a.conversationId||"announcement",closeOnClick:!0,notifyClick:function(){window.focus(),b.trigger("layer-notification-click",{item:a}),b.onDesktopClick(a)}}),this.properties.desktopNotify.show(),a.on("messages:change destroy",function(c){(a.isRead||"destroy"===c.eventName)&&b.closeDesktopNotify()},this)}catch(a){}},closeDesktopNotify:function(){this.properties.desktopNotify&&(this.properties.desktopNotify.close(),this.properties.desktopMessage.off(null,null,this),this.properties.desktopMessage=this.properties.desktopNotify=null)},onDesktopClick:function(a){},toastNotify:function(a){var b=this,c=this.querySelector(".layer-message-item-placeholder"),d=(0,g.getHandler)(a,this);if(d){c&&this.nodes.container.removeChild(c),this.nodes.avatar.users=[a.sender],this.nodes.title.innerHTML=a.sender.displayName,this.properties._toastTimeout&&clearTimeout(this.properties._toastTimeout),this.classList.add(d.tagName);var e=document.createElement(d.tagName);e.parentComponent=this,e.message=a,e.classList.add("layer-message-item-placeholder"),this.nodes.container.appendChild(e),this.classList.add("layer-notifier-toast-fade"),this.classList.add("layer-notifier-toast"),this.properties._toastTimeout=setTimeout(this.closeToast.bind(this),1e3*this.timeoutSeconds),this.properties.toastMessage=a,a.on("messages:change destroy",function(c){(a.isRead||"destroy"===c.eventName)&&b.closeToast()},this)}},closeToast:function(){this.classList.add("layer-notifier-toast-fade"),this.classList.remove("layer-notifier-toast"),clearTimeout(this.properties._toastTimeout),this.properties._toastTimeout=0,this.properties.toastMessage&&this.properties.toastMessage.off(null,null,this),this.properties.toastMessage=null},onClickToast:function(a){this.properties.toastMessage&&(a.preventDefault(),a.stopPropagation(),this.trigger("layer-notification-click",{item:this.properties.toastMessage}),this.closeToast())}}}),function(){var b=a("../../base");b.buildAndRegisterTemplate("layer-notifier","<layer-avatar layer-id='avatar'></layer-avatar><div class='layer-message-item-main' layer-id='container'><div class='layer-notifier-title' layer-id='title'></div><div class='layer-message-item-placeholder'></div></div>",""),b.buildStyle("layer-notifier","layer-notifier {\nposition: fixed;\nz-index: 1000;\nright: 10px;\ntop: -10000px;\nmax-width: 40%;\nmax-height: 250px;\ndisplay: flex;\nopacity: 0;\ntransition: opacity 500ms;\n}\nlayer-notifier.layer-notifier-toast-fade {\ntop: 10px;\n}\nlayer-notifier.layer-notifier-toast {\ntop: 10px;\nflex-direction: row;\nopacity: 1;\ntransition: opacity 1s;\n}\nlayer-notifier .layer-message-item-main {\ndisplay: flex;\nflex-direction: column;\nflex-grow: 1;\n}\nlayer-notifier layer-message-text-plain {\noverflow: hidden;\nmax-height: 200px;\n}","")}()},{"../../base":4,"../../components/component":5,"../../mixins/main-component":51,"../subcomponents/layer-avatar/layer-avatar":19,notifyjs:67}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../../mixins/list-item"),f=d(e),g=a("../../../mixins/list-item-selection"),h=d(g),i=a("../../component");a("../../subcomponents/layer-avatar/layer-avatar"),(0,i.registerComponent)("layer-membership-item",{mixins:[f.default,h.default],properties:{item:{set:function(a){a&&a.identity.on("identities:change",this.onRerender.bind(this))}}},methods:{onRender:function(){this.nodes.avatar.users=[this.item.identity],this.onRerender()},onRerender:function(){this.nodes.title.innerHTML=this.item.identity.displayName||"User ID "+this.item.identity.userId},_runFilter:function(a){var b=this.properties.item.identity,c=!1;a?a instanceof RegExp?c=a.test(b.displayName)||a.test(b.firstName)||a.test(b.lastName)||a.test(b.emailAddress):"function"==typeof a?c=a(b):(a=a.toLowerCase(),c=b.displayName.toLowerCase().indexOf(a)!==-1||b.firstName.toLowerCase().indexOf(a)!==-1||b.lastName.toLowerCase().indexOf(a)!==-1||b.emailAddress.toLowerCase().indexOf(a)!==-1):c=!0,this.classList[c?"remove":"add"]("layer-item-filtered")}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-membership-item","<div class='layer-list-item'><layer-avatar layer-id='avatar'></layer-avatar><label class='layer-membership-name' layer-id='title'></label></div>",""),b.buildStyle("layer-membership-item","layer-membership-item {\ndisplay: flex;\nflex-direction: column;\n}\nlayer-membership-item .layer-list-item {\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}\nlayer-membership-item .layer-list-item layer-avatar {\nmargin-right: 20px;\n}\nlayer-membership-item .layer-list-item label {\nflex-grow: 1;\nwidth: 100px; \n}\nlayer-membership-item.layer-item-filtered .layer-list-item {\ndisplay: none;\n}\nlayer-membership-item.layer-membership-item-empty {\ndisplay: none;\n}","")}()},{"../../../base":4,"../../../mixins/list-item":47,"../../../mixins/list-item-selection":46,"../../component":5,"../../subcomponents/layer-avatar/layer-avatar":19}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../component"),h=a("../../../mixins/list"),i=d(h),j=a("../../../mixins/main-component"),k=d(j),l=a("../../../mixins/list-selection"),m=d(l);a("../layer-membership-item/layer-membership-item"),(0,g.registerComponent)("layer-membership-list",{mixins:[i.default,m.default,k.default],events:["layer-membership-selected"],properties:{channelId:{set:function(a){var b=this;a&&0!==a.indexOf("layer:///channels")&&0!==a.indexOf("layer:///channels")&&(this.properties.channelId=""),this.client&&this.channelId&&(this.client.isReady&&!this.client.isDestroyed?this.channel=this.client.getObject(this.channelId,!0):this.client.once("ready",function(){b.channelId&&(b.channel=b.client.getObject(b.channelId,!0))}))}},channel:{set:function(a){!a||a instanceof f.default.Channel||(a=this.properties.channel=null),this.query&&this.query.update({predicate:a?'channel.id = "'+a.id+'"':""})}},_queryModel:{value:f.default.Query.Membership},_selectedItemEventName:{value:"layer-membership-selected"}},methods:{_generateItem:function(a){var b=document.createElement("layer-membership-item");return b.item=a,b.id=this._getItemId(a.id),b._runFilter(this.filter),b}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-membership-list","<div class='layer-load-indicator' layer-id='loadIndicator'>Loading users...</div>",""),b.buildStyle("layer-membership-list","layer-membership-list {\noverflow-y: auto;\ndisplay: block;\n}\nlayer-membership-list .layer-load-indicator {\ntext-align: center;\nborder-top: solid 1px #ccc;\nfont-style: italic;\ndisplay: none;\n}\nlayer-membership-list.layer-loading-data .layer-load-indicator {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../mixins/list":50,"../../../mixins/list-selection":49,"../../../mixins/main-component":51,"../../component":5,"../layer-membership-item/layer-membership-item":13,"layer-websdk":66}],15:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);b.exports={properties:{isMessageListItem:{value:!0},item:{},getDeleteEnabled:{type:Function},_contentTag:{set:function(a,b){b&&this.removeClass(b),a&&this.addClass(a)}},dateRenderer:{},messageStatusRenderer:{}},methods:{onRender:function(){try{this.nodes.sender&&(this.nodes.sender.innerHTML=this.item.sender.displayName),this.nodes.avatar&&(this.nodes.avatar.users=[this.item.sender]),this.nodes.date&&(this.dateRenderer&&(this.nodes.date.dateRenderer=this.dateRenderer),this.nodes.date.date=this.item.sentAt),this.nodes.status&&this.messageStatusRenderer&&(this.nodes.status.messageStatusRenderer=this.messageStatusRenderer),this.nodes.delete&&(this.nodes.delete.enabled=!this.getDeleteEnabled||this.getDeleteEnabled(this.properties.item)),this._applyContentTag(),this.onRerender()}catch(a){console.error("layer-message-item.render(): ",a)}},onRerender:function(){var a=this.properties.item.readStatus,b=this.properties.item.deliveryStatus,c="layer-message-status";this.toggleClass("layer-unread-message",!this.properties.item.isRead),this.toggleClass(c+"-read-by-all",a===e.default.Constants.RECIPIENT_STATE.ALL),this.toggleClass(c+"-read-by-some",a===e.default.Constants.RECIPIENT_STATE.SOME),this.toggleClass(c+"-read-by-none",a===e.default.Constants.RECIPIENT_STATE.NONE),this.toggleClass(c+"-delivered-to-all",b===e.default.Constants.RECIPIENT_STATE.ALL),this.toggleClass(c+"-delivered-to-some",b===e.default.Constants.RECIPIENT_STATE.SOME),this.toggleClass(c+"-delivered-to-none",b===e.default.Constants.RECIPIENT_STATE.NONE),this.toggleClass(c+"-pending",this.properties.item.isSaving()),this.toggleClass("layer-message-preview",this.properties.item.isNew())},_applyContentTag:function(){var a=this,b=document.createElement(this._contentTag);b.parentComponent=this,b.message=this.item,this.nodes.messageHandler=b,this.nodes.content.appendChild(b),e.default.Util.defer(function(){b.style.height&&(a.nodes.content.style.height=b.style.height)})}}}},{"layer-websdk":66}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../../components/component"),f=a("../../../mixins/list-item"),g=d(f),h=a("../layer-message-item-mixin"),i=d(h);a("../../subcomponents/layer-avatar/layer-avatar"),a("../../subcomponents/layer-date/layer-date"),(0,e.registerComponent)("layer-message-item-received",{mixins:[g.default,i.default]}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-message-item-received","<div class='layer-list-item' layer-id='innerNode'><div class='layer-message-body-and-avatar'><layer-avatar layer-id='avatar' show-presence='false'></layer-avatar><div class='layer-message-item-main'><div class='layer-message-item-content' layer-id='content'></div></div></div><div class='layer-sender-info'><div class='layer-sender-name' layer-id='sender'></div><layer-date layer-id='date'></layer-date></div></div>",""),b.buildStyle("layer-message-item-received","layer-message-item-received {\ndisplay: flex;\nflex-direction: column;\nalign-content: stretch;\n}\nlayer-message-item-received .layer-list-item {\ndisplay: flex;\nflex-direction: column;\nalign-content: stretch;\n}\nlayer-message-item-received .layer-message-body-and-avatar {\ndisplay: flex;\nflex-direction: row;\nalign-items: flex-end;\n}\nlayer-message-item-received  .layer-message-item-main {\nflex-grow: 1;\noverflow: hidden;\n}\nlayer-message-item-received .layer-message-item-main .layer-message-item-content {\nmax-width: 90%;\n}\nlayer-message-item-received layer-message-text-plain {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list-item":47,"../../subcomponents/layer-avatar/layer-avatar":19,"../../subcomponents/layer-date/layer-date":24,"../layer-message-item-mixin":15}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../../components/component"),f=a("../../../mixins/list-item"),g=d(f),h=a("../layer-message-item-mixin"),i=d(h);a("../../subcomponents/layer-avatar/layer-avatar"),a("../../subcomponents/layer-delete/layer-delete"),a("../../subcomponents/layer-date/layer-date"),a("../../subcomponents/layer-message-status/layer-message-status"),(0,e.registerComponent)("layer-message-item-sent",{mixins:[g.default,i.default]}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-message-item-sent","<div class='layer-list-item' layer-id='innerNode'><div class='layer-message-body-and-avatar' layer-id='messageRow'><div class='layer-message-item-main'><div class='layer-message-item-content' layer-id='content'></div></div><div class='layer-avatar-delete-panel'><layer-avatar layer-id='avatar' show-presence='false'></layer-avatar><layer-delete layer-id='delete'></layer-delete></div></div><div class='layer-sender-info layer-sender-details'><div class='layer-sender-name' layer-id='sender'></div><layer-message-status layer-id='status'></layer-message-status><layer-date layer-id='date'></layer-date></div></div>",""),b.buildStyle("layer-message-item-sent","layer-message-item-sent {\ndisplay: flex;\nflex-direction: column;\nalign-content: stretch;\n}\nlayer-message-item-sent img.emoji {\nmargin: 0 .05em 0 .1em;\nvertical-align: -0.1em;\n}\nlayer-message-item-sent .layer-list-item {\ndisplay: flex;\nflex-direction: column;\nalign-items: stretch;\n}\nlayer-message-item-sent .layer-message-body-and-avatar {\ndisplay: flex;\nflex-direction: row;\nalign-items: flex-end;\nflex-grow: 1;\n}\nlayer-message-item-sent .layer-message-item-main {\ntext-align: right;\nflex-grow: 1;\noverflow: hidden;\n}\nlayer-message-item-sent .layer-message-item-main .layer-message-item-content {\ndisplay: inline-block;\ntext-align: right;\nmax-width: 90%;\n}\nlayer-message-item-sent layer-message-text-plain {\ndisplay: block;\n}\nlayer-message-item-sent .layer-avatar-delete-panel {\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/list-item":47,"../../subcomponents/layer-avatar/layer-avatar":19,"../../subcomponents/layer-date/layer-date":24,"../../subcomponents/layer-delete/layer-delete":25,"../../subcomponents/layer-message-status/layer-message-status":27,"../layer-message-item-mixin":15}],18:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../base"),h=d(g),i=a("../../../components/component"),j=a("../../../mixins/list"),k=d(j),l=a("../../../mixins/has-query"),m=d(l),n=a("../../../mixins/empty-list"),o=d(n),p=a("../../../mixins/list-load-indicator"),q=d(p),r=a("../../../mixins/query-end-indicator"),s=d(r);a("../layer-message-item-sent/layer-message-item-sent"),a("../layer-message-item-received/layer-message-item-received");(0,i.registerComponent)("layer-messages-list",{mixins:[k.default,m.default,o.default,q.default,s.default],properties:{dateRenderer:{},messageStatusRenderer:{},getMessageDeleteEnabled:{},disable:{set:function(a){a||(this.properties.stuckToBottom=!0,this.scrollTo(this.scrollHeight-this.clientHeight),this._checkVisibility())}},screenFullsBeforePaging:{value:2}},methods:{onCreate:function(){this.id||(this.id=f.default.Util.generateUUID()),this.properties.lastPagedAt=0,this.properties.isSelfScrolling=!1,this.properties.stuckToBottom=!0,this.properties._checkVisibilityBound=this._checkVisibility.bind(this),window.addEventListener("focus",this.properties._checkVisibilityBound)},onDestroy:function(){window.removeEventListener("focus",this.properties._checkVisibilityBound)},_shouldPage:function(){var a=Math.max(this.clientHeight,300)*this.screenFullsBeforePaging;return this.scrollTop<=a&&this.scrollHeight>this.clientHeight+1&&!this.isDataLoading},_handleScroll:{mode:i.registerComponent.MODES.OVERWRITE,value:function(){var a=this;if(!this.properties.isSelfScrolling){this._shouldPage()&&!this.properties.delayedPagingTimeout&&(this.properties.lastPagedAt+2e3<Date.now()?this.query.isFiring||(this.query.update({paginationWindow:this.query.paginationWindow+50}),this.isDataLoading=this.properties.query.isFiring):this.properties.delayedPagingTimeout||(this.properties.delayedPagingTimeout=setTimeout(function(){a.query.update({paginationWindow:a.query.paginationWindow+50}),a.isDataLoading=a.properties.query.isFiring,a.properties.delayedPagingTimeout=0},500)));var b=this.scrollHeight-10<=this.clientHeight+this.scrollTop;b!==this.properties.stuckToBottom&&(this.properties.stuckToBottom=b),this._checkVisibility()}}},scrollTo:{mode:i.registerComponent.MODES.OVERWRITE,value:function(a,b){var c=this;a!==this.scrollTop&&(this.properties.isSelfScrolling=!0,this.scrollTop=a,setTimeout(function(){c.properties.isSelfScrolling=!1,c._checkVisibility(),b&&b()},200))}},animatedScrollTo:{mode:i.registerComponent.MODES.OVERWRITE,value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,d=arguments[2];if(a!==this.scrollTop){this.properties.isSelfScrolling=!0,this.properties.cancelAnimatedScroll&&this.properties.cancelAnimatedScroll();var e=this.properties.cancelAnimatedScroll=h.default.animatedScrollTo(this,a,c,function(){clearTimeout(f),setTimeout(function(){e===b.properties.cancelAnimatedScroll&&(b.properties.cancelAnimatedScroll=null,b.properties.isSelfScrolling=!1,b._checkVisibility(),d&&d())},100)}),f=setTimeout(function(){b.properties.cancelAnimatedScroll&&b.properties.cancelAnimatedScroll(),b.properties.cancelAnimatedScroll=null,b.scrollTo(a,d)},c+20)}}},_checkVisibility:function(){var a=this;if(!h.default.isInBackground()&&!this.disable){var b=this.scrollTop,c=this.scrollTop+this.clientHeight;Array.prototype.slice.call(this.childNodes).forEach(function(d){var e=d.offsetTop-a.offsetTop;e>=b&&e+d.clientHeight<=c&&d.properties&&d.properties.item&&!d.properties.item.isRead&&setTimeout(function(){return a._markAsRead(d)},h.default.settings.markReadDelay)},this)}},_markAsRead:function(a){if(!h.default.isInBackground()&&!this.disable){var b=this.scrollTop,c=this.scrollTop+this.clientHeight,d=a.offsetTop-this.offsetTop;d>=b&&d+a.clientHeight<=c&&(a.properties.item.isRead=!0)}},_generateItem:function(a){var b=h.default.getHandler(a,this);if(b){var c=document.createElement(a.sender.sessionOwner?"layer-message-item-sent":"layer-message-item-received");return c.id=this._getItemId(a.id),c.dateRenderer=this.dateRenderer,c.messageStatusRenderer=this.messageStatusRenderer,c.getDeleteEnabled=this.getMessageDeleteEnabled,c._contentTag=b.tagName,c.item=a,c}return null},_inSameGroup:function(a,b){if(!a||!b)return!1;var c=Math.abs(a.sentAt.getTime()-b.sentAt.getTime());return a.sender===b.sender&&c<h.default.settings.messageGroupTimeSpan},_processAffectedWidgetsCustom:function(a,b,c){if(0!==a.length){c&&(a[0].firstInSeries=!0);for(var d=1;d<a.length;d++){var e=this._inSameGroup(a[d-1].item,a[d].item);a[d].firstInSeries=!e,a[d-1].lastInSeries=!e}a[a.length-1].nextSibling||(a[a.length-1].lastInSeries=!0)}},_renderResetData:{mode:i.registerComponent.MODES.AFTER,value:function(a){this.properties.stuckToBottom=!0,this.properties.lastPagedAt=0,this.properties.isSelfScrolling=!1}},_renderWithoutRemovedData:{mode:i.registerComponent.MODES.OVERWRITE,value:function(a){this.properties.listData=[].concat(this.properties.query.data).reverse();var b=this.querySelector("#"+this._getItemId(a.target.id));b&&this.removeChild(b);var c=this.properties.listData.length-a.index,d=this.properties.listData.slice(Math.max(0,c-3),c+3);this._gatherAndProcessAffectedItems(d,!1)}},_renderInsertedData:{mode:i.registerComponent.MODES.OVERWRITE,value:function(a){var b=this;if(this.properties.appendingMore)return this.properties.insertEvents||(this.properties.insertEvents=[]),void this.properties.insertEvents.push(a);var c=this.properties.listData;this.properties.listData=[].concat(this.properties.query.data).reverse();var d=c.length-a.index,e=0===d,f=this.properties.listData.slice(Math.max(0,d-3),d+4),g=this._generateFragment([a.target]);if(d<c.length){var h=f.length>1?this.querySelector("#"+this._getItemId(c[d].id)):null;this.insertBefore(g,h)}else this.appendChild(g);this._gatherAndProcessAffectedItems(f,e),this._updateLastMessageSent(),this.properties.stuckToBottom?setTimeout(function(){return b.animatedScrollTo(b.scrollHeight-b.clientHeight)},0):this._checkVisibility(),a.inRender||this.onRerender()}},_updateLastMessageSent:function(){for(var a=this.properties.listData.length-1;a>=0;a--)if(this.properties.listData[a].sender.sessionOwner){var b=this.querySelector("#"+this._getItemId(this.properties.listData[a].id));b&&!b.classList.contains("layer-last-message-sent")&&(this.querySelectorAllArray(".layer-last-message-sent").forEach(function(a){a.classList.remove("layer-last-message-sent")}),b.classList.add("layer-last-message-sent"));break}},_findFirstVisibleItem:function(){for(var a=this.scrollTop,b=this.scrollTop+this.clientHeight,c=Array.prototype.slice.call(this.childNodes),d=0;d<c.length;d++){var e=c[d],f=e.offsetTop-this.offsetTop;if(f>=a&&f+e.clientHeight<=b&&e.properties&&e.properties.item)return e}return null},_renderPagedData:{mode:i.registerComponent.MODES.OVERWRITE,value:function(a){if(0===a.data.length)return void(this.isDataLoading=this.properties.query.isFiring);this.properties.lastPagedAt=Date.now();var b=this.properties.listData
;this.properties.listData=[].concat(this.properties.query.data).reverse();var c=[].concat(a.data).reverse(),d=[].concat(c),e=void 0;b.length&&(d=d.concat(b.slice(0,3))),function b(){var g=this;if(this.query&&!this.query.isDestroyed){this.properties.appendingMore=!0;var h=c.splice(0,20).filter(function(a){return!a.isDestroyed});e=this._generateFragment(h,e),c.length?setTimeout(function(){return b.call(g)},20):(this.properties.appendingMore=!1,f.default.Util.defer(function(){return g._renderPagedDataDone(d,e,a)}))}}.bind(this)()}},_renderPagedDataDone:function(a,b,c){var d=this;if(a.length){var e="#"+a.map(function(a){return d._getItemId(a.id)}).join(", #"),g=this.querySelectorAllArray(e);if(b){g=Array.prototype.slice.call(b.querySelectorAll(e)).concat(g)}try{this._processAffectedWidgets(g,!0)}catch(a){console.error(a)}}var h=this._findFirstVisibleItem(),i=h?h.offsetTop-this.offsetTop-this.scrollTop:0,j=this.nodes.listHeader.nextSibling;this.insertBefore(b,j),this._updateLastMessageSent(),this.isDataLoading=this.properties.query.isFiring,this._checkVisibility(),c.inRender||this.onRerender(),this.properties.insertEvents&&this.properties.insertEvents.forEach(function(a){return d._renderInsertedData(a)}),delete this.properties.insertEvents,f.default.Util.defer(function(){d.properties.stuckToBottom?d.scrollTo(d.scrollHeight-d.clientHeight):h&&"data"===c.type&&0!==c.data.length&&d.scrollTo(h.offsetTop-d.offsetTop-i)})}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-messages-list","<div class='layer-list-header' layer-id='listHeader'><div class='layer-empty-list' layer-id='emptyNode'></div><div class='layer-header-toggle'><div class='layer-end-of-results-indicator' layer-id='endOfResultsNode'>This is the beginning of your conversation</div><div class='layer-load-indicator' layer-id='loadIndicator'>Loading messages...</div></div></div>",""),b.buildStyle("layer-messages-list","layer-messages-list {\ndisplay: block;\nflex-grow: 1;\nheight: 100px; \npadding-bottom: 15px;\noverflow-y: scroll; \n-webkit-overflow-scrolling: touch;\n}\nlayer-messages-list .layer-header-toggle {\nmin-height: 20px;\nmargin-bottom: 2px;\n}\nlayer-messages-list .layer-load-indicator, layer-messages-list .layer-end-of-results-indicator {\ntext-align: center;\ndisplay: none;\n}\nlayer-messages-list.layer-loading-data .layer-load-indicator,\nlayer-messages-list.layer-end-of-results .layer-end-of-results-indicator {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/empty-list":43,"../../../mixins/has-query":45,"../../../mixins/list":50,"../../../mixins/list-load-indicator":48,"../../../mixins/query-end-indicator":53,"../layer-message-item-received/layer-message-item-received":16,"../layer-message-item-sent/layer-message-item-sent":17,"layer-websdk":66}],19:[function(a,b,c){"use strict";var d=a("../../../components/component");a("../layer-presence/layer-presence"),(0,d.registerComponent)("layer-avatar",{properties:{users:{set:function(a,b){if(b&&a&&a.length===b.length){if(a.filter(function(a){return b.indexOf(a)!==-1})!==a.length)return}a||(a=[]),Array.isArray(a)||(a=[a]),this.classList[a.length?"add":"remove"]("layer-has-user"),this.onRender()}},showPresence:{value:!0,type:Boolean}},methods:{onCreate:function(){this.properties.users=[]},onRender:function(){this.users.length&&(this.innerHTML=""),this.users.forEach(this._renderUser.bind(this)),this.classList[this.users.length>1?"add":"remove"]("layer-avatar-cluster"),1===this.users.length&&this.showPresence&&this.users[0].getClient().isPresenceEnabled&&(this.nodes.presence=document.createElement("layer-presence"),this.nodes.presence.item=this.users[0],this.appendChild(this.nodes.presence))},_renderUser:function(a){if(a.avatarUrl){var b=document.createElement("img");b.onerror=function(){b.style.display="none"},b.src=a.avatarUrl,this.appendChild(b)}else{var c=document.createElement("span");a.firstName&&a.lastName?c.innerHTML=a.firstName.substring(0,1).toUpperCase()+a.lastName.substring(0,1).toUpperCase():a.displayName.indexOf(" ")!==-1?c.innerHTML=a.displayName.substr(0,1).toUpperCase()+a.displayName.substr(a.displayName.indexOf(" ")+1,1).toUpperCase():c.innerHTML=a.displayName.substring(0,2).toUpperCase(),this.appendChild(c)}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-avatar","",""),b.buildStyle("layer-avatar","layer-avatar {\ndisplay: block;\n}\nlayer-avatar layer-presence {\nposition: absolute;\nbottom: 0px;\nright: 0px;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../layer-presence/layer-presence":28}],20:[function(a,b,c){"use strict";(0,a("../../../components/component").registerComponent)("layer-compose-button-panel",{properties:{buttons:{value:[],set:function(a){this.classList[a&&a.length?"remove":"add"]("is-empty"),this.onRender()}}},methods:{onRender:function(){if(this.innerHTML="",this.buttons.length){var a=document.createDocumentFragment();this.buttons.forEach(function(b){return a.appendChild(b)}),this.appendChild(a)}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-compose-button-panel","",""),b.buildStyle("layer-compose-button-panel","layer-compose-button-panel.is-empty {\ndisplay: none;\n}\nlayer-compose-button-panel {\ndisplay: flex;\nflex-direction: row;\nalign-items: stretch;\n}","")}()},{"../../../base":4,"../../../components/component":5}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../base"),h=d(g),i=a("../../../components/component");a("../layer-compose-button-panel/layer-compose-button-panel");(0,i.registerComponent)("layer-composer",{properties:{conversation:{set:function(a){a&&(this.client=a.getClient()),this._setTypingListenerConversation()}},client:{set:function(a){this.nodes.input||console.error("NO INPUT FOR COMPOSER"),a&&(this.properties.typingListener=this.properties.client.createTypingListener(this.nodes.input),this._setTypingListenerConversation())}},buttons:{set:function(a){this.nodes.buttonPanel.buttons=a}},buttonsLeft:{set:function(a){this.nodes.buttonPanelLeft.buttons=a}},value:{set:function(a){var b=this.nodes.input.value;this.nodes.input.value=a,this.onRender(),this._triggerChange(a,b)},get:function(){return this.nodes.input.value}},placeholder:{set:function(a){this.nodes.input.placeholder=a,this.onRender()},get:function(){return this.nodes.input.placeholder}}},methods:{onCreate:function(){this.classList.add("layer-composer-one-line-of-text"),this.properties.buttons=[],this.nodes.input.placeholder="Enter a message",this.nodes.input.addEventListener("keydown",this._onKeyDown.bind(this)),this.nodes.input.addEventListener("input",this._onInput.bind(this)),this.addEventListener("layer-file-selected",this._handleAttachments.bind(this)),this.addEventListener("layer-send-click",this.send.bind(this,null))},_triggerChange:function(a,b){a!==b&&(this.properties.value=a,this.trigger("layer-composer-change-value",{value:a,oldValue:b}))},focus:function(){this.nodes.input.focus()},_setTypingListenerConversation:function(){this.properties.typingListener.setConversation(this.conversation)},send:function(a){var b=[];if(a?b=a:this.nodes.input.value&&(b.push(new f.default.MessagePart({type:"text/plain",body:this.nodes.input.value})),this.nodes.input.value="",this._onInput()),0!==b.length){var c=this.conversation?this.conversation.createMessage({parts:b}):null,d=b.filter(function(a){return"text/plain"===a.mimeType})[0],e={text:d?d.body:"File received",title:"New Message from "+this.client.user.displayName};this.trigger("layer-send-message",{parts:b,notification:e,item:c,conversation:this.conversation})&&(this.conversation?this.conversation instanceof f.default.Channel?(this.onSend(c),c.send()):(this.onSend(c,e),c.send(e)):console.error("Unable to send message without a conversationId"))}},onSend:function(a,b){},_onKeyDown:function(a){13===a.keyCode?a.shiftKey||a.ctrlKey||a.metaKey?(a.target.value+="\n",this._onInput(a)):(a.preventDefault(),this.send()):h.default.settings.disableTabAsWhiteSpace||9!==a.keyCode||a.shiftKey||(a.preventDefault(),a.target.value+="\t  ",this._onInput(a))},_onInput:function(a){this.onRender(),this._triggerChange(this.nodes.input.value,this.properties.value)},onRender:function(){var a=this;setTimeout(function(){a.nodes.resizer.innerHTML=a.nodes.input.value.replace(/\n/g,"<br/>")||"&nbsp;",a.nodes.lineHeighter.innerHTML=a.nodes.input.value.replace(/\n/g,"<br/>")||"&nbsp;";var b=!a.nodes.input.value.match(/\n/)&&a.nodes.resizer.clientHeight-a.nodes.lineHeighter.clientHeight<10;b&&(a.nodes.input.style.overflow="hidden",setTimeout(function(){a.nodes.input.style.overflow=""},1)),a.classList[b?"add":"remove"]("layer-composer-one-line-of-text")},10)},_handleAttachments:function(a){this.send(a.detail.parts)}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-composer","<layer-compose-button-panel layer-id='buttonPanelLeft' class='layer-button-panel-left'></layer-compose-button-panel><div class='layer-compose-edit-panel' layer-id='editPanel'><div class='hidden-resizer' layer-id='resizer'>&nbsp;&nbsp;</div><div class='hidden-lineheighter' layer-id='lineHeighter'>&nbsp;</div><textarea rows=\"1\" layer-id='input'></textarea></div><layer-compose-button-panel layer-id='buttonPanel' class='layer-button-panel-right'></layer-compose-button-panel>",""),b.buildStyle("layer-composer",'layer-composer {\ndisplay: flex;\nflex-direction: row;\n}\nlayer-composer .layer-compose-edit-panel {\nposition: relative;\nflex-grow: 1;\nwidth: 100px; \npadding: 1px 0px;\n}\nlayer-composer textarea, layer-composer .hidden-resizer, layer-composer .hidden-lineheighter {\nline-height: 1.2em;\nmin-height: 20px;\noverflow :hidden;\nborder-width: 0px;\nfont-size: 1em;\npadding: 4px 8px;\nbox-sizing: border-box;\nfont-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;\nmargin: 0px;\n}\nlayer-composer textarea {\nresize: none;\noutline: none;\ncolor: rgba(0,0,0,0.87);\nposition: absolute;\nz-index: 2;\ntop: 0px;\nleft: 0px;\nwidth: 100%;\nheight: 100%;\noverflow-y: auto;\nwhite-space: pre-wrap;\nword-wrap: break-word;\n}\nlayer-composer.layer-composer-one-line-of-text textarea {\noverflow-y: hidden;\n}\nlayer-composer .hidden-resizer {\nopacity: 0.1;\nwhite-space: pre-wrap;\nword-wrap: break-word;\nmax-height: 250px;\n}\nlayer-composer .layer-compose-edit-panel .hidden-lineheighter {\ntop: 0px;\nopacity: 0.1;\nwhite-space: nowrap;\nposition: absolute;\nright: 10000px;\n}',"")}()},{"../../../base":4,"../../../components/component":5,"../layer-compose-button-panel/layer-compose-button-panel":20,"layer-websdk":66}],22:[function(a,b,c){"use strict";var d=a("../../../base"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);(0,a("../../../components/component").registerComponent)("layer-conversation-last-message",{properties:{item:{set:function(a,b){b&&b.off(null,null,this),a&&a.on("conversations:change",this.onRerender,this),this.onRender()}},canFullyRenderLastMessage:{}},methods:{onCreate:function(){},onRender:function(){this.onRerender()},onRerender:function(a){if(!a||a.hasProperty("lastMessage")){var b=this.item,c=b?b.lastMessage:null;if(this.firstChild&&this.firstChild.onDestroy&&this.firstChild.onDestroy(),this.innerHTML="",c){var d=e.default.getHandler(c,this);if(d)if(this.classList.add(d.tagName),!this.canFullyRenderLastMessage||this.canFullyRenderLastMessage(c)){var f=document.createElement(d.tagName);f.parentComponent=this,f.message=c,this.appendChild(f)}else d.label&&(this.innerHTML='<div class="layer-custom-mime-type">'+d.label+"</div>")}}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-conversation-last-message","",""),b.buildStyle("layer-conversation-last-message","layer-conversation-last-message, .layer-custom-mime-type {\ndisplay: block;\nwhite-space: nowrap;\ntext-overflow: ellipsis;\noverflow: hidden;\n}","")}()},{"../../../base":4,"../../../components/component":5}],23:[function(a,b,c){"use strict";(0,a("../../../components/component").registerComponent)("layer-conversation-title",{properties:{item:{set:function(a,b){b&&b.off(null,null,this),a&&a.on("conversations:change",this.onRerender,this),this.onRender()}}},methods:{onCreate:function(){},onRender:function(){this.onRerender()},onRerender:function(a){if(!a||a.hasProperty("metadata")||a.hasProperty("participants")){var b=this.item;if(b){var c=b.metadata.conversationName||b.metadata.title;if(!c){var d=b.participants.filter(function(a){return!a.sessionOwner}).filter(function(a){return a.displayName}).map(function(a){return a.displayName});c=d.length?d.join(", ").replace(/, ([^,]*)$/," and $1"):"No Title"}c!==this.innerHTML&&(this.innerHTML=c)}else this.innerHTML=""}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-conversation-title","",""),b.buildStyle("layer-conversation-title","layer-conversation-title {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5}],24:[function(a,b,c){"use strict";(0,a("../../../components/component").registerComponent)("layer-date",{properties:{date:{set:function(a){if(a)if(this.dateRenderer)this.value=this.dateRenderer(a);else{var b=a.toLocaleDateString(),c=a.toLocaleTimeString();this.value=(new Date).toLocaleDateString()===b?c:b+" "+c}else this.value=""}},value:{set:function(a){this.innerHTML=a}},dateRenderer:{}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-date","",""),b.buildStyle("layer-date","layer-date {\ndisplay: block;\n}","")}()},{"../../../base":4,"../../../components/component":5}],25:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);(0,a("../../../components/component").registerComponent)("layer-delete",{properties:{item:{},enabled:{type:Boolean,set:function(a){this.classList[a?"add":"remove"]("layer-delete-enabled")}}},methods:{onCreate:function(){this.addEventListener("click",this.onDeleteClick,this)},onDeleteClick:function(a){a.preventDefault(),a.stopPropagation(),this.enabled&&(this.item instanceof e.default.Message?this.trigger("layer-message-deleted",{item:this.item})&&window.confirm("Are you sure you want to delete this message?")&&this.item.delete(e.default.Constants.DELETION_MODE.ALL):this.trigger("layer-conversation-deleted",{item:this.item})&&window.confirm("Are you sure you want to delete this conversation?")&&this.item.delete(e.default.Constants.DELETION_MODE.ALL))}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-delete","&#x2715;",""),b.buildStyle("layer-delete","layer-delete {\ndisplay: none;\n}\nlayer-delete.layer-delete-enabled {\ndisplay: inline;\nwidth: 12px;\nheight: 12px;\nfont-size: 12px;\npadding: 4px 4px 6px 4px;\nmargin-right: 5px;\nborder: solid 1px transparent;\ncursor: default;\ntext-align: center;\ncursor: pointer;\n}","")}()},{"../../../base":4,"../../../components/component":5,"layer-websdk":66}],26:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../base"),h=d(g),i=a("../../../mixins/main-component"),j=d(i);(0,a("../../../components/component").registerComponent)("layer-file-upload-button",{mixins:[j.default],properties:{accept:{set:function(a){this.nodes.input.accept=a}}},methods:{onCreate:function(){var a=this;this.nodes.input.id=f.default.Util.generateUUID(),this.nodes.label.setAttribute("for",this.nodes.input.id),this.nodes.input.addEventListener("change",this.onChange.bind(this)),this.addEventListener("click",function(b){b.target!==a.nodes.input&&a.nodes.input.click()})},onChange:function(){var a=this,b=this.nodes.input.files,c=Array.prototype.map.call(b,function(a){return new f.default.MessagePart(a)});h.default.files.processAttachments(c,function(b){a.trigger("layer-file-selected",{parts:b})})}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-file-upload-button","<label layer-id='label'>+</label><input layer-id='input' type='file'></input>",""),b.buildStyle("layer-file-upload-button","layer-file-upload-button {\ncursor: pointer;\ndisplay: flex;\nflex-direction: column;\njustify-content: center;\n}\nlayer-file-upload-button input {\nwidth: 0.1px;\nheight: 0.1px;\nopacity: 0;\noverflow: hidden;\nposition: absolute;\nz-index: -1;\n}\nlayer-file-upload-button label {\ndisplay: block;\npointer-events: none;\ntext-align: center;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/main-component":51,"layer-websdk":66}],27:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);(0,a("../../../components/component").registerComponent)("layer-message-status",{properties:{item:{set:function(a,b){b&&b.off(null,null,this),a&&a.on("messages:change",this.onRerender,this),this.onRender()}},messageStatusRenderer:{}},methods:{onCreate:function(){},onRender:function(){this.onRerender()},onRerender:function(a){if(this.item&&(!a||a.hasProperty("recipientStatus")||a.hasProperty("syncState"))){var b=this.item;if(this.messageStatusRenderer)this.innerHTML=this.messageStatusRenderer(b);else{var c="";if(b.isNew())c="";else if(b.isSaving()||b.isNew())c="pending";else if(b instanceof e.default.Message.ChannelMessage||b.deliveryStatus===e.default.Constants.RECIPIENT_STATE.NONE)c="sent";else if(b.readStatus===e.default.Constants.RECIPIENT_STATE.NONE)c="delivered";else if(b.readStatus===e.default.Constants.RECIPIENT_STATE.ALL)c="read";else{var d=b.getClient().user.id,f=b.recipientStatus,g=Object.keys(f).filter(function(a){return a!==d&&f[a]===e.default.Constants.RECEIPT_STATE.READ}).length;c="read by "+g+" participants"}this.innerHTML=c}}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-message-status","",""),b.buildStyle("layer-message-status","layer-message-status {\ndisplay: inline;\n}","")}()},{"../../../base":4,"../../../components/component":5,"layer-websdk":66}],28:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../../../components/component"),h=a("../../../mixins/main-component"),i=d(h);(0,g.registerComponent)("layer-presence",{mixins:[i.default],events:["layer-presence-click"],properties:{item:{set:function(a){if(a&&!(a instanceof f.default.Identity)){var b=f.default.Client.getClient(a.clientId);a=this.properties.item=b?b.getIdentity(a.id):null}a&&a.on("identities:change",this.onRerender,this),this.onRender()}}},methods:{onCreate:function(){this.addEventListener("click",this.onClick.bind(this))},onRender:function(){this.onRerender()},onRerender:function(a){this.className="layer-presence-"+(this.item?this.item.status:"unknown")},onClick:function(a){a.preventDefault(),this.trigger("layer-presence-click",{item:this.item})}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-presence","",""),b.buildStyle("layer-presence","layer-presence {\ndisplay: inline-block;\nborder-radius: 30px;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/main-component":51,"layer-websdk":66}],29:[function(a,b,c){"use strict";var d=a("../../../components/component"),e=a("../../../mixins/main-component"),f=function(a){return a&&a.__esModule?a:{default:a}}(e);(0,d.registerComponent)("layer-send-button",{mixins:[f.default],properties:{text:{value:"SEND",set:function(a){this.firstChild.innerHTML=a}}},methods:{onCreate:function(){this.addEventListener("click",this.onClick.bind(this))},onClick:function(a){this.trigger("layer-send-click")}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-send-button","<div></div>",""),b.buildStyle("layer-send-button","layer-send-button {\ncursor: pointer;\ndisplay: flex;\nflex-direction: row;\nalign-items: center;\n}\nlayer-send-button div {\ntext-align: center;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/main-component":51}],30:[function(a,b,c){"use strict";(0,a("../../../components/component").registerComponent)("layer-typing-indicator",{properties:{conversation:{set:function(a){if(a){this.client=a.getClient();var b=this.client.getTypingState(a);this.onRerender({conversationId:a.id,typing:b.typing,paused:b.paused})}else this.value=""}},client:{set:function(a,b){b&&b.off(null,null,this),a&&a.on("typing-indicator-change",this.onRerender,this)}},value:{set:function(a){this.nodes.panel.innerHTML=a||"",this.classList[a?"add":"remove"]("layer-typing-occuring")}}},methods:{onCreate:function(){},onRender:function(){if(this.conversation&&this.conversation.id){var a=this.client.getTypingState(this.conversation.id);a.conversationId=this.conversation.id,this.onRerender(a)}},onRerender:function(a){if(this.conversation&&a.conversationId===this.conversation.id&&this.trigger("layer-typing-indicator-change",{typing:a.typing,paused:a.paused,widget:this})){var b=a.typing.map(function(a){return a.displayName});switch(b.length){case 0:this.value="";break;case 1:this.value=b.join(", ")+" is typing";break;default:this.value=b.join(", ").replace(/, ([^,]*)$/," and $1")+" are typing"}}}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-typing-indicator","<span class='layer-typing-message' layer-id='panel'></span>",""),b.buildStyle("layer-typing-indicator","layer-typing-indicator {\ndisplay: block;\n}\nlayer-typing-indicator span {\ndisplay: none;\n}\nlayer-typing-indicator.layer-typing-occuring span {\ndisplay: inline;\n}","")}()},{"../../../base":4,"../../../components/component":5}],31:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("blueimp-load-image/js/load-image"),f=d(e);a("blueimp-load-image/js/load-image-orientation"),a("blueimp-load-image/js/load-image-meta"),a("blueimp-load-image/js/load-image-exif");var g=a("../../../base"),h=a("../../../components/component"),i=a("../../../utils/sizing"),j=d(i),k=a("../../../mixins/message-handler"),l=d(k);(0,h.registerMessageComponent)("layer-message-image",{mixins:[l.default],properties:{label:{value:'<i class="fa fa-file-image-o layer-image-message-icon" aria-hidden="true"></i> Image message'},message:{set:function(a){this.properties.image=a.parts.filter(function(a){return["image/png","image/gif","image/jpeg"].indexOf(a.mimeType)!==-1})[0],this.properties.preview=a.parts.filter(function(a){return"image/jpeg+preview"===a.mimeType})[0];var b=a.parts.filter(function(a){return"application/json+imageSize"===a.mimeType})[0];b&&(this.properties.meta=JSON.parse(b.body)),this.properties.preview&&this.properties.image?(this.properties.preview.body||(this.properties.preview.fetchContent(),this.properties.preview.on("content-loaded",this.onRender,this)),this.properties.image.url||this.properties.image.body||this.properties.image.fetchStream()):this.properties.image.body||(this.properties.image.fetchContent(),this.properties.image.on("content-loaded",this.onRender,this))}}},methods:{handlesMessage:function(a){var b=a.parts.filter(function(a){return["image/png","image/gif","image/jpeg"].indexOf(a.mimeType)!==-1}).length,c=a.parts.filter(function(a){return"image/jpeg+preview"===a.mimeType}).length,d=a.parts.filter(function(a){return"application/json+imageSize"===a.mimeType}).length;return 1===a.parts.length&&b||3===a.parts.length&&1===b&&1===c&&1===d},onCreate:function(){this.addEventListener("click",this._handleClick.bind(this))},_handleClick:function(a){"LAYER-CONVERSATION-LAST-MESSAGE"!==this.parentNode.tagName&&(a.preventDefault(),this.properties.image&&this.properties.image.url&&window.open(this.properties.image.url))},onRender:function(){var a=g.settings.maxSizes;this.parentComponent&&"LAYER-NOTIFIER"===this.parentComponent.tagName&&(a={height:140,width:a.width}),this.properties.sizes=(0,j.default)(this.properties.meta,{width:a.width,height:a.height}),this.style.height=g.settings.verticalMessagePadding+this.properties.sizes.height+"px",this.properties.preview&&this.properties.preview.body?this._renderCanvas(this.properties.preview.body):this.properties.image&&this.properties.image.body&&this._renderCanvas(this.properties.image.body)},_renderCanvas:function(a){var b=this;f.default.parseMetaData(a,function(c){var d={canvas:!0};c.imageHead&&c.exif&&(d.orientation=c.exif[274]||1),d.maxWidth=d.minWidth=b.properties.sizes.width,d.maxHeight=d.minHeight=b.properties.sizes.height,(0,f.default)(a,function(a){for(;b.firstChild;)b.removeChild(b.firstChild);a instanceof HTMLElement?b.appendChild(a):console.error(a)},d)})}}}),function(){var b=a("../../../base");b.buildAndRegisterTemplate("layer-message-image","",""),b.buildStyle("layer-message-image","layer-message-image {\ndisplay: flex;\nflex-direction: column;\nalign-items: center;\n}\nlayer-message-image canvas {\nwidth: 100%;\n}","")}()},{"../../../base":4,"../../../components/component":5,"../../../mixins/message-handler":52,"../../../utils/sizing":58,"blueimp-load-image/js/load-image":65,"blueimp-load-image/js/load-image-exif":61,"blueimp-load-image/js/load-image-meta":62,"blueimp-load-image/js/load-image-orientation":63}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../components/component"),f=a("../../mixins/message-handler"),g=d(f),h=a("../../base"),i=d(h);(0,e.registerMessageComponent)("layer-message-text-plain",{template:'<div class="layer-message-text" layer-id="text"></div>',mixins:[g.default],properties:{label:{label:"Text"},html:{set:function(a){this.parentComponent.isMessageListItem?this.nodes.text.innerHTML=a:this.innerHTML=a}}},methods:{handlesMessage:function(a,b){return"text/plain"===a.parts[0].mimeType},_fixHtml:function(a){return a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;")},onRender:function(){var a=this;i.default.textHandlersOrdered||this._setupOrderedHandlers();var b=this.message.parts[0].body,c={text:this._fixHtml(b),afterText:[],afterClasses:[]};i.default.textHandlersOrdered.forEach(function(b){var d=c.afterText.concat([]);b.handler(c,a.message,Boolean(a.parentComponent&&a.parentComponent.isMessageListItem));var e=c.afterText[c.afterText.length-1];d.indexOf(e)===-1&&(c.afterClasses[c.afterText.length-1]="layer-message-text-plain-"+b.name)}),this.html=c.text,c.afterText.length&&this.parentComponent&&this.parentComponent.isMessageListItem&&c.afterText.forEach(function(b,d){var e=document.createElement("div");e.classList.add("layer-message-text-plain-after-text"),e.classList.add(c.afterClasses[d]),e.innerHTML=b,e.firstChild.properties&&(e.firstChild.properties.parentComponent=a),a.appendChild(e)})},_setupOrderedHandlers:function(){i.default.textHandlersOrdered=Object.keys(i.default.textHandlers).filter(function(a){return i.default.textHandlers[a].enabled}).map(function(a){return i.default.textHandlers[a]}).sort(function(a,b){return a.order>b.order?1:b.order>a.order?-1:0})},onSent:function(){this.onRender()}}})},{"../../base":4,"../../components/component":5,"../../mixins/message-handler":52}],33:[function(a,b,c){"use strict";var d=a("../../components/component"),e=a("../../mixins/message-handler"),f=function(a){return a&&a.__esModule?a:{default:a}}(e);(0,d.registerComponent)("layer-message-unknown",{mixins:[f.default],methods:{onRender:function(){var a=this.message.parts.map(function(a){return a.mimeType}).join(", ");this.innerHTML="Message with mimeTypes "+a+" has been received but has no renderer"}}})},{"../../components/component":5,"../../mixins/message-handler":52}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../components/component"),f=a("../../utils/sizing"),g=d(f),h=a("../../base"),i=a("../../mixins/message-handler"),j=d(i);(0,e.registerMessageComponent)("layer-message-video",{mixins:[j.default],template:'<video layer-id="video"></video>',properties:{label:{value:'<i class="fa fa-file-video-o layer-video-message-icon" aria-hidden="true"></i> Video message'},message:{set:function(a){this.properties.video=a.parts.filter(function(a){return"video/mp4"===a.mimeType})[0],this.properties.preview=a.parts.filter(function(a){return"image/jpeg+preview"===a.mimeType})[0];var b=a.parts.filter(function(a){return"application/json+imageSize"===a.mimeType})[0];b&&(this.properties.meta=JSON.parse(b.body)),this.properties.sizes=(0,g.default)(this.properties.meta,{width:h.settings.maxSizes.width,height:h.settings.maxSizes.height}),this.properties.video.url||this.properties.video.fetchStream(),this.properties.video.on("url-loaded",this.onRender,this),this.properties.preview&&(this.properties.preview.url||this.properties.preview.fetchStream(),this.properties.preview.on("url-loaded",this.onRender,this))}}},methods:{handlesMessage:function(a,b){var c=a.parts.filter(function(a){return"video/mp4"===a.mimeType}).length,d=a.parts.filter(function(a){return"image/jpeg+preview"===a.mimeType}).length,e=a.parts.filter(function(a){return"application/json+imageSize"===a.mimeType}).length;return 1===a.parts.length&&c||3===a.parts.length&&1===c&&1===d&&1===e},onRender:function(){this.nodes.video.width=this.properties.sizes.width,this.nodes.video.height=this.properties.sizes.height,this.nodes.video.src=this.properties.video.url,this.properties.preview&&(this.nodes.video.poster=this.properties.preview.url),this.nodes.video.controls=!0}}})},{"../../base":4,"../../components/component":5,"../../mixins/message-handler":52,"../../utils/sizing":58}],35:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("autolinker"),f=d(e),g=a("../../base"),h=d(g),i=new f.default({truncate:{length:40,location:"middle"},className:"layer-parsed-url"});h.default.registerTextHandler({name:"autolinker",order:400,requiresEnable:!0,handler:function(a){a.text=i.link(a.text)}})},{"../../base":4,autolinker:60}],36:[function(a,b,c){"use strict";var d=a("../../base");(function(a){return a&&a.__esModule?a:{default:a}})(d).default.registerTextHandler({name:"code-blocks",order:500,requiresEnable:!0,handler:function(a){var b=a.text.replace(/```[\s\S]*?```/g,function(a){return'<pre class="code_block">'+a.substring(3,a.length-3)+"</pre>"});b=b.replace(/`.*?`/g,function(a){return"<code>"+a.substring(1,a.length-1)+"</code>"}),a.text=b}})},{"../../base":4}],37:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("twemoji"),f=d(e),g=a("remarkable-emoji/setEmoji"),h=d(g);d(a("../../base")).default.registerTextHandler({base:location.protocol+"://twemoji.maxcdn.com/",name:"emoji",order:300,requiresEnable:!0,handler:function(a){var b=a.text.replace(/<br\/>/g," <br/> "),c=(0,h.default)(b),d=!f.default.replace(c,function(){return""}).match(/\S/);b=f.default.parse((0,h.default)(b),{size:d?"36x36":"16x16",className:d?"emoji emoji-line":"emoji"}),b=b.replace(/ <br\/> /g,"<br/>"),a.text=b}})},{"../../base":4,"remarkable-emoji/setEmoji":69,twemoji:70}],38:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("../../base"),f=d(e),g=a("../../utils/is-url"),h=d(g);f.default.registerTextHandler({name:"images",order:100,requiresEnable:!0,handler:function(a){var b=a.text.match((0,h.default)(["png","jpg","jpeg","gif"]));b&&b.forEach(function(b){return a.afterText.push('<img class="layer-parsed-image" src="'+b+'"></img>')})}})},{"../../base":4,"../../utils/is-url":57}],39:[function(a,b,c){"use strict";var d=a("../../base");(function(a){return a&&a.__esModule?a:{default:a}})(d).default.registerTextHandler({name:"newline",order:600,requiresEnable:!0,handler:function(a){function b(a){return Boolean(e.filter(function(b){return a>b[0]&&a<b[1]}).length)}for(var c=a.text,d=[],e=[],f=0;f!==-1;)(f=c.indexOf("```",f))!==-1&&(d.push(f),f+=3);for(var g=1;g<d.length;g++)e.push([d[g-1],d[g]]);c=c.replace(/\n/g,function(a,c){return b(c)?a:"<br/>"}),a.text=c}})},{"../../base":4}],40:[function(a,b,c){"use strict";var d=a("../../base");(function(a){return a&&a.__esModule?a:{default:a}})(d).default.registerTextHandler({name:"youtube",order:200,
requiresEnable:!0,handler:function(a){var b=a.text.match(/https:\/\/(www\.)?(youtu\.be|youtube\.com)\/(watch\?.*?v=)?([a-zA-Z0-9-]+)/g);b&&b.forEach(function(b){var c=void 0,d=b.match(/https:\/\/youtu\.be\/(.*)$/);if(d&&(c=d[1]),!c){var e=b.match(/https:\/\/www\.youtube\.com\/watch\?v=(.*)$/);e&&(c=e[1])}c&&a.afterText.push('<iframe width="560" height="315" src="https://www.youtube.com/embed/'+c+'" frameborder="0" allowfullscreen></iframe>')})}})},{"../../base":4}],41:[function(a,b,c){(function(c){"use strict";var d=a("./layer-ui");a("./adapters/angular"),a("./adapters/backbone"),a("./adapters/react"),a("./components/conversation-list-panel/layer-conversations-list/layer-conversations-list"),a("./components/identities-list-panel/layer-identities-list/layer-identities-list"),a("./components/membership-list-panel/layer-membership-list/layer-membership-list"),a("./components/layer-conversation-panel/layer-conversation-panel"),a("./components/layer-notifier/layer-notifier"),a("./components/subcomponents/layer-file-upload-button/layer-file-upload-button"),a("./components/subcomponents/layer-send-button/layer-send-button"),a("./handlers/message/layer-message-text-plain"),a("./handlers/message/layer-message-image/layer-message-image"),a("./handlers/message/layer-message-video"),a("./handlers/text/autolinker"),a("./handlers/text/code-blocks"),a("./handlers/text/emoji"),a("./handlers/text/images"),a("./handlers/text/newline"),a("./handlers/text/youtube"),a("./utils/date-separator"),d.files=a("./utils/files"),d.animatedScrollTo=a("animated-scrollto"),d.mixins={MessageHandler:a("./mixins/message-handler"),HasQuery:a("./mixins/has-query"),MainComponent:a("./mixins/main-component"),List:a("./mixins/list"),ListItem:a("./mixins/list-item"),ListSelection:a("./mixins/list-selection"),ListItemSelection:a("./mixins/list-item-selection"),FocusOnKeydown:a("./mixins/focus-on-keydown")},b.exports=c.layerUI=d;var d=a("./layer-ui");a("./adapters/angular"),a("./adapters/backbone"),a("./adapters/react"),a("./components/conversation-list-panel/layer-conversations-list/layer-conversations-list"),a("./components/identities-list-panel/layer-identities-list/layer-identities-list"),a("./components/membership-list-panel/layer-membership-list/layer-membership-list"),a("./components/layer-conversation-panel/layer-conversation-panel"),a("./components/layer-notifier/layer-notifier"),a("./components/subcomponents/layer-file-upload-button/layer-file-upload-button"),a("./components/subcomponents/layer-send-button/layer-send-button"),a("./handlers/message/layer-message-text-plain"),a("./handlers/message/layer-message-image/layer-message-image"),a("./handlers/message/layer-message-video"),a("./handlers/text/autolinker"),a("./handlers/text/code-blocks"),a("./handlers/text/emoji"),a("./handlers/text/images"),a("./handlers/text/newline"),a("./handlers/text/youtube"),a("./utils/date-separator"),d.files=a("./utils/files"),d.animatedScrollTo=a("animated-scrollto"),d.mixins={MessageHandler:a("./mixins/message-handler"),HasQuery:a("./mixins/has-query"),MainComponent:a("./mixins/main-component"),List:a("./mixins/list"),ListItem:a("./mixins/list-item"),ListSelection:a("./mixins/list-selection"),ListItemSelection:a("./mixins/list-item-selection"),FocusOnKeydown:a("./mixins/focus-on-keydown")},b.exports=c.layerUI=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapters/angular":1,"./adapters/backbone":2,"./adapters/react":3,"./components/conversation-list-panel/layer-conversations-list/layer-conversations-list":8,"./components/identities-list-panel/layer-identities-list/layer-identities-list":9,"./components/layer-conversation-panel/layer-conversation-panel":11,"./components/layer-notifier/layer-notifier":12,"./components/membership-list-panel/layer-membership-list/layer-membership-list":14,"./components/subcomponents/layer-file-upload-button/layer-file-upload-button":26,"./components/subcomponents/layer-send-button/layer-send-button":29,"./handlers/message/layer-message-image/layer-message-image":31,"./handlers/message/layer-message-text-plain":32,"./handlers/message/layer-message-video":34,"./handlers/text/autolinker":35,"./handlers/text/code-blocks":36,"./handlers/text/emoji":37,"./handlers/text/images":38,"./handlers/text/newline":39,"./handlers/text/youtube":40,"./layer-ui":42,"./mixins/focus-on-keydown":44,"./mixins/has-query":45,"./mixins/list":50,"./mixins/list-item":47,"./mixins/list-item-selection":46,"./mixins/list-selection":49,"./mixins/main-component":51,"./mixins/message-handler":52,"./utils/date-separator":55,"./utils/files":56,"animated-scrollto":59}],42:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function d(a){return a&&a.__esModule?a:{default:a}}a("webcomponents.js/webcomponents-lite");var e=a("./base"),f=d(e),g=a("./components/component");a("./handlers/message/layer-message-unknown"),a("webcomponents.js/webcomponents-lite");var e=a("./base"),f=d(e),g=a("./components/component");a("./handlers/message/layer-message-unknown"),f.default.registerComponent=g.registerComponent,f.default.registerMessageComponent=g.registerMessageComponent,f.default.unregisterComponent=g.unregisterComponent,f.default.init=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(a).forEach(function(b){f.default.settings[b]=a[b]}),f.default.settings.mixins||(f.default.settings.mixins=[]),(0,g.registerAll)(),f.default.settings.textHandlers.forEach(function(a){f.default.registerTextHandler({name:a})})},b.exports=f.default,f.default.registerComponent=g.registerComponent,f.default.registerMessageComponent=g.registerMessageComponent,f.default.unregisterComponent=g.unregisterComponent,f.default.init=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(a).forEach(function(b){f.default.settings[b]=a[b]}),f.default.settings.mixins||(f.default.settings.mixins=[]),(0,g.registerAll)(),f.default.settings.textHandlers.forEach(function(a){f.default.registerTextHandler({name:a})})},b.exports=f.default},{"./base":4,"./components/component":5,"./handlers/message/layer-message-unknown":33,"webcomponents.js/webcomponents-lite":71}],43:[function(a,b,c){"use strict";b.exports={properties:{isEmptyList:{value:!1,set:function(a){this.nodes.emptyNode.style.display=a?"":"none"}},emptyNode:{set:function(a){this.nodes.emptyNode.innerHTML="",a&&this.nodes.emptyNode.appendChild(a)}}},methods:{onRender:function(){this.nodes.emptyNode.style.display=this.isEmptyList?"":"none",this.emptyNode&&this.nodes.emptyNode.appendChild(this.emptyNode)},onRerender:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.query.isDestroyed?this.isEmptyList=!1:this.isEmptyList="reset"!==a.type&&0===this.query.data.length}}}},{}],44:[function(a,b,c){"use strict";b.exports={methods:{onCreate:function(){this.addEventListener("keydown",this._onKeyDown.bind(this));var a=document.head?document.head.tabIndex:null;""!==this.tabIndex&&this.tabIndex!==-1&&this.tabIndex!==a||(this.tabIndex=-1)},_onKeyDown:function(a){var b=a.keyCode,c=a.metaKey,d=a.ctrlKey;c||d||(b>=65&&b<=90||b>=48&&b<=57||b>=97&&b<=111||b>=186&&b<=191||[32,219,220,222].indexOf(b)!==-1)&&["INPUT","TEXTAREA"].indexOf(document.activeElement.tagName)===-1&&this.onKeyDown()}}}},{}],45:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);b.exports={properties:{client:{set:function(a){a&&(this.queryId&&(this.query=a.getQuery(this.queryId)),this.properties._isMainComponent&&this.useGeneratedQuery&&this._setupGeneratedQuery())}},queryId:{set:function(a){a&&0!==a.indexOf("layer:///")&&(this.properties.queryId=""),this.client&&(this.query=this.queryId?this.client.getQuery(this.queryId):null)}},query:{set:function(a,b){b&&b.off(null,null,this),a instanceof e.default.Query?this._updateQuery():this.properties.query=null,this.properties._isMainComponent&&this.hasGeneratedQuery&&(this.hasGeneratedQuery=!1,b.destroy())}},hasGeneratedQuery:{value:!1,type:Boolean},useGeneratedQuery:{value:!0,type:Boolean},pageSize:{value:50}},methods:{_setupGeneratedQuery:function(){this._queryModel&&!this.properties.query&&this.client&&!this.client.isDestroyed&&(this.query=this.client.createQuery({model:this._queryModel,dataType:e.default.Query.InstanceDataType,paginationWindow:this.pageSize||50,sortBy:this.sortBy}),this.hasGeneratedQuery=!0)},_updateQuery:function(){this.client=this.query.client,this.onRender(),this.query.on("change",this.onRerender,this)}}}},{"layer-websdk":66}],46:[function(a,b,c){"use strict";b.exports={properties:{isSelected:{type:Boolean,set:function(a){this.toggleClass("layer-selected-item",a),this.onSelection(a)}}},methods:{onSelection:function(a){}}}},{}],47:[function(a,b,c){"use strict";b.exports={properties:{_isListItem:{value:!0},customNodeAbove:{set:function(a){if(this.properties._customNodeAbove&&this.removeChild(this.properties._customNodeAbove),a&&"string"==typeof a){var b=a;a=document.createElement("div"),a.innerHTML=b,this.properties.customNodeAbove=a}a?this.insertBefore(a,this.querySelector(".layer-list-item")):this.properties.customNodeAbove=null,this.properties._customNodeAbove=a}},customNodeBelow:{set:function(a){if(this.properties._customNodeBelow&&this.removeChild(this.properties._customNodeBelow),a&&"string"==typeof a){var b=a;a=document.createElement("div"),a.innerHTML=b,this.properties.customNodeBelow=a}a?this.appendChild(a):this.properties.customNodeBelow=null,this.properties._customNodeBelow=a}},innerNode:{},firstInSeries:{type:Boolean,value:!1,set:function(a){this.toggleClass("layer-list-item-first",a)}},lastInSeries:{type:Boolean,value:!1,set:function(a){this.toggleClass("layer-list-item-last",a)}},item:{set:function(a,b){var c=this;b&&b.off(null,null,this),a&&a.on(a.constructor.eventPrefix+":change",this.onRerender,this),Object.keys(this.nodes).forEach(function(b){c.nodes[b].item=a}),this.onRender()}}},methods:{onCreate:function(){this.innerNode=this.querySelector(".layer-list-item")},onRender:{conditional:function(){return Boolean(this.item)}},addClass:function(a){this.classList.add(a)},removeClass:function(a){this.classList.remove(a)},toggleClass:function(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.classList[b?"add":"remove"](a)}}}},{}],48:[function(a,b,c){"use strict";b.exports={properties:{isDataLoading:{set:function(a){this.classList[a?"add":"remove"]("layer-loading-data")}},dataLoadingNode:{set:function(a){this.nodes.loadIndicator.innerHTML="",a&&this.nodes.loadIndicator.appendChild(a)}}},methods:{onRender:function(){this.dataLoadingNode&&this.nodes.loadIndicator.appendChild(this.dataLoadingNode)}}}},{}],49:[function(a,b,c){"use strict";b.exports={properties:{selectedId:{set:function(a,b){var c=this.client.getObject(a);if(!c&&!b||this.trigger(this._selectedItemEventName,{item:c})){if(b){var d=this.querySelector("#"+this._getItemId(b));d&&(d.isSelected=!1)}if(a){var e=this.querySelector("#"+this._getItemId(a));e&&(e.isSelected=!0)}}else this.properties.selectedId=b}}},methods:{onCreate:function(){this.addEventListener("click",this._onClick.bind(this))},onAfterCreate:function(){this.properties._selectedItemEventName||(this.properties._selectedItemEventName="layer-item-selected")},_onClick:function(a){for(var b=a.target;b&&b!==this&&!b._isListItem;)b=b.parentNode;b.item&&b._isListItem&&(a.preventDefault(),a.stopPropagation(),this.selectedId=b.item.id),this.onClick(a)},onClick:function(a){},onGenerateListItem:function(a){a.item.id===this.selectedId&&(a.isSelected=!0)}}}},{}],50:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("layer-websdk"),f=d(e),g=a("../base"),h=a("../components/component"),i=a("./has-query"),j=d(i);b.exports={mixins:[j.default],properties:{_isList:{value:!0},isDataLoading:{},onRenderListItem:{type:Function},pageSize:{value:50},throttlerTimeout:{value:66},state:{set:function(a){Array.prototype.slice.call(this.childNodes).forEach(function(b){b.state=a})}},filter:{set:function(a){this._runFilter()}}},methods:{onCreate:function(){this.id||(this.id=f.default.Util.generateUUID()),this.properties.listData=[],this.addEventListener("scroll",this._onScroll.bind(this)),this.onRender()},_onScroll:function(a){this.properties.isSelfScrolling?a.preventDefault():this._throttler(this._handleScroll.bind(this))},_throttler:function(a){var b=this;this.properties.throttleTimeout||(this.properties.throttleTimeout=setTimeout(function(){b.properties.throttleTimeout=null,a()},this.throttlerTimeout))},_updateQuery:function(){this.query.on("change:property",this._runFilter,this)},_handleScroll:function(){this.scrollTop>=this.scrollHeight-this.clientHeight-20&&this.scrollTop>0&&(this.query.update({paginationWindow:this.query.paginationWindow+this.pageSize}),this.isDataLoading=this.properties.query.isFiring)},scrollTo:function(a){a!==this.scrollTop&&(this.scrollTop=a)},animatedScrollTo:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,d=arguments[2];this.properties.cancelAnimatedScroll&&this.properties.cancelAnimatedScroll();var e=this.properties.cancelAnimatedScroll=(0,g.animatedScrollTo)(this,a,c,function(){e===b.properties.cancelAnimatedScroll&&(b.properties.cancelAnimatedScroll=null,d&&d())})},scrollToItem:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments[2],d=document.getElementById(this._getItemId(a.id));if(!d)return!1;var e=d.offsetTop-this.offsetTop;return b?this.animatedScrollTo(e,b,c):this.scrollTop=e,!0},onRender:function(){var a=this;Array.prototype.slice.call(this.childNodes).forEach(function(b){b._isListItem&&a.removeChild(b)}),this.query&&this.query.size&&this.onRerender({type:"data",data:this.query.data,inRender:!0})},onRerender:{mode:h.registerComponent.MODES.BEFORE,value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.query.isDestroyed?this._renderResetData(a):this._processQueryEvt(a)}},_generateFragment:function(a,b){var c=this;return b||(b=document.createDocumentFragment()),a.forEach(function(a,d){c._generateFragmentItem(a,b)},this),b},_getItemId:function(a){return"list-item-"+this.id+"-"+a.replace(/[^a-zA-Z0-9-_]/g,"-").replace(/-+/g,"-")},_generateFragmentItem:function(a,b){var c=a instanceof f.default.Root?a:this.client.getObject(a.id);if(c){var d=this._generateItem(c);d.parentComponent=this,d.setAttribute("layer-item-id",a.id.replace(/^layer:\/\/\//,"").replace(/\//g,"_")),d&&(this.onGenerateListItem(d),b.appendChild(d))}},onGenerateListItem:function(a){},_gatherAndProcessAffectedItems:function(a,b){var c=this;if(a.length){var d=a.map(function(a){return c._getItemId(a.id)}),e=this.querySelectorAllArray("#"+d.join(", #"));this._processAffectedWidgets(e,b)}},_processAffectedWidgets:function(a,b){for(var c=this,d=void 0,e=0;e<this.properties.listData.length;e++)if(a.length&&a[0].item.id===this.properties.listData[e].id){d=e;break}this._processAffectedWidgetsCustom(a,d,b),a.forEach(function(a,e){if(c.properties.onRenderListItem)try{c.properties.onRenderListItem(a,c.properties.listData,d+e,b)}catch(b){console.error("Error in onRenderListItem for "+a.item.id+"; "+b)}},this)},_processAffectedWidgetsCustom:function(a,b,c){},_processQueryEvt:function(a){switch(a.type){case"data":this._renderPagedData(a);break;case"insert":this._renderInsertedData(a);break;case"remove":this._renderWithoutRemovedData(a);break;case"reset":this._renderResetData(a);break;case"move":this._renderMovedData(a)}},_renderResetData:function(a){this.properties.listData=[],this.scrollTo(0),this.onRender()},_renderMovedData:function(a){var b=a.fromIndex,c=a.toIndex,d=this.childNodes[b];this.removeChild(d),this.insertBefore(d,this.childNodes[c]),a.inRender||this.onRerender()},_renderWithoutRemovedData:function(a){this.properties.listData=[].concat(this.properties.query.data);var b=a.index,c=this.properties.listData.slice(Math.max(0,b-3),b+3),d=this.querySelector("#"+this._getItemId(a.target.id));d&&this.removeChild(d),this._gatherAndProcessAffectedItems(c,!1)},_renderInsertedData:function(a){this.properties.listData=[].concat(this.properties.query.data);var b=a.index,c=this.properties.listData.slice(Math.max(0,b-3),b+4),d=this._generateFragment([a.target]);this.insertBefore(d,this.childNodes[b]),this._gatherAndProcessAffectedItems(c,0===b)},_renderPagedData:function(a){var b=this.properties.listData.slice(this.properties.listData.length-3,this.properties.listData.length).concat(a.data);this.properties.listData=[].concat(this.properties.query.data);var c=this._generateFragment(a.data);this.insertBefore(c,this.nodes.loadIndicator),this._gatherAndProcessAffectedItems(b,a.data.length===this.properties.query.data.length),this.isDataLoading=this.properties.query.isFiring,a.inRender||this.onRerender()},_runFilter:function(){if(this.filter)for(var a=0;a<this.childNodes.length;a++){var b=this.childNodes[a];b.item instanceof f.default.Root&&b._runFilter(this.filter)}else this.querySelectorAllArray(".layer-item-filtered").forEach(function(a){return a.removeClass("layer-item-filtered")})}}}},{"../base":4,"../components/component":5,"./has-query":45,"layer-websdk":66}],51:[function(a,b,c){"use strict";var d=a("layer-websdk"),e=function(a){return a&&a.__esModule?a:{default:a}}(d),f=a("../base");b.exports={properties:{_isMainComponent:{value:!0},appId:{order:1,set:function(a){var b=this;if(a&&0===a.indexOf("layer:///")){var c=e.default.Client.getClient(a);if(c)this.client=c;else{if(!e.default.Client.addListenerForNewClient)throw new Error("You must create a layer.Client with your appId before creating this component. Or upgrade to Layer WebSDK 3.2.2 or above.");e.default.Client.addListenerForNewClient(function(a){return b.client=a},a)}}}},client:{order:2,set:function(a){var b=this;a&&(a.telemetryMonitor&&a.telemetryMonitor.on("telemetry-environment",function(a){a.environment.layer_ui_sdk_version=f.version}),a.on("destroy",function(c){c.target===a&&(b.properties.client=null)},this))}}},methods:{onCreate:function(){f.settings.appId&&(this.appId=f.settings.appId),navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&this.classList.add("safari")}}}},{"../base":4,"layer-websdk":66}],52:[function(a,b,c){"use strict";var d=a("../components/component");b.exports={properties:{message:{mode:d.registerComponent.MODES.AFTER,set:function(){this.onRender(),this.message.on("messages:change",this._onChange,this),this.message.isNew()&&this.message.once("messages:sent",this.onSent,this)}}},methods:{onRender:{conditional:function(){return Boolean(this.message&&!this.message.isDestroyed)},mode:d.registerComponent.MODES.AFTER,value:function(){this.onRerender()}},onRerender:function(){},_onChange:function(){this.message.isNew()?this.onRender():this.onRerender()},onSent:function(){}}}},{"../components/component":5}],53:[function(a,b,c){"use strict";b.exports={properties:{isEndOfResults:{value:!1,set:function(a){this.classList[a&&!this.isEmptyList?"add":"remove"]("layer-end-of-results")}},endOfResultsNode:{set:function(a){this.nodes.endOfResultsNode.innerHTML="",a&&this.nodes.endOfResultsNode.appendChild(a)}}},methods:{onRender:function(){this.endOfResultsNode&&this.nodes.endOfResultsNode.appendChild(this.endOfResultsNode)},_renderPagedDataDone:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.query.isDestroyed?this.isEndOfResults=!1:this.isEndOfResults=this.query.pagedToEnd}}}},{}],54:[function(a,b,c){"use strict";b.exports={properties:{state:{propagateToChildren:!0,set:function(a){this.onRenderState&&this.onRenderState()}}}}},{}],55:[function(a,b,c){"use strict";var d=a("../base"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);b.exports=d.utils.dateSeparator=function(a,b,c){if(!(c>b.length)){var d=a.item;if(0===c||d.sentAt.toDateString()!==b[c-1].sentAt.toDateString()){var f={weekday:"long",year:"numeric",month:"short",day:"2-digit"},g=b[c].sentAt.toLocaleDateString(void 0,f);e.default.addListItemSeparator(a,"<span>"+g+"</span>","layer-list-item-separator-date",!0)}else e.default.addListItemSeparator(a,"","layer-list-item-separator-date",!0)}}},{"../base":4}],56:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}var e=a("blueimp-load-image/js/load-image"),f=d(e);a("blueimp-load-image/js/load-image-orientation"),a("blueimp-load-image/js/load-image-meta"),a("blueimp-load-image/js/load-image-exif");var g=a("layer-websdk"),h=d(g),i=a("../base"),j=d(i),k=a("./sizing"),l=d(k),m={};b.exports=m,window.loadImage=f.default,m.DragAndDropFileWatcher=function(a){this.node="string"==typeof a.node?document.getElementById(a.node):a.node,this.callback=a.callback,this.allowDocumentDrop=Boolean(a.allowDocumentDrop),this.onDragOverBound=this.onDragOver.bind(this),this.onDragEndBound=this.onDragEnd.bind(this),this.onFileDropBound=this.onFileDrop.bind(this),this.ignoreDropBound=this.ignoreDrop.bind(this),this.node.addEventListener("dragover",this.onDragOverBound,!1),this.node.addEventListener("dragenter",this.onDragOverBound,!1),this.node.addEventListener("dragend",this.onDragEndBound,!1),this.node.addEventListener("dragleave",this.onDragEndBound,!1),this.node.addEventListener("drop",this.onFileDropBound,!1),this.allowDocumentDrop||(document.addEventListener("drop",this.ignoreDropBound,!1),document.addEventListener("dragenter",this.ignoreDropBound,!1),document.addEventListener("dragover",this.ignoreDropBound,!1))},m.DragAndDropFileWatcher.prototype.destroy=function(){this.node.removeEventListener("dragover",this.onDragOverBound,!1),this.node.removeEventListener("dragenter",this.onDragOverBound,!1),this.node.removeEventListener("dragend",this.onDragEndBound,!1),this.node.removeEventListener("dragleave",this.onDragEndBound,!1),this.node.removeEventListener("drop",this.onFileDropBound,!1),this.allowDocumentDrop||(document.removeEventListener("drop",this.ignoreDropBound,!1),document.removeEventListener("dragenter",this.ignoreDropBound,!1),document.removeEventListener("dragover",this.ignoreDropBound,!1)),delete this.node,delete this.callback},m.DragAndDropFileWatcher.prototype.ignoreDrop=function(a){return a.preventDefault&&(a.preventDefault(),a.stopPropagation()),!1},m.DragAndDropFileWatcher.prototype.onDragOver=function(a){return this.node.classList.add("layer-file-drag-and-drop-hover"),a.preventDefault(),!1},m.DragAndDropFileWatcher.prototype.onDragEnd=function(a){this.node.classList.remove("layer-file-drag-and-drop-hover")},m.DragAndDropFileWatcher.prototype.onFileDrop=function(a){this.onDragEnd(),a.preventDefault&&(a.preventDefault(),a.stopPropagation());var b=a.dataTransfer,c=Array.prototype.map.call(b.files,function(a){return new h.default.MessagePart(a)});return m.processAttachments(c,this.callback),!1},m.processAttachments=function(a,b){a.forEach(function(a){["image/gif","image/png","image/jpeg"].indexOf(a.mimeType)!==-1?m.generateImageMessageParts(a,b):"video/mp4"===a.mimeType?m.generateVideoMessageParts(a,b):b&&b([a])})},m.generateImageMessageParts=function(a,b){function c(b){var c={canvas:!0};b.imageHead&&b.exif&&(g=c.orientation=b.exif[274]||g),(0,f.default)(a.body,d,c)}function d(a){var c={width:a.width,height:a.height},d=(0,l.default)(c,j.default.settings.maxSizes),f=document.createElement("canvas");f.width=d.width,f.height=d.height;var i=f.getContext("2d");i.fillStyle=i.strokeStyle="white",i.fillRect(0,0,d.width,d.height),i.drawImage(a,0,0,d.width,d.height);for(var k=atob(f.toDataURL("image/jpeg").split(",")[1]),m=k.length,n=new Uint8Array(m),o=0;o<m;o++)n[o]=k.charCodeAt(o);var p=new Blob([n],{type:"image/jpeg"});e.push(new h.default.MessagePart({body:p,mimeType:"image/jpeg+preview"})),e.push(new h.default.MessagePart({mimeType:"application/json+imageSize",body:JSON.stringify({orientation:g,width:c.width,height:c.height,previewWidth:f.width,previewHeight:f.height})})),b(e)}var e=[a],g=0;f.default.parseMetaData(a.body,c)},m.generateVideoMessageParts=function(a,b){var c=[a],d=document.createElement("video");d.addEventListener("loadedmetadata",function(){var a={width:d.videoWidth,height:d.videoHeight},e=(0,l.default)(a,j.default.settings.maxSizes),f=document.createElement("canvas");f.width=e.width,f.height=e.height,f.getContext("2d").drawImage(d,0,0,f.width,f.height);for(var g=atob(f.toDataURL("image/jpeg").split(",")[1]),i=g.length,k=new Uint8Array(i),m=0;m<i;m++)k[m]=g.charCodeAt(m);c.push(new h.default.MessagePart({body:new Blob([k],{type:"image/jpeg"}),mimeType:"image/jpeg+preview"})),c.push(new h.default.MessagePart({mimeType:"application/json+imageSize",body:'{"orientation":0, "width":'+a.width+', "height":'+a.height+"}"})),b&&b(c)}),d.src=URL.createObjectURL(a.body)}},{"../base":4,"./sizing":58,"blueimp-load-image/js/load-image":65,"blueimp-load-image/js/load-image-exif":61,"blueimp-load-image/js/load-image-meta":62,"blueimp-load-image/js/load-image-orientation":63,"layer-websdk":66}],57:[function(a,b,c){"use strict";b.exports=function(a){var b="?";return a&&(b=".("+a.join("|")+")"),new RegExp("(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)"+b,"igm")}},{}],58:[function(a,b,c){"use strict";b.exports=function(a,b){if(!a)return b;var c={width:a.previewWidth||a.width,height:a.previewHeight||a.height};if(c.width>b.width){var d=c.width;c.width=b.width,c.height=c.height*b.width/d}if(c.height>b.height){var e=c.height;c.height=b.height,c.width=c.width*b.height/e}return{width:Math.round(c.width),height:Math.round(c.height)}}},{}],59:[function(a,b,c){!function(a){var c=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(),d=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},e=function(a,b,e,f){var g=a.scrollTop,h=b-g,i=+new Date,j=!0,k=null,l=function(){if(j){c(l);var m=+new Date,n=Math.floor(d(m-i,g,h,e));k?k===a.scrollTop?(k=n,a.scrollTop=n):j=!1:(k=n,a.scrollTop=n),m>i+e&&(a.scrollTop=b,j=!1,f&&f())}};return c(l),function(){j=!1}},f=function(a,b,e,f){var g=a.scrollLeft,h=b-g,i=+new Date,j=!0,k=null,l=function(){if(j){c(l);var m=+new Date,n=Math.floor(d(m-i,g,h,e));k?k===a.scrollLeft?(k=n,a.scrollLeft=n):j=!1:(k=n,a.scrollLeft=n),m>i+e&&(a.scrollLeft=b,j=!1,f&&f())}};return c(l),function(){j=!1}};void 0!==b&&void 0!==b.exports?b.exports={animatedScrollTo:e,animatedScrollLeftTo:f}:(a.animatedScrollTo=e,a.animatedScrollLeftTo=f)}(window)},{}],60:[function(a,b,c){!function(a,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof c?b.exports=d():a.Autolinker=d()}(this,function(){var a=function(b){b=b||{},this.version=a.version,this.urls=this.normalizeUrlsCfg(b.urls),this.email="boolean"!=typeof b.email||b.email,this.phone="boolean"!=typeof b.phone||b.phone,this.hashtag=b.hashtag||!1,this.mention=b.mention||!1,this.newWindow="boolean"!=typeof b.newWindow||b.newWindow,this.stripPrefix=this.normalizeStripPrefixCfg(b.stripPrefix),this.stripTrailingSlash="boolean"!=typeof b.stripTrailingSlash||b.stripTrailingSlash;var c=this.mention;if(c!==!1&&"twitter"!==c&&"instagram"!==c)throw new Error("invalid `mention` cfg - see docs");var d=this.hashtag;if(d!==!1&&"twitter"!==d&&"facebook"!==d&&"instagram"!==d)throw new Error("invalid `hashtag` cfg - see docs");this.truncate=this.normalizeTruncateCfg(b.truncate),this.className=b.className||"",this.replaceFn=b.replaceFn||null,this.context=b.context||this,this.htmlParser=null,this.matchers=null,this.tagBuilder=null};return a.link=function(b,c){return new a(c).link(b)},a.parse=function(b,c){return new a(c).parse(b)},a.version="1.4.2",a.prototype={constructor:a,normalizeUrlsCfg:function(a){return null==a&&(a=!0),"boolean"==typeof a?{schemeMatches:a,wwwMatches:a,tldMatches:a}:{schemeMatches:"boolean"!=typeof a.schemeMatches||a.schemeMatches,wwwMatches:"boolean"!=typeof a.wwwMatches||a.wwwMatches,tldMatches:"boolean"!=typeof a.tldMatches||a.tldMatches}},normalizeStripPrefixCfg:function(a){return null==a&&(a=!0),"boolean"==typeof a?{scheme:a,www:a}:{scheme:"boolean"!=typeof a.scheme||a.scheme,www:"boolean"!=typeof a.www||a.www}},normalizeTruncateCfg:function(b){return"number"==typeof b?{length:b,location:"end"}:a.Util.defaults(b||{},{length:Number.POSITIVE_INFINITY,location:"end"})},parse:function(a){for(var b=this.getHtmlParser(),c=b.parse(a),d=0,e=[],f=0,g=c.length;f<g;f++){var h=c[f],i=h.getType();if("element"===i&&"a"===h.getTagName())h.isClosing()?d=Math.max(d-1,0):d++;else if("text"===i&&0===d){var j=this.parseText(h.getText(),h.getOffset());e.push.apply(e,j)}}return e=this.compactMatches(e),e=this.removeUnwantedMatches(e)},compactMatches:function(a){a.sort(function(a,b){return a.getOffset()-b.getOffset()});for(var b=0;b<a.length-1;b++)for(var c=a[b],d=c.getOffset()+c.getMatchedText().length;b+1<a.length&&a[b+1].getOffset()<=d;)a.splice(b+1,1);return a},removeUnwantedMatches:function(b){var c=a.Util.remove;return this.hashtag||c(b,function(a){return"hashtag"===a.getType()}),this.email||c(b,function(a){return"email"===a.getType()}),this.phone||c(b,function(a){return"phone"===a.getType()}),this.mention||c(b,function(a){return"mention"===a.getType()}),this.urls.schemeMatches||c(b,function(a){return"url"===a.getType()&&"scheme"===a.getUrlMatchType()}),this.urls.wwwMatches||c(b,function(a){return"url"===a.getType()&&"www"===a.getUrlMatchType()}),this.urls.tldMatches||c(b,function(a){return"url"===a.getType()&&"tld"===a.getUrlMatchType()}),b},parseText:function(a,b){b=b||0;for(var c=this.getMatchers(),d=[],e=0,f=c.length;e<f;e++){for(var g=c[e].parseMatches(a),h=0,i=g.length;h<i;h++)g[h].setOffset(b+g[h].getOffset());d.push.apply(d,g)}return d},link:function(a){if(!a)return"";for(var b=this.parse(a),c=[],d=0,e=0,f=b.length;e<f;e++){var g=b[e];c.push(a.substring(d,g.getOffset())),c.push(this.createMatchReturnVal(g)),d=g.getOffset()+g.getMatchedText().length}return c.push(a.substring(d)),c.join("")},createMatchReturnVal:function(b){var c;return this.replaceFn&&(c=this.replaceFn.call(this.context,b)),"string"==typeof c?c:c===!1?b.getMatchedText():c instanceof a.HtmlTag?c.toAnchorString():b.buildTag().toAnchorString()},getHtmlParser:function(){var b=this.htmlParser;return b||(b=this.htmlParser=new a.htmlParser.HtmlParser),b},getMatchers:function(){if(this.matchers)return this.matchers;var b=a.matcher,c=this.getTagBuilder(),d=[new b.Hashtag({tagBuilder:c,serviceName:this.hashtag}),new b.Email({tagBuilder:c}),new b.Phone({tagBuilder:c}),new b.Mention({tagBuilder:c,serviceName:this.mention}),new b.Url({tagBuilder:c,stripPrefix:this.stripPrefix,stripTrailingSlash:this.stripTrailingSlash})];return this.matchers=d},getTagBuilder:function(){var b=this.tagBuilder;return b||(b=this.tagBuilder=new a.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),b}},a.match={},a.matcher={},a.htmlParser={},a.truncate={},a.Util={abstractMethod:function(){throw"abstract"},trimRegex:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,assign:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},defaults:function(a,b){for(var c in b)b.hasOwnProperty(c)&&void 0===a[c]&&(a[c]=b[c]);return a},extend:function(b,c){var d=b.prototype,e=function(){};e.prototype=d;var f;f=c.hasOwnProperty("constructor")?c.constructor:function(){d.constructor.apply(this,arguments)};var g=f.prototype=new e;return g.constructor=f,g.superclass=d,delete c.constructor,a.Util.assign(g,c),f},ellipsis:function(a,b,c){var d;return a.length>b&&(null==c?(c="&hellip;",d=3):d=c.length,a=a.substring(0,b-d)+c),a},indexOf:function(a,b){
if(Array.prototype.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},remove:function(a,b){for(var c=a.length-1;c>=0;c--)b(a[c])===!0&&a.splice(c,1)},splitAndCapture:function(a,b){if(!b.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var c,d=[],e=0;c=b.exec(a);)d.push(a.substring(e,c.index)),d.push(c[0]),e=c.index+c[0].length;return d.push(a.substring(e)),d},trim:function(a){return a.replace(this.trimRegex,"")}},a.HtmlTag=a.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(b){a.Util.assign(this,b),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(a){return this.tagName=a,this},getTagName:function(){return this.tagName||""},setAttr:function(a,b){return this.getAttrs()[a]=b,this},getAttr:function(a){return this.getAttrs()[a]},setAttrs:function(b){var c=this.getAttrs();return a.Util.assign(c,b),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(a){return this.setAttr("class",a)},addClass:function(b){for(var c,d=this.getClass(),e=this.whitespaceRegex,f=a.Util.indexOf,g=d?d.split(e):[],h=b.split(e);c=h.shift();)f(g,c)===-1&&g.push(c);return this.getAttrs().class=g.join(" "),this},removeClass:function(b){for(var c,d=this.getClass(),e=this.whitespaceRegex,f=a.Util.indexOf,g=d?d.split(e):[],h=b.split(e);g.length&&(c=h.shift());){var i=f(g,c);i!==-1&&g.splice(i,1)}return this.getAttrs().class=g.join(" "),this},getClass:function(){return this.getAttrs().class||""},hasClass:function(a){return(" "+this.getClass()+" ").indexOf(" "+a+" ")!==-1},setInnerHtml:function(a){return this.innerHtml=a,this},getInnerHtml:function(){return this.innerHtml||""},toAnchorString:function(){var a=this.getTagName(),b=this.buildAttrsStr();return b=b?" "+b:"",["<",a,b,">",this.getInnerHtml(),"</",a,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var a=this.getAttrs(),b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+'="'+a[c]+'"');return b.join(" ")}}),a.RegexLib=function(){var a="A-Za-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",b=a+"0-9------------------------------------";return{alphaNumericCharsStr:b,alphaCharsStr:a,domainNameRegex:new RegExp("["+b+".\\-]*["+b+"\\-]")}}(),a.AnchorTagBuilder=a.Util.extend(Object,{constructor:function(a){a=a||{},this.newWindow=a.newWindow,this.truncate=a.truncate,this.className=a.className},build:function(b){return new a.HtmlTag({tagName:"a",attrs:this.createAttrs(b),innerHtml:this.processAnchorText(b.getAnchorText())})},createAttrs:function(a){var b={href:a.getAnchorHref()},c=this.createCssClass(a);return c&&(b.class=c),this.newWindow&&(b.target="_blank",b.rel="noopener noreferrer"),this.truncate&&this.truncate.length&&this.truncate.length<a.getAnchorText().length&&(b.title=a.getAnchorHref()),b},createCssClass:function(a){var b=this.className;if(b){for(var c=[b],d=a.getCssClassSuffixes(),e=0,f=d.length;e<f;e++)c.push(b+"-"+d[e]);return c.join(" ")}return""},processAnchorText:function(a){return a=this.doTruncate(a)},doTruncate:function(b){var c=this.truncate;if(!c||!c.length)return b;var d=c.length,e=c.location;return"smart"===e?a.truncate.TruncateSmart(b,d):"middle"===e?a.truncate.TruncateMiddle(b,d):a.truncate.TruncateEnd(b,d)}}),a.htmlParser.HtmlParser=a.Util.extend(Object,{htmlRegex:function(){var a=/[^\s"'>\/=\x00-\x1F\x7F]+/.source+"(?:\\s*=\\s*"+/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",a,"|",/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/.source+")",")*",">",")","|","(?:","<(/)?","(?:",/!--([\s\S]+?)--/.source,"|","(?:","("+/[0-9a-zA-Z][0-9a-zA-Z:]*/.source+")","\\s*/?",")","|","(?:","("+/[0-9a-zA-Z][0-9a-zA-Z:]*/.source+")","\\s+","(?:","(?:\\s+|\\b)",a,")*","\\s*/?",")",")",">",")"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(a){for(var b,c,d=this.htmlRegex,e=0,f=[];null!==(b=d.exec(a));){var g=b[0],h=b[3],i=b[1]||b[4]||b[5],j=!!b[2],k=b.index,l=a.substring(e,k);l&&(c=this.parseTextAndEntityNodes(e,l),f.push.apply(f,c)),h?f.push(this.createCommentNode(k,g,h)):f.push(this.createElementNode(k,g,i,j)),e=k+g.length}if(e<a.length){var m=a.substring(e);m&&(c=this.parseTextAndEntityNodes(e,m),c.forEach(function(a){f.push(a)}))}return f},parseTextAndEntityNodes:function(b,c){for(var d=[],e=a.Util.splitAndCapture(c,this.htmlCharacterEntitiesRegex),f=0,g=e.length;f<g;f+=2){var h=e[f],i=e[f+1];h&&(d.push(this.createTextNode(b,h)),b+=h.length),i&&(d.push(this.createEntityNode(b,i)),b+=i.length)}return d},createCommentNode:function(b,c,d){return new a.htmlParser.CommentNode({offset:b,text:c,comment:a.Util.trim(d)})},createElementNode:function(b,c,d,e){return new a.htmlParser.ElementNode({offset:b,text:c,tagName:d.toLowerCase(),closing:e})},createEntityNode:function(b,c){return new a.htmlParser.EntityNode({offset:b,text:c})},createTextNode:function(b,c){return new a.htmlParser.TextNode({offset:b,text:c})}}),a.htmlParser.HtmlNode=a.Util.extend(Object,{offset:void 0,text:void 0,constructor:function(b){if(a.Util.assign(this,b),null==this.offset)throw new Error("`offset` cfg required");if(null==this.text)throw new Error("`text` cfg required")},getType:a.Util.abstractMethod,getOffset:function(){return this.offset},getText:function(){return this.text}}),a.htmlParser.CommentNode=a.Util.extend(a.htmlParser.HtmlNode,{comment:"",getType:function(){return"comment"},getComment:function(){return this.comment}}),a.htmlParser.ElementNode=a.Util.extend(a.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}}),a.htmlParser.EntityNode=a.Util.extend(a.htmlParser.HtmlNode,{getType:function(){return"entity"}}),a.htmlParser.TextNode=a.Util.extend(a.htmlParser.HtmlNode,{getType:function(){return"text"}}),a.match.Match=a.Util.extend(Object,{constructor:function(a){if(null==a.tagBuilder)throw new Error("`tagBuilder` cfg required");if(null==a.matchedText)throw new Error("`matchedText` cfg required");if(null==a.offset)throw new Error("`offset` cfg required");this.tagBuilder=a.tagBuilder,this.matchedText=a.matchedText,this.offset=a.offset},getType:a.Util.abstractMethod,getMatchedText:function(){return this.matchedText},setOffset:function(a){this.offset=a},getOffset:function(){return this.offset},getAnchorHref:a.Util.abstractMethod,getAnchorText:a.Util.abstractMethod,getCssClassSuffixes:function(){return[this.getType()]},buildTag:function(){return this.tagBuilder.build(this)}}),a.match.Email=a.Util.extend(a.match.Match,{constructor:function(b){if(a.match.Match.prototype.constructor.call(this,b),!b.email)throw new Error("`email` cfg required");this.email=b.email},getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),a.match.Hashtag=a.Util.extend(a.match.Match,{constructor:function(b){if(a.match.Match.prototype.constructor.call(this,b),!b.hashtag)throw new Error("`hashtag` cfg required");this.serviceName=b.serviceName,this.hashtag=b.hashtag},getType:function(){return"hashtag"},getServiceName:function(){return this.serviceName},getHashtag:function(){return this.hashtag},getAnchorHref:function(){var a=this.serviceName,b=this.hashtag;switch(a){case"twitter":return"https://twitter.com/hashtag/"+b;case"facebook":return"https://www.facebook.com/hashtag/"+b;case"instagram":return"https://instagram.com/explore/tags/"+b;default:throw new Error("Unknown service name to point hashtag to: ",a)}},getAnchorText:function(){return"#"+this.hashtag}}),a.match.Phone=a.Util.extend(a.match.Match,{constructor:function(b){if(a.match.Match.prototype.constructor.call(this,b),!b.number)throw new Error("`number` cfg required");if(null==b.plusSign)throw new Error("`plusSign` cfg required");this.number=b.number,this.plusSign=b.plusSign},getType:function(){return"phone"},getNumber:function(){return this.number},getAnchorHref:function(){return"tel:"+(this.plusSign?"+":"")+this.number},getAnchorText:function(){return this.matchedText}}),a.match.Mention=a.Util.extend(a.match.Match,{constructor:function(b){if(a.match.Match.prototype.constructor.call(this,b),!b.serviceName)throw new Error("`serviceName` cfg required");if(!b.mention)throw new Error("`mention` cfg required");this.mention=b.mention,this.serviceName=b.serviceName},getType:function(){return"mention"},getMention:function(){return this.mention},getServiceName:function(){return this.serviceName},getAnchorHref:function(){switch(this.serviceName){case"twitter":return"https://twitter.com/"+this.mention;case"instagram":return"https://instagram.com/"+this.mention;default:throw new Error("Unknown service name to point mention to: ",this.serviceName)}},getAnchorText:function(){return"@"+this.mention},getCssClassSuffixes:function(){var b=a.match.Match.prototype.getCssClassSuffixes.call(this),c=this.getServiceName();return c&&b.push(c),b}}),a.match.Url=a.Util.extend(a.match.Match,{constructor:function(b){if(a.match.Match.prototype.constructor.call(this,b),"scheme"!==b.urlMatchType&&"www"!==b.urlMatchType&&"tld"!==b.urlMatchType)throw new Error('`urlMatchType` cfg must be one of: "scheme", "www", or "tld"');if(!b.url)throw new Error("`url` cfg required");if(null==b.protocolUrlMatch)throw new Error("`protocolUrlMatch` cfg required");if(null==b.protocolRelativeMatch)throw new Error("`protocolRelativeMatch` cfg required");if(null==b.stripPrefix)throw new Error("`stripPrefix` cfg required");if(null==b.stripTrailingSlash)throw new Error("`stripTrailingSlash` cfg required");this.urlMatchType=b.urlMatchType,this.url=b.url,this.protocolUrlMatch=b.protocolUrlMatch,this.protocolRelativeMatch=b.protocolRelativeMatch,this.stripPrefix=b.stripPrefix,this.stripTrailingSlash=b.stripTrailingSlash},schemePrefixRegex:/^(https?:\/\/)?/i,wwwPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrlMatchType:function(){return this.urlMatchType},getUrl:function(){var a=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(a=this.url="http://"+a,this.protocolPrepended=!0),a},getAnchorHref:function(){return this.getUrl().replace(/&amp;/g,"&")},getAnchorText:function(){var a=this.getMatchedText();return this.protocolRelativeMatch&&(a=this.stripProtocolRelativePrefix(a)),this.stripPrefix.scheme&&(a=this.stripSchemePrefix(a)),this.stripPrefix.www&&(a=this.stripWwwPrefix(a)),this.stripTrailingSlash&&(a=this.removeTrailingSlash(a)),a},stripSchemePrefix:function(a){return a.replace(this.schemePrefixRegex,"")},stripWwwPrefix:function(a){return a.replace(this.wwwPrefixRegex,"$1")},stripProtocolRelativePrefix:function(a){return a.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(a){return"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),a}}),a.tldRegex=/(?:xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--clchc0ea0b2g2a9gcd|xn--w4r85el8fhu5dnra|northwesternmutual|travelersinsurance|vermgensberatung|xn--3oq18vl8pn36a|xn--5su34j936bgsg|xn--bck1b9a5dre4c|xn--mgbai9azgqp6j|xn--mgberp4a5d4ar|xn--xkc2dl3a5ee0h|vermgensberater|xn--fzys8d69uvgm|xn--mgba7c0bbn0a|xn--xkc2al3hye2a|americanexpress|kerryproperties|sandvikcoromant|xn--i1b6b1a6a2e|xn--kcrx77d1x4a|xn--lgbbat1ad8j|xn--mgba3a4f16a|xn--mgbc0a9azcg|xn--nqv7fs00ema|afamilycompany|americanfamily|bananarepublic|cancerresearch|cookingchannel|kerrylogistics|weatherchannel|xn--54b7fta0cc|xn--6qq986b3xl|xn--80aqecdr1a|xn--b4w605ferd|xn--fiq228c5hs|xn--jlq61u9w7b|xn--mgba3a3ejt|xn--mgbaam7a8h|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a71e|xn--mgbca7dzdo|xn--mgbi4ecexp|xn--mgbx4cd0ab|international|lifeinsurance|orientexpress|spreadbetting|travelchannel|wolterskluwer|xn--eckvdtc9d|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--tiq49xqyj|xn--yfro4i67o|xn--ygbi2ammx|construction|lplfinancial|pamperedchef|scholarships|versicherung|xn--3e0b707e|xn--80adxhks|xn--80asehdb|xn--8y0a063a|xn--gckr3f0f|xn--mgb9awbf|xn--mgbab2bd|xn--mgbpl2fh|xn--mgbt3dhd|xn--mk1bu44c|xn--ngbc5azd|xn--ngbe9e0a|xn--ogbpf8fl|xn--qcka1pmc|accountants|barclaycard|blackfriday|blockbuster|bridgestone|calvinklein|contractors|creditunion|engineering|enterprises|foodnetwork|investments|kerryhotels|lamborghini|motorcycles|olayangroup|photography|playstation|productions|progressive|redumbrella|rightathome|williamhill|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--3bst00m|xn--3ds443g|xn--42c2d9a|xn--45brj9c|xn--55qw42g|xn--6frz82g|xn--80ao21a|xn--9krt00a|xn--cck2b3b|xn--czr694b|xn--d1acj3b|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fjq720a|xn--flw351e|xn--g2xx48c|xn--gecrj9c|xn--gk3at1e|xn--h2brj9c|xn--hxt814e|xn--imr513n|xn--j6w193g|xn--jvr189m|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--mgbtx2b|xn--mix891f|xn--nyqy26a|xn--pbt977c|xn--pgbs0dh|xn--q9jyb4c|xn--rhqv96g|xn--rovu88b|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--vuq861b|xn--w4rs40l|xn--xhq521b|xn--zfr164b||accountant|apartments|associates|basketball|bnpparibas|boehringer|capitalone|consulting|creditcard|cuisinella|eurovision|extraspace|foundation|healthcare|immobilien|industries|management|mitsubishi|nationwide|newholland|nextdirect|onyourside|properties|protection|prudential|realestate|republican|restaurant|schaeffler|swiftcover|tatamotors|technology|telefonica|university|vistaprint|vlaanderen|volkswagen|xn--30rr7y|xn--3pxu8k|xn--45q11c|xn--4gbrim|xn--55qx5d|xn--5tzm5g|xn--80aswg|xn--90a3ac|xn--9dbq2a|xn--9et52u|xn--c2br7g|xn--cg4bki|xn--czrs0t|xn--czru2d|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--io0a7i|xn--kput3i|xn--mxtq1m|xn--o3cw4h|xn--pssy2u|xn--unup4y|xn--wgbh1c|xn--wgbl6a|xn--y9a3aq|accenture|alfaromeo|allfinanz|amsterdam|analytics|aquarelle|barcelona|bloomberg|christmas|community|directory|education|equipment|fairwinds|financial|firestone|fresenius|frontdoor|fujixerox|furniture|goldpoint|goodhands|hisamitsu|homedepot|homegoods|homesense|honeywell|institute|insurance|kuokgroup|ladbrokes|lancaster|landrover|lifestyle|marketing|marshalls|mcdonalds|melbourne|microsoft|montblanc|panasonic|passagens|pramerica|richardli|scjohnson|shangrila|solutions|statebank|statefarm|stockholm|travelers|vacations|xn--90ais|xn--c1avg|xn--d1alf|xn--e1a4c|xn--fhbei|xn--j1aef|xn--j1amh|xn--l1acc|xn--nqv7f|xn--p1acf|xn--tckwe|xn--vhquv|yodobashi|abudhabi|airforce|allstate|attorney|barclays|barefoot|bargains|baseball|boutique|bradesco|broadway|brussels|budapest|builders|business|capetown|catering|catholic|chrysler|cipriani|cityeats|cleaning|clinique|clothing|commbank|computer|delivery|deloitte|democrat|diamonds|discount|discover|download|engineer|ericsson|esurance|everbank|exchange|feedback|fidelity|firmdale|football|frontier|goodyear|grainger|graphics|guardian|hdfcbank|helsinki|holdings|hospital|infiniti|ipiranga|istanbul|jpmorgan|lighting|lundbeck|marriott|maserati|mckinsey|memorial|mortgage|movistar|observer|partners|pharmacy|pictures|plumbing|property|redstone|reliance|saarland|samsclub|security|services|shopping|showtime|softbank|software|stcgroup|supplies|symantec|telecity|training|uconnect|vanguard|ventures|verisign|woodside|xn--90ae|xn--node|xn--p1ai|xn--qxam|yokohama||abogado|academy|agakhan|alibaba|android|athleta|auction|audible|auspost|avianca|banamex|bauhaus|bentley|bestbuy|booking|brother|bugatti|capital|caravan|careers|cartier|channel|chintai|citadel|clubmed|college|cologne|comcast|company|compare|contact|cooking|corsica|country|coupons|courses|cricket|cruises|dentist|digital|domains|exposed|express|farmers|fashion|ferrari|ferrero|finance|fishing|fitness|flights|florist|flowers|forsale|frogans|fujitsu|gallery|genting|godaddy|guitars|hamburg|hangout|hitachi|holiday|hosting|hoteles|hotmail|hyundai|iselect|ismaili|jewelry|juniper|kitchen|komatsu|lacaixa|lancome|lanxess|lasalle|latrobe|leclerc|liaison|limited|lincoln|markets|metlife|monster|netbank|netflix|network|neustar|okinawa|oldnavy|organic|origins|panerai|philips|pioneer|politie|realtor|recipes|rentals|reviews|rexroth|samsung|sandvik|schmidt|schwarz|science|shiksha|shriram|singles|spiegel|staples|starhub|statoil|storage|support|surgery|systems|temasek|theater|theatre|tickets|tiffany|toshiba|trading|walmart|wanggou|watches|weather|website|wedding|whoswho|windows|winners|xfinity|yamaxun|youtube|zuerich||||||||abarth|abbott|abbvie|active|africa|agency|airbus|airtel|alipay|alsace|alstom|anquan|aramco|author|bayern|beauty|berlin|bharti|blanco|bostik|boston|broker|camera|career|caseih|casino|center|chanel|chrome|church|circle|claims|clinic|coffee|comsec|condos|coupon|credit|cruise|dating|datsun|dealer|degree|dental|design|direct|doctor|dunlop|dupont|durban|emerck|energy|estate|events|expert|family|flickr|futbol|gallup|garden|george|giving|global|google|gratis|health|hermes|hiphop|hockey|hughes|imamat|insure|intuit|jaguar|joburg|juegos|kaufen|kinder|kindle|kosher|lancia|latino|lawyer|lefrak|living|locker|london|luxury|madrid|maison|makeup|market|mattel|mobile|mobily|monash|mormon|moscow|museum|mutual|nagoya|natura|nissan|nissay|norton|nowruz|office|olayan|online|oracle|orange|otsuka|pfizer|photos|physio|piaget|pictet|quebec|racing|realty|reisen|repair|report|review|rocher|rogers|ryukyu|safety|sakura|sanofi|school|schule|secure|select|shouji|soccer|social|stream|studio|supply|suzuki|swatch|sydney|taipei|taobao|target|tattoo|tennis|tienda|tjmaxx|tkmaxx|toyota|travel|unicom|viajes|viking|villas|virgin|vision|voting|voyage|vuelos|walter|warman|webcam|xihuan|xperia|yachts|yandex|zappos||||||||||||actor|adult|aetna|amfam|amica|apple|archi|audio|autos|azure|baidu|beats|bible|bingo|black|boats|boots|bosch|build|canon|cards|chase|cheap|chloe|cisco|citic|click|cloud|coach|codes|crown|cymru|dabur|dance|deals|delta|dodge|drive|dubai|earth|edeka|email|epost|epson|faith|fedex|final|forex|forum|gallo|games|gifts|gives|glade|glass|globo|gmail|green|gripe|group|gucci|guide|homes|honda|horse|house|hyatt|ikano|intel|irish|iveco|jetzt|koeln|kyoto|lamer|lease|legal|lexus|lilly|linde|lipsy|lixil|loans|locus|lotte|lotto|lupin|macys|mango|media|miami|money|mopar|movie|nadex|nexus|nikon|ninja|nokia|nowtv|omega|osaka|paris|parts|party|phone|photo|pizza|place|poker|praxi|press|prime|promo|quest|radio|rehab|reise|ricoh|rocks|rodeo|salon|sener|seven|sharp|shell|shoes|skype|sling|smart|smile|solar|space|stada|store|study|style|sucks|swiss|tatar|tires|tirol|tmall|today|tokyo|tools|toray|total|tours|trade|trust|tunes|tushu|ubank|vegas|video|vista|vodka|volvo|wales|watch|weber|weibo|works|world|xerox|yahoo|zippo|||||||||||aarp|able|adac|aero|aigo|akdn|ally|amex|army|arpa|arte|asda|asia|audi|auto|baby|band|bank|bbva|beer|best|bike|bing|blog|blue|bofa|bond|book|buzz|cafe|call|camp|care|cars|casa|case|cash|cbre|cern|chat|citi|city|club|cool|coop|cyou|data|date|dclk|deal|dell|desi|diet|dish|docs|doha|duck|duns|dvag|erni|fage|fail|fans|farm|fast|fiat|fido|film|fire|fish|flir|food|ford|free|fund|game|gbiz|gent|ggee|gift|gmbh|gold|golf|goog|guge|guru|hair|haus|hdfc|help|here|hgtv|host|hsbc|icbc|ieee|imdb|immo|info|itau|java|jeep|jobs|jprs|kddi|kiwi|kpmg|kred|land|lego|lgbt|lidl|life|like|limo|link|live|loan|loft|love|ltda|luxe|maif|meet|meme|menu|mini|mint|mobi|moda|moto|mtpc|name|navy|news|next|nico|nike|ollo|open|page|pars|pccw|pics|ping|pink|play|plus|pohl|porn|post|prod|prof|qpon|raid|read|reit|rent|rest|rich|rmit|room|rsvp|ruhr|safe|sale|sapo|sarl|save|saxo|scor|scot|seat|seek|sexy|shaw|shia|shop|show|silk|sina|site|skin|sncf|sohu|song|sony|spot|star|surf|talk|taxi|team|tech|teva|tiaa|tips|town|toys|tube|vana|visa|viva|vivo|vote|voto|wang|weir|wien|wiki|wine|work|xbox|yoga|zara|zero|zone|||||||||||||||||||||aaa|abb|abc|aco|ads|aeg|afl|aig|anz|aol|app|art|aws|axa|bar|bbc|bbt|bcg|bcn|bet|bid|bio|biz|bms|bmw|bnl|bom|boo|bot|box|buy|bzh|cab|cal|cam|car|cat|cba|cbn|cbs|ceb|ceo|cfa|cfd|com|crs|csc|dad|day|dds|dev|dhl|diy|dnp|dog|dot|dtv|dvr|eat|eco|edu|esq|eus|fan|fit|fly|foo|fox|frl|ftr|fun|fyi|gal|gap|gdn|gea|gle|gmo|gmx|goo|gop|got|gov|hbo|hiv|hkt|hot|how|htc|ibm|ice|icu|ifm|ing|ink|int|ist|itv|iwc|jcb|jcp|jio|jlc|jll|jmp|jnj|jot|joy|kfh|kia|kim|kpn|krd|lat|law|lds|lol|lpl|ltd|man|mba|mcd|med|men|meo|mil|mit|mlb|mls|mma|moe|moi|mom|mov|msd|mtn|mtr|nab|nba|nec|net|new|nfl|ngo|nhk|now|nra|nrw|ntt|nyc|obi|off|one|ong|onl|ooo|org|ott|ovh|pay|pet|pid|pin|pnc|pro|pru|pub|pwc|qvc|red|ren|ril|rio|rip|run|rwe|sap|sas|sbi|sbs|sca|scb|ses|sew|sex|sfr|ski|sky|soy|srl|srt|stc|tab|tax|tci|tdk|tel|thd|tjx|top|trv|tui|tvs|ubs|uno|uol|ups|vet|vig|vin|vip|wed|win|wme|wow|wtc|wtf|xin|xxx|xyz|you|yun|zip|||||||||||||||||||||||||||||ac|ad|ae|af|ag|ai|al|am|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)/,a.matcher.Matcher=a.Util.extend(Object,{constructor:function(a){if(!a.tagBuilder)throw new Error("`tagBuilder` cfg required");this.tagBuilder=a.tagBuilder},parseMatches:a.Util.abstractMethod}),a.matcher.Email=a.Util.extend(a.matcher.Matcher,{matcherRegex:function(){var b=a.RegexLib.alphaNumericCharsStr,c=new RegExp("["+b+"\\-_';:&=+$.,]+@"),d=a.RegexLib.domainNameRegex,e=a.tldRegex;return new RegExp([c.source,d.source,"\\.",e.source].join(""),"gi")}(),parseMatches:function(b){for(var c,d=this.matcherRegex,e=this.tagBuilder,f=[];null!==(c=d.exec(b));){var g=c[0];f.push(new a.match.Email({tagBuilder:e,matchedText:g,offset:c.index,email:g}))}return f}}),a.matcher.Hashtag=a.Util.extend(a.matcher.Matcher,{matcherRegex:new RegExp("#[_"+a.RegexLib.alphaNumericCharsStr+"]{1,139}","g"),nonWordCharRegex:new RegExp("[^"+a.RegexLib.alphaNumericCharsStr+"]"),constructor:function(b){a.matcher.Matcher.prototype.constructor.call(this,b),this.serviceName=b.serviceName},parseMatches:function(b){for(var c,d=this.matcherRegex,e=this.nonWordCharRegex,f=this.serviceName,g=this.tagBuilder,h=[];null!==(c=d.exec(b));){var i=c.index,j=b.charAt(i-1);if(0===i||e.test(j)){var k=c[0],l=c[0].slice(1);h.push(new a.match.Hashtag({tagBuilder:g,matchedText:k,offset:i,serviceName:f,hashtag:l}))}}return h}}),a.matcher.Phone=a.Util.extend(a.matcher.Matcher,{matcherRegex:/(?:(\+)?\d{1,3}[-\040.]?)?\(?\d{3}\)?[-\040.]?\d{3}[-\040.]?\d{4}([,;]*[0-9]+#?)*/g,parseMatches:function(b){for(var c,d=this.matcherRegex,e=this.tagBuilder,f=[];null!==(c=d.exec(b));){var g=c[0],h=g.replace(/[^0-9,;#]/g,""),i=!!c[1];/\D/.test(c[2])&&/\D/.test(g)&&f.push(new a.match.Phone({tagBuilder:e,matchedText:g,offset:c.index,number:h,plusSign:i}))}return f}}),a.matcher.Mention=a.Util.extend(a.matcher.Matcher,{matcherRegexes:{twitter:new RegExp("@[_"+a.RegexLib.alphaNumericCharsStr+"]{1,20}","g"),instagram:new RegExp("@[_."+a.RegexLib.alphaNumericCharsStr+"]{1,50}","g")},nonWordCharRegex:new RegExp("[^"+a.RegexLib.alphaNumericCharsStr+"]"),constructor:function(b){a.matcher.Matcher.prototype.constructor.call(this,b),this.serviceName=b.serviceName},parseMatches:function(b){var c,d=this.matcherRegexes[this.serviceName],e=this.nonWordCharRegex,f=this.serviceName,g=this.tagBuilder,h=[];if(!d)return h;for(;null!==(c=d.exec(b));){var i=c.index,j=b.charAt(i-1);if(0===i||e.test(j)){var k=c[0].replace(/\.+$/g,""),l=k.slice(1);h.push(new a.match.Mention({tagBuilder:g,matchedText:k,offset:i,serviceName:f,mention:l}))}}return h}}),a.matcher.Url=a.Util.extend(a.matcher.Matcher,{matcherRegex:function(){var b=a.RegexLib.domainNameRegex,c=a.tldRegex,d=a.RegexLib.alphaNumericCharsStr,e=new RegExp("[/?#](?:["+d+"\\-+&@#/%=~_()|'$*\\[\\]?!:,.;]*["+d+"\\-+&@#/%=~_()|'$*\\[\\]])?");return new RegExp(["(?:","(",/(?:[A-Za-z][-.+A-Za-z0-9]*:(?![A-Za-z][-.+A-Za-z0-9]*:\/\/)(?!\d+\/?)(?:\/\/)?)/.source,b.source,")","|","(","(//)?",/(?:www\.)/.source,b.source,")","|","(","(//)?",b.source+"\\.",c.source,"(?![-"+d+"])",")",")","(?::[0-9]+)?","(?:"+e.source+")?"].join(""),"gi")}(),wordCharRegExp:new RegExp("["+a.RegexLib.alphaNumericCharsStr+"]"),openParensRe:/\(/g,closeParensRe:/\)/g,constructor:function(b){if(a.matcher.Matcher.prototype.constructor.call(this,b),null==b.stripPrefix)throw new Error("`stripPrefix` cfg required");if(null==b.stripTrailingSlash)throw new Error("`stripTrailingSlash` cfg required");this.stripPrefix=b.stripPrefix,this.stripTrailingSlash=b.stripTrailingSlash},parseMatches:function(b){for(var c,d=this.matcherRegex,e=this.stripPrefix,f=this.stripTrailingSlash,g=this.tagBuilder,h=[];null!==(c=d.exec(b));){var i=c[0],j=c[1],k=c[2],l=c[3],m=c[5],n=c.index,o=l||m,p=b.charAt(n-1);if(a.matcher.UrlMatchValidator.isValid(i,j)&&!(n>0&&"@"===p||n>0&&o&&this.wordCharRegExp.test(p))){if(/\?$/.test(i)&&(i=i.substr(0,i.length-1)),this.matchHasUnbalancedClosingParen(i))i=i.substr(0,i.length-1);else{var q=this.matchHasInvalidCharAfterTld(i,j);q>-1&&(i=i.substr(0,q))}var r=j?"scheme":k?"www":"tld",s=!!j;h.push(new a.match.Url({tagBuilder:g,matchedText:i,offset:n,urlMatchType:r,url:i,protocolUrlMatch:s,protocolRelativeMatch:!!o,stripPrefix:e,stripTrailingSlash:f}))}}return h},matchHasUnbalancedClosingParen:function(a){if(")"===a.charAt(a.length-1)){var b=a.match(this.openParensRe),c=a.match(this.closeParensRe);if((b&&b.length||0)<(c&&c.length||0))return!0}return!1},matchHasInvalidCharAfterTld:function(b,c){if(!b)return-1;var d=0;c&&(d=b.indexOf(":"),b=b.slice(d));var e=a.RegexLib.alphaNumericCharsStr,f=new RegExp("^((.?//)?[-."+e+"]*[-"+e+"]\\.[-"+e+"]+)"),g=f.exec(b);return null===g?-1:(d+=g[1].length,b=b.slice(g[1].length),/^[^-.A-Za-z0-9:\/?#]/.test(b)?d:-1)}}),a.matcher.UrlMatchValidator={hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]*:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]*:/,hasWordCharAfterProtocolRegex:new RegExp(":[^\\s]*?["+a.RegexLib.alphaCharsStr+"]"),ipRegex:/[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?\.[0-9][0-9]?[0-9]?(:[0-9]*)?\/?$/,isValid:function(a,b){return!(b&&!this.isValidUriScheme(b)||this.urlMatchDoesNotHaveProtocolOrDot(a,b)||this.urlMatchDoesNotHaveAtLeastOneWordChar(a,b)&&!this.isValidIpAddress(a)||this.containsMultipleDots(a))},isValidIpAddress:function(a){var b=new RegExp(this.hasFullProtocolRegex.source+this.ipRegex.source);return null!==a.match(b)},containsMultipleDots:function(a){return a.indexOf("..")>-1},isValidUriScheme:function(a){var b=a.match(this.uriSchemeRegex)[0].toLowerCase();return"javascript:"!==b&&"vbscript:"!==b},urlMatchDoesNotHaveProtocolOrDot:function(a,b){return!(!a||b&&this.hasFullProtocolRegex.test(b)||a.indexOf(".")!==-1)},urlMatchDoesNotHaveAtLeastOneWordChar:function(a,b){return!(!a||!b)&&!this.hasWordCharAfterProtocolRegex.test(a)}},a.truncate.TruncateEnd=function(b,c,d){return a.Util.ellipsis(b,c,d)},a.truncate.TruncateMiddle=function(a,b,c){if(a.length<=b)return a;var d,e;null==c?(c="&hellip;",d=8,e=3):(d=c.length,e=c.length);var f=b-e,g="";return f>0&&(g=a.substr(-1*Math.floor(f/2))),(a.substr(0,Math.ceil(f/2))+c+g).substr(0,f+d)},a.truncate.TruncateSmart=function(a,b,c){var d,e;null==c?(c="&hellip;",e=3,d=8):(e=c.length,d=c.length);var f=function(a){var b="";return a.scheme&&a.host&&(b+=a.scheme+"://"),a.host&&(b+=a.host),a.path&&(b+="/"+a.path),a.query&&(b+="?"+a.query),a.fragment&&(b+="#"+a.fragment),b},g=function(a,b){var d=b/2,e=Math.ceil(d),f=-1*Math.floor(d),g="";return f<0&&(g=a.substr(f)),a.substr(0,e)+c+g};if(a.length<=b)return a;var h=b-e,i=function(a){var b={},c=a,d=c.match(/^([a-z]+):\/\//i);return d&&(b.scheme=d[1],c=c.substr(d[0].length)),d=c.match(/^(.*?)(?=(\?|#|\/|$))/i),d&&(b.host=d[1],c=c.substr(d[0].length)),d=c.match(/^\/(.*?)(?=(\?|#|$))/i),d&&(b.path=d[1],c=c.substr(d[0].length)),d=c.match(/^\?(.*?)(?=(#|$))/i),d&&(b.query=d[1],c=c.substr(d[0].length)),d=c.match(/^#(.*?)$/i),d&&(b.fragment=d[1]),b}(a);if(i.query){var j=i.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);j&&(i.query=i.query.substr(0,j[1].length),a=f(i))}if(a.length<=b)return a;if(i.host&&(i.host=i.host.replace(/^www\./,""),a=f(i)),a.length<=b)return a;var k="";if(i.host&&(k+=i.host),k.length>=h)return i.host.length==b?(i.host.substr(0,b-e)+c).substr(0,h+d):g(k,h).substr(0,h+d);var l="";if(i.path&&(l+="/"+i.path),i.query&&(l+="?"+i.query),l){if((k+l).length>=h){if((k+l).length==b)return(k+l).substr(0,b);return(k+g(l,h-k.length)).substr(0,h+d)}k+=l}if(i.fragment){var m="#"+i.fragment;if((k+m).length>=h){if((k+m).length==b)return(k+m).substr(0,b);return(k+g(m,h-k.length)).substr(0,h+d)}k+=m}if(i.scheme&&i.host){var n=i.scheme+"://";if((k+n).length<h)return(n+k).substr(0,b)}if(k.length<=b)return k;var o="";return h>0&&(o=k.substr(-1*Math.floor(h/2))),(k.substr(0,Math.ceil(h/2))+c+o).substr(0,h+d)},a})},{}],61:[function(a,b,c){!function(c){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],c):"object"==typeof b&&b.exports?c(a("./load-image"),a("./load-image-meta")):c(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(d=[],e=0;e<c;e+=1)f=a.getUint8(b+e),d.push((f<16?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return void console.log("Invalid Exif data: Invalid tag type.");if(h=n.size*f,(i=h>4?c+b.getUint32(d+8,g):d+8)+h>b.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return n.getValue(b,i,g);for(j=[],
k=0;k<f;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&"\0"!==(m=j[k]);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=a.getUint16(c,d),(g=c+2+12*f)+4>a.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(h=0;h<f;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(c+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(j+2,g))return void console.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)})},{"./load-image":65,"./load-image-meta":62}],62:[function(a,b,c){!function(c){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],c):c("object"==typeof b&&b.exports?a("./load-image"):window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d,e){d=d||{},e=e||{};var f=this,g=d.maxMetaDataSize||262144;!!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice)&&a.readFile(a.blobSlice.call(b,0,g),function(b){if(b.target.error)return console.log(b.target.error),void c(e);var g,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;m<n&&((g=l.getUint16(m))>=65504&&g<=65519||65534===g);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[g])for(j=0;j<i.length;j+=1)i[j].call(f,l,m,h,e,d);m+=h,o=m}!d.disableImageHead&&o>6&&(k.slice?e.imageHead=k.slice(0,o):e.imageHead=new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(e)},"readAsArrayBuffer")||c(e)},a.hasMetaOption=function(a){return a&&a.meta};var c=a.transform;a.transform=function(b,d,e,f,g){a.hasMetaOption(d)?a.parseMetaData(f,function(g){c.call(a,b,d,e,f,g)},d,g):c.apply(a,arguments)}})},{"./load-image":65}],63:[function(a,b,c){!function(c){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],c):"object"==typeof b&&b.exports?c(a("./load-image"),a("./load-image-scale"),a("./load-image-meta")):c(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption,c=a.hasMetaOption,d=a.transformCoordinates,e=a.getTransformedOptions;a.hasCanvasOption=function(c){return!!c.orientation||b.call(a,c)},a.hasMetaOption=function(b){return b&&b.orientation===!0||c.call(a,b)},a.transformCoordinates=function(b,c){d.call(a,b,c);var e=b.getContext("2d"),f=b.width,g=b.height,h=b.style.width,i=b.style.height,j=c.orientation;if(j&&!(j>8))switch(j>4&&(b.width=g,b.height=f,b.style.width=i,b.style.height=h),j){case 2:e.translate(f,0),e.scale(-1,1);break;case 3:e.translate(f,g),e.rotate(Math.PI);break;case 4:e.translate(0,g),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-g);break;case 7:e.rotate(.5*Math.PI),e.translate(f,-g),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-f,0)}},a.getTransformedOptions=function(b,c,d){var f,g,h=e.call(a,b,c),i=h.orientation;if(i===!0&&d&&d.exif&&(i=d.exif.get("Orientation")),!i||i>8||1===i)return h;f={};for(g in h)h.hasOwnProperty(g)&&(f[g]=h[g]);switch(f.orientation=i,i){case 2:f.left=h.right,f.right=h.left;break;case 3:f.left=h.right,f.top=h.bottom,f.right=h.left,f.bottom=h.top;break;case 4:f.top=h.bottom,f.bottom=h.top;break;case 5:f.left=h.top,f.top=h.left,f.right=h.bottom,f.bottom=h.right;break;case 6:f.left=h.top,f.top=h.right,f.right=h.bottom,f.bottom=h.left;break;case 7:f.left=h.bottom,f.top=h.right,f.right=h.top,f.bottom=h.left;break;case 8:f.left=h.bottom,f.top=h.left,f.right=h.top,f.bottom=h.right}return f.orientation>4&&(f.maxWidth=h.maxHeight,f.maxHeight=h.maxWidth,f.minWidth=h.minHeight,f.minHeight=h.minWidth,f.sourceWidth=h.sourceHeight,f.sourceHeight=h.sourceWidth),f}})},{"./load-image":65,"./load-image-meta":62,"./load-image-scale":64}],64:[function(a,b,c){!function(c){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],c):c("object"==typeof b&&b.exports?a("./load-image"):window.loadImage)}(function(a){"use strict";var b=a.transform;a.transform=function(c,d,e,f,g){b.call(a,a.scale(c,d,g),d,e,f,g)},a.transformCoordinates=function(){},a.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},a.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},a.hasCanvasOption=function(a){return a.canvas||a.crop||!!a.aspectRatio},a.scale=function(b,c,d){function e(){var a=Math.max((i||v)/v,(j||w)/w);a>1&&(v*=a,w*=a)}function f(){var a=Math.min((g||v)/v,(h||w)/w);a<1&&(v*=a,w*=a)}c=c||{};var g,h,i,j,k,l,m,n,o,p,q,r=document.createElement("canvas"),s=b.getContext||a.hasCanvasOption(c)&&r.getContext,t=b.naturalWidth||b.width,u=b.naturalHeight||b.height,v=t,w=u;if(s&&(c=a.getTransformedOptions(b,c,d),m=c.left||0,n=c.top||0,c.sourceWidth?(k=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(m=t-k-c.right)):k=t-m-(c.right||0),c.sourceHeight?(l=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(n=u-l-c.bottom)):l=u-n-(c.bottom||0),v=k,w=l),g=c.maxWidth,h=c.maxHeight,i=c.minWidth,j=c.minHeight,s&&g&&h&&c.crop?(v=g,w=h,q=k/l-g/h,q<0?(l=h*k/g,void 0===c.top&&void 0===c.bottom&&(n=(u-l)/2)):q>0&&(k=g*l/h,void 0===c.left&&void 0===c.right&&(m=(t-k)/2))):((c.contain||c.cover)&&(i=g=g||i,j=h=h||j),c.cover?(f(),e()):(e(),f())),s){if(o=c.pixelRatio,o>1&&(r.style.width=v+"px",r.style.height=w+"px",v*=o,w*=o,r.getContext("2d").scale(o,o)),(p=c.downsamplingRatio)>0&&p<1&&v<k&&w<l)for(;k*p>v;)r.width=k*p,r.height=l*p,a.renderImageToCanvas(r,b,m,n,k,l,0,0,r.width,r.height),m=0,n=0,k=r.width,l=r.height,b=document.createElement("canvas"),b.width=k,b.height=l,a.renderImageToCanvas(b,r,0,0,k,l,0,0,k,l);return r.width=v,r.height=w,a.transformCoordinates(r,c),a.renderImageToCanvas(r,b,m,n,k,l,0,0,v,w)}return b.width=v,b.height=w,b}})},{"./load-image":65}],65:[function(a,b,c){!function(a){"use strict";function c(a,b,d){var e,f=document.createElement("img");return f.onerror=function(e){return c.onerror(f,e,a,b,d)},f.onload=function(e){return c.onload(f,e,a,b,d)},"string"==typeof a?(c.fetchBlob(a,function(b){b?(a=b,e=c.createObjectURL(a)):(e=a,d&&d.crossOrigin&&(f.crossOrigin=d.crossOrigin)),f.src=e},d),f):c.isInstanceOf("Blob",a)||c.isInstanceOf("File",a)?(e=f._objectURL=c.createObjectURL(a),e?(f.src=e,f):c.readFile(a,function(a){var c=a.target;c&&c.result?f.src=c.result:b&&b(a)})):void 0}function d(a,b){!a._objectURL||b&&b.noRevoke||(c.revokeObjectURL(a._objectURL),delete a._objectURL)}var e=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;c.fetchBlob=function(a,b,c){b()},c.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},c.transform=function(a,b,c,d,e){c(a,e)},c.onerror=function(a,b,c,e,f){d(a,f),e&&e.call(a,b)},c.onload=function(a,b,e,f,g){d(a,g),f&&c.transform(a,g,f,e,{})},c.createObjectURL=function(a){return!!e&&e.createObjectURL(a)},c.revokeObjectURL=function(a){return!!e&&e.revokeObjectURL(a)},c.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return c}):"object"==typeof b&&b.exports?b.exports=c:a.loadImage=c}(window)},{}],66:[function(a,b,c){(function(a){b.exports=a.layer}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],67:[function(a,b,c){!function(a,d){"object"==typeof c&&void 0!==b?d(c):"function"==typeof define&&define.amd?define(["exports"],d):d(a.Notify=a.Notify||{})}(this,function(a){"use strict";function b(a){return"function"==typeof a}function c(a){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if("string"!=typeof a)throw new Error("Notify(): first arg (title) must be a string.");if("object"!=typeof c)throw new Error("Notify(): second arg (options) must be an object.");var e=c.notifyShow,f=void 0===e?null:e,g=c.notifyClose,h=void 0===g?null:g,i=c.notifyClick,j=void 0===i?null:i,k=c.notifyError,l=void 0===k?null:k,m=c.closeOnClick,n=void 0!==m&&m,o=c.timeout,p=void 0===o?null:o,q=d(c,["notifyShow","notifyClose","notifyClick","notifyError","closeOnClick","timeout"]);this.title=a,this.options=q,this.permission=null,this.closeOnClick=n,this.timeout=p,b(f)&&(this.onShowCallback=f),b(h)&&(this.onCloseCallback=h),b(j)&&(this.onClickCallback=j),b(l)&&(this.onErrorCallback=l)}var d=function(a,b){var c={};for(var d in a)b.indexOf(d)>=0||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c},e=window.Notification;c.isSupported=function(a){if(!e||!e.requestPermission)return!1;if("granted"===a||"granted"===e.permission)throw new Error("You must only call this before calling Notification.requestPermission(), otherwise this feature detect would trigger an actual notification!");try{new e("")}catch(a){if("TypeError"===a.name)return!1}return!0},c.needsPermission=!e||!e.permission||"granted"!==e.permission,c.requestPermission=function(a,d){e.requestPermission(function(e){switch(e){case"granted":c.needsPermission=!1,b(a)&&a();break;case"denied":c.needsPermission=!0,b(d)&&d()}})},c.prototype.show=function(){this.myNotify=new e(this.title,this.options),this.options.requireInteraction||!this.timeout||isNaN(this.timeout)||setTimeout(this.close.bind(this),1e3*this.timeout),this.myNotify.addEventListener("show",this,!1),this.myNotify.addEventListener("error",this,!1),this.myNotify.addEventListener("close",this,!1),this.myNotify.addEventListener("click",this,!1)},c.prototype.onShowNotification=function(a){this.onShowCallback&&this.onShowCallback(a)},c.prototype.onCloseNotification=function(a){this.onCloseCallback&&this.onCloseCallback(a),this.destroy()},c.prototype.onClickNotification=function(a){this.onClickCallback&&this.onClickCallback(a),this.closeOnClick&&this.close()},c.prototype.onErrorNotification=function(a){this.onErrorCallback&&this.onErrorCallback(a),this.destroy()},c.prototype.destroy=function(){this.myNotify.removeEventListener("show",this,!1),this.myNotify.removeEventListener("error",this,!1),this.myNotify.removeEventListener("close",this,!1),this.myNotify.removeEventListener("click",this,!1)},c.prototype.close=function(){this.myNotify.close()},c.prototype.handleEvent=function(a){switch(a.type){case"show":this.onShowNotification(a);break;case"close":this.onCloseNotification(a);break;case"click":this.onClickNotification(a);break;case"error":this.onErrorNotification(a)}},a.default=c})},{}],68:[function(a,b,c){b.exports={":alarm_clock:":"",":anchor:":"",":aquarius:":"",":aries:":"",":arrow_backward:":"",":arrow_double_down:":"",":arrow_double_up:":"",":arrow_down:":"",":arrow_forward:":"",":arrow_heading_down:":"",":arrow_heading_up:":"",":arrow_left:":"",":arrow_lower_left:":"",":arrow_lower_right:":"",":arrow_right:":"",":arrow_right_hook:":"",":arrow_up:":"",":arrow_up_down:":"",":arrow_upper_left:":"",":arrow_upper_right:":"",":ballot_box_with_check:":"",":bangbang:":"",":cancer:":"",":baseball:":"",":black_large_square:":"",":black_medium_small_square:":"",":black_medium_square:":"",":black_nib:":"",":black_small_square:":"",":black_circle:":"",":boat:":"",":capricorn:":"",":church:":"",":cloud:":"",":clubs:":"",":coffee:":"",":congratulations:":"",":copyright:":"",":curly_loop:":"",":eight_pointed_black_star:":"",":eight_spoked_asterisk:":"",":diamonds:":"",":email:":"",":envelope:":"",":exclamation:":"",":fast_forward:":"",":fist:":"",":fountain:":"",":fuelpump:":"",":gemini:":"",":golf:":"",":grey_exclamation:":"",":grey_question:":"",":hand:":"",":heart:":"",":hearts:":"",":heavy_check_mark:":"",":heavy_division_sign:":"",":heavy_exclamation_mark:":"",":heavy_minus_sign:":"",":heavy_multiplication_x:":"",":heavy_plus_sign:":"",":hotsprings:":"",":hourglass:":"",":hourglass_flowing_sand:":"",":information_source:":"",":interrobang:":"",":left_right_arrow:":"",":leftwards_arrow_with_hook:":"",":leo:":"",":libra:":"",":loop:":"",":m:":"",":negative_squared_cross_mark:":"",":no_entry:":"",":o:":"",":ophiuchus:":"",":part_alternation_mark:":"",":partly_sunny:":"",":pencil2:":"",":phone:":"",":pisces:":"",":point_up:":"",":question:":"",":raised_hand:":"",":recycle:":"",":registered:":"",":relaxed:":"",":rewind:":"",":sagittarius:":"",":sailboat:":"",":scissors:":"",":scorpius:":"",":secret:":"",":snowflake:":"",":snowman:":"",":soccer:":"",":spades:":"",":sparkle:":"",":sparkles:":"",":star:":"",":sunny:":"",":taurus:":"",":telephone:":"",":tent:":"",":tm:":"",":umbrella:":"",":v:":"",":virgo:":"",":warning:":"",":watch:":"",":wavy_dash:":"",":wheelchair:":"",":white_check_mark:":"",":white_circle:":"",":white_large_square:":"",":white_medium_small_square:":"",":white_medium_square:":"",":white_small_square:":"",":x:":"",":zap:":"",":airplane:":"",":+1:":"",":-1:":"",":100:":"",":1234:":"",":8ball:":"",":a:":"",":ab:":"",":abc:":"",":abcd:":"",":accept:":"",":aerial_tramway:":"",":alien:":"",":ambulance:":"",":angel:":"",":anger:":"",":angry:":"",":-||":"",":@":"",">:(":"",":anguished:":"",":ant:":"",":apple:":"",":arrow_down_small:":"",":arrow_up_small:":"",":arrows_clockwise:":"",":arrows_counterclockwise:":"",":art:":"",":articulated_lorry:":"",":astonished:":"",":athletic_shoe:":"",":atm:":"",":b:":"",":baby:":"",":baby_bottle:":"",":baby_chick:":"",":baby_symbol:":"",":back:":"",":baggage_claim:":"",":balloon:":"",":bamboo:":"",":banana:":"",":bank:":"",":bar_chart:":"",":barber:":"",":basketball:":"",":bath:":"",":bathtub:":"",":battery:":"",":bear:":"",":bee:":"",":beer:":"",":beers:":"",":beetle:":"",":beginner:":"",":bell:":"",":bento:":"",":bicyclist:":"",":bike:":"",":bikini:":"",":bird:":"",":birthday:":"",":black_joker:":"",":black_square_button:":"",":blossom:":"",":blowfish:":"",":blue_book:":"",":blue_car:":"",":blue_heart:":"",":blush:":"",":$":"",":boar:":"",":bomb:":"",":book:":"",":bookmark:":"",":bookmark_tabs:":"",":books:":"",":boom:":"",":boot:":"",":bouquet:":"",":bow:":"",":bowling:":"",":boy:":"",":bread:":"",":bride_with_veil:":"",":bridge_at_night:":"",":briefcase:":"",":broken_heart:":"",":bug:":"",":bulb:":"",":bullettrain_front:":"",":bullettrain_side:":"",":bus:":"",":busstop:":"",":bust_in_silhouette:":"",":busts_in_silhouette:":"",":cactus:":"",":cake:":"",":calendar:":"",":calling:":"",":camel:":"",":camera:":"",":candy:":"",":capital_abcd:":"",":car:":"",":card_index:":"",":carousel_horse:":"",":cat:":"",":cat2:":"",":cd:":"",":chart:":"",":chart_with_downwards_trend:":"",":chart_with_upwards_trend:":"",":checkered_flag:":"",":cherries:":"",":cherry_blossom:":"",":chestnut:":"",":chicken:":"",":children_crossing:":"",":chocolate_bar:":"",":christmas_tree:":"",":cinema:":"",":circus_tent:":"",":city_sunrise:":"",":city_sunset:":"",":cl:":"",":clap:":"",":clapper:":"",":clipboard:":"",":clock1:":"",":clock10:":"",":clock1030:":"",":clock11:":"",":clock1130:":"",":clock12:":"",":clock1230:":"",":clock130:":"",":clock2:":"",":clock230:":"",":clock3:":"",":clock330:":"",":clock4:":"",":clock430:":"",":clock5:":"",":clock530:":"",":clock6:":"",":clock630:":"",":clock7:":"",":clock730:":"",":clock8:":"",":clock830:":"",":clock9:":"",":clock930:":"",":closed_book:":"",":closed_lock_with_key:":"",":closed_umbrella:":"",":cocktail:":"",":cold_sweat:":"",":collision:":"",":computer:":"",":confetti_ball:":"",":confounded:":"",":confused:":"","%-)":"","%)":"",":construction:":"",":construction_worker:":"",":convenience_store:":"",":cookie:":"",":cool:":"",":cop:":"",":corn:":"",":couple:":"",":couple_with_heart:":"",":couplekiss:":"",":cow:":"",":cow2:":"",":credit_card:":"",":crocodile:":"",":crossed_flags:":"",":crown:":"",":cry:":"",":'(":"",":-'(":"",":crying_cat_face:":"",":crystal_ball:":"",":cupid:":"",":currency_exchange:":"",":curry:":"",":custard:":"",":customs:":"",":cyclone:":"",":dancer:":"",":dancers:":"",":dango:":"",":dart:":"",":dash:":"",":date:":"",":deciduous_tree:":"",":department_store:":"",":diamond_shape_with_a_dot_inside:":"",":disappointed:":"",":disappointed_relieved:":"",":dizzy:":"",":dizzy_face:":"",":do_not_litter:":"",":dog:":"",":dog2:":"",":dollar:":"",":dolls:":"",":dolphin:":"",":door:":"",":doughnut:":"",":dragon:":"",":dragon_face:":"",":dress:":"",":dromedary_camel:":"",":droplet:":"",":dvd:":"",":e-mail:":"",":ear:":"",":ear_of_rice:":"",":earth_africa:":"",":earth_americas:":"",":earth_asia:":"",":egg:":"",":eggplant:":"",":electric_plug:":"",":elephant:":"",":end:":"",":envelope_with_arrow:":"",":euro:":"",":european_castle:":"",":european_post_office:":"",":evergreen_tree:":"",":expressionless:":"",":eyeglasses:":"",":eyes:":"",":facepunch:":"",":factory:":"",":fallen_leaf:":"",":family:":"",":fax:":"",":fearful:":"",":feet:":"",":ferris_wheel:":"",":file_folder:":"",":fire:":"",":fire_engine:":"",":fireworks:":"",":first_quarter_moon:":"",":first_quarter_moon_with_face:":"",":fish:":"",":fish_cake:":"",":fishing_pole_and_fish:":"",":flags:":"",":flashlight:":"",":floppy_disk:":"",":flower_playing_cards:":"",":flushed:":"",":foggy:":"",":football:":"",":footprints:":"",":fork_and_knife:":"",":four_leaf_clover:":"",":free:":"",":fried_shrimp:":"",":fries:":"",":frog:":"",":frowning:":"",":(":"",":-(":"",":-[":"",":[":"",":full_moon:":"",":full_moon_with_face:":"",":game_die:":"",":gem:":"",":ghost:":"",":gift:":"",":gift_heart:":"",":girl:":"",":globe_with_meridians:":"",":goat:":"",":grapes:":"",":green_apple:":"",":green_book:":"",":green_heart:":"",":grimacing:":"",":grin:":"",xD:"","x-D":"",XD:"","X-D":"",":grinning:":"",":guardsman:":"",":guitar:":"",":gun:":"",":haircut:":"",":hamburger:":"",":hammer:":"",":hamster:":"",":handbag:":"",":hankey:":"",":hatched_chick:":"",":hatching_chick:":"",":headphones:":"",":hear_no_evil:":"",":heart_decoration:":"",":heart_eyes:":"",":heart_eyes_cat:":"",":heartbeat:":"",":heartpulse:":"",":heavy_dollar_sign:":"",":helicopter:":"",":herb:":"",":hibiscus:":"",":high_brightness:":"",":high_heel:":"",":hocho:":"",":honey_pot:":"",":honeybee:":"",":horse:":"",":horse_racing:":"",":hospital:":"",":hotel:":"",":house:":"",":house_with_garden:":"",":hushed:":"",":ice_cream:":"",":icecream:":"",":id:":"",":ideograph_advantage:":"",":imp:":"",":inbox_tray:":"",":incoming_envelope:":"",":information_desk_person:":"",":innocent:":"",":halo:":"","0:-)":"","0:)":"","0:3":"","0:-3":"",":iphone:":"",":izakaya_lantern:":"",":jack_o_lantern:":"",":japan:":"",":japanese_castle:":"",":japanese_goblin:":"",":japanese_ogre:":"",":jeans:":"",":joy:":"",":joy_cat:":"",":key:":"",":keycap_ten:":"",":kimono:":"",":kiss:":"",":kissing:":"",":*":"",":^*":"",":kissing_cat:":"",":kissing_closed_eyes:":"",":kissing_heart:":"",":kissing_smiling_eyes:":"",":koala:":"",":koko:":"",":large_blue_circle:":"",":large_blue_diamond:":"",":large_orange_diamond:":"",":last_quarter_moon:":"",":last_quarter_moon_with_face:":"",":laughing:":"",":laugh:":"",":-D":"",":D":"",":leaves:":"",":ledger:":"",":left_luggage:":"",":lemon:":"",":leopard:":"",":light_rail:":"",":link:":"",":lips:":"",":lipstick:":"",":lock:":"",":lock_with_ink_pen:":"",":lollipop:":"",":loudspeaker:":"",":love_hotel:":"",":love_letter:":"",":low_brightness:":"",":mag:":"",":mag_right:":"",":mahjong:":"",":mailbox:":"",":mailbox_closed:":"",":mailbox_with_mail:":"",":mailbox_with_no_mail:":"",":man:":"",":man_with_gua_pi_mao:":"",":man_with_turban:":"",":mans_shoe:":"",":maple_leaf:":"",":mask:":"",":massage:":"",":meat_on_bone:":"",":mega:":"",":melon:":"",":memo:":"",":mens:":"",":metro:":"",":microphone:":"",":microscope:":"",":milky_way:":"",":minibus:":"",":minidisc:":"",":mobile_phone_off:":"",":money_with_wings:":"",":moneybag:":"",":monkey:":"",":monkey_face:":"",":monorail:":"",":moon:":"",":mortar_board:":"",":mount_fuji:":"",":mountain_bicyclist:":"",":mountain_cableway:":"",":mountain_railway:":"",":mouse:":"",":mouse2:":"",":movie_camera:":"",":moyai:":"",":muscle:":"",":mushroom:":"",":musical_keyboard:":"",":musical_note:":"",":musical_score:":"",":mute:":"",":nail_care:":"",":name_badge:":"",":necktie:":"",":neutral_face:":"",":|":"",":-|":"",":new:":"",":new_moon:":"",":new_moon_with_face:":"",":newspaper:":"",":ng:":"",":no_bell:":"",":no_bicycles:":"",":no_entry_sign:":"",":no_good:":"",":no_mobile_phones:":"",":no_mouth:":"",":no_pedestrians:":"",":no_smoking:":"",":non-potable_water:":"",":nose:":"",":notebook:":"",":notebook_with_decorative_cover:":"",":notes:":"",":nut_and_bolt:":"",":o2:":"",":ocean:":"",":octopus:":"",":oden:":"",":office:":"",":ok:":"",":ok_hand:":"",":ok_woman:":"",":older_man:":"",":older_woman:":"",":on:":"",":oncoming_automobile:":"",":oncoming_bus:":"",":oncoming_police_car:":"",":oncoming_taxi:":"",":open_book:":"",":open_file_folder:":"",":open_hands:":"",":open_mouth:":"",":O":"",":-O":"",":-o":"",":o":"",":orange_book:":"",":outbox_tray:":"",":ox:":"",":package:":"",":page_facing_up:":"",":page_with_curl:":"",":pager:":"",":palm_tree:":"",":panda_face:":"",":paperclip:":"",":parking:":"",":passport_control:":"",":paw_prints:":"",":peach:":"",":pear:":"",":pencil:":"",":penguin:":"",":pensive:":"",":performing_arts:":"",":persevere:":"",":person_frowning:":"",":person_with_blond_hair:":"",":person_with_pouting_face:":"",":pig:":"",":pig2:":"",":pig_nose:":"",":pill:":"",":pineapple:":"",":pizza:":"",":point_down:":"",":point_left:":"",":point_right:":"",":point_up_2:":"",":police_car:":"",":poodle:":"",":poop:":"",":post_office:":"",":postal_horn:":"",":postbox:":"",":potable_water:":"",":pouch:":"",":poultry_leg:":"",":pound:":"",":pouting_cat:":"",":pray:":"",":princess:":"",":punch:":"",":purple_heart:":"",":purse:":"",":pushpin:":"",":put_litter_in_its_place:":"",":rabbit:":"",":rabbit2:":"",":racehorse:":"",":radio:":"",":radio_button:":"",":rage:":"",":railway_car:":"",":rainbow:":"",":raised_hands:":"",":raising_hand:":"",":ram:":"",":ramen:":"",":rat:":"",":red_car:":"",":red_circle:":"",":relieved:":"",":repeat:":"",":repeat_one:":"",":restroom:":"",":revolving_hearts:":"",":ribbon:":"",":rice:":"",":rice_ball:":"",":rice_cracker:":"",":rice_scene:":"",":ring:":"",":rocket:":"",":roller_coaster:":"",":rooster:":"",":rose:":"",":rotating_light:":"",":round_pushpin:":"",":rowboat:":"",":rugby_football:":"",":runner:":"",":running:":"",":running_shirt_with_sash:":"",":sa:":"",":sake:":"",":sandal:":"",":santa:":"",":satellite:":"",":satisfied:":"",":saxophone:":"",":school:":"",":school_satchel:":"",":scream:":"",":scream_cat:":"",":scroll:":"",":seat:":"",":see_no_evil:":"",":seedling:":"",":shaved_ice:":"",":sheep:":"",":shell:":"",":ship:":"",":shirt:":"",":shit:":"",":shoe:":"",":shower:":"",":signal_strength:":"",":six_pointed_star:":"",":ski:":"",":skull:":"",":sleeping:":"",":sleepy:":"",":slot_machine:":"",":small_blue_diamond:":"",":small_orange_diamond:":"",":small_red_triangle:":"",":small_red_triangle_down:":"",":smile:":"",":))":"",":-))":"",":smile_cat:":"",":smiley:":"",":-)":"",":)":"",":]":"",":o)":"",":smiley_cat:":"",":smiling_imp:":"","}:-)":"","3:-)":"","}:)":"","3:)":"",":smirk:":"",":smirk_cat:":"",":smoking:":"",":snail:":"",":snake:":"",":snowboarder:":"",":sob:":"",":soon:":"",":sos:":"",":sound:":"",":space_invader:":"",":spaghetti:":"",":sparkler:":"",":sparkling_heart:":"",":speak_no_evil:":"",":speaker:":"",":speech_balloon:":"",":speedboat:":"",":star2:":"",":stars:":"",":station:":"",":statue_of_liberty:":"",":steam_locomotive:":"",":stew:":"",":straight_ruler:":"",":strawberry:":"",":stuck_out_tongue:":"",":P":"",":-P":"",":-p":"",":p":"",":stuck_out_tongue_closed_eyes:":"",XP:"","X-P":"",xP:"","x-P":"",Xp:"","X-p":"",":stuck_out_tongue_winking_eye:":"",":sun_with_face:":"",":sunflower:":"",":sunglasses:":"","8-)":"","8)":"",":sunrise:":"",":sunrise_over_mountains:":"",":surfer:":"",":sushi:":"",":suspension_railway:":"",":sweat:":"",":sweat_drops:":"",":sweat_smile:":"",":sweet_potato:":"",":swimmer:":"",":symbols:":"",":syringe:":"",":tada:":"",":tanabata_tree:":"",":tangerine:":"",":taxi:":"",":tea:":"",":telephone_receiver:":"",":telescope:":"",":tennis:":"",":thought_balloon:":"",":thumbsdown:":"",":thumbsup:":"",":ticket:":"",":tiger:":"",":tiger2:":"",":tired_face:":"",":toilet:":"",":tokyo_tower:":"",":tomato:":"",":tongue:":"",":top:":"",":tophat:":"",":tractor:":"",":traffic_light:":"",":train:":"",":train2:":"",":tram:":"",":triangular_flag_on_post:":"",":triangular_ruler:":"",":trident:":"",":triumph:":"",":trolleybus:":"",":trophy:":"",":tropical_drink:":"",":tropical_fish:":"",":truck:":"",":trumpet:":"",":tshirt:":"",":tulip:":"",":turtle:":"",":tv:":"",":twisted_rightwards_arrows:":"",":two_hearts:":"",":two_men_holding_hands:":"",":two_women_holding_hands:":"",":u5272:":"",":u5408:":"",":u55b6:":"",":u6307:":"",":u6708:":"",":u6709:":"",":u6e80:":"",":u7121:":"",":u7533:":"",":u7981:":"",":u7a7a:":"",":unamused:":"",":\\":"",":-\\":"",":-/":"",":/":"",":underage:":"",":unlock:":"",":up:":"",":vertical_traffic_light:":"",":vhs:":"",":vibration_mode:":"",":video_camera:":"",":video_game:":"",":violin:":"",":volcano:":"",":vs:":"",":walking:":"",":waning_crescent_moon:":"",":waning_gibbous_moon:":"",":water_buffalo:":"",":watermelon:":"",":wave:":"",":waxing_crescent_moon:":"",":waxing_gibbous_moon:":"",":wc:":"",":weary:":"",":wedding:":"",":whale:":"",":whale2:":"",":white_flower:":"",":white_square_button:":"",":wind_chime:":"",":wine_glass:":"",":wink:":"",";)":"",";-)":"",":wolf:":"",":woman:":"",":womans_clothes:":"",":womans_hat:":"",":womens:":"",":worried:":"",":wrench:":"",":yellow_heart:":"",":yen:":"",":yum:":"",":zzz:":""}},{}],69:[function(a,b,c){var d=a("./emoji-map.js");b.exports=function(a){if("string"==typeof a){var b;return a.split(/[,. ]+/).forEach(function(c){d.hasOwnProperty(c)&&(b=d[c],a=a.replace(c,b))}),a}}},{"./emoji-map.js":68}],70:[function(a,b,c){(function(a){var c=a.location||{},d=function(){"use strict";function a(a){return document.createTextNode(a)}function b(a){return a.replace(t,i)}function d(a,b){return"".concat(b.base,b.size,"/",a,b.ext)}function e(a,b){for(var c,d,f=a.childNodes,g=f.length;g--;)c=f[g],d=c.nodeType,3===d?b.push(c):1!==d||u.test(c.nodeName)||e(c,b);return b}function f(a,b){return p(""===b?a.slice(0,-1):3===a.length&&""===a.charAt(1)?a.charAt(0)+a.charAt(2):a)}function g(b,c){for(var d,g,h,i,j,k,l,m,n,o,p,r,t,u,v=e(b,[]),w=v.length;w--;){for(h=!1,i=document.createDocumentFragment(),j=v[w],k=j.nodeValue,m=0;l=s.exec(k);){if(n=l.index,n!==m&&i.appendChild(a(k.slice(m,n))),p=l[0],r=l[1],t=l[2],m=n+p.length,""!==t&&(u=c.callback(f(r,t),c,t))){o=new Image,o.onerror=q.onerror,o.setAttribute("draggable","false"),d=c.attributes(r,t);for(g in d)d.hasOwnProperty(g)&&0!==g.indexOf("on")&&!o.hasAttribute(g)&&o.setAttribute(g,d[g]);o.className=c.className,o.alt=p,o.src=u,h=!0,i.appendChild(o)}o||i.appendChild(a(p)),o=null}h&&(m<k.length&&i.appendChild(a(k.slice(m))),j.parentNode.replaceChild(i,j))}return b}function h(a,c){return n(a,function(a,d,e){var g,h,i,j=a;if(""!==e&&(i=c.callback(f(d,e),c,e))){j="<img ".concat('class="',c.className,'" ','draggable="false" ','alt="',a,'"',' src="',i,'"'),g=c.attributes(d,e);for(h in g)g.hasOwnProperty(h)&&0!==h.indexOf("on")&&j.indexOf(" "+h+"=")===-1&&(j=j.concat(" ",h,'="',b(g[h]),'"'));j=j.concat(">")}return j})}function i(a){return r[a]}function j(){return null}function k(a){return"number"==typeof a?a+"x"+a:a}function l(a){var b="string"==typeof a?parseInt(a,16):a;return b<65536?v(b):(b-=65536,v(55296+(b>>10),56320+(1023&b)))}function m(a,b){return b&&"function"!=typeof b||(b={callback:b}),("string"==typeof a?h:g)(a,{callback:b.callback||d,attributes:"function"==typeof b.attributes?b.attributes:j,base:"string"==typeof b.base?b.base:q.base,ext:b.ext||q.ext,size:b.folder||k(b.size||q.size),className:b.className||q.className})}function n(a,b){return String(a).replace(s,b)}function o(a){s.lastIndex=0;var b=s.test(a);return s.lastIndex=0,b}function p(a,b){for(var c=[],d=0,e=0,f=0;f<a.length;)d=a.charCodeAt(f++),e?(c.push((65536+(e-55296<<10)+(d-56320)).toString(16)),e=0):55296<=d&&d<=56319?e=d:c.push(d.toString(16));return c.join(b||"-")}var q={base:("https:"===c.protocol?"https:":"http:")+"//twemoji.maxcdn.com/",ext:".png",size:"36x36",className:"emoji",convert:{fromCodePoint:l,toCodePoint:p},onerror:function(){this.parentNode&&this.parentNode.replaceChild(a(this.alt),this)},parse:m,replace:n,test:o},r={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"
},s=/((?:\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddf0\ud83c\uddf7|\ud83c\uddef\ud83c\uddf5|\ud83c\uddee\ud83c\uddf9|\ud83c\uddec\ud83c\udde7|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\udde9\ud83c\uddea|\u0039\ufe0f?\u20e3|\u0038\ufe0f?\u20e3|\u0037\ufe0f?\u20e3|\u0036\ufe0f?\u20e3|\u0035\ufe0f?\u20e3|\u0034\ufe0f?\u20e3|\u0033\ufe0f?\u20e3|\u0032\ufe0f?\u20e3|\u0031\ufe0f?\u20e3|\u0030\ufe0f?\u20e3|\u0023\ufe0f?\u20e3|\ud83d\udeb3|\ud83d\udeb1|\ud83d\udeb0|\ud83d\udeaf|\ud83d\udeae|\ud83d\udea6|\ud83d\udea3|\ud83d\udea1|\ud83d\udea0|\ud83d\ude9f|\ud83d\ude9e|\ud83d\ude9d|\ud83d\ude9c|\ud83d\ude9b|\ud83d\ude98|\ud83d\ude96|\ud83d\ude94|\ud83d\ude90|\ud83d\ude8e|\ud83d\ude8d|\ud83d\ude8b|\ud83d\ude8a|\ud83d\ude88|\ud83d\ude86|\ud83d\ude82|\ud83d\ude81|\ud83d\ude36|\ud83d\ude34|\ud83d\ude2f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude27|\ud83d\ude26|\ud83d\ude1f|\ud83d\ude1b|\ud83d\ude19|\ud83d\ude17|\ud83d\ude15|\ud83d\ude11|\ud83d\ude10|\ud83d\ude0e|\ud83d\ude08|\ud83d\ude07|\ud83d\ude00|\ud83d\udd67|\ud83d\udd66|\ud83d\udd65|\ud83d\udd64|\ud83d\udd63|\ud83d\udd62|\ud83d\udd61|\ud83d\udd60|\ud83d\udd5f|\ud83d\udd5e|\ud83d\udd5d|\ud83d\udd5c|\ud83d\udd2d|\ud83d\udd2c|\ud83d\udd15|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd06|\ud83d\udd05|\ud83d\udd04|\ud83d\udd02|\ud83d\udd01|\ud83d\udd00|\ud83d\udcf5|\ud83d\udcef|\ud83d\udced|\ud83d\udcec|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcad|\ud83d\udc6d|\ud83d\udc6c|\ud83d\udc65|\ud83d\udc2a|\ud83d\udc16|\ud83d\udc15|\ud83d\udc13|\ud83d\udc10|\ud83d\udc0f|\ud83d\udc0b|\ud83d\udc0a|\ud83d\udc09|\ud83d\udc08|\ud83d\udc07|\ud83d\udc06|\ud83d\udc05|\ud83d\udc04|\ud83d\udc03|\ud83d\udc02|\ud83d\udc01|\ud83d\udc00|\ud83c\udfe4|\ud83c\udfc9|\ud83c\udfc7|\ud83c\udf7c|\ud83c\udf50|\ud83c\udf4b|\ud83c\udf33|\ud83c\udf32|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1c|\ud83c\udf1a|\ud83c\udf18|\ud83c\udccf|\ud83c\udd70|\ud83c\udd71|\ud83c\udd7e|\ud83c\udd8e|\ud83c\udd91|\ud83c\udd92|\ud83c\udd93|\ud83c\udd94|\ud83c\udd95|\ud83c\udd96|\ud83c\udd97|\ud83c\udd98|\ud83c\udd99|\ud83c\udd9a|\ud83d\udc77|\ud83d\udec5|\ud83d\udec4|\ud83d\udec3|\ud83d\udec2|\ud83d\udec1|\ud83d\udebf|\ud83d\udeb8|\ud83d\udeb7|\ud83d\udeb5|\ud83c\ude01|\ud83c\ude02|\ud83c\ude32|\ud83c\ude33|\ud83c\ude34|\ud83c\ude35|\ud83c\ude36|\ud83c\ude37|\ud83c\ude38|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude50|\ud83c\ude51|\ud83c\udf00|\ud83c\udf01|\ud83c\udf02|\ud83c\udf03|\ud83c\udf04|\ud83c\udf05|\ud83c\udf06|\ud83c\udf07|\ud83c\udf08|\ud83c\udf09|\ud83c\udf0a|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf0f|\ud83c\udf11|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf19|\ud83c\udf1b|\ud83c\udf1f|\ud83c\udf20|\ud83c\udf30|\ud83c\udf31|\ud83c\udf34|\ud83c\udf35|\ud83c\udf37|\ud83c\udf38|\ud83c\udf39|\ud83c\udf3a|\ud83c\udf3b|\ud83c\udf3c|\ud83c\udf3d|\ud83c\udf3e|\ud83c\udf3f|\ud83c\udf40|\ud83c\udf41|\ud83c\udf42|\ud83c\udf43|\ud83c\udf44|\ud83c\udf45|\ud83c\udf46|\ud83c\udf47|\ud83c\udf48|\ud83c\udf49|\ud83c\udf4a|\ud83c\udf4c|\ud83c\udf4d|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf51|\ud83c\udf52|\ud83c\udf53|\ud83c\udf54|\ud83c\udf55|\ud83c\udf56|\ud83c\udf57|\ud83c\udf58|\ud83c\udf59|\ud83c\udf5a|\ud83c\udf5b|\ud83c\udf5c|\ud83c\udf5d|\ud83c\udf5e|\ud83c\udf5f|\ud83c\udf60|\ud83c\udf61|\ud83c\udf62|\ud83c\udf63|\ud83c\udf64|\ud83c\udf65|\ud83c\udf66|\ud83c\udf67|\ud83c\udf68|\ud83c\udf69|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6e|\ud83c\udf6f|\ud83c\udf70|\ud83c\udf71|\ud83c\udf72|\ud83c\udf73|\ud83c\udf74|\ud83c\udf75|\ud83c\udf76|\ud83c\udf77|\ud83c\udf78|\ud83c\udf79|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf80|\ud83c\udf81|\ud83c\udf82|\ud83c\udf83|\ud83c\udf84|\ud83c\udf85|\ud83c\udf86|\ud83c\udf87|\ud83c\udf88|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf8b|\ud83c\udf8c|\ud83c\udf8d|\ud83c\udf8e|\ud83c\udf8f|\ud83c\udf90|\ud83c\udf91|\ud83c\udf92|\ud83c\udf93|\ud83c\udfa0|\ud83c\udfa1|\ud83c\udfa2|\ud83c\udfa3|\ud83c\udfa4|\ud83c\udfa5|\ud83c\udfa6|\ud83c\udfa7|\ud83c\udfa8|\ud83c\udfa9|\ud83c\udfaa|\ud83c\udfab|\ud83c\udfac|\ud83c\udfad|\ud83c\udfae|\ud83c\udfaf|\ud83c\udfb0|\ud83c\udfb1|\ud83c\udfb2|\ud83c\udfb3|\ud83c\udfb4|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb7|\ud83c\udfb8|\ud83c\udfb9|\ud83c\udfba|\ud83c\udfbb|\ud83c\udfbc|\ud83c\udfbd|\ud83c\udfbe|\ud83c\udfbf|\ud83c\udfc0|\ud83c\udfc1|\ud83c\udfc2|\ud83c\udfc3|\ud83c\udfc4|\ud83c\udfc6|\ud83c\udfc8|\ud83c\udfca|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfe7|\ud83c\udfe8|\ud83c\udfe9|\ud83c\udfea|\ud83c\udfeb|\ud83c\udfec|\ud83c\udfed|\ud83c\udfee|\ud83c\udfef|\ud83c\udff0|\ud83d\udc0c|\ud83d\udc0d|\ud83d\udc0e|\ud83d\udc11|\ud83d\udc12|\ud83d\udc14|\ud83d\udc17|\ud83d\udc18|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc1b|\ud83d\udc1c|\ud83d\udc1d|\ud83d\udc1e|\ud83d\udc1f|\ud83d\udc20|\ud83d\udc21|\ud83d\udc22|\ud83d\udc23|\ud83d\udc24|\ud83d\udc25|\ud83d\udc26|\ud83d\udc27|\ud83d\udc28|\ud83d\udc29|\ud83d\udc2b|\ud83d\udc2c|\ud83d\udc2d|\ud83d\udc2e|\ud83d\udc2f|\ud83d\udc30|\ud83d\udc31|\ud83d\udc32|\ud83d\udc33|\ud83d\udc34|\ud83d\udc35|\ud83d\udc36|\ud83d\udc37|\ud83d\udc38|\ud83d\udc39|\ud83d\udc3a|\ud83d\udc3b|\ud83d\udc3c|\ud83d\udc3d|\ud83d\udc3e|\ud83d\udc40|\ud83d\udc42|\ud83d\udc43|\ud83d\udc44|\ud83d\udc45|\ud83d\udc46|\ud83d\udc47|\ud83d\udc48|\ud83d\udc49|\ud83d\udc4a|\ud83d\udc4b|\ud83d\udc4c|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4f|\ud83d\udc50|\ud83d\udc51|\ud83d\udc52|\ud83d\udc53|\ud83d\udc54|\ud83d\udc55|\ud83d\udc56|\ud83d\udc57|\ud83d\udc58|\ud83d\udc59|\ud83d\udc5a|\ud83d\udc5b|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5e|\ud83d\udc5f|\ud83d\udc60|\ud83d\udc61|\ud83d\udc62|\ud83d\udc63|\ud83d\udc64|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc6a|\ud83d\udc6b|\ud83d\udc6e|\ud83d\udc6f|\ud83d\udc70|\ud83d\udc71|\ud83d\udc72|\ud83d\udc73|\ud83d\udc74|\ud83d\udc75|\ud83d\udc76|\ud83d\udeb4|\ud83d\udc78|\ud83d\udc79|\ud83d\udc7a|\ud83d\udc7b|\ud83d\udc7c|\ud83d\udc7d|\ud83d\udc7e|\ud83d\udc7f|\ud83d\udc80|\ud83d\udc81|\ud83d\udc82|\ud83d\udc83|\ud83d\udc84|\ud83d\udc85|\ud83d\udc86|\ud83d\udc87|\ud83d\udc88|\ud83d\udc89|\ud83d\udc8a|\ud83d\udc8b|\ud83d\udc8c|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc8f|\ud83d\udc90|\ud83d\udc91|\ud83d\udc92|\ud83d\udc93|\ud83d\udc94|\ud83d\udc95|\ud83d\udc96|\ud83d\udc97|\ud83d\udc98|\ud83d\udc99|\ud83d\udc9a|\ud83d\udc9b|\ud83d\udc9c|\ud83d\udc9d|\ud83d\udc9e|\ud83d\udc9f|\ud83d\udca0|\ud83d\udca1|\ud83d\udca2|\ud83d\udca3|\ud83d\udca4|\ud83d\udca5|\ud83d\udca6|\ud83d\udca7|\ud83d\udca8|\ud83d\udca9|\ud83d\udcaa|\ud83d\udcab|\ud83d\udcac|\ud83d\udcae|\ud83d\udcaf|\ud83d\udcb0|\ud83d\udcb1|\ud83d\udcb2|\ud83d\udcb3|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb8|\ud83d\udcb9|\ud83d\udcba|\ud83d\udcbb|\ud83d\udcbc|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcc1|\ud83d\udcc2|\ud83d\udcc3|\ud83d\udcc4|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcca|\ud83d\udccb|\ud83d\udccc|\ud83d\udccd|\ud83d\udcce|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd1|\ud83d\udcd2|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd5|\ud83d\udcd6|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcda|\ud83d\udcdb|\ud83d\udcdc|\ud83d\udcdd|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udce2|\ud83d\udce3|\ud83d\udce4|\ud83d\udce5|\ud83d\udce6|\ud83d\udce7|\ud83d\udce8|\ud83d\udce9|\ud83d\udcea|\ud83d\udceb|\ud83d\udcee|\ud83d\udcf0|\ud83d\udcf1|\ud83d\udcf2|\ud83d\udcf3|\ud83d\udcf4|\ud83d\udcf6|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udcfc|\ud83d\udd03|\ud83d\udd0a|\ud83d\udd0b|\ud83d\udd0c|\ud83d\udd0d|\ud83d\udd0e|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd12|\ud83d\udd13|\ud83d\udd14|\ud83d\udd16|\ud83d\udd17|\ud83d\udd18|\ud83d\udd19|\ud83d\udd1a|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd1d|\ud83d\udd1e|\ud83d\udd1f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd22|\ud83d\udd23|\ud83d\udd24|\ud83d\udd25|\ud83d\udd26|\ud83d\udd27|\ud83d\udd28|\ud83d\udd29|\ud83d\udd2a|\ud83d\udd2b|\ud83d\udd2e|\ud83d\udd2f|\ud83d\udd30|\ud83d\udd31|\ud83d\udd32|\ud83d\udd33|\ud83d\udd34|\ud83d\udd35|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39|\ud83d\udd3a|\ud83d\udd3b|\ud83d\udd3c|\ud83d\udd3d|\ud83d\udd50|\ud83d\udd51|\ud83d\udd52|\ud83d\udd53|\ud83d\udd54|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd5b|\ud83d\uddfb|\ud83d\uddfc|\ud83d\uddfd|\ud83d\uddfe|\ud83d\uddff|\ud83d\ude01|\ud83d\ude02|\ud83d\ude03|\ud83d\ude04|\ud83d\ude05|\ud83d\ude06|\ud83d\ude09|\ud83d\ude0a|\ud83d\ude0b|\ud83d\ude0c|\ud83d\ude0d|\ud83d\ude0f|\ud83d\ude12|\ud83d\ude13|\ud83d\ude14|\ud83d\ude16|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1e|\ud83d\ude20|\ud83d\ude21|\ud83d\ude22|\ud83d\ude23|\ud83d\ude24|\ud83d\ude25|\ud83d\ude28|\ud83d\ude29|\ud83d\ude2a|\ud83d\ude2b|\ud83d\ude2d|\ud83d\ude30|\ud83d\ude31|\ud83d\ude32|\ud83d\ude33|\ud83d\ude35|\ud83d\ude37|\ud83d\ude38|\ud83d\ude39|\ud83d\ude3a|\ud83d\ude3b|\ud83d\ude3c|\ud83d\ude3d|\ud83d\ude3e|\ud83d\ude3f|\ud83d\ude40|\ud83d\ude45|\ud83d\ude46|\ud83d\ude47|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\ude4b|\ud83d\ude4c|\ud83d\ude4d|\ud83d\ude4e|\ud83d\ude4f|\ud83d\ude80|\ud83d\ude83|\ud83d\ude84|\ud83d\ude85|\ud83d\ude87|\ud83d\ude89|\ud83d\ude8c|\ud83d\ude8f|\ud83d\ude91|\ud83d\ude92|\ud83d\ude93|\ud83d\ude95|\ud83d\ude97|\ud83d\ude99|\ud83d\ude9a|\ud83d\udea2|\ud83d\udea4|\ud83d\udea5|\ud83d\udea7|\ud83d\udea8|\ud83d\udea9|\ud83d\udeaa|\ud83d\udeab|\ud83d\udeac|\ud83d\udead|\ud83d\udeb2|\ud83d\udeb6|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebb|\ud83d\udebc|\ud83d\udebd|\ud83d\udebe|\ud83d\udec0|\ud83c\udde6|\ud83c\udde7|\ud83c\udde8|\ud83c\udde9|\ud83c\uddea|\ud83c\uddeb|\ud83c\uddec|\ud83c\udded|\ud83c\uddee|\ud83c\uddef|\ud83c\uddf0|\ud83c\uddf1|\ud83c\uddf2|\ud83c\uddf3|\ud83c\uddf4|\ud83c\uddf5|\ud83c\uddf6|\ud83c\uddf7|\ud83c\uddf8|\ud83c\uddf9|\ud83c\uddfa|\ud83c\uddfb|\ud83c\uddfc|\ud83c\uddfd|\ud83c\uddfe|\ud83c\uddff|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf10|\ud83c\udf12|\ud83c\udf16|\ud83c\udf17|\ue50a|\u3030|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u2122|\u27bf|\u00a9|\u00ae)|(?:(?:\ud83c\udc04|\ud83c\udd7f|\ud83c\ude1a|\ud83c\ude2f|\u3299|\u303d|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2049|\u203c|\u2668)([\uFE0E\uFE0F]?)))/g,t=/[&<>'"]/g,u=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA/,v=String.fromCharCode;return q}();c.protocol||(d.base=d.base.replace(/^http:/,"")),b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],71:[function(a,b,c){!function(){window.WebComponents=window.WebComponents||{flags:{}};var a=document.querySelector('script[src*="webcomponents-lite.js"]'),b={};if(!b.noOpts){if(location.search.slice(1).split("&").forEach(function(a){var c,d=a.split("=");d[0]&&(c=d[0].match(/wc-(.+)/))&&(b[c[1]]=d[1]||!0)}),a)for(var c,d=0;c=a.attributes[d];d++)"src"!==c.name&&(b[c.name]=c.value||!0);if(b.log&&b.log.split){var e=b.log.split(",");b.log={},e.forEach(function(a){b.log[a]=!0})}else b.log={}}b.register&&(window.CustomElements=window.CustomElements||{flags:{}},window.CustomElements.flags.register=b.register),WebComponents.flags=b}(),function(a){"use strict";function b(a){return void 0!==l[a]}function c(){h.call(this),this._isInvalid=!0}function d(a){return""==a&&c.call(this),a.toLowerCase()}function e(a){var b=a.charCodeAt(0);return b>32&&b<127&&[34,35,60,62,63,96].indexOf(b)==-1?a:encodeURIComponent(a)}function f(a){var b=a.charCodeAt(0);return b>32&&b<127&&[34,35,60,62,96].indexOf(b)==-1?a:encodeURIComponent(a)}function g(a,g,h){function i(a){t.push(a)}var j=g||"scheme start",k=0,q="",r=!1,s=!1,t=[];a:for(;(a[k-1]!=n||0==k)&&!this._isInvalid;){var u=a[k];switch(j){case"scheme start":if(!u||!o.test(u)){if(g){i("Invalid scheme.");break a}q="",j="no scheme";continue}q+=u.toLowerCase(),j="scheme";break;case"scheme":if(u&&p.test(u))q+=u.toLowerCase();else{if(":"!=u){if(g){if(n==u)break a;i("Code point not allowed in scheme: "+u);break a}q="",k=0,j="no scheme";continue}if(this._scheme=q,q="",g)break a;b(this._scheme)&&(this._isRelative=!0),j="file"==this._scheme?"relative":this._isRelative&&h&&h._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==u?(this._query="?",j="query"):"#"==u?(this._fragment="#",j="fragment"):n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._schemeData+=e(u));break;case"no scheme":if(h&&b(h._scheme)){j="relative";continue}i("Missing scheme."),c.call(this);break;case"relative or authority":if("/"!=u||"/"!=a[k+1]){i("Expected /, got: "+u),j="relative";continue}j="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=h._scheme),n==u){this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query=h._query,this._username=h._username,this._password=h._password;break a}if("/"==u||"\\"==u)"\\"==u&&i("\\ is an invalid code point."),j="relative slash";else if("?"==u)this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query="?",this._username=h._username,this._password=h._password,j="query";else{if("#"!=u){var v=a[k+1],w=a[k+2];("file"!=this._scheme||!o.test(u)||":"!=v&&"|"!=v||n!=w&&"/"!=w&&"\\"!=w&&"?"!=w&&"#"!=w)&&(this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password,this._path=h._path.slice(),this._path.pop()),j="relative path";continue}this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query=h._query,this._fragment="#",this._username=h._username,this._password=h._password,j="fragment"}break;case"relative slash":if("/"!=u&&"\\"!=u){"file"!=this._scheme&&(this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password),j="relative path";continue}"\\"==u&&i("\\ is an invalid code point."),j="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=u){i("Expected '/', got: "+u),j="authority ignore slashes";continue}j="authority second slash";break;case"authority second slash":if(j="authority ignore slashes","/"!=u){i("Expected '/', got: "+u);continue}break;case"authority ignore slashes":if("/"!=u&&"\\"!=u){j="authority";continue}i("Expected authority, got: "+u);break;case"authority":if("@"==u){r&&(i("@ already seen."),q+="%40"),r=!0;for(var x=0;x<q.length;x++){var y=q[x];if("\t"!=y&&"\n"!=y&&"\r"!=y)if(":"!=y||null!==this._password){var z=e(y);null!==this._password?this._password+=z:this._username+=z}else this._password="";else i("Invalid whitespace in authority.")}q=""}else{if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){k-=q.length,q="",j="host";continue}q+=u}break;case"file host":if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){2!=q.length||!o.test(q[0])||":"!=q[1]&&"|"!=q[1]?0==q.length?j="relative path start":(this._host=d.call(this,q),q="",j="relative path start"):j="relative path";continue}"\t"==u||"\n"==u||"\r"==u?i("Invalid whitespace in file host."):q+=u;break;case"host":case"hostname":if(":"!=u||s){if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){if(this._host=d.call(this,q),q="",j="relative path start",g)break a;continue}"\t"!=u&&"\n"!=u&&"\r"!=u?("["==u?s=!0:"]"==u&&(s=!1),q+=u):i("Invalid code point in host/hostname: "+u)}else if(this._host=d.call(this,q),q="",j="port","hostname"==g)break a;break;case"port":if(/[0-9]/.test(u))q+=u;else{if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u||g){if(""!=q){var A=parseInt(q,10);A!=l[this._scheme]&&(this._port=A+""),q=""}if(g)break a;j="relative path start";continue}"\t"==u||"\n"==u||"\r"==u?i("Invalid code point in port: "+u):c.call(this)}break;case"relative path start":if("\\"==u&&i("'\\' not allowed in path."),j="relative path","/"!=u&&"\\"!=u)continue;break;case"relative path":if(n!=u&&"/"!=u&&"\\"!=u&&(g||"?"!=u&&"#"!=u))"\t"!=u&&"\n"!=u&&"\r"!=u&&(q+=e(u));else{"\\"==u&&i("\\ not allowed in relative path.");var B;(B=m[q.toLowerCase()])&&(q=B),".."==q?(this._path.pop(),"/"!=u&&"\\"!=u&&this._path.push("")):"."==q&&"/"!=u&&"\\"!=u?this._path.push(""):"."!=q&&("file"==this._scheme&&0==this._path.length&&2==q.length&&o.test(q[0])&&"|"==q[1]&&(q=q[0]+":"),this._path.push(q)),q="","?"==u?(this._query="?",j="query"):"#"==u&&(this._fragment="#",j="fragment")}break;case"query":g||"#"!=u?n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._query+=f(u)):(this._fragment="#",j="fragment");break;case"fragment":n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._fragment+=u)}k++}}function h(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function i(a,b){void 0===b||b instanceof i||(b=new i(String(b))),this._url=a,h.call(this);var c=a.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");g.call(this,c,null,b)}var j=!1;if(!a.forceJURL)try{var k=new URL("b","http://a");k.pathname="c%20d",j="http://a/c%20d"===k.href}catch(a){}if(!j){var l=Object.create(null);l.ftp=21,l.file=0,l.gopher=70,l.http=80,l.https=443,l.ws=80,l.wss=443;var m=Object.create(null);m["%2e"]=".",m[".%2e"]="..",m["%2e."]="..",m["%2e%2e"]="..";var n=void 0,o=/[a-zA-Z]/,p=/[a-zA-Z0-9\+\-\.]/;i.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var a="";return""==this._username&&null==this._password||(a=this._username+(null!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+a+this.host:"")+this.pathname+this._query+this._fragment},set href(a){h.call(this),g.call(this,a)},get protocol(){return this._scheme+":"},set protocol(a){this._isInvalid||g.call(this,a+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"host")},get hostname(){return this._host},set hostname(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"hostname")},get port(){return this._port},set port(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(a){!this._isInvalid&&this._isRelative&&(this._path=[],g.call(this,a,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(a){!this._isInvalid&&this._isRelative&&(this._query="?","?"==a[0]&&(a=a.slice(1)),g.call(this,a,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(a){this._isInvalid||(this._fragment="#","#"==a[0]&&(a=a.slice(1)),g.call(this,a,"fragment"))},get origin(){var a;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return a=this.host,a?this._scheme+"://"+a:""}};var q=a.URL;q&&(i.createObjectURL=function(a){return q.createObjectURL.apply(q,arguments)},i.revokeObjectURL=function(a){q.revokeObjectURL(a)}),a.URL=i}}(self),"undefined"==typeof WeakMap&&function(){var a=Object.defineProperty,b=Date.now()%1e9,c=function(){this.name="__st"+(1e9*Math.random()>>>0)+b+++"__"};c.prototype={set:function(b,c){var d=b[this.name];return d&&d[0]===b?d[1]=c:a(b,this.name,{value:[b,c],writable:!0}),this},get:function(a){var b;return(b=a[this.name])&&b[0]===a?b[1]:void 0},delete:function(a){var b=a[this.name];return!(!b||b[0]!==a)&&(b[0]=b[1]=void 0,!0)},has:function(a){var b=a[this.name];return!!b&&b[0]===a}},window.WeakMap=c}(),function(a){function b(a){u.push(a),t||(t=!0,p(d))}function c(a){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(a)||a}function d(){t=!1;var a=u;u=[],a.sort(function(a,b){return a.uid_-b.uid_});var b=!1;a.forEach(function(a){var c=a.takeRecords();e(a),c.length&&(a.callback_(c,a),b=!0)}),b&&d()}function e(a){a.nodes_.forEach(function(b){var c=q.get(b);c&&c.forEach(function(b){b.observer===a&&b.removeTransientObservers()})})}function f(a,b){for(var c=a;c;c=c.parentNode){var d=q.get(c);if(d)for(var e=0;e<d.length;e++){var f=d[e],g=f.options;if(c===a||g.subtree){var h=b(g);h&&f.enqueue(h)}}}}function g(a){this.callback_=a,this.nodes_=[],this.records_=[],this.uid_=++v}function h(a,b){this.type=a,this.target=b,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function i(a){var b=new h(a.type,a.target);return b.addedNodes=a.addedNodes.slice(),b.removedNodes=a.removedNodes.slice(),b.previousSibling=a.previousSibling,b.nextSibling=a.nextSibling,b.attributeName=a.attributeName,b.attributeNamespace=a.attributeNamespace,b.oldValue=a.oldValue,b}function j(a,b){return w=new h(a,b)}function k(a){return x?x:(x=i(w),x.oldValue=a,x)}function l(){w=x=void 0}function m(a){return a===x||a===w}function n(a,b){return a===b?a:x&&m(a)?x:null}function o(a,b,c){this.observer=a,this.target=b,this.options=c,this.transientObservedNodes=[]}if(!a.JsMutationObserver){var p,q=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))p=setTimeout;else if(window.setImmediate)p=window.setImmediate;else{var r=[],s=String(Math.random());window.addEventListener("message",function(a){if(a.data===s){var b=r;r=[],b.forEach(function(a){a()})}}),p=function(a){r.push(a),window.postMessage(s,"*")}}var t=!1,u=[],v=0;g.prototype={observe:function(a,b){if(a=c(a),!b.childList&&!b.attributes&&!b.characterData||b.attributeOldValue&&!b.attributes||b.attributeFilter&&b.attributeFilter.length&&!b.attributes||b.characterDataOldValue&&!b.characterData)throw new SyntaxError;var d=q.get(a);d||q.set(a,d=[]);for(var e,f=0;f<d.length;f++)if(d[f].observer===this){e=d[f],e.removeListeners(),e.options=b;break}e||(e=new o(this,a,b),d.push(e),this.nodes_.push(a)),e.addListeners()},disconnect:function(){this.nodes_.forEach(function(a){for(var b=q.get(a),c=0;c<b.length;c++){var d=b[c];if(d.observer===this){d.removeListeners(),b.splice(c,1);break}}},this),this.records_=[]},takeRecords:function(){var a=this.records_;return this.records_=[],a}};var w,x;o.prototype={enqueue:function(a){var c=this.observer.records_,d=c.length;if(c.length>0){var e=c[d-1],f=n(e,a);if(f)return void(c[d-1]=f)}else b(this.observer);c[d]=a},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(a){var b=this.options;b.attributes&&a.addEventListener("DOMAttrModified",this,!0),b.characterData&&a.addEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.addEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(a){var b=this.options;b.attributes&&a.removeEventListener("DOMAttrModified",this,!0),b.characterData&&a.removeEventListener("DOMCharacterDataModified",this,!0),b.childList&&a.removeEventListener("DOMNodeInserted",this,!0),(b.childList||b.subtree)&&a.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(a){if(a!==this.target){this.addListeners_(a),this.transientObservedNodes.push(a);var b=q.get(a);b||q.set(a,b=[]),b.push(this)}},removeTransientObservers:function(){var a=this.transientObservedNodes;this.transientObservedNodes=[],a.forEach(function(a){this.removeListeners_(a);for(var b=q.get(a),c=0;c<b.length;c++)if(b[c]===this){b.splice(c,1);break}},this)},handleEvent:function(a){switch(a.stopImmediatePropagation(),a.type){case"DOMAttrModified":var b=a.attrName,c=a.relatedNode.namespaceURI,d=a.target,e=new j("attributes",d);e.attributeName=b,e.attributeNamespace=c;var g=a.attrChange===MutationEvent.ADDITION?null:a.prevValue;f(d,function(a){if(a.attributes&&(!a.attributeFilter||!a.attributeFilter.length||a.attributeFilter.indexOf(b)!==-1||a.attributeFilter.indexOf(c)!==-1))return a.attributeOldValue?k(g):e});break;case"DOMCharacterDataModified":var d=a.target,e=j("characterData",d),g=a.prevValue;f(d,function(a){if(a.characterData)return a.characterDataOldValue?k(g):e});break;case"DOMNodeRemoved":this.addTransientObserver(a.target);case"DOMNodeInserted":var h,i,m=a.target;"DOMNodeInserted"===a.type?(h=[m],i=[]):(h=[],i=[m]);var n=m.previousSibling,o=m.nextSibling,e=j("childList",a.target.parentNode);e.addedNodes=h,e.removedNodes=i,e.previousSibling=n,e.nextSibling=o,f(a.relatedNode,function(a){if(a.childList)return e})}l()}},a.JsMutationObserver=g,a.MutationObserver||(a.MutationObserver=g,g._isPolyfilled=!0)}}(self),function(){function a(a){switch(a){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case"":return"&nbsp;"}}function b(b){return b.replace(k,a)}var c="undefined"==typeof HTMLTemplateElement;/Trident/.test(navigator.userAgent)&&function(){var a=document.importNode;document.importNode=function(){var b=a.apply(document,arguments);if(b.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var c=document.createDocumentFragment();return c.appendChild(b),c}return b}}();var d=function(){if(!c){var a=document.createElement("template"),b=document.createElement("template");b.content.appendChild(document.createElement("div")),a.content.appendChild(b);var d=a.cloneNode(!0);return 0===d.content.childNodes.length||0===d.content.firstChild.content.childNodes.length}}(),e=function(){};if(c){var f=document.implementation.createHTMLDocument("template"),g=!0,h=document.createElement("style");h.textContent="template{display:none;}";var i=document.head;i.insertBefore(h,i.firstElementChild),e.prototype=Object.create(HTMLElement.prototype),e.decorate=function(a){if(!a.content){a.content=f.createDocumentFragment();for(var c;c=a.firstChild;)a.content.appendChild(c);if(a.cloneNode=function(a){return e.cloneNode(this,a)},g)try{Object.defineProperty(a,"innerHTML",{get:function(){for(var a="",c=this.content.firstChild;c;c=c.nextSibling)a+=c.outerHTML||b(c.data);return a},set:function(a){for(f.body.innerHTML=a,e.bootstrap(f);this.content.firstChild;)this.content.removeChild(this.content.firstChild);for(;f.body.firstChild;)this.content.appendChild(f.body.firstChild)},configurable:!0})}catch(a){g=!1}e.bootstrap(a.content)}},e.bootstrap=function(a){for(var b,c=a.querySelectorAll("template"),d=0,f=c.length;d<f&&(b=c[d]);d++)e.decorate(b)},document.addEventListener("DOMContentLoaded",function(){e.bootstrap(document)});var j=document.createElement;document.createElement=function(){"use strict";var a=j.apply(document,arguments);return"template"===a.localName&&e.decorate(a),a};var k=/[&\u00A0<>]/g}if(c||d){var l=Node.prototype.cloneNode;e.cloneNode=function(a,b){var c=l.call(a,!1);return this.decorate&&this.decorate(c),b&&(c.content.appendChild(l.call(a.content,!0)),this.fixClonedDom(c.content,a.content)),c},e.fixClonedDom=function(a,b){if(b.querySelectorAll)for(var c,d,e=b.querySelectorAll("template"),f=a.querySelectorAll("template"),g=0,h=f.length;g<h;g++)d=e[g],c=f[g],this.decorate&&this.decorate(d),c.parentNode.replaceChild(d.cloneNode(!0),c)};var m=document.importNode;Node.prototype.cloneNode=function(a){var b=l.call(this,a);return a&&e.fixClonedDom(b,this),b},document.importNode=function(a,b){if("template"===a.localName)return e.cloneNode(a,b);var c=m.call(document,a,b);return b&&e.fixClonedDom(c,a),c},d&&(HTMLTemplateElement.prototype.cloneNode=function(a){return e.cloneNode(this,a)})}c&&(window.HTMLTemplateElement=e)}(),function(a){"use strict";if(!window.performance||!window.performance.now){var b=Date.now();window.performance={now:function(){return Date.now()-b}}}if(window.requestAnimationFrame||(window.requestAnimationFrame=function(){var a=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return a?function(b){return a(function(){b(performance.now())})}:function(a){return window.setTimeout(a,1e3/60)}}()),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(a){clearTimeout(a)}}()),!function(){var a=document.createEvent("Event");return a.initEvent("foo",!0,!0),a.preventDefault(),a.defaultPrevented}()){var c=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(c.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var d=/Trident/.test(navigator.userAgent);if((!window.CustomEvent||d&&"function"!=typeof window.CustomEvent)&&(window.CustomEvent=function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,Boolean(b.bubbles),Boolean(b.cancelable),b.detail),c},window.CustomEvent.prototype=window.Event.prototype),!window.Event||d&&"function"!=typeof window.Event){var e=window.Event;window.Event=function(a,b){b=b||{};var c=document.createEvent("Event");return c.initEvent(a,Boolean(b.bubbles),Boolean(b.cancelable)),c},window.Event.prototype=e.prototype}}(window.WebComponents),window.HTMLImports=window.HTMLImports||{flags:{}},function(a){function b(a,b){b=b||n,d(function(){f(a,b)},b)}function c(a){return"complete"===a.readyState||a.readyState===q}function d(a,b){if(c(b))a&&a();else{var e=function(){"complete"!==b.readyState&&b.readyState!==q||(b.removeEventListener(r,e),d(a,b))};b.addEventListener(r,e)}}function e(a){a.target.__loaded=!0}function f(a,b){function c(){i==j&&a&&a({allImports:h,loadedImports:k,errorImports:l})}function d(a){e(a),k.push(this),i++,c()}function f(a){l.push(this),i++,c()}var h=b.querySelectorAll("link[rel=import]"),i=0,j=h.length,k=[],l=[];if(j)for(var m,n=0;n<j&&(m=h[n]);n++)g(m)?(k.push(this),i++,c()):(m.addEventListener("load",d),m.addEventListener("error",f));else c()}function g(a){return k?a.__loaded||a.import&&"loading"!==a.import.readyState:a.__importParsed}function h(a){for(var b,c=0,d=a.length;c<d&&(b=a[c]);c++)i(b)&&j(b)}function i(a){return"link"===a.localName&&"import"===a.rel}function j(a){a.import?e({target:a}):(a.addEventListener("load",e),a.addEventListener("error",e))}var k=Boolean("import"in document.createElement("link")),l=Boolean(window.ShadowDOMPolyfill),m=function(a){return l?window.ShadowDOMPolyfill.wrapIfNeeded(a):a},n=m(document),o={get:function(){return m(window.HTMLImports.currentScript||document.currentScript||("complete"!==document.readyState?document.scripts[document.scripts.length-1]:null))},configurable:!0};Object.defineProperty(document,"_currentScript",o),Object.defineProperty(n,"_currentScript",o);var p=/Trident/.test(navigator.userAgent),q=p?"complete":"interactive",r="readystatechange";k&&(new MutationObserver(function(a){for(var b,c=0,d=a.length;c<d&&(b=a[c]);c++)b.addedNodes&&h(b.addedNodes)}).observe(document.head,{childList:!0}),function(){if("loading"===document.readyState)for(var a,b=document.querySelectorAll("link[rel=import]"),c=0,d=b.length;c<d&&(a=b[c]);c++)j(a)}()),b(function(a){window.HTMLImports.ready=!0,window.HTMLImports.readyTime=(new Date).getTime();var b=n.createEvent("CustomEvent");b.initCustomEvent("HTMLImportsLoaded",!0,!0,a),n.dispatchEvent(b)}),a.IMPORT_LINK_TYPE="import",a.useNative=k,a.rootDocument=n,a.whenReady=b,a.isIE=p}(window.HTMLImports),function(a){var b=[],c=function(a){b.push(a)},d=function(){b.forEach(function(b){b(a)})};a.addModule=c,a.initializeModules=d}(window.HTMLImports),window.HTMLImports.addModule(function(a){var b={resolveUrlsInStyle:function(a,b){var c=a.ownerDocument,d=c.createElement("a");return a.textContent=this.resolveUrlsInCssText(a.textContent,b,d),a},resolveUrlsInCssText:function(a,b,c){var d=this.replaceUrls(a,c,b,/(url\()([^)]*)(\))/g)
;return d=this.replaceUrls(d,c,b,/(@import[\s]+(?!url\())([^;]*)(;)/g)},replaceUrls:function(a,b,c,d){return a.replace(d,function(a,d,e,f){var g=e.replace(/["']/g,"");return c&&(g=new URL(g,c).href),b.href=g,g=b.href,d+"'"+g+"'"+f})}};a.path=b}),window.HTMLImports.addModule(function(a){var b={async:!0,ok:function(a){return a.status>=200&&a.status<300||304===a.status||0===a.status},load:function(c,d,e){var f=new XMLHttpRequest;return(a.flags.debug||a.flags.bust)&&(c+="?"+Math.random()),f.open("GET",c,b.async),f.addEventListener("readystatechange",function(a){if(4===f.readyState){var c=null;try{var g=f.getResponseHeader("Location");g&&(c="/"===g.substr(0,1)?location.origin+g:g)}catch(a){console.error(a.message)}d.call(e,!b.ok(f)&&f,f.response||f.responseText,c)}}),f.send(),f},loadDocument:function(a,b,c){this.load(a,b,c).responseType="document"}};a.xhr=b}),window.HTMLImports.addModule(function(a){var b=a.xhr,c=a.flags,d=function(a,b){this.cache={},this.onload=a,this.oncomplete=b,this.inflight=0,this.pending={}};d.prototype={addNodes:function(a){this.inflight+=a.length;for(var b,c=0,d=a.length;c<d&&(b=a[c]);c++)this.require(b);this.checkDone()},addNode:function(a){this.inflight++,this.require(a),this.checkDone()},require:function(a){var b=a.src||a.href;a.__nodeUrl=b,this.dedupe(b,a)||this.fetch(b,a)},dedupe:function(a,b){if(this.pending[a])return this.pending[a].push(b),!0;return this.cache[a]?(this.onload(a,b,this.cache[a]),this.tail(),!0):(this.pending[a]=[b],!1)},fetch:function(a,d){if(c.load&&console.log("fetch",a,d),a)if(a.match(/^data:/)){var e=a.split(","),f=e[0],g=e[1];g=f.indexOf(";base64")>-1?atob(g):decodeURIComponent(g),setTimeout(function(){this.receive(a,d,null,g)}.bind(this),0)}else{var h=function(b,c,e){this.receive(a,d,b,c,e)}.bind(this);b.load(a,h)}else setTimeout(function(){this.receive(a,d,{error:"href must be specified"},null)}.bind(this),0)},receive:function(a,b,c,d,e){this.cache[a]=d;for(var f,g=this.pending[a],h=0,i=g.length;h<i&&(f=g[h]);h++)this.onload(a,f,d,c,e),this.tail();this.pending[a]=null},tail:function(){--this.inflight,this.checkDone()},checkDone:function(){this.inflight||this.oncomplete()}},a.Loader=d}),window.HTMLImports.addModule(function(a){var b=function(a){this.addCallback=a,this.mo=new MutationObserver(this.handler.bind(this))};b.prototype={handler:function(a){for(var b,c=0,d=a.length;c<d&&(b=a[c]);c++)"childList"===b.type&&b.addedNodes.length&&this.addedNodes(b.addedNodes)},addedNodes:function(a){this.addCallback&&this.addCallback(a);for(var b,c=0,d=a.length;c<d&&(b=a[c]);c++)b.children&&b.children.length&&this.addedNodes(b.children)},observe:function(a){this.mo.observe(a,{childList:!0,subtree:!0})}},a.Observer=b}),window.HTMLImports.addModule(function(a){function b(a){return"link"===a.localName&&a.rel===k}function c(a){var b=d(a);return"data:text/javascript;charset=utf-8,"+encodeURIComponent(b)}function d(a){return a.textContent+e(a)}function e(a){var b=a.ownerDocument;b.__importedScripts=b.__importedScripts||0;var c=a.ownerDocument.baseURI,d=b.__importedScripts?"-"+b.__importedScripts:"";return b.__importedScripts++,"\n//# sourceURL="+c+d+".js\n"}function f(a){var b=a.ownerDocument.createElement("style");return b.textContent=a.textContent,g.resolveUrlsInStyle(b),b}var g=a.path,h=a.rootDocument,i=a.flags,j=a.isIE,k=a.IMPORT_LINK_TYPE,l="link[rel="+k+"]",m={documentSelectors:l,importsSelectors:[l,"link[rel=stylesheet]:not([type])","style:not([type])","script:not([type])",'script[type="application/javascript"]','script[type="text/javascript"]'].join(","),map:{link:"parseLink",script:"parseScript",style:"parseStyle"},dynamicElements:[],parseNext:function(){var a=this.nextToParse();a&&this.parse(a)},parse:function(a){if(this.isParsed(a))return void(i.parse&&console.log("[%s] is already parsed",a.localName));var b=this[this.map[a.localName]];b&&(this.markParsing(a),b.call(this,a))},parseDynamic:function(a,b){this.dynamicElements.push(a),b||this.parseNext()},markParsing:function(a){i.parse&&console.log("parsing",a),this.parsingElement=a},markParsingComplete:function(a){a.__importParsed=!0,this.markDynamicParsingComplete(a),a.__importElement&&(a.__importElement.__importParsed=!0,this.markDynamicParsingComplete(a.__importElement)),this.parsingElement=null,i.parse&&console.log("completed",a)},markDynamicParsingComplete:function(a){var b=this.dynamicElements.indexOf(a);b>=0&&this.dynamicElements.splice(b,1)},parseImport:function(a){if(a.import=a.__doc,window.HTMLImports.__importsParsingHook&&window.HTMLImports.__importsParsingHook(a),a.import&&(a.import.__importParsed=!0),this.markParsingComplete(a),a.__resource&&!a.__error?a.dispatchEvent(new CustomEvent("load",{bubbles:!1})):a.dispatchEvent(new CustomEvent("error",{bubbles:!1})),a.__pending)for(var b;a.__pending.length;)(b=a.__pending.shift())&&b({target:a});this.parseNext()},parseLink:function(a){b(a)?this.parseImport(a):(a.href=a.href,this.parseGeneric(a))},parseStyle:function(a){var b=a;a=f(a),b.__appliedElement=a,a.__importElement=b,this.parseGeneric(a)},parseGeneric:function(a){this.trackElement(a),this.addElementToDocument(a)},rootImportForElement:function(a){for(var b=a;b.ownerDocument.__importLink;)b=b.ownerDocument.__importLink;return b},addElementToDocument:function(a){var b=this.rootImportForElement(a.__importElement||a);b.parentNode.insertBefore(a,b)},trackElement:function(a,b){var c=this,d=function(e){a.removeEventListener("load",d),a.removeEventListener("error",d),b&&b(e),c.markParsingComplete(a),c.parseNext()};if(a.addEventListener("load",d),a.addEventListener("error",d),j&&"style"===a.localName){var e=!1;if(a.textContent.indexOf("@import")==-1)e=!0;else if(a.sheet){e=!0;for(var f,g=a.sheet.cssRules,h=g?g.length:0,i=0;i<h&&(f=g[i]);i++)f.type===CSSRule.IMPORT_RULE&&(e=e&&Boolean(f.styleSheet))}e&&setTimeout(function(){a.dispatchEvent(new CustomEvent("load",{bubbles:!1}))})}},parseScript:function(b){var d=document.createElement("script");d.__importElement=b,d.src=b.src?b.src:c(b),a.currentScript=b,this.trackElement(d,function(b){d.parentNode&&d.parentNode.removeChild(d),a.currentScript=null}),this.addElementToDocument(d)},nextToParse:function(){return this._mayParse=[],!this.parsingElement&&(this.nextToParseInDoc(h)||this.nextToParseDynamic())},nextToParseInDoc:function(a,c){if(a&&this._mayParse.indexOf(a)<0){this._mayParse.push(a);for(var d,e=a.querySelectorAll(this.parseSelectorsForNode(a)),f=0,g=e.length;f<g&&(d=e[f]);f++)if(!this.isParsed(d))return this.hasResource(d)?b(d)?this.nextToParseInDoc(d.__doc,d):d:void 0}return c},nextToParseDynamic:function(){return this.dynamicElements[0]},parseSelectorsForNode:function(a){return(a.ownerDocument||a)===h?this.documentSelectors:this.importsSelectors},isParsed:function(a){return a.__importParsed},needsDynamicParsing:function(a){return this.dynamicElements.indexOf(a)>=0},hasResource:function(a){return!b(a)||void 0!==a.__doc}};a.parser=m,a.IMPORT_SELECTOR=l}),window.HTMLImports.addModule(function(a){function b(a){return c(a,g)}function c(a,b){return"link"===a.localName&&a.getAttribute("rel")===b}function d(a){return!!Object.getOwnPropertyDescriptor(a,"baseURI")}function e(a,b){var c=document.implementation.createHTMLDocument(g);c._URL=b;var e=c.createElement("base");e.setAttribute("href",b),c.baseURI||d(c)||Object.defineProperty(c,"baseURI",{value:b});var f=c.createElement("meta");return f.setAttribute("charset","utf-8"),c.head.appendChild(f),c.head.appendChild(e),c.body.innerHTML=a,window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap&&HTMLTemplateElement.bootstrap(c),c}var f=a.flags,g=a.IMPORT_LINK_TYPE,h=a.IMPORT_SELECTOR,i=a.rootDocument,j=a.Loader,k=a.Observer,l=a.parser,m={documents:{},documentPreloadSelectors:h,importsPreloadSelectors:[h].join(","),loadNode:function(a){n.addNode(a)},loadSubtree:function(a){var b=this.marshalNodes(a);n.addNodes(b)},marshalNodes:function(a){return a.querySelectorAll(this.loadSelectorsForNode(a))},loadSelectorsForNode:function(a){return(a.ownerDocument||a)===i?this.documentPreloadSelectors:this.importsPreloadSelectors},loaded:function(a,c,d,g,h){if(f.load&&console.log("loaded",a,c),c.__resource=d,c.__error=g,b(c)){var i=this.documents[a];void 0===i&&(i=g?null:e(d,h||a),i&&(i.__importLink=c,this.bootDocument(i)),this.documents[a]=i),c.__doc=i}l.parseNext()},bootDocument:function(a){this.loadSubtree(a),this.observer.observe(a),l.parseNext()},loadedAll:function(){l.parseNext()}},n=new j(m.loaded.bind(m),m.loadedAll.bind(m));if(m.observer=new k,!document.baseURI){var o={get:function(){var a=document.querySelector("base");return a?a.href:window.location.href},configurable:!0};Object.defineProperty(document,"baseURI",o),Object.defineProperty(i,"baseURI",o)}a.importer=m,a.importLoader=n}),window.HTMLImports.addModule(function(a){var b=a.parser,c=a.importer,d={added:function(a){for(var d,e,f,g,h=0,i=a.length;h<i&&(g=a[h]);h++)d||(d=g.ownerDocument,e=b.isParsed(d)),f=this.shouldLoadNode(g),f&&c.loadNode(g),this.shouldParseNode(g)&&e&&b.parseDynamic(g,f)},shouldLoadNode:function(a){return 1===a.nodeType&&e.call(a,c.loadSelectorsForNode(a))},shouldParseNode:function(a){return 1===a.nodeType&&e.call(a,b.parseSelectorsForNode(a))}};c.observer.addCallback=d.added.bind(d);var e=HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector}),function(a){function b(){window.HTMLImports.importer.bootDocument(d)}var c=a.initializeModules;a.isIE;if(!a.useNative){c();var d=a.rootDocument;"complete"===document.readyState||"interactive"===document.readyState&&!window.attachEvent?b():document.addEventListener("DOMContentLoaded",b)}}(window.HTMLImports),window.CustomElements=window.CustomElements||{flags:{}},function(a){var b=a.flags,c=[],d=function(a){c.push(a)},e=function(){c.forEach(function(b){b(a)})};a.addModule=d,a.initializeModules=e,a.hasNative=Boolean(document.registerElement),a.isIE=/Trident/.test(navigator.userAgent),a.useNative=!b.register&&a.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule(function(a){function b(a,b){c(a,function(a){if(b(a))return!0;d(a,b)}),d(a,b)}function c(a,b,d){var e=a.firstElementChild;if(!e)for(e=a.firstChild;e&&e.nodeType!==Node.ELEMENT_NODE;)e=e.nextSibling;for(;e;)b(e,d)!==!0&&c(e,b,d),e=e.nextElementSibling;return null}function d(a,c){for(var d=a.shadowRoot;d;)b(d,c),d=d.olderShadowRoot}function e(a,b){f(a,b,[])}function f(a,b,c){if(a=window.wrap(a),!(c.indexOf(a)>=0)){c.push(a);for(var d,e=a.querySelectorAll("link[rel="+g+"]"),h=0,i=e.length;h<i&&(d=e[h]);h++)d.import&&f(d.import,b,c);b(a)}}var g=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";a.forDocumentTree=e,a.forSubtree=b}),window.CustomElements.addModule(function(a){function b(a,b){return c(a,b)||d(a,b)}function c(b,c){if(a.upgrade(b,c))return!0;c&&g(b)}function d(a,b){t(a,function(a){if(c(a,b))return!0})}function e(a){x.push(a),w||(w=!0,setTimeout(f))}function f(){w=!1;for(var a,b=x,c=0,d=b.length;c<d&&(a=b[c]);c++)a();x=[]}function g(a){v?e(function(){h(a)}):h(a)}function h(a){a.__upgraded__&&!a.__attached&&(a.__attached=!0,a.attachedCallback&&a.attachedCallback())}function i(a){j(a),t(a,function(a){j(a)})}function j(a){v?e(function(){k(a)}):k(a)}function k(a){a.__upgraded__&&a.__attached&&(a.__attached=!1,a.detachedCallback&&a.detachedCallback())}function l(a){for(var b=a,c=window.wrap(document);b;){if(b==c)return!0;b=b.parentNode||b.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&b.host}}function m(a){if(a.shadowRoot&&!a.shadowRoot.__watched){s.dom&&console.log("watching shadow-root for: ",a.localName);for(var b=a.shadowRoot;b;)p(b),b=b.olderShadowRoot}}function n(a,c){if(s.dom){var d=c[0];if(d&&"childList"===d.type&&d.addedNodes&&d.addedNodes){for(var e=d.addedNodes[0];e&&e!==document&&!e.host;)e=e.parentNode;var f=e&&(e.URL||e._URL||e.host&&e.host.localName)||"";f=f.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",c.length,f||"")}var g=l(a);c.forEach(function(a){"childList"===a.type&&(y(a.addedNodes,function(a){a.localName&&b(a,g)}),y(a.removedNodes,function(a){a.localName&&i(a)}))}),s.dom&&console.groupEnd()}function o(a){for(a=window.wrap(a),a||(a=window.wrap(document));a.parentNode;)a=a.parentNode;var b=a.__observer;b&&(n(a,b.takeRecords()),f())}function p(a){if(!a.__observer){var b=new MutationObserver(n.bind(this,a));b.observe(a,{childList:!0,subtree:!0}),a.__observer=b}}function q(a){a=window.wrap(a),s.dom&&console.group("upgradeDocument: ",a.baseURI.split("/").pop()),b(a,a===window.wrap(document)),p(a),s.dom&&console.groupEnd()}function r(a){u(a,q)}var s=a.flags,t=a.forSubtree,u=a.forDocumentTree,v=window.MutationObserver._isPolyfilled&&s["throttle-attached"];a.hasPolyfillMutations=v,a.hasThrottledAttached=v;var w=!1,x=[],y=Array.prototype.forEach.call.bind(Array.prototype.forEach),z=Element.prototype.createShadowRoot;z&&(Element.prototype.createShadowRoot=function(){var a=z.call(this);return window.CustomElements.watchShadow(this),a}),a.watchShadow=m,a.upgradeDocumentTree=r,a.upgradeDocument=q,a.upgradeSubtree=d,a.upgradeAll=b,a.attached=g,a.takeRecords=o}),window.CustomElements.addModule(function(a){function b(b,d){if("template"===b.localName&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(b),!b.__upgraded__&&b.nodeType===Node.ELEMENT_NODE){var e=b.getAttribute("is"),f=a.getRegisteredDefinition(b.localName)||a.getRegisteredDefinition(e);if(f&&(e&&f.tag==b.localName||!e&&!f.extends))return c(b,f,d)}}function c(b,c,e){return g.upgrade&&console.group("upgrade:",b.localName),c.is&&b.setAttribute("is",c.is),d(b,c),b.__upgraded__=!0,f(b),e&&a.attached(b),a.upgradeSubtree(b,e),g.upgrade&&console.groupEnd(),b}function d(a,b){Object.__proto__?a.__proto__=b.prototype:(e(a,b.prototype,b.native),a.__proto__=b.prototype)}function e(a,b,c){for(var d={},e=b;e!==c&&e!==HTMLElement.prototype;){for(var f,g=Object.getOwnPropertyNames(e),h=0;f=g[h];h++)d[f]||(Object.defineProperty(a,f,Object.getOwnPropertyDescriptor(e,f)),d[f]=1);e=Object.getPrototypeOf(e)}}function f(a){a.createdCallback&&a.createdCallback()}var g=a.flags;a.upgrade=b,a.upgradeWithDefinition=c,a.implementPrototype=d}),window.CustomElements.addModule(function(a){function b(b,d){var i=d||{};if(!b)throw new Error("document.registerElement: first argument `name` must not be empty");if(b.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(b)+"'.");if(e(b))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(b)+"'. The type name is invalid.");if(j(b))throw new Error("DuplicateDefinitionError: a type with name '"+String(b)+"' is already registered");return i.prototype||(i.prototype=Object.create(HTMLElement.prototype)),i.__name=b.toLowerCase(),i.extends&&(i.extends=i.extends.toLowerCase()),i.lifecycle=i.lifecycle||{},i.ancestry=f(i.extends),g(i),h(i),c(i.prototype),k(i.__name,i),i.ctor=l(i),i.ctor.prototype=i.prototype,i.prototype.constructor=i.ctor,a.ready&&q(document),i.ctor}function c(a){if(!a.setAttribute._polyfilled){var b=a.setAttribute;a.setAttribute=function(a,c){d.call(this,a,c,b)};var c=a.removeAttribute;a.removeAttribute=function(a){d.call(this,a,null,c)},a.setAttribute._polyfilled=!0}}function d(a,b,c){a=a.toLowerCase();var d=this.getAttribute(a);c.apply(this,arguments);var e=this.getAttribute(a);this.attributeChangedCallback&&e!==d&&this.attributeChangedCallback(a,d,e)}function e(a){for(var b=0;b<v.length;b++)if(a===v[b])return!0}function f(a){var b=j(a);return b?f(b.extends).concat([b]):[]}function g(a){for(var b,c=a.extends,d=0;b=a.ancestry[d];d++)c=b.is&&b.tag;a.tag=c||a.__name,c&&(a.is=a.__name)}function h(a){if(!Object.__proto__){var b=HTMLElement.prototype;if(a.is){var c=document.createElement(a.tag);b=Object.getPrototypeOf(c)}for(var d,e=a.prototype,f=!1;e;)e==b&&(f=!0),d=Object.getPrototypeOf(e),d&&(e.__proto__=d),e=d;f||console.warn(a.tag+" prototype not found in prototype chain for "+a.is),a.native=b}}function i(a){return s(y(a.tag),a)}function j(a){if(a)return w[a.toLowerCase()]}function k(a,b){w[a]=b}function l(a){return function(){return i(a)}}function m(a,b,c){return a===x?n(b,c):z(a,b)}function n(a,b){a&&(a=a.toLowerCase()),b&&(b=b.toLowerCase());var c=j(b||a);if(c){if(a==c.tag&&b==c.is)return new c.ctor;if(!b&&!c.is)return new c.ctor}var d;return b?(d=n(a),d.setAttribute("is",b),d):(d=y(a),a.indexOf("-")>=0&&t(d,HTMLElement),d)}function o(a,b){var c=a[b];a[b]=function(){var a=c.apply(this,arguments);return r(a),a}}var p,q=(a.isIE,a.upgradeDocumentTree),r=a.upgradeAll,s=a.upgradeWithDefinition,t=a.implementPrototype,u=a.useNative,v=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],w={},x="http://www.w3.org/1999/xhtml",y=document.createElement.bind(document),z=document.createElementNS.bind(document);p=Object.__proto__||u?function(a,b){return a instanceof b}:function(a,b){if(a instanceof b)return!0;for(var c=a;c;){if(c===b.prototype)return!0;c=c.__proto__}return!1},o(Node.prototype,"cloneNode"),o(document,"importNode"),document.registerElement=b,document.createElement=n,document.createElementNS=m,a.registry=w,a.instanceof=p,a.reservedTagList=v,a.getRegisteredDefinition=j,document.register=document.registerElement}),function(a){function b(){f(window.wrap(document)),window.CustomElements.ready=!0,(window.requestAnimationFrame||function(a){setTimeout(a,16)})(function(){setTimeout(function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))})})}var c=a.useNative,d=a.initializeModules;a.isIE;if(c){var e=function(){};a.watchShadow=e,a.upgrade=e,a.upgradeAll=e,a.upgradeDocumentTree=e,a.upgradeSubtree=e,a.takeRecords=e,a.instanceof=function(a,b){return a instanceof b}}else d();var f=a.upgradeDocumentTree,g=a.upgradeDocument;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(a){return a}),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(a){a.import&&g(wrap(a.import))}),"complete"===document.readyState||a.flags.eager)b();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var h=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(h,b)}else b()}(window.CustomElements),function(a){var b=document.createElement("style");b.textContent="body {transition: opacity ease-in 0.2s; } \nbody[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } \n";var c=document.querySelector("head");c.insertBefore(b,c.firstChild)}(window.WebComponents)},{}]},{},[41])(41)});

const layerAppId = '/* @echo LAYER_APP_ID */';
const identityProviderUrl = '/* @echo IDENTITY_PROVIDER_URL */';

window.layerUI.init({
  appId: layerAppId
});

window.layerUI.adapters.angular(angular);

angular.module(
  'am-communications', [
    'loginUtils',
    'layerUIControllers'
  ]
);

angular.module('am-communications').config([
  function () {}
]);

angular.module('am-communications').factory('identityService', function() {
  const identityData = {
    layerAppId,
    identityProviderUrl: `${identityProviderUrl}/authenticate`,
    validateSetup(client) {
      const conversationQuery = client.createQuery({
        paginationWindow: 1,
        model: window.layer.Query.Conversation
      });
      conversationQuery.on('change:data', function() {
        console.log('conversationQuery: ', conversationQuery.data);
        if (conversationQuery.data.length === 0) {
          const identityQuery = client.createQuery({
            paginationWindow: 5,
            model: window.layer.Query.Identity
          });
          identityQuery.on('change:data', function() {
            if (identityQuery.data.length === 0) {
              alert('There are no other users to talk to');
            } else {
              const conversation = client.createConversation({
                participants: identityQuery.data.map(function(user) {
                  return user.id;
                }),
                metadata: {
                  conversationName: 'Sample Conversation'
                }
              });
              conversation.createMessage('Welcome to the new Conversation').send();
            }
          });
        }
      });
    },
    getIdentityToken(nonce, callback) {
      window.layer.xhr({
        url: identityData.identityProviderUrl,
        headers: {
          'Content-type': 'application/json',
          Accept: 'application/json'
        },
        method: 'POST',
        data: {
          nonce,
          email: 'pablo@example.com',
          password: '12345678'
        }
      }, function(res) {
        if (res.success && res.data.identity_token) {
          console.log('challenge: ok');
          callback(res.data.identity_token);
        } else {
          alert('Login failed; please check your user id and password');
        }
      });
    },
    onLogin(callback) {
      this.loginCallback = callback;
    }
  };
  return identityData;
});

angular.module('am-communications').factory('amcService', [
  function() {
    return {
      openConversationWith(otherUser) {
        console.log('Opening conversation with: ', otherUser);
      },
      getUsersStatus(userIds) {
        console.log('getUsersStatus for: ', userIds);
        return userIds.map((id) => ({ id, status: 'online' }));
      }
    };
  }
]);

angular.module('am-communications').factory('layerService', ['identityService', function(identityService) {
  const client = new window.layer.Client({
    appId: layerAppId
  });

  client.on('challenge', function(evt) {
    identityService.getIdentityToken(evt.nonce, evt.callback);
  });

  identityService.validateSetup(client);

  identityService.onLogin(function() {
    /**
     * Start authentication
     */
    client.connect();
  });
  identityService.loginCallback();

  return client;
}]);

angular
    .module('am-communications')
    .directive('amcWidget', function() {
      return {
        restrict: 'E',
        template:
          `<layer-conversations-list selected-id={selectedConversation.id} />
           <layer-conversation-panel conversation-id="layer:///conversations/9c9fb01c-3cc5-4bf3-bbff-a5332eb19013" />`,
        scope: {},
        controller: [function() {}]
      };
    });
